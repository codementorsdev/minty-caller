{"version":3,"file":"connectycube.min.js","sources":["../src/platform.ts","../src/types/config.ts","../src/config.ts","../node_modules/tslib/tslib.es6.js","../src/Utils.ts","../src/types/proxy.ts","../src/AddressBook.ts","../src/Auth.ts","../node_modules/@xmpp/events/lib/TimeoutError.js","../node_modules/@xmpp/events/lib/delay.js","../node_modules/@xmpp/events/lib/timeout.js","../node_modules/@xmpp/events/lib/promise.js","../node_modules/eventemitter3/index.js","../node_modules/@xmpp/events/lib/Deferred.js","../node_modules/@xmpp/events/index.js","../node_modules/@xmpp/jid/lib/escaping.js","../node_modules/@xmpp/jid/lib/JID.js","../node_modules/@xmpp/jid/index.js","../node_modules/@xmpp/jid/lib/parse.js","../node_modules/ltx/lib/escape.js","../node_modules/ltx/lib/Element.js","../node_modules/@xmpp/xml/lib/XMLError.js","../node_modules/@xmpp/xml/lib/Parser.js","../node_modules/ltx/lib/parsers/ltx.js","../node_modules/@xmpp/xml/index.js","../node_modules/ltx/lib/createElement.js","../node_modules/@xmpp/error/index.js","../node_modules/@xmpp/connection/index.js","../node_modules/@xmpp/connection/lib/StreamError.js","../node_modules/@xmpp/connection/lib/util.js","../node_modules/@xmpp/client-core/index.js","../node_modules/@xmpp/client-core/lib/Client.js","../node_modules/@xmpp/reconnect/index.js","../node_modules/ws/lib/constants.js","../node_modules/ws/lib/buffer-util.js","../node_modules/ws/lib/permessage-deflate.js","../node_modules/ws/lib/limiter.js","../node_modules/ws/lib/validation.js","../node_modules/ws/lib/receiver.js","../node_modules/ws/lib/sender.js","../node_modules/ws/lib/extension.js","../node_modules/ws/lib/websocket.js","../node_modules/ws/lib/event-target.js","../node_modules/ws/lib/subprotocol.js","../node_modules/ws/lib/websocket-server.js","../node_modules/ws/index.js","../node_modules/ws/lib/stream.js","../node_modules/@xmpp/websocket/lib/Connection.js","../node_modules/@xmpp/websocket/lib/Socket.js","../node_modules/@xmpp/websocket/lib/FramedParser.js","../node_modules/@xmpp/websocket/index.js","../node_modules/@xmpp/middleware/lib/Context.js","../node_modules/@xmpp/middleware/index.js","../node_modules/koa-compose/index.js","../node_modules/@xmpp/middleware/lib/IncomingContext.js","../node_modules/@xmpp/middleware/lib/OutgoingContext.js","../node_modules/@xmpp/stream-features/route.js","../node_modules/@xmpp/stream-features/index.js","../node_modules/@xmpp/iq/caller.js","../node_modules/@xmpp/id/index.js","../node_modules/@xmpp/middleware/lib/StanzaError.js","../node_modules/@xmpp/iq/callee.js","../node_modules/@xmpp/resolve/lib/dns.js","../node_modules/@xmpp/xml/lib/parse.js","../node_modules/@xmpp/resolve/lib/http.js","../node_modules/@xmpp/resolve/lib/alt-connections.js","../node_modules/@xmpp/resolve/resolve.js","../node_modules/@xmpp/resolve/index.js","../node_modules/@xmpp/base64/index.js","../node_modules/base-64/base64.js","../node_modules/saslmechanisms/main.js","../node_modules/saslmechanisms/lib/factory.js","../node_modules/@xmpp/sasl/index.js","../node_modules/@xmpp/sasl/lib/SASLError.js","../node_modules/@xmpp/resource-binding/index.js","../node_modules/@xmpp/session-establishment/index.js","../node_modules/sasl-anonymous/main.js","../node_modules/sasl-anonymous/lib/mechanism.js","../node_modules/@xmpp/sasl-anonymous/index.js","../node_modules/sasl-plain/main.js","../node_modules/sasl-plain/lib/mechanism.js","../node_modules/@xmpp/sasl-plain/index.js","../src/messaging/xmpp.ts","../src/types/chat.ts","../src/messaging/Dialogs.ts","../src/messaging/Messages.ts","../src/messaging/ChatUtils.ts","../src/messaging/Helpers.ts","../src/messaging/StreamManagement.ts","../src/messaging/ContactList.ts","../src/messaging/PrivacyList.ts","../src/messaging/MultiUserChat.ts","../src/messaging/Chat.ts","../src/types/janus.ts","../src/videocalling_conference/janus.js","../src/videocalling_conference/JanusClient.ts","../src/types/calls.ts","../src/videocalling_conference/ConferenceSession.ts","../src/videocalling_conference/ConferenceClient.ts","../src/Data.ts","../src/Meetings.ts","../src/Proxy.ts","../src/PushNotifications.ts","../src/Storage.ts","../src/Users.ts","../src/videocalling/WebRTCHelpers.ts","../src/videocalling/WebRTCPeerConnection.ts","../src/videocalling/WebRTCSession.ts","../src/videocalling/WebRTCSignalingProcessor.ts","../src/videocalling/WebRTCSignalingProvider.ts","../src/videocalling/WebRTCClient.ts","../src/Whiteboard.ts","../src/index.ts"],"sourcesContent":["declare global {\n  interface Window {\n    adapter: any;\n  }\n}\n\nexport const base64Encode = (str: string): string =>\n  isBrowser\n    ? btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, (_, p1) => String.fromCharCode(parseInt(p1, 16))))\n    : Buffer.from(str).toString('base64');\n\nexport const isBrowser: boolean = typeof window === 'object' && typeof document === 'object';\nexport const isNodeJS: boolean =\n  typeof process === 'object' && typeof process.versions === 'object' && !!process.versions.node;\nexport const isReactNative: boolean = false;\nexport const isExpo: boolean = false;\n\nexport const fetchImpl = isNodeJS ? require('node-fetch') : fetch;\nexport const formDataImpl = isNodeJS ? require('form-data') : FormData;\n\nexport const navigator = isBrowser ? window.navigator : undefined;\nexport const mediaDevices = isBrowser && navigator ? navigator.mediaDevices : undefined;\nexport const MediaStream = isBrowser ? window.MediaStream : undefined;\nexport const MediaStreamTrack = isBrowser ? window.MediaStreamTrack : undefined;\nexport const RTCIceCandidate = isBrowser ? window.RTCIceCandidate : undefined;\nexport const RTCPeerConnection = isBrowser ? window.RTCPeerConnection : undefined;\nexport const RTCRtpReceiver = isBrowser ? window.RTCRtpReceiver : undefined;\nexport const RTCRtpSender = isBrowser ? window.RTCRtpSender : undefined;\nexport const RTCSessionDescription = isBrowser ? window.RTCSessionDescription : undefined;\n\nexport const isWebRTCAvailable: boolean = isBrowser ? Boolean(mediaDevices && window?.RTCPeerConnection) : false;\n\nexport const adapter = isBrowser ? window.adapter : undefined;\n","import { Config } from '../config';\n\nexport enum ChatProtocol {\n  BOSH = 1,\n  WS = 2,\n}\nexport enum JanusDebugMode {\n  ALL = 'all',\n  TRACE = 'trace',\n  DEBUG = 'debug',\n  VDEBUG = 'vdebug',\n  LOG = 'log',\n  WARN = 'warn',\n  ERROR = 'error',\n}\n\nexport namespace ConnectyCubeConfig {\n  export type Object = Partial<Config>;\n  export type Credentials = {\n    appId: number | string;\n    authKey?: string;\n    token?: string;\n    systemApiKey?: string;\n    authSecret?: string;\n  };\n  export type Endpoints = { api: string; chat: string; muc?: string };\n  export type ChatProtocolURLs = { bosh?: string; websocket?: string; active: ChatProtocol | number };\n  export type ChatContactList = { subscriptionMode: { mutual: boolean } };\n  export type ChatStreamManagement = { enable: boolean };\n  export type ChatPing = { enable: boolean; timeInterval: number };\n  export type ChatReconnect = { enable: boolean; timeInterval: number };\n  export type Chat = {\n    contactList?: ChatContactList;\n    streamManagement?: ChatStreamManagement;\n    ping: ChatPing;\n    reconnect: ChatReconnect;\n  };\n  export type VideochatIceServer = {\n    urls: string | string[];\n    url?: string;\n    credential?: string;\n    username?: string;\n  };\n  export type Videochat = {\n    alwaysRelayCalls: boolean;\n    answerTimeInterval: number;\n    dialingTimeInterval: number;\n    disconnectTimeInterval: number;\n    statsReportTimeInterval: number;\n    iceServers: VideochatIceServer[];\n  };\n  export type JanusDebug = JanusDebugMode.ALL | JanusDebugMode[] | boolean;\n  export type Conference = {\n    server: string;\n    debug?: JanusDebug;\n  };\n  export type Whiteboard = {\n    server: string;\n  };\n  export type ApiRoutes = {\n    session: string;\n    login: string;\n    users: string;\n    chat: string;\n    blobs: string;\n    subscriptions: string;\n    events: string;\n    data: string;\n    addressbook: string;\n    meetings: string;\n    whiteboards: string;\n    calls: string;\n    type: string;\n  };\n  export type SessionHandlerResponse = () => void;\n  export type SessionRetryCallback = (session: any) => void;\n  export type SessionExpiredListener = (handler: SessionHandlerResponse, retry: SessionRetryCallback) => void;\n  export type XMPPDataListener = (size: number) => number;\n  export type Listeners = {\n    sessionExpired?: SessionExpiredListener;\n    xmppDataWrite?: XMPPDataListener;\n    xmppDataRead?: XMPPDataListener;\n  };\n  export type Debug = { mode: number | boolean };\n  export type Options = {\n    creds?: Credentials;\n    endpoints?: Endpoints;\n    chatProtocol?: ChatProtocolURLs;\n    chat?: Chat;\n    videochat?: Videochat;\n    conference?: Conference;\n    whiteboard?: Whiteboard;\n    on?: Listeners;\n    timeout?: number;\n    debug?: Debug;\n  };\n}\n","import { JanusDebugMode, ConnectyCubeConfig } from './types/config';\n\nexport class Config {\n  private static instance: Config;\n\n  public version: string = '4.0.0';\n  public creds: ConnectyCubeConfig.Credentials = { appId: '', authKey: '' };\n  public endpoints: ConnectyCubeConfig.Endpoints = {\n    api: 'api.connectycube.com',\n    chat: 'chat.connectycube.com',\n    muc: 'muc.chat.connectycube.com',\n  };\n  public chatProtocol: ConnectyCubeConfig.ChatProtocolURLs = {\n    bosh: 'https://chat.connectycube.com:5281',\n    websocket: 'wss://chat.connectycube.com:5291',\n    active: 2,\n  };\n  public chat: ConnectyCubeConfig.Chat = {\n    contactList: { subscriptionMode: { mutual: true } },\n    streamManagement: { enable: false },\n    ping: { enable: false, timeInterval: 60 },\n    reconnect: { enable: true, timeInterval: 5 },\n  };\n  public videochat: ConnectyCubeConfig.Videochat = {\n    alwaysRelayCalls: false,\n    answerTimeInterval: 60,\n    dialingTimeInterval: 5,\n    disconnectTimeInterval: 30,\n    statsReportTimeInterval: null,\n    iceServers: [\n      { urls: 'stun:stun.l.google.com:19302' },\n      { urls: 'stun:turn.connectycube.com' },\n      {\n        urls: 'turn:turn.connectycube.com:5349?transport=udp',\n        username: 'connectycube',\n        credential: '4c29501ca9207b7fb9c4b4b6b04faeb1',\n      },\n      {\n        urls: 'turn:turn.connectycube.com:5349?transport=tcp',\n        username: 'connectycube',\n        credential: '4c29501ca9207b7fb9c4b4b6b04faeb1',\n      },\n    ],\n  };\n  public conference: ConnectyCubeConfig.Conference = {\n    server: 'wss://janus.connectycube.com:8989',\n    debug: JanusDebugMode.ALL,\n  };\n  public whiteboard: ConnectyCubeConfig.Whiteboard = { server: 'https://whiteboard.connectycube.com' };\n  readonly urls: ConnectyCubeConfig.ApiRoutes = {\n    session: 'session',\n    login: 'login',\n    users: 'users',\n    chat: 'chat',\n    blobs: 'blobs',\n    subscriptions: 'subscriptions',\n    events: 'events',\n    data: 'data',\n    addressbook: 'address_book',\n    meetings: 'meetings',\n    whiteboards: 'whiteboards',\n    calls: 'calls',\n    type: '.json',\n  };\n  public on: ConnectyCubeConfig.Listeners = {\n    sessionExpired: undefined,\n    xmppDataWrite: undefined,\n    xmppDataRead: undefined,\n  };\n  public timeout: number | null = null;\n  public debug: ConnectyCubeConfig.Debug = { mode: 1 };\n\n  private constructor() {}\n\n  public static getInstance(): Config {\n    if (!Config.instance) {\n      Config.instance = new Config();\n    }\n    return Config.instance;\n  }\n\n  public set(options: ConnectyCubeConfig.Options): void {\n    if (options.endpoints && options.endpoints.chat) {\n      this.endpoints.muc = `muc.${options.endpoints.chat}`;\n      this.chatProtocol.bosh = `https://${options.endpoints.chat}:5281`;\n      this.chatProtocol.websocket = `wss://${options.endpoints.chat}:5291`;\n    }\n\n    Object.keys(options).forEach((key) => {\n      if (key !== 'set' && this.hasOwnProperty(key)) {\n        const optionValue = options[key];\n\n        if (typeof optionValue !== 'object') {\n          this[key] = optionValue;\n        } else {\n          Object.keys(optionValue).forEach((nextKey) => {\n            if (this[key]?.hasOwnProperty(nextKey)) {\n              this[key][nextKey] = optionValue[nextKey];\n            }\n          });\n        }\n      }\n    });\n  }\n}\n\nexport default Config.getInstance();\n","/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.unshift(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.unshift(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\r\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\r\n    function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nvar ownKeys = function(o) {\r\n    ownKeys = Object.getOwnPropertyNames || function (o) {\r\n        var ar = [];\r\n        for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\r\n        return ar;\r\n    };\r\n    return ownKeys(o);\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n\r\nexport function __addDisposableResource(env, value, async) {\r\n    if (value !== null && value !== void 0) {\r\n        if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\r\n        var dispose, inner;\r\n        if (async) {\r\n            if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\r\n            dispose = value[Symbol.asyncDispose];\r\n        }\r\n        if (dispose === void 0) {\r\n            if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\r\n            dispose = value[Symbol.dispose];\r\n            if (async) inner = dispose;\r\n        }\r\n        if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\r\n        if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\r\n        env.stack.push({ value: value, dispose: dispose, async: async });\r\n    }\r\n    else if (async) {\r\n        env.stack.push({ async: true });\r\n    }\r\n    return value;\r\n\r\n}\r\n\r\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\r\n\r\nexport function __disposeResources(env) {\r\n    function fail(e) {\r\n        env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\r\n        env.hasError = true;\r\n    }\r\n    var r, s = 0;\r\n    function next() {\r\n        while (r = env.stack.pop()) {\r\n            try {\r\n                if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\r\n                if (r.dispose) {\r\n                    var result = r.dispose.call(r.value);\r\n                    if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\r\n                }\r\n                else s |= 1;\r\n            }\r\n            catch (e) {\r\n                fail(e);\r\n            }\r\n        }\r\n        if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\r\n        if (env.hasError) throw env.error;\r\n    }\r\n    return next();\r\n}\r\n\r\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\r\n    if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\r\n        return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\r\n            return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\r\n        });\r\n    }\r\n    return path;\r\n}\r\n\r\nexport default {\r\n    __extends: __extends,\r\n    __assign: __assign,\r\n    __rest: __rest,\r\n    __decorate: __decorate,\r\n    __param: __param,\r\n    __esDecorate: __esDecorate,\r\n    __runInitializers: __runInitializers,\r\n    __propKey: __propKey,\r\n    __setFunctionName: __setFunctionName,\r\n    __metadata: __metadata,\r\n    __awaiter: __awaiter,\r\n    __generator: __generator,\r\n    __createBinding: __createBinding,\r\n    __exportStar: __exportStar,\r\n    __values: __values,\r\n    __read: __read,\r\n    __spread: __spread,\r\n    __spreadArrays: __spreadArrays,\r\n    __spreadArray: __spreadArray,\r\n    __await: __await,\r\n    __asyncGenerator: __asyncGenerator,\r\n    __asyncDelegator: __asyncDelegator,\r\n    __asyncValues: __asyncValues,\r\n    __makeTemplateObject: __makeTemplateObject,\r\n    __importStar: __importStar,\r\n    __importDefault: __importDefault,\r\n    __classPrivateFieldGet: __classPrivateFieldGet,\r\n    __classPrivateFieldSet: __classPrivateFieldSet,\r\n    __classPrivateFieldIn: __classPrivateFieldIn,\r\n    __addDisposableResource: __addDisposableResource,\r\n    __disposeResources: __disposeResources,\r\n    __rewriteRelativeImportExtension: __rewriteRelativeImportExtension,\r\n};\r\n","import { isBrowser, isExpo, isNodeJS, isReactNative } from './platform';\nimport config from './config';\nimport { Config } from './types';\n\nexport default class Utils {\n  static loggers: Array<(args: any[]) => void> = [];\n\n  static env = {\n    isReactNative,\n    isBrowser,\n    isNodeJS,\n    isExpo,\n  };\n\n  static safeCallbackCall(cb: (...args: any[]) => void = () => {}): (...args: any[]) => void {\n    return (...args: any[]) => {\n      if (typeof cb === 'function') {\n        try {\n          cb(...args);\n        } catch (err) {\n          console.error('Error in listener:', err, `Check the code:\\n>>>\\n${cb.toString()}\\n<<<`);\n        }\n      }\n    };\n  }\n\n  static getUrl(base: Config.ApiRoutes[keyof Config.ApiRoutes], res?: string | number, ext?: string | number): string {\n    const resource = res ? `/${res}` : '';\n    const extension = ext ? `/${ext}` : '';\n    return `https://${config.endpoints.api}/${base}${resource}${extension}${config.urls.type}`;\n  }\n\n  static isArray(arg: any): arg is any[] {\n    return Array.isArray(arg);\n  }\n\n  static isObject(obj: any): boolean {\n    return Object.prototype.toString.call(obj) === '[object Object]';\n  }\n\n  static getBsonObjectId(): string {\n    // The object for type MongoDB.Bson.ObjectId\n    // http://docs.mongodb.org/manual/reference/object-id/\n    const ObjectId = {\n      machine: Math.floor(Math.random() * 16777216).toString(16),\n      pid: Math.floor(Math.random() * 32767).toString(16),\n      increment: 0,\n    };\n    const timestamp = Math.floor(Date.now() / 1000).toString(16);\n    const increment = (ObjectId.increment++).toString(16);\n\n    if (parseInt(increment, 16) > 0xffffff) {\n      ObjectId.increment = 0;\n    }\n\n    return (\n      timestamp.padStart(8, '0') +\n      ObjectId.machine.padStart(6, '0') +\n      ObjectId.pid.padStart(4, '0') +\n      increment.padStart(6, '0')\n    );\n  }\n\n  static DLog(...args: any[]): void {\n    if (Utils.loggers.length > 0) {\n      Utils.loggers.forEach((logger) => logger(args));\n      return;\n    }\n\n    const consoleLoggerFunction = () => {\n      return (args: any[]) => {\n        console.log(...args);\n      };\n    };\n\n    if (typeof config.debug === 'object') {\n      const modes = Array.isArray(config.debug.mode) ? config.debug.mode : [config.debug.mode];\n      modes.forEach((mode) => {\n        if (mode === 1) {\n          Utils.loggers.push(consoleLoggerFunction());\n        }\n      });\n    }\n\n    Utils.loggers.forEach((logger) => logger(args));\n  }\n\n  static mergeArrays<T extends { user_id: any }>(arrayTo: T[], arrayFrom: T[]): T[] {\n    const merged = Utils.cloneObject(arrayTo);\n\n    for (const newItem of arrayFrom) {\n      const existingItem = merged.find((item) => item.user_id === newItem.user_id);\n      if (existingItem) {\n        Object.assign(existingItem, newItem);\n      } else {\n        merged.push(newItem);\n      }\n    }\n    return merged;\n  }\n\n  static toBase64(str: string): string {\n    if (isBrowser) {\n      return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, (_, p1) => String.fromCharCode(parseInt(p1, 16))));\n    } else if (isReactNative) {\n      return global.encodeToBase64(str);\n    } else {\n      return Buffer.from(str).toString('base64');\n    }\n  }\n\n  static callTrafficUsageCallback(callbackName: 'xmppDataRead' | 'xmppDataWrite', data: any): void {\n    if (typeof config.on[callbackName] === 'function') {\n      const getStringSize = (str: string): number => new Blob([str]).size;\n      const getDataSize = (data: any = {}): number => {\n        const { body: b, headers: h } = data;\n        let size = 0;\n        if (b) {\n          size += getStringSize(typeof b === 'string' ? b : JSON.stringify(b));\n        }\n        if (h) {\n          size += getStringSize(JSON.stringify(h));\n        }\n        return size;\n      };\n\n      config.on[callbackName](getDataSize(data));\n    }\n  }\n\n  static cloneObject<T>(obj: T = {} as T, escapeNull: boolean = false): T {\n    try {\n      const json = JSON.stringify(obj);\n      const jsonObject = escapeNull ? json.replace(/null/g, '\"\"') : json;\n\n      return JSON.parse(jsonObject);\n    } catch {\n      return obj;\n    }\n  }\n}\n","import { ConnectyCubeConfig } from './config';\nimport { ConnectyCubeAuth } from './auth';\n\nexport enum ProxyMethod {\n  GET = 'GET',\n  POST = 'POST',\n  PUT = 'PUT',\n  PATCH = 'PATCH',\n  DELETE = 'DELETE',\n  HEAD = 'HEAD',\n}\nexport enum ProxyType {\n  JSON = 'json',\n  TEXT = 'text',\n}\nexport namespace ConnectyCubeProxy {\n  export type Params = {\n    url: string;\n    type?: ProxyMethod;\n    data?: any;\n    contentType?: boolean;\n    dataType?: ProxyType;\n    useArrayQuery?: boolean;\n    fileToCustomObject?: boolean;\n    authKey?: string;\n    abort_id?: string | number;\n  };\n  export type AbortControllersMap = {\n    [key: string | number]: {\n      controllers: AbortController[];\n      doneRequestsCount?: number;\n    };\n  };\n  export type SDKInstance = {\n    config: ConnectyCubeConfig.Object;\n    session: Partial<ConnectyCubeAuth.Session> | null;\n  };\n}\n","import ProxyService from './Proxy';\nimport Utils from './Utils';\nimport config from './config';\nimport { AddressBook } from './types';\nimport { ProxyMethod } from './types/proxy';\n\nexport default class AddressBookService {\n  public proxy: ProxyService;\n  readonly route = config.urls.addressbook;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async uploadAddressBook(\n    list: AddressBook.Contact[] = [],\n    params: AddressBook.UploadParams = {}\n  ): Promise<AddressBook.UploadResponse> {\n    if (!Utils.isArray(list)) {\n      throw new Error('First parameter must be an Array.');\n    }\n\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: { contacts: list, ...params },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async get(udid?: string): Promise<AddressBook.Contact[]> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route),\n      data: udid ? { udid } : undefined,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getRegisteredUsers(\n    params: AddressBook.GetRegisteredUsersParams = false\n  ): Promise<AddressBook.GetRegisteredUsersResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, 'registered_users'),\n      data: typeof params === 'boolean' ? { compact: params ? 1 : 0 } : params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n","import ProxyService from './Proxy';\nimport Utils from './Utils';\nimport config from './config';\nimport { Auth, Users } from './types';\nimport { ProxyMethod, ProxyType } from './types/proxy';\nimport { EmptyParams, EmptyResponse } from './types/common';\n\nexport default class AuthService {\n  public proxy: ProxyService;\n  readonly routes = {\n    session: config.urls.session,\n    login: config.urls.login,\n  };\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public setSession = (session: Auth.Session): void => {\n    this.proxy.setSession(session);\n  };\n\n  public getSession = async (): Promise<Auth.Session> => {\n    try {\n      const ajaxParams = {\n        type: ProxyMethod.GET,\n        url: Utils.getUrl(this.routes.session),\n      };\n      const response = await this.proxy.ajax<Auth.GetSessionRawResponse>(ajaxParams);\n      return response.session;\n    } catch (error) {\n      throw error;\n    }\n  };\n\n  public createSession = async (params: Auth.LoginParams | EmptyParams = {}): Promise<Auth.Session> => {\n    if (config.creds.appId === '' || config.creds.authKey === '') {\n      throw new Error('Cannot create a new session without \"appId\" and \"authKey\"');\n    }\n\n    try {\n      const ajaxParams = {\n        type: ProxyMethod.POST,\n        url: Utils.getUrl(this.routes.session),\n        data: this.generateCreateSessionParams(params),\n      };\n      const response = await this.proxy.ajax<Auth.GetSessionRawResponse>(ajaxParams);\n      this.proxy.setSession(response.session);\n      this.proxy.setCurrentUserId(response.session.user_id);\n      return response.session;\n    } catch (error) {\n      throw error;\n    }\n  };\n\n  public destroySession = async (): Promise<EmptyResponse> => {\n    try {\n      const ajaxParams = {\n        type: ProxyMethod.DELETE,\n        url: Utils.getUrl(this.routes.session),\n        dataType: ProxyType.TEXT,\n      };\n      await this.proxy.ajax(ajaxParams);\n      this.proxy.setSession(null);\n      this.proxy.setCurrentUserId(null);\n    } catch (error) {\n      throw error;\n    }\n  };\n\n  public login = async (params: Auth.LoginParams): Promise<Users.User> => {\n    try {\n      const ajaxParams = {\n        type: ProxyMethod.POST,\n        url: Utils.getUrl(this.routes.login),\n        data: params,\n      };\n      const { user } = await this.proxy.ajax<Auth.LoginRawResponse>(ajaxParams);\n      this.proxy.setCurrentUserId(user.id);\n      return user;\n    } catch (error) {\n      throw error;\n    }\n  };\n\n  public logout = async (): Promise<EmptyResponse> => {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.routes.login),\n      dataType: ProxyType.TEXT,\n    };\n    this.proxy.setCurrentUserId(null);\n    return this.proxy.ajax(ajaxParams);\n  };\n\n  private generateCreateSessionParams(params: Auth.LoginParams | EmptyParams = {}): Auth.GeneratedSessionParams {\n    const message: any = {\n      application_id: config.creds.appId,\n      auth_key: config.creds.authKey,\n    };\n\n    if ('guest' in params) {\n      message.user = params;\n    } else if ('login' in params && 'password' in params) {\n      message.user = { login: params.login, password: params.password };\n    } else if ('email' in params && 'password' in params) {\n      message.user = { email: params.email, password: params.password };\n    } else if ('provider' in params) {\n      message.provider = params.provider;\n      if ('keys' in params) {\n        message.keys = params.keys;\n      }\n      if ('firebase_phone' in params) {\n        message.firebase_phone = params.firebase_phone;\n      }\n      if ('firebase_email' in params) {\n        message.firebase_email = params.firebase_email;\n      }\n    }\n\n    return message;\n  }\n}\n","\"use strict\";\n\nmodule.exports = class TimeoutError extends Error {\n  constructor(message) {\n    super(message);\n    this.name = \"TimeoutError\";\n  }\n};\n","\"use strict\";\n\nmodule.exports = function delay(ms) {\n  let timeout;\n  const promise = new Promise((resolve) => {\n    timeout = setTimeout(resolve, ms);\n  });\n  promise.timeout = timeout;\n  return promise;\n};\n","\"use strict\";\n\nconst TimeoutError = require(\"./TimeoutError\");\nconst delay = require(\"./delay\");\n\nmodule.exports = function timeout(promise, ms) {\n  const promiseDelay = delay(ms);\n\n  function cancelDelay() {\n    clearTimeout(promiseDelay.timeout);\n  }\n\n  return Promise.race([\n    promise.finally(cancelDelay),\n    promiseDelay.then(() => {\n      throw new TimeoutError();\n    }),\n  ]);\n};\n","\"use strict\";\n\nconst TimeoutError = require(\"./TimeoutError\");\n\nmodule.exports = function promise(EE, event, rejectEvent = \"error\", timeout) {\n  return new Promise((resolve, reject) => {\n    let timeoutId;\n\n    const cleanup = () => {\n      clearTimeout(timeoutId);\n      EE.removeListener(event, onEvent);\n      EE.removeListener(rejectEvent, onError);\n    };\n\n    function onError(reason) {\n      reject(reason);\n      cleanup();\n    }\n\n    function onEvent(value) {\n      resolve(value);\n      cleanup();\n    }\n\n    EE.once(event, onEvent);\n    if (rejectEvent) {\n      EE.once(rejectEvent, onError);\n    }\n\n    if (timeout) {\n      timeoutId = setTimeout(() => {\n        cleanup();\n        reject(new TimeoutError());\n      }, timeout);\n    }\n  });\n};\n","'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","\"use strict\";\n\nmodule.exports = function Deferred() {\n  this.promise = new Promise((resolve, reject) => {\n    this.resolve = resolve;\n    this.reject = reject;\n  });\n};\n","\"use strict\";\n\nconst timeout = require(\"./lib/timeout\");\nconst delay = require(\"./lib/delay\");\nconst TimeoutError = require(\"./lib/TimeoutError\");\nconst promise = require(\"./lib/promise\");\nconst EventEmitter = require(\"events\");\nconst Deferred = require(\"./lib/Deferred\");\n\nexports.EventEmitter = EventEmitter;\nexports.timeout = timeout;\nexports.delay = delay;\nexports.TimeoutError = TimeoutError;\nexports.promise = promise;\nexports.Deferred = Deferred;\n","\"use strict\";\n\nmodule.exports.detect = function detect(local) {\n  if (!local) {\n    return false;\n  }\n\n  // Remove all escaped sequences\n  const tmp = local\n    .replace(/\\\\20/g, \"\")\n    .replace(/\\\\22/g, \"\")\n    .replace(/\\\\26/g, \"\")\n    .replace(/\\\\27/g, \"\")\n    .replace(/\\\\2f/g, \"\")\n    .replace(/\\\\3a/g, \"\")\n    .replace(/\\\\3c/g, \"\")\n    .replace(/\\\\3e/g, \"\")\n    .replace(/\\\\40/g, \"\")\n    .replace(/\\\\5c/g, \"\");\n\n  // Detect if we have unescaped sequences\n  const search = tmp.search(/[ \"&'/:<>@\\\\]/g);\n  if (search === -1) {\n    return false;\n  }\n\n  return true;\n};\n\n/**\n * Escape the local part of a JID.\n *\n * @see http://xmpp.org/extensions/xep-0106.html\n * @param String local local part of a jid\n * @return An escaped local part\n */\nmodule.exports.escape = function escape(local) {\n  if (local === null) {\n    return null;\n  }\n\n  return local\n    .replace(/^\\s+|\\s+$/g, \"\")\n    .replace(/\\\\/g, \"\\\\5c\")\n    .replace(/ /g, \"\\\\20\")\n    .replace(/\"/g, \"\\\\22\")\n    .replace(/&/g, \"\\\\26\")\n    .replace(/'/g, \"\\\\27\")\n    .replace(/\\//g, \"\\\\2f\")\n    .replace(/:/g, \"\\\\3a\")\n    .replace(/</g, \"\\\\3c\")\n    .replace(/>/g, \"\\\\3e\")\n    .replace(/@/g, \"\\\\40\");\n};\n\n/**\n * Unescape a local part of a JID.\n *\n * @see http://xmpp.org/extensions/xep-0106.html\n * @param String local local part of a jid\n * @return unescaped local part\n */\nmodule.exports.unescape = function unescape(local) {\n  if (local === null) {\n    return null;\n  }\n\n  return local\n    .replace(/\\\\20/g, \" \")\n    .replace(/\\\\22/g, '\"')\n    .replace(/\\\\26/g, \"&\")\n    .replace(/\\\\27/g, \"'\")\n    .replace(/\\\\2f/g, \"/\")\n    .replace(/\\\\3a/g, \":\")\n    .replace(/\\\\3c/g, \"<\")\n    .replace(/\\\\3e/g, \">\")\n    .replace(/\\\\40/g, \"@\")\n    .replace(/\\\\5c/g, \"\\\\\");\n};\n","\"use strict\";\n\nconst escaping = require(\"./escaping\");\n\n/**\n * JID implements\n * - XMPP addresses according to RFC6122\n * - XEP-0106: JID Escaping\n *\n * @see http://tools.ietf.org/html/rfc6122#section-2\n * @see http://xmpp.org/extensions/xep-0106.html\n */\nclass JID {\n  constructor(local, domain, resource) {\n    if (typeof domain !== \"string\" || !domain) {\n      throw new TypeError(`Invalid domain.`);\n    }\n\n    this.setDomain(domain);\n    this.setLocal(typeof local === \"string\" ? local : \"\");\n    this.setResource(typeof resource === \"string\" ? resource : \"\");\n  }\n\n  [Symbol.toPrimitive](hint) {\n    if (hint === \"number\") {\n      return NaN;\n    }\n\n    return this.toString();\n  }\n\n  toString(unescape) {\n    let s = this._domain;\n    if (this._local) {\n      s = this.getLocal(unescape) + \"@\" + s;\n    }\n\n    if (this._resource) {\n      s = s + \"/\" + this._resource;\n    }\n\n    return s;\n  }\n\n  /**\n   * Convenience method to distinguish users\n   * */\n  bare() {\n    if (this._resource) {\n      return new JID(this._local, this._domain, null);\n    }\n\n    return this;\n  }\n\n  /**\n   * Comparison function\n   * */\n  equals(other) {\n    return (\n      this._local === other._local &&\n      this._domain === other._domain &&\n      this._resource === other._resource\n    );\n  }\n\n  /**\n   * http://xmpp.org/rfcs/rfc6122.html#addressing-localpart\n   * */\n  setLocal(local, escape) {\n    escape = escape || escaping.detect(local);\n\n    if (escape) {\n      local = escaping.escape(local);\n    }\n\n    this._local = local && local.toLowerCase();\n    return this;\n  }\n\n  getLocal(unescape = false) {\n    let local = null;\n\n    local = unescape ? escaping.unescape(this._local) : this._local;\n\n    return local;\n  }\n\n  /**\n   * http://xmpp.org/rfcs/rfc6122.html#addressing-domain\n   */\n  setDomain(domain) {\n    this._domain = domain.toLowerCase();\n    return this;\n  }\n\n  getDomain() {\n    return this._domain;\n  }\n\n  /**\n   * http://xmpp.org/rfcs/rfc6122.html#addressing-resourcepart\n   */\n  setResource(resource) {\n    this._resource = resource;\n    return this;\n  }\n\n  getResource() {\n    return this._resource;\n  }\n}\n\nObject.defineProperty(JID.prototype, \"local\", {\n  get: JID.prototype.getLocal,\n  set: JID.prototype.setLocal,\n});\n\nObject.defineProperty(JID.prototype, \"domain\", {\n  get: JID.prototype.getDomain,\n  set: JID.prototype.setDomain,\n});\n\nObject.defineProperty(JID.prototype, \"resource\", {\n  get: JID.prototype.getResource,\n  set: JID.prototype.setResource,\n});\n\nmodule.exports = JID;\n","\"use strict\";\n\nconst JID = require(\"./lib/JID\");\nconst escaping = require(\"./lib/escaping\");\nconst parse = require(\"./lib/parse\");\n\nfunction jid(...args) {\n  if (!args[1] && !args[2]) {\n    return parse(...args);\n  }\n\n  return new JID(...args);\n}\n\nmodule.exports = jid.bind();\nmodule.exports.jid = jid;\nmodule.exports.JID = JID;\nmodule.exports.equal = function equal(a, b) {\n  return a.equals(b);\n};\n\nmodule.exports.detectEscape = escaping.detect;\nmodule.exports.escapeLocal = escaping.escape;\nmodule.exports.unescapeLocal = escaping.unescape;\nmodule.exports.parse = parse;\n","\"use strict\";\n\nconst JID = require(\"../lib/JID\");\n\nmodule.exports = function parse(s) {\n  let local;\n  let resource;\n\n  const resourceStart = s.indexOf(\"/\");\n  if (resourceStart !== -1) {\n    resource = s.slice(resourceStart + 1);\n    s = s.slice(0, resourceStart);\n  }\n\n  const atStart = s.indexOf(\"@\");\n  if (atStart !== -1) {\n    local = s.slice(0, atStart);\n    s = s.slice(atStart + 1);\n  }\n\n  return new JID(local, s, resource);\n};\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nconst escapeXMLTable = {\n  \"&\": \"&amp;\",\n  \"<\": \"&lt;\",\n  \">\": \"&gt;\",\n  '\"': \"&quot;\",\n  \"'\": \"&apos;\",\n};\n\nfunction escapeXMLReplace(match) {\n  return escapeXMLTable[match];\n}\n\nconst unescapeXMLTable = {\n  \"&amp;\": \"&\",\n  \"&lt;\": \"<\",\n  \"&gt;\": \">\",\n  \"&quot;\": '\"',\n  \"&apos;\": \"'\",\n};\n\nfunction unescapeXMLReplace(match) {\n  if (match[1] === \"#\") {\n    const num =\n      match[2] === \"x\"\n        ? parseInt(match.slice(3), 16)\n        : parseInt(match.slice(2), 10);\n    // https://www.w3.org/TR/xml/#NT-Char defines legal XML characters:\n    // #x9 | #xA | #xD | [#x20-#xD7FF] | [#xE000-#xFFFD] | [#x10000-#x10FFFF]\n    if (\n      num === 0x9 ||\n      num === 0xa ||\n      num === 0xd ||\n      (num >= 0x20 && num <= 0xd7ff) ||\n      (num >= 0xe000 && num <= 0xfffd) ||\n      (num >= 0x10000 && num <= 0x10ffff)\n    ) {\n      return String.fromCodePoint(num);\n    }\n    throw new Error(\"Illegal XML character 0x\" + num.toString(16));\n  }\n  if (unescapeXMLTable[match]) {\n    return unescapeXMLTable[match] || match;\n  }\n  throw new Error(\"Illegal XML entity \" + match);\n}\n\nfunction escapeXML(s) {\n  return s.replace(/[\"&'<>]/g, escapeXMLReplace);\n}\n\nfunction unescapeXML(s) {\n  let result = \"\";\n  let start = -1;\n  let end = -1;\n  let previous = 0;\n  while (\n    (start = s.indexOf(\"&\", previous)) !== -1 &&\n    (end = s.indexOf(\";\", start + 1)) !== -1\n  ) {\n    result =\n      result +\n      s.slice(previous, start) +\n      unescapeXMLReplace(s.slice(start, end + 1));\n    previous = end + 1;\n  }\n\n  // shortcut if loop never entered:\n  // return the original string without creating new objects\n  if (previous === 0) return s;\n\n  // push the remaining characters\n  result = result + s.substring(previous);\n\n  return result;\n}\n\nfunction escapeXMLText(s) {\n  return s.replace(/[&<>]/g, escapeXMLReplace);\n}\n\nfunction unescapeXMLText(s) {\n  return s.replace(/&(amp|#38|lt|#60|gt|#62);/g, unescapeXMLReplace);\n}\n\nexports.escapeXML = escapeXML;\nexports.escapeXMLText = escapeXMLText;\nexports.unescapeXML = unescapeXML;\nexports.unescapeXMLText = unescapeXMLText;\n","'use strict';\n\nvar _escape = require('./escape.js');\n\n/**\n * Element\n *\n * Attributes are in the element.attrs object. Children is a list of\n * either other Elements or Strings for text content.\n **/\nclass Element {\n  constructor(name, attrs) {\n    this.name = name;\n    this.parent = null;\n    this.children = [];\n    this.attrs = {};\n    this.setAttrs(attrs);\n  }\n\n  /* Accessors */\n\n  /**\n   * if (element.is('message', 'jabber:client')) ...\n   **/\n  is(name, xmlns) {\n    return this.getName() === name && (!xmlns || this.getNS() === xmlns);\n  }\n\n  /* without prefix */\n  getName() {\n    const idx = this.name.indexOf(\":\");\n    return idx >= 0 ? this.name.slice(idx + 1) : this.name;\n  }\n\n  /**\n   * retrieves the namespace of the current element, upwards recursively\n   **/\n  getNS() {\n    const idx = this.name.indexOf(\":\");\n    if (idx >= 0) {\n      const prefix = this.name.slice(0, idx);\n      return this.findNS(prefix);\n    }\n    return this.findNS();\n  }\n\n  /**\n   * find the namespace to the given prefix, upwards recursively\n   **/\n  findNS(prefix) {\n    if (!prefix) {\n      /* default namespace */\n      if (this.attrs.xmlns) {\n        return this.attrs.xmlns;\n      } else if (this.parent) {\n        return this.parent.findNS();\n      }\n    } else {\n      /* prefixed namespace */\n      const attr = \"xmlns:\" + prefix;\n      if (this.attrs[attr]) {\n        return this.attrs[attr];\n      } else if (this.parent) {\n        return this.parent.findNS(prefix);\n      }\n    }\n  }\n\n  /**\n   * Recursiverly gets all xmlns defined, in the form of {url:prefix}\n   **/\n  getXmlns() {\n    let namespaces = {};\n\n    if (this.parent) {\n      namespaces = this.parent.getXmlns();\n    }\n\n    for (const attr in this.attrs) {\n      const m = attr.match(\"xmlns:?(.*)\");\n      // eslint-disable-next-line  no-prototype-builtins\n      if (this.attrs.hasOwnProperty(attr) && m) {\n        namespaces[this.attrs[attr]] = m[1];\n      }\n    }\n    return namespaces;\n  }\n\n  setAttrs(attrs) {\n    if (typeof attrs === \"string\") {\n      this.attrs.xmlns = attrs;\n    } else if (attrs) {\n      Object.assign(this.attrs, attrs);\n    }\n  }\n\n  /**\n   * xmlns can be null, returns the matching attribute.\n   **/\n  getAttr(name, xmlns) {\n    if (!xmlns) {\n      return this.attrs[name];\n    }\n\n    const namespaces = this.getXmlns();\n\n    if (!namespaces[xmlns]) {\n      return null;\n    }\n\n    return this.attrs[[namespaces[xmlns], name].join(\":\")];\n  }\n\n  /**\n   * xmlns can be null\n   **/\n  getChild(name, xmlns) {\n    return this.getChildren(name, xmlns)[0];\n  }\n\n  /**\n   * xmlns can be null\n   **/\n  getChildren(name, xmlns) {\n    const result = [];\n    for (const child of this.children) {\n      if (\n        child.getName &&\n        child.getName() === name &&\n        (!xmlns || child.getNS() === xmlns)\n      ) {\n        result.push(child);\n      }\n    }\n    return result;\n  }\n\n  /**\n   * xmlns and recursive can be null\n   **/\n  getChildByAttr(attr, val, xmlns, recursive) {\n    return this.getChildrenByAttr(attr, val, xmlns, recursive)[0];\n  }\n\n  /**\n   * xmlns and recursive can be null\n   **/\n  getChildrenByAttr(attr, val, xmlns, recursive) {\n    let result = [];\n    for (const child of this.children) {\n      if (\n        child.attrs &&\n        child.attrs[attr] === val &&\n        (!xmlns || child.getNS() === xmlns)\n      ) {\n        result.push(child);\n      }\n      if (recursive && child.getChildrenByAttr) {\n        result.push(child.getChildrenByAttr(attr, val, xmlns, true));\n      }\n    }\n    if (recursive) {\n      result = result.flat();\n    }\n    return result;\n  }\n\n  getChildrenByFilter(filter, recursive) {\n    let result = [];\n    for (const child of this.children) {\n      if (filter(child)) {\n        result.push(child);\n      }\n      if (recursive && child.getChildrenByFilter) {\n        result.push(child.getChildrenByFilter(filter, true));\n      }\n    }\n    if (recursive) {\n      result = result.flat();\n    }\n    return result;\n  }\n\n  getText() {\n    let text = \"\";\n    for (const child of this.children) {\n      if (typeof child === \"string\" || typeof child === \"number\") {\n        text += child;\n      }\n    }\n    return text;\n  }\n\n  getChildText(name, xmlns) {\n    const child = this.getChild(name, xmlns);\n    return child ? child.getText() : null;\n  }\n\n  /**\n   * Return all direct descendents that are Elements.\n   * This differs from `getChildren` in that it will exclude text nodes,\n   * processing instructions, etc.\n   */\n  getChildElements() {\n    return this.getChildrenByFilter((child) => {\n      return child instanceof Element;\n    });\n  }\n\n  /* Builder */\n\n  /** returns uppermost parent */\n  root() {\n    if (this.parent) {\n      return this.parent.root();\n    }\n    return this;\n  }\n\n  /** just parent or itself */\n  up() {\n    if (this.parent) {\n      return this.parent;\n    }\n    return this;\n  }\n\n  /** create child node and return it */\n  c(name, attrs) {\n    return this.cnode(new Element(name, attrs));\n  }\n\n  cnode(child) {\n    this.children.push(child);\n    if (typeof child === \"object\") {\n      child.parent = this;\n    }\n    return child;\n  }\n\n  append(...nodes) {\n    for (const node of nodes) {\n      this.children.push(node);\n      if (typeof node === \"object\") {\n        node.parent = this;\n      }\n    }\n  }\n\n  prepend(...nodes) {\n    for (const node of nodes) {\n      this.children.unshift(node);\n      if (typeof node === \"object\") {\n        node.parent = this;\n      }\n    }\n  }\n\n  /** add text node and return element */\n  t(text) {\n    this.children.push(text);\n    return this;\n  }\n\n  /* Manipulation */\n\n  /**\n   * Either:\n   *   el.remove(childEl)\n   *   el.remove('author', 'urn:...')\n   */\n  remove(el, xmlns) {\n    const filter =\n      typeof el === \"string\"\n        ? (child) => {\n            /* 1st parameter is tag name */\n            return !(child.is && child.is(el, xmlns));\n          }\n        : (child) => {\n            /* 1st parameter is element */\n            return child !== el;\n          };\n\n    this.children = this.children.filter(filter);\n\n    return this;\n  }\n\n  text(val) {\n    if (val && this.children.length === 1) {\n      this.children[0] = val;\n      return this;\n    }\n    return this.getText();\n  }\n\n  attr(attr, val) {\n    if (typeof val !== \"undefined\" || val === null) {\n      if (!this.attrs) {\n        this.attrs = {};\n      }\n      this.attrs[attr] = val;\n      return this;\n    }\n    return this.attrs[attr];\n  }\n\n  /* Serialization */\n\n  toString() {\n    let s = \"\";\n    this.write((c) => {\n      s += c;\n    });\n    return s;\n  }\n\n  _addChildren(writer) {\n    writer(\">\");\n    for (const child of this.children) {\n      /* Skip null/undefined */\n      if (child != null) {\n        if (child.write) {\n          child.write(writer);\n        } else if (typeof child === \"string\") {\n          writer(_escape.escapeXMLText(child));\n        } else if (child.toString) {\n          writer(_escape.escapeXMLText(child.toString(10)));\n        }\n      }\n    }\n    writer(\"</\");\n    writer(this.name);\n    writer(\">\");\n  }\n\n  write(writer) {\n    writer(\"<\");\n    writer(this.name);\n    for (const k in this.attrs) {\n      const v = this.attrs[k];\n      // === null || undefined\n      if (v != null) {\n        writer(\" \");\n        writer(k);\n        writer('=\"');\n        writer(_escape.escapeXML(typeof v === \"string\" ? v : v.toString(10)));\n        writer('\"');\n      }\n    }\n    if (this.children.length === 0) {\n      writer(\"/>\");\n    } else {\n      this._addChildren(writer);\n    }\n  }\n}\n\nElement.prototype.tree = Element.prototype.root;\n\nmodule.exports = Element;\n","\"use strict\";\n\nmodule.exports = class XMLError extends Error {\n  constructor(...args) {\n    super(...args);\n    this.name = \"XMLError\";\n  }\n};\n","\"use strict\";\n\nconst LtxParser = require(\"ltx/lib/parsers/ltx\");\nconst Element = require(\"ltx/lib/Element\");\nconst EventEmitter = require(\"events\");\nconst XMLError = require(\"./XMLError\");\n\nclass Parser extends EventEmitter {\n  constructor() {\n    super();\n    const parser = new LtxParser();\n    this.root = null;\n    this.cursor = null;\n\n    parser.on(\"startElement\", this.onStartElement.bind(this));\n    parser.on(\"endElement\", this.onEndElement.bind(this));\n    parser.on(\"text\", this.onText.bind(this));\n\n    this.parser = parser;\n  }\n\n  onStartElement(name, attrs) {\n    const element = new Element(name, attrs);\n\n    const { root, cursor } = this;\n\n    if (!root) {\n      this.root = element;\n      this.emit(\"start\", element);\n    } else if (cursor !== root) {\n      cursor.append(element);\n    }\n\n    this.cursor = element;\n  }\n\n  onEndElement(name) {\n    const { root, cursor } = this;\n    if (name !== cursor.name) {\n      // <foo></bar>\n      this.emit(\"error\", new XMLError(`${cursor.name} must be closed.`));\n      return;\n    }\n\n    if (cursor === root) {\n      this.emit(\"end\", root);\n      return;\n    }\n\n    if (!cursor.parent) {\n      cursor.parent = root;\n      this.emit(\"element\", cursor);\n      this.cursor = root;\n      return;\n    }\n\n    this.cursor = cursor.parent;\n  }\n\n  onText(str) {\n    const { cursor } = this;\n    if (!cursor) {\n      this.emit(\"error\", new XMLError(`${str} must be a child.`));\n      return;\n    }\n\n    cursor.t(str);\n  }\n\n  write(data) {\n    this.parser.write(data);\n  }\n\n  end(data) {\n    if (data) {\n      this.parser.write(data);\n    }\n  }\n}\n\nParser.XMLError = XMLError;\n\nmodule.exports = Parser;\n","'use strict';\n\nvar events = require('events');\nvar _escape = require('../escape.js');\n\nconst STATE_TEXT = 0;\nconst STATE_IGNORE_COMMENT = 1;\nconst STATE_IGNORE_INSTRUCTION = 2;\nconst STATE_TAG_NAME = 3;\nconst STATE_TAG = 4;\nconst STATE_ATTR_NAME = 5;\nconst STATE_ATTR_EQ = 6;\nconst STATE_ATTR_QUOT = 7;\nconst STATE_ATTR_VALUE = 8;\nconst STATE_CDATA = 9;\nconst STATE_IGNORE_CDATA = 10;\n\nclass SaxLtx extends events.EventEmitter {\n  constructor() {\n    super();\n    let state = STATE_TEXT;\n    let remainder;\n    let parseRemainder;\n    let tagName;\n    let attrs;\n    let endTag;\n    let selfClosing;\n    let attrQuote;\n    let attrQuoteChar;\n    let recordStart = 0;\n    let attrName;\n\n    this._handleTagOpening = function _handleTagOpening(\n      endTag,\n      tagName,\n      attrs\n    ) {\n      if (!endTag) {\n        this.emit(\"startElement\", tagName, attrs);\n        if (selfClosing) {\n          this.emit(\"endElement\", tagName);\n        }\n      } else {\n        this.emit(\"endElement\", tagName);\n      }\n    };\n\n    this.write = function write(data) {\n      if (typeof data !== \"string\") {\n        data = data.toString();\n      }\n      let pos = 0;\n\n      /* Anything from previous write()? */\n      if (remainder) {\n        data = remainder + data;\n        pos += !parseRemainder ? remainder.length : 0;\n        parseRemainder = false;\n        remainder = null;\n      }\n\n      function endRecording() {\n        if (typeof recordStart === \"number\") {\n          const recorded = data.slice(recordStart, pos);\n          recordStart = undefined;\n          return recorded;\n        }\n      }\n\n      for (; pos < data.length; pos++) {\n        switch (state) {\n          case STATE_TEXT: {\n            // if we're looping through text, fast-forward using indexOf to\n            // the next '<' character\n            const lt = data.indexOf(\"<\", pos);\n            if (lt !== -1 && pos !== lt) {\n              pos = lt;\n            }\n\n            break;\n          }\n          case STATE_ATTR_VALUE: {\n            // if we're looping through an attribute, fast-forward using\n            // indexOf to the next end quote character\n            const quot = data.indexOf(attrQuoteChar, pos);\n            if (quot !== -1) {\n              pos = quot;\n            }\n\n            break;\n          }\n          case STATE_IGNORE_COMMENT: {\n            // if we're looping through a comment, fast-forward using\n            // indexOf to the first end-comment character\n            const endcomment = data.indexOf(\"-->\", pos);\n            if (endcomment !== -1) {\n              pos = endcomment + 2; // target the '>' character\n            }\n\n            break;\n          }\n          case STATE_IGNORE_CDATA: {\n            // if we're looping through a CDATA, fast-forward using\n            // indexOf to the first end-CDATA character ]]>\n            const endCDATA = data.indexOf(\"]]>\", pos);\n            if (endCDATA !== -1) {\n              pos = endCDATA + 2; // target the '>' character\n            }\n\n            break;\n          }\n          // No default\n        }\n\n        const c = data.charCodeAt(pos);\n        switch (state) {\n          case STATE_TEXT:\n            if (c === 60 /* < */) {\n              const text = endRecording();\n              if (text) {\n                this.emit(\"text\", _escape.unescapeXML(text));\n              }\n              state = STATE_TAG_NAME;\n              recordStart = pos + 1;\n              attrs = {};\n            }\n            break;\n          case STATE_CDATA:\n            if (c === 93 /* ] */) {\n              if (data.substr(pos + 1, 2) === \"]>\") {\n                const cData = endRecording();\n                if (cData) {\n                  this.emit(\"text\", cData);\n                }\n                state = STATE_TEXT;\n              } else if (data.length < pos + 2) {\n                parseRemainder = true;\n                pos = data.length;\n              }\n            }\n            break;\n          case STATE_TAG_NAME:\n            if (c === 47 /* / */ && recordStart === pos) {\n              recordStart = pos + 1;\n              endTag = true;\n            } else if (c === 33 /* ! */) {\n              if (data.substr(pos + 1, 7) === \"[CDATA[\") {\n                recordStart = pos + 8;\n                state = STATE_CDATA;\n              } else if (\n                data.length < pos + 8 &&\n                \"[CDATA[\".startsWith(data.slice(pos + 1))\n              ) {\n                // We potentially have CDATA, but the chunk is ending; stop here and let the next write() decide\n                parseRemainder = true;\n                pos = data.length;\n              } else {\n                recordStart = undefined;\n                state = STATE_IGNORE_COMMENT;\n              }\n            } else if (c === 63 /* ? */) {\n              recordStart = undefined;\n              state = STATE_IGNORE_INSTRUCTION;\n            } else if (c <= 32 || c === 47 /* / */ || c === 62 /* > */) {\n              tagName = endRecording();\n              pos--;\n              state = STATE_TAG;\n            }\n            break;\n          case STATE_IGNORE_COMMENT:\n            if (c === 62 /* > */) {\n              const prevFirst = data.charCodeAt(pos - 1);\n              const prevSecond = data.charCodeAt(pos - 2);\n              if (\n                (prevFirst === 45 /* - */ && prevSecond === 45) /* - */ ||\n                (prevFirst === 93 /* ] */ && prevSecond === 93) /* ] */\n              ) {\n                state = STATE_TEXT;\n              }\n            }\n            break;\n          case STATE_IGNORE_INSTRUCTION:\n            if (c === 62 /* > */) {\n              const prev = data.charCodeAt(pos - 1);\n              if (prev === 63 /* ? */) {\n                state = STATE_TEXT;\n              }\n            }\n            break;\n          case STATE_TAG:\n            if (c === 62 /* > */) {\n              this._handleTagOpening(endTag, tagName, attrs);\n              tagName = undefined;\n              attrs = undefined;\n              endTag = undefined;\n              selfClosing = undefined;\n              state = STATE_TEXT;\n              recordStart = pos + 1;\n            } else if (c === 47 /* / */) {\n              selfClosing = true;\n            } else if (c > 32) {\n              recordStart = pos;\n              state = STATE_ATTR_NAME;\n            }\n            break;\n          case STATE_ATTR_NAME:\n            if (c <= 32 || c === 61 /* = */) {\n              attrName = endRecording();\n              pos--;\n              state = STATE_ATTR_EQ;\n            }\n            break;\n          case STATE_ATTR_EQ:\n            if (c === 61 /* = */) {\n              state = STATE_ATTR_QUOT;\n            }\n            break;\n          case STATE_ATTR_QUOT:\n            if (c === 34 /* \" */ || c === 39 /* ' */) {\n              attrQuote = c;\n              attrQuoteChar = c === 34 ? '\"' : \"'\";\n              state = STATE_ATTR_VALUE;\n              recordStart = pos + 1;\n            }\n            break;\n          case STATE_ATTR_VALUE:\n            if (c === attrQuote) {\n              const value = _escape.unescapeXML(endRecording());\n              attrs[attrName] = value;\n              attrName = undefined;\n              state = STATE_TAG;\n            }\n            break;\n        }\n      }\n\n      if (typeof recordStart === \"number\" && recordStart <= data.length) {\n        remainder = data.slice(recordStart);\n        recordStart = 0;\n      }\n    };\n  }\n\n  end(data) {\n    if (data) {\n      this.write(data);\n    }\n\n    /* Uh, yeah */\n    this.write = function write() {};\n  }\n}\n\nmodule.exports = SaxLtx;\n","\"use strict\";\n\nconst Element = require(\"ltx/lib/Element\");\nconst createElement = require(\"ltx/lib/createElement\");\nconst Parser = require(\"./lib/Parser\");\nconst {\n  escapeXML,\n  unescapeXML,\n  escapeXMLText,\n  unescapeXMLText,\n} = require(\"ltx/lib/escape\");\nconst XMLError = require(\"./lib/XMLError\");\n\nfunction xml(...args) {\n  return createElement(...args);\n}\n\nmodule.exports = xml;\n\nObject.assign(module.exports, {\n  Element,\n  createElement,\n  Parser,\n  escapeXML,\n  unescapeXML,\n  escapeXMLText,\n  unescapeXMLText,\n  XMLError,\n});\n","'use strict';\n\nvar Element = require('./Element.js');\n\nfunction append(el, child) {\n  if (Array.isArray(child)) {\n    for (const c of child) append(el, c);\n    return;\n  }\n\n  if (child === \"\" || child == null || child === true || child === false) {\n    return;\n  }\n\n  el.cnode(child);\n}\n\n/**\n * JSX compatible API, use this function as pragma\n * https://facebook.github.io/jsx/\n *\n * @param  {string} name  name of the element\n * @param  {object} attrs object of attribute key/value pairs\n * @return {Element}      Element\n */\nfunction createElement(name, attrs, ...children) {\n  if (typeof attrs === \"object\" && attrs !== null) {\n    // __self and __source are added by babel in development\n    // https://github.com/facebook/react/pull/4596\n    // https://babeljs.io/docs/en/babel-preset-react#development\n    // https://babeljs.io/docs/en/babel-plugin-transform-react-jsx-source\n    delete attrs.__source;\n    delete attrs.__self;\n\n    for (const [key, value] of Object.entries(attrs)) {\n      if (value == null) delete attrs[key];\n      else attrs[key] = value.toString(10);\n    }\n  }\n\n  const el = new Element(name, attrs);\n\n  for (const child of children) {\n    append(el, child);\n  }\n\n  return el;\n}\n\nmodule.exports = createElement;\n","\"use strict\";\n\n// https://xmpp.org/rfcs/rfc6120.html#rfc.section.4.9.2\n\nclass XMPPError extends Error {\n  constructor(condition, text, application) {\n    super(condition + (text ? ` - ${text}` : \"\"));\n    this.name = \"XMPPError\";\n    this.condition = condition;\n    this.text = text;\n    this.application = application;\n  }\n\n  static fromElement(element) {\n    const [condition, second, third] = element.children;\n    let text;\n    let application;\n\n    if (second) {\n      if (second.is(\"text\")) {\n        text = second;\n      } else if (second) {\n        application = second;\n      }\n\n      if (third) application = third;\n    }\n\n    const error = new this(\n      condition.name,\n      text ? text.text() : \"\",\n      application,\n    );\n    error.element = element;\n    return error;\n  }\n}\n\nmodule.exports = XMPPError;\n","\"use strict\";\n\nconst { EventEmitter, promise } = require(\"@xmpp/events\");\nconst jid = require(\"@xmpp/jid\");\nconst xml = require(\"@xmpp/xml\");\nconst StreamError = require(\"./lib/StreamError\");\nconst { parseHost, parseService } = require(\"./lib/util\");\n\nconst NS_STREAM = \"urn:ietf:params:xml:ns:xmpp-streams\";\nconst NS_JABBER_STREAM = \"http://etherx.jabber.org/streams\";\n\nclass Connection extends EventEmitter {\n  constructor(options = {}) {\n    super();\n    this.jid = null;\n    this.timeout = 2000;\n    this.options = options;\n    this.socketListeners = Object.create(null);\n    this.parserListeners = Object.create(null);\n    this.status = \"offline\";\n    this.socket = null;\n    this.parser = null;\n    this.root = null;\n  }\n\n  _reset() {\n    this.jid = null;\n    this.status = \"offline\";\n    this._detachSocket();\n    this._detachParser();\n  }\n\n  async _streamError(condition, children) {\n    try {\n      await this.send(\n        // prettier-ignore\n        xml('stream:error', {}, [\n          xml(condition, {xmlns: NS_STREAM}, children),\n        ]),\n      );\n    } catch {}\n\n    return this._end();\n  }\n\n  _onData(data) {\n    const str = data.toString(\"utf8\");\n    this.emit(\"input\", str);\n    this.parser.write(str);\n  }\n\n  _onParserError(error) {\n    // https://xmpp.org/rfcs/rfc6120.html#streams-error-conditions-bad-format\n    // \"This error can be used instead of the more specific XML-related errors,\n    // such as <bad-namespace-prefix/>, <invalid-xml/>, <not-well-formed/>, <restricted-xml/>,\n    // and <unsupported-encoding/>. However, the more specific errors are RECOMMENDED.\"\n    this._streamError(\"bad-format\");\n    this._detachParser();\n    this.emit(\"error\", error);\n  }\n\n  _attachSocket(socket) {\n    this.socket = socket;\n    const listeners = this.socketListeners;\n\n    listeners.data = this._onData.bind(this);\n\n    listeners.close = (dirty, event) => {\n      this._reset();\n      this._status(\"disconnect\", { clean: !dirty, event });\n    };\n\n    listeners.connect = () => {\n      this._status(\"connect\");\n    };\n\n    listeners.error = (error) => {\n      this.emit(\"error\", error);\n    };\n\n    this.socket.on(\"close\", listeners.close);\n    this.socket.on(\"data\", listeners.data);\n    this.socket.on(\"error\", listeners.error);\n    this.socket.on(\"connect\", listeners.connect);\n  }\n\n  _detachSocket() {\n    const { socketListeners, socket } = this;\n    for (const k of Object.getOwnPropertyNames(socketListeners)) {\n      socket.removeListener(k, socketListeners[k]);\n      delete socketListeners[k];\n    }\n    this.socket = null;\n    return socket;\n  }\n\n  _onElement(element) {\n    const isStreamError = element.is(\"error\", NS_JABBER_STREAM);\n\n    if (isStreamError) {\n      this._onStreamError(element);\n    }\n\n    this.emit(\"element\", element);\n    this.emit(this.isStanza(element) ? \"stanza\" : \"nonza\", element);\n\n    if (isStreamError) {\n      // \"Stream Errors Are Unrecoverable\"\n      // \"The entity that receives the stream error then SHALL close the stream\"\n      this._end();\n    }\n  }\n\n  // https://xmpp.org/rfcs/rfc6120.html#streams-error\n  _onStreamError(element) {\n    const error = StreamError.fromElement(element);\n\n    if (error.condition === \"see-other-host\") {\n      return this._onSeeOtherHost(error);\n    }\n\n    this.emit(\"error\", error);\n  }\n\n  // https://xmpp.org/rfcs/rfc6120.html#streams-error-conditions-see-other-host\n  async _onSeeOtherHost(error) {\n    const { protocol } = parseService(this.options.service);\n\n    const host = error.element.getChildText(\"see-other-host\");\n    const { port } = parseHost(host);\n\n    let service;\n    service = port\n      ? `${protocol || \"xmpp:\"}//${host}`\n      : (protocol ? `${protocol}//` : \"\") + host;\n\n    try {\n      await promise(this, \"disconnect\");\n      const { domain, lang } = this.options;\n      await this.connect(service);\n      await this.open({ domain, lang });\n    } catch (err) {\n      this.emit(\"error\", err);\n    }\n  }\n\n  _attachParser(parser) {\n    this.parser = parser;\n    const listeners = this.parserListeners;\n\n    listeners.element = this._onElement.bind(this);\n    listeners.error = this._onParserError.bind(this);\n\n    listeners.end = (element) => {\n      this._detachParser();\n      this._status(\"close\", element);\n    };\n\n    listeners.start = (element) => {\n      this._status(\"open\", element);\n    };\n\n    this.parser.on(\"error\", listeners.error);\n    this.parser.on(\"element\", listeners.element);\n    this.parser.on(\"end\", listeners.end);\n    this.parser.on(\"start\", listeners.start);\n  }\n\n  _detachParser() {\n    const listeners = this.parserListeners;\n    for (const k of Object.getOwnPropertyNames(listeners)) {\n      this.parser.removeListener(k, listeners[k]);\n      delete listeners[k];\n    }\n    this.parser = null;\n  }\n\n  _jid(id) {\n    this.jid = jid(id);\n    return this.jid;\n  }\n\n  _status(status, ...args) {\n    this.status = status;\n    this.emit(\"status\", status, ...args);\n    this.emit(status, ...args);\n  }\n\n  async _end() {\n    let el;\n    try {\n      el = await this.close();\n    } catch {}\n\n    try {\n      await this.disconnect();\n    } catch {}\n\n    return el;\n  }\n\n  /**\n   * Opens the socket then opens the stream\n   */\n  async start() {\n    if (this.status !== \"offline\") {\n      throw new Error(\"Connection is not offline\");\n    }\n\n    const { service, domain, lang } = this.options;\n\n    await this.connect(service);\n\n    const promiseOnline = promise(this, \"online\");\n\n    await this.open({ domain, lang });\n\n    return promiseOnline;\n  }\n\n  /**\n   * Connects the socket\n   */\n  async connect(service) {\n    this._status(\"connecting\", service);\n    const socket = new this.Socket();\n    this._attachSocket(socket);\n    // The 'connect' status is set by the socket 'connect' listener\n    socket.connect(this.socketParameters(service));\n    return promise(socket, \"connect\");\n  }\n\n  /**\n   * Disconnects the socket\n   * https://xmpp.org/rfcs/rfc6120.html#streams-close\n   * https://tools.ietf.org/html/rfc7395#section-3.6\n   */\n  async disconnect(timeout = this.timeout) {\n    if (this.socket) this._status(\"disconnecting\");\n\n    this.socket.end();\n\n    // The 'disconnect' status is set by the socket 'close' listener\n    await promise(this.socket, \"close\", \"error\", timeout);\n  }\n\n  /**\n   * Opens the stream\n   */\n  async open(options) {\n    this._status(\"opening\");\n\n    if (typeof options === \"string\") {\n      options = { domain: options };\n    }\n\n    const { domain, lang, timeout = this.timeout } = options;\n\n    const headerElement = this.headerElement();\n    headerElement.attrs.to = domain;\n    headerElement.attrs[\"xml:lang\"] = lang;\n    this.root = headerElement;\n\n    this._attachParser(new this.Parser());\n\n    await this.write(this.header(headerElement));\n    return promise(this, \"open\", \"error\", timeout);\n  }\n\n  /**\n   * Closes the stream then closes the socket\n   * https://xmpp.org/rfcs/rfc6120.html#streams-close\n   * https://tools.ietf.org/html/rfc7395#section-3.6\n   */\n  async stop() {\n    const el = await this._end();\n    if (this.status !== \"offline\") this._status(\"offline\", el);\n    return el;\n  }\n\n  /**\n   * Closes the stream and wait for the server to close it\n   * https://xmpp.org/rfcs/rfc6120.html#streams-close\n   * https://tools.ietf.org/html/rfc7395#section-3.6\n   */\n  async close(timeout = this.timeout) {\n    const fragment = this.footer(this.footerElement());\n\n    const p = Promise.all([\n      promise(this.parser, \"end\", \"error\", timeout),\n      this.write(fragment),\n    ]);\n\n    if (this.parser && this.socket) this._status(\"closing\");\n    const [el] = await p;\n    this.root = null;\n    return el;\n    // The 'close' status is set by the parser 'end' listener\n  }\n\n  /**\n   * Restart the stream\n   * https://xmpp.org/rfcs/rfc6120.html#streams-negotiation-restart\n   */\n  async restart() {\n    this._detachParser();\n    const { domain, lang } = this.options;\n    return this.open({ domain, lang });\n  }\n\n  async send(element) {\n    element.parent = this.root;\n    await this.write(element.toString());\n    this.emit(\"send\", element);\n  }\n\n  sendReceive(element, timeout = this.timeout) {\n    return Promise.all([\n      this.send(element),\n      promise(this, \"element\", \"error\", timeout),\n    ]).then(([, el]) => el);\n  }\n\n  write(string) {\n    return new Promise((resolve, reject) => {\n      // https://xmpp.org/rfcs/rfc6120.html#streams-close\n      // \"Refrain from sending any further data over its outbound stream to the other entity\"\n      if (this.status === \"closing\") {\n        reject(new Error(\"Connection is closing\"));\n        return;\n      }\n\n      this.socket.write(string, (err) => {\n        if (err) {\n          return reject(err);\n        }\n\n        this.emit(\"output\", string);\n        resolve();\n      });\n    });\n  }\n\n  isStanza(element) {\n    const { name } = element;\n    return name === \"iq\" || name === \"message\" || name === \"presence\";\n  }\n\n  isNonza(element) {\n    return !this.isStanza(element);\n  }\n\n  // Override\n  header(el) {\n    return el.toString();\n  }\n\n  // Override\n  headerElement() {\n    return new xml.Element(\"\", {\n      version: \"1.0\",\n      xmlns: this.NS,\n    });\n  }\n\n  // Override\n  footer(el) {\n    return el.toString();\n  }\n\n  // Override\n  footerElement() {}\n\n  // Override\n  socketParameters() {}\n}\n\n// Overrirde\nConnection.prototype.NS = \"\";\nConnection.prototype.Socket = null;\nConnection.prototype.Parser = null;\n\nmodule.exports = Connection;\n","\"use strict\";\n\nconst XMPPError = require(\"@xmpp/error\");\n\n// https://xmpp.org/rfcs/rfc6120.html#streams-error\n\nclass StreamError extends XMPPError {\n  constructor(...args) {\n    super(...args);\n    this.name = \"StreamError\";\n  }\n}\n\nmodule.exports = StreamError;\n","\"use strict\";\n\nfunction parseURI(URI) {\n  let { port, hostname, protocol } = new URL(URI);\n  // https://github.com/nodejs/node/issues/12410#issuecomment-294138912\n  if (hostname === \"[::1]\") {\n    hostname = \"::1\";\n  }\n\n  return { port, hostname, protocol };\n}\n\nfunction parseHost(host) {\n  const { port, hostname } = parseURI(`http://${host}`);\n  return { port, hostname };\n}\n\nfunction parseService(service) {\n  return service.includes(\"://\") ? parseURI(service) : parseHost(service);\n}\n\nObject.assign(module.exports, { parseURI, parseHost, parseService });\n","\"use strict\";\n\nconst Client = require(\"./lib/Client\");\nconst xml = require(\"@xmpp/xml\");\nconst jid = require(\"@xmpp/jid\");\n\nmodule.exports.Client = Client;\nmodule.exports.xml = xml;\nmodule.exports.jid = jid;\n","\"use strict\";\n\nconst Connection = require(\"@xmpp/connection\");\n\nclass Client extends Connection {\n  constructor(options) {\n    super(options);\n    this.transports = [];\n  }\n\n  send(element, ...args) {\n    return this.Transport.prototype.send.call(this, element, ...args);\n  }\n\n  sendMany(...args) {\n    return this.Transport.prototype.sendMany.call(this, ...args);\n  }\n\n  _findTransport(service) {\n    return this.transports.find((Transport) => {\n      try {\n        return Transport.prototype.socketParameters(service) !== undefined;\n      } catch {\n        return false;\n      }\n    });\n  }\n\n  connect(service) {\n    const Transport = this._findTransport(service);\n\n    if (!Transport) {\n      throw new Error(\"No compatible connection method found.\");\n    }\n\n    this.Transport = Transport;\n    this.Socket = Transport.prototype.Socket;\n    this.Parser = Transport.prototype.Parser;\n\n    return super.connect(service);\n  }\n\n  socketParameters(...args) {\n    return this.Transport.prototype.socketParameters(...args);\n  }\n\n  header(...args) {\n    return this.Transport.prototype.header(...args);\n  }\n\n  headerElement(...args) {\n    return this.Transport.prototype.headerElement(...args);\n  }\n\n  footer(...args) {\n    return this.Transport.prototype.footer(...args);\n  }\n\n  footerElement(...args) {\n    return this.Transport.prototype.footerElement(...args);\n  }\n}\n\nClient.prototype.NS = \"jabber:client\";\n\nmodule.exports = Client;\n","\"use strict\";\n\nconst { EventEmitter } = require(\"@xmpp/events\");\n\nclass Reconnect extends EventEmitter {\n  constructor(entity) {\n    super();\n\n    this.delay = 1000;\n    this.entity = entity;\n    this._timeout = null;\n  }\n\n  scheduleReconnect() {\n    const { entity, delay, _timeout } = this;\n    clearTimeout(_timeout);\n    this._timeout = setTimeout(async () => {\n      if (entity.status !== \"disconnect\") {\n        return;\n      }\n\n      try {\n        await this.reconnect();\n      } catch {\n        // Ignoring the rejection is safe because the error is emitted on entity by #start\n      }\n    }, delay);\n  }\n\n  async reconnect() {\n    const { entity } = this;\n    this.emit(\"reconnecting\");\n\n    const { service, domain, lang } = entity.options;\n    await entity.connect(service);\n    await entity.open({ domain, lang });\n\n    this.emit(\"reconnected\");\n  }\n\n  start() {\n    const { entity } = this;\n    const listeners = {};\n    listeners.disconnect = () => {\n      this.scheduleReconnect();\n    };\n\n    this.listeners = listeners;\n    entity.on(\"disconnect\", listeners.disconnect);\n  }\n\n  stop() {\n    const { entity, listeners, _timeout } = this;\n    entity.removeListener(\"disconnect\", listeners.disconnect);\n    clearTimeout(_timeout);\n  }\n}\n\nmodule.exports = function reconnect({ entity }) {\n  const r = new Reconnect(entity);\n  r.start();\n  return r;\n};\n","'use strict';\n\nconst BINARY_TYPES = ['nodebuffer', 'arraybuffer', 'fragments'];\nconst hasBlob = typeof Blob !== 'undefined';\n\nif (hasBlob) BINARY_TYPES.push('blob');\n\nmodule.exports = {\n  BINARY_TYPES,\n  EMPTY_BUFFER: Buffer.alloc(0),\n  GUID: '258EAFA5-E914-47DA-95CA-C5AB0DC85B11',\n  hasBlob,\n  kForOnEventAttribute: Symbol('kIsForOnEventAttribute'),\n  kListener: Symbol('kListener'),\n  kStatusCode: Symbol('status-code'),\n  kWebSocket: Symbol('websocket'),\n  NOOP: () => {}\n};\n","'use strict';\n\nconst { EMPTY_BUFFER } = require('./constants');\n\nconst FastBuffer = Buffer[Symbol.species];\n\n/**\n * Merges an array of buffers into a new buffer.\n *\n * @param {Buffer[]} list The array of buffers to concat\n * @param {Number} totalLength The total length of buffers in the list\n * @return {Buffer} The resulting buffer\n * @public\n */\nfunction concat(list, totalLength) {\n  if (list.length === 0) return EMPTY_BUFFER;\n  if (list.length === 1) return list[0];\n\n  const target = Buffer.allocUnsafe(totalLength);\n  let offset = 0;\n\n  for (let i = 0; i < list.length; i++) {\n    const buf = list[i];\n    target.set(buf, offset);\n    offset += buf.length;\n  }\n\n  if (offset < totalLength) {\n    return new FastBuffer(target.buffer, target.byteOffset, offset);\n  }\n\n  return target;\n}\n\n/**\n * Masks a buffer using the given mask.\n *\n * @param {Buffer} source The buffer to mask\n * @param {Buffer} mask The mask to use\n * @param {Buffer} output The buffer where to store the result\n * @param {Number} offset The offset at which to start writing\n * @param {Number} length The number of bytes to mask.\n * @public\n */\nfunction _mask(source, mask, output, offset, length) {\n  for (let i = 0; i < length; i++) {\n    output[offset + i] = source[i] ^ mask[i & 3];\n  }\n}\n\n/**\n * Unmasks a buffer using the given mask.\n *\n * @param {Buffer} buffer The buffer to unmask\n * @param {Buffer} mask The mask to use\n * @public\n */\nfunction _unmask(buffer, mask) {\n  for (let i = 0; i < buffer.length; i++) {\n    buffer[i] ^= mask[i & 3];\n  }\n}\n\n/**\n * Converts a buffer to an `ArrayBuffer`.\n *\n * @param {Buffer} buf The buffer to convert\n * @return {ArrayBuffer} Converted buffer\n * @public\n */\nfunction toArrayBuffer(buf) {\n  if (buf.length === buf.buffer.byteLength) {\n    return buf.buffer;\n  }\n\n  return buf.buffer.slice(buf.byteOffset, buf.byteOffset + buf.length);\n}\n\n/**\n * Converts `data` to a `Buffer`.\n *\n * @param {*} data The data to convert\n * @return {Buffer} The buffer\n * @throws {TypeError}\n * @public\n */\nfunction toBuffer(data) {\n  toBuffer.readOnly = true;\n\n  if (Buffer.isBuffer(data)) return data;\n\n  let buf;\n\n  if (data instanceof ArrayBuffer) {\n    buf = new FastBuffer(data);\n  } else if (ArrayBuffer.isView(data)) {\n    buf = new FastBuffer(data.buffer, data.byteOffset, data.byteLength);\n  } else {\n    buf = Buffer.from(data);\n    toBuffer.readOnly = false;\n  }\n\n  return buf;\n}\n\nmodule.exports = {\n  concat,\n  mask: _mask,\n  toArrayBuffer,\n  toBuffer,\n  unmask: _unmask\n};\n\n/* istanbul ignore else  */\nif (!process.env.WS_NO_BUFFER_UTIL) {\n  try {\n    const bufferUtil = require('bufferutil');\n\n    module.exports.mask = function (source, mask, output, offset, length) {\n      if (length < 48) _mask(source, mask, output, offset, length);\n      else bufferUtil.mask(source, mask, output, offset, length);\n    };\n\n    module.exports.unmask = function (buffer, mask) {\n      if (buffer.length < 32) _unmask(buffer, mask);\n      else bufferUtil.unmask(buffer, mask);\n    };\n  } catch (e) {\n    // Continue regardless of the error.\n  }\n}\n","'use strict';\n\nconst zlib = require('zlib');\n\nconst bufferUtil = require('./buffer-util');\nconst Limiter = require('./limiter');\nconst { kStatusCode } = require('./constants');\n\nconst FastBuffer = Buffer[Symbol.species];\nconst TRAILER = Buffer.from([0x00, 0x00, 0xff, 0xff]);\nconst kPerMessageDeflate = Symbol('permessage-deflate');\nconst kTotalLength = Symbol('total-length');\nconst kCallback = Symbol('callback');\nconst kBuffers = Symbol('buffers');\nconst kError = Symbol('error');\n\n//\n// We limit zlib concurrency, which prevents severe memory fragmentation\n// as documented in https://github.com/nodejs/node/issues/8871#issuecomment-250915913\n// and https://github.com/websockets/ws/issues/1202\n//\n// Intentionally global; it's the global thread pool that's an issue.\n//\nlet zlibLimiter;\n\n/**\n * permessage-deflate implementation.\n */\nclass PerMessageDeflate {\n  /**\n   * Creates a PerMessageDeflate instance.\n   *\n   * @param {Object} [options] Configuration options\n   * @param {(Boolean|Number)} [options.clientMaxWindowBits] Advertise support\n   *     for, or request, a custom client window size\n   * @param {Boolean} [options.clientNoContextTakeover=false] Advertise/\n   *     acknowledge disabling of client context takeover\n   * @param {Number} [options.concurrencyLimit=10] The number of concurrent\n   *     calls to zlib\n   * @param {(Boolean|Number)} [options.serverMaxWindowBits] Request/confirm the\n   *     use of a custom server window size\n   * @param {Boolean} [options.serverNoContextTakeover=false] Request/accept\n   *     disabling of server context takeover\n   * @param {Number} [options.threshold=1024] Size (in bytes) below which\n   *     messages should not be compressed if context takeover is disabled\n   * @param {Object} [options.zlibDeflateOptions] Options to pass to zlib on\n   *     deflate\n   * @param {Object} [options.zlibInflateOptions] Options to pass to zlib on\n   *     inflate\n   * @param {Boolean} [isServer=false] Create the instance in either server or\n   *     client mode\n   * @param {Number} [maxPayload=0] The maximum allowed message length\n   */\n  constructor(options, isServer, maxPayload) {\n    this._maxPayload = maxPayload | 0;\n    this._options = options || {};\n    this._threshold =\n      this._options.threshold !== undefined ? this._options.threshold : 1024;\n    this._isServer = !!isServer;\n    this._deflate = null;\n    this._inflate = null;\n\n    this.params = null;\n\n    if (!zlibLimiter) {\n      const concurrency =\n        this._options.concurrencyLimit !== undefined\n          ? this._options.concurrencyLimit\n          : 10;\n      zlibLimiter = new Limiter(concurrency);\n    }\n  }\n\n  /**\n   * @type {String}\n   */\n  static get extensionName() {\n    return 'permessage-deflate';\n  }\n\n  /**\n   * Create an extension negotiation offer.\n   *\n   * @return {Object} Extension parameters\n   * @public\n   */\n  offer() {\n    const params = {};\n\n    if (this._options.serverNoContextTakeover) {\n      params.server_no_context_takeover = true;\n    }\n    if (this._options.clientNoContextTakeover) {\n      params.client_no_context_takeover = true;\n    }\n    if (this._options.serverMaxWindowBits) {\n      params.server_max_window_bits = this._options.serverMaxWindowBits;\n    }\n    if (this._options.clientMaxWindowBits) {\n      params.client_max_window_bits = this._options.clientMaxWindowBits;\n    } else if (this._options.clientMaxWindowBits == null) {\n      params.client_max_window_bits = true;\n    }\n\n    return params;\n  }\n\n  /**\n   * Accept an extension negotiation offer/response.\n   *\n   * @param {Array} configurations The extension negotiation offers/reponse\n   * @return {Object} Accepted configuration\n   * @public\n   */\n  accept(configurations) {\n    configurations = this.normalizeParams(configurations);\n\n    this.params = this._isServer\n      ? this.acceptAsServer(configurations)\n      : this.acceptAsClient(configurations);\n\n    return this.params;\n  }\n\n  /**\n   * Releases all resources used by the extension.\n   *\n   * @public\n   */\n  cleanup() {\n    if (this._inflate) {\n      this._inflate.close();\n      this._inflate = null;\n    }\n\n    if (this._deflate) {\n      const callback = this._deflate[kCallback];\n\n      this._deflate.close();\n      this._deflate = null;\n\n      if (callback) {\n        callback(\n          new Error(\n            'The deflate stream was closed while data was being processed'\n          )\n        );\n      }\n    }\n  }\n\n  /**\n   *  Accept an extension negotiation offer.\n   *\n   * @param {Array} offers The extension negotiation offers\n   * @return {Object} Accepted configuration\n   * @private\n   */\n  acceptAsServer(offers) {\n    const opts = this._options;\n    const accepted = offers.find((params) => {\n      if (\n        (opts.serverNoContextTakeover === false &&\n          params.server_no_context_takeover) ||\n        (params.server_max_window_bits &&\n          (opts.serverMaxWindowBits === false ||\n            (typeof opts.serverMaxWindowBits === 'number' &&\n              opts.serverMaxWindowBits > params.server_max_window_bits))) ||\n        (typeof opts.clientMaxWindowBits === 'number' &&\n          !params.client_max_window_bits)\n      ) {\n        return false;\n      }\n\n      return true;\n    });\n\n    if (!accepted) {\n      throw new Error('None of the extension offers can be accepted');\n    }\n\n    if (opts.serverNoContextTakeover) {\n      accepted.server_no_context_takeover = true;\n    }\n    if (opts.clientNoContextTakeover) {\n      accepted.client_no_context_takeover = true;\n    }\n    if (typeof opts.serverMaxWindowBits === 'number') {\n      accepted.server_max_window_bits = opts.serverMaxWindowBits;\n    }\n    if (typeof opts.clientMaxWindowBits === 'number') {\n      accepted.client_max_window_bits = opts.clientMaxWindowBits;\n    } else if (\n      accepted.client_max_window_bits === true ||\n      opts.clientMaxWindowBits === false\n    ) {\n      delete accepted.client_max_window_bits;\n    }\n\n    return accepted;\n  }\n\n  /**\n   * Accept the extension negotiation response.\n   *\n   * @param {Array} response The extension negotiation response\n   * @return {Object} Accepted configuration\n   * @private\n   */\n  acceptAsClient(response) {\n    const params = response[0];\n\n    if (\n      this._options.clientNoContextTakeover === false &&\n      params.client_no_context_takeover\n    ) {\n      throw new Error('Unexpected parameter \"client_no_context_takeover\"');\n    }\n\n    if (!params.client_max_window_bits) {\n      if (typeof this._options.clientMaxWindowBits === 'number') {\n        params.client_max_window_bits = this._options.clientMaxWindowBits;\n      }\n    } else if (\n      this._options.clientMaxWindowBits === false ||\n      (typeof this._options.clientMaxWindowBits === 'number' &&\n        params.client_max_window_bits > this._options.clientMaxWindowBits)\n    ) {\n      throw new Error(\n        'Unexpected or invalid parameter \"client_max_window_bits\"'\n      );\n    }\n\n    return params;\n  }\n\n  /**\n   * Normalize parameters.\n   *\n   * @param {Array} configurations The extension negotiation offers/reponse\n   * @return {Array} The offers/response with normalized parameters\n   * @private\n   */\n  normalizeParams(configurations) {\n    configurations.forEach((params) => {\n      Object.keys(params).forEach((key) => {\n        let value = params[key];\n\n        if (value.length > 1) {\n          throw new Error(`Parameter \"${key}\" must have only a single value`);\n        }\n\n        value = value[0];\n\n        if (key === 'client_max_window_bits') {\n          if (value !== true) {\n            const num = +value;\n            if (!Number.isInteger(num) || num < 8 || num > 15) {\n              throw new TypeError(\n                `Invalid value for parameter \"${key}\": ${value}`\n              );\n            }\n            value = num;\n          } else if (!this._isServer) {\n            throw new TypeError(\n              `Invalid value for parameter \"${key}\": ${value}`\n            );\n          }\n        } else if (key === 'server_max_window_bits') {\n          const num = +value;\n          if (!Number.isInteger(num) || num < 8 || num > 15) {\n            throw new TypeError(\n              `Invalid value for parameter \"${key}\": ${value}`\n            );\n          }\n          value = num;\n        } else if (\n          key === 'client_no_context_takeover' ||\n          key === 'server_no_context_takeover'\n        ) {\n          if (value !== true) {\n            throw new TypeError(\n              `Invalid value for parameter \"${key}\": ${value}`\n            );\n          }\n        } else {\n          throw new Error(`Unknown parameter \"${key}\"`);\n        }\n\n        params[key] = value;\n      });\n    });\n\n    return configurations;\n  }\n\n  /**\n   * Decompress data. Concurrency limited.\n   *\n   * @param {Buffer} data Compressed data\n   * @param {Boolean} fin Specifies whether or not this is the last fragment\n   * @param {Function} callback Callback\n   * @public\n   */\n  decompress(data, fin, callback) {\n    zlibLimiter.add((done) => {\n      this._decompress(data, fin, (err, result) => {\n        done();\n        callback(err, result);\n      });\n    });\n  }\n\n  /**\n   * Compress data. Concurrency limited.\n   *\n   * @param {(Buffer|String)} data Data to compress\n   * @param {Boolean} fin Specifies whether or not this is the last fragment\n   * @param {Function} callback Callback\n   * @public\n   */\n  compress(data, fin, callback) {\n    zlibLimiter.add((done) => {\n      this._compress(data, fin, (err, result) => {\n        done();\n        callback(err, result);\n      });\n    });\n  }\n\n  /**\n   * Decompress data.\n   *\n   * @param {Buffer} data Compressed data\n   * @param {Boolean} fin Specifies whether or not this is the last fragment\n   * @param {Function} callback Callback\n   * @private\n   */\n  _decompress(data, fin, callback) {\n    const endpoint = this._isServer ? 'client' : 'server';\n\n    if (!this._inflate) {\n      const key = `${endpoint}_max_window_bits`;\n      const windowBits =\n        typeof this.params[key] !== 'number'\n          ? zlib.Z_DEFAULT_WINDOWBITS\n          : this.params[key];\n\n      this._inflate = zlib.createInflateRaw({\n        ...this._options.zlibInflateOptions,\n        windowBits\n      });\n      this._inflate[kPerMessageDeflate] = this;\n      this._inflate[kTotalLength] = 0;\n      this._inflate[kBuffers] = [];\n      this._inflate.on('error', inflateOnError);\n      this._inflate.on('data', inflateOnData);\n    }\n\n    this._inflate[kCallback] = callback;\n\n    this._inflate.write(data);\n    if (fin) this._inflate.write(TRAILER);\n\n    this._inflate.flush(() => {\n      const err = this._inflate[kError];\n\n      if (err) {\n        this._inflate.close();\n        this._inflate = null;\n        callback(err);\n        return;\n      }\n\n      const data = bufferUtil.concat(\n        this._inflate[kBuffers],\n        this._inflate[kTotalLength]\n      );\n\n      if (this._inflate._readableState.endEmitted) {\n        this._inflate.close();\n        this._inflate = null;\n      } else {\n        this._inflate[kTotalLength] = 0;\n        this._inflate[kBuffers] = [];\n\n        if (fin && this.params[`${endpoint}_no_context_takeover`]) {\n          this._inflate.reset();\n        }\n      }\n\n      callback(null, data);\n    });\n  }\n\n  /**\n   * Compress data.\n   *\n   * @param {(Buffer|String)} data Data to compress\n   * @param {Boolean} fin Specifies whether or not this is the last fragment\n   * @param {Function} callback Callback\n   * @private\n   */\n  _compress(data, fin, callback) {\n    const endpoint = this._isServer ? 'server' : 'client';\n\n    if (!this._deflate) {\n      const key = `${endpoint}_max_window_bits`;\n      const windowBits =\n        typeof this.params[key] !== 'number'\n          ? zlib.Z_DEFAULT_WINDOWBITS\n          : this.params[key];\n\n      this._deflate = zlib.createDeflateRaw({\n        ...this._options.zlibDeflateOptions,\n        windowBits\n      });\n\n      this._deflate[kTotalLength] = 0;\n      this._deflate[kBuffers] = [];\n\n      this._deflate.on('data', deflateOnData);\n    }\n\n    this._deflate[kCallback] = callback;\n\n    this._deflate.write(data);\n    this._deflate.flush(zlib.Z_SYNC_FLUSH, () => {\n      if (!this._deflate) {\n        //\n        // The deflate stream was closed while data was being processed.\n        //\n        return;\n      }\n\n      let data = bufferUtil.concat(\n        this._deflate[kBuffers],\n        this._deflate[kTotalLength]\n      );\n\n      if (fin) {\n        data = new FastBuffer(data.buffer, data.byteOffset, data.length - 4);\n      }\n\n      //\n      // Ensure that the callback will not be called again in\n      // `PerMessageDeflate#cleanup()`.\n      //\n      this._deflate[kCallback] = null;\n\n      this._deflate[kTotalLength] = 0;\n      this._deflate[kBuffers] = [];\n\n      if (fin && this.params[`${endpoint}_no_context_takeover`]) {\n        this._deflate.reset();\n      }\n\n      callback(null, data);\n    });\n  }\n}\n\nmodule.exports = PerMessageDeflate;\n\n/**\n * The listener of the `zlib.DeflateRaw` stream `'data'` event.\n *\n * @param {Buffer} chunk A chunk of data\n * @private\n */\nfunction deflateOnData(chunk) {\n  this[kBuffers].push(chunk);\n  this[kTotalLength] += chunk.length;\n}\n\n/**\n * The listener of the `zlib.InflateRaw` stream `'data'` event.\n *\n * @param {Buffer} chunk A chunk of data\n * @private\n */\nfunction inflateOnData(chunk) {\n  this[kTotalLength] += chunk.length;\n\n  if (\n    this[kPerMessageDeflate]._maxPayload < 1 ||\n    this[kTotalLength] <= this[kPerMessageDeflate]._maxPayload\n  ) {\n    this[kBuffers].push(chunk);\n    return;\n  }\n\n  this[kError] = new RangeError('Max payload size exceeded');\n  this[kError].code = 'WS_ERR_UNSUPPORTED_MESSAGE_LENGTH';\n  this[kError][kStatusCode] = 1009;\n  this.removeListener('data', inflateOnData);\n  this.reset();\n}\n\n/**\n * The listener of the `zlib.InflateRaw` stream `'error'` event.\n *\n * @param {Error} err The emitted error\n * @private\n */\nfunction inflateOnError(err) {\n  //\n  // There is no need to call `Zlib#close()` as the handle is automatically\n  // closed when an error is emitted.\n  //\n  this[kPerMessageDeflate]._inflate = null;\n  err[kStatusCode] = 1007;\n  this[kCallback](err);\n}\n","'use strict';\n\nconst kDone = Symbol('kDone');\nconst kRun = Symbol('kRun');\n\n/**\n * A very simple job queue with adjustable concurrency. Adapted from\n * https://github.com/STRML/async-limiter\n */\nclass Limiter {\n  /**\n   * Creates a new `Limiter`.\n   *\n   * @param {Number} [concurrency=Infinity] The maximum number of jobs allowed\n   *     to run concurrently\n   */\n  constructor(concurrency) {\n    this[kDone] = () => {\n      this.pending--;\n      this[kRun]();\n    };\n    this.concurrency = concurrency || Infinity;\n    this.jobs = [];\n    this.pending = 0;\n  }\n\n  /**\n   * Adds a job to the queue.\n   *\n   * @param {Function} job The job to run\n   * @public\n   */\n  add(job) {\n    this.jobs.push(job);\n    this[kRun]();\n  }\n\n  /**\n   * Removes a job from the queue and runs it if possible.\n   *\n   * @private\n   */\n  [kRun]() {\n    if (this.pending === this.concurrency) return;\n\n    if (this.jobs.length) {\n      const job = this.jobs.shift();\n\n      this.pending++;\n      job(this[kDone]);\n    }\n  }\n}\n\nmodule.exports = Limiter;\n","'use strict';\n\nconst { isUtf8 } = require('buffer');\n\nconst { hasBlob } = require('./constants');\n\n//\n// Allowed token characters:\n//\n// '!', '#', '$', '%', '&', ''', '*', '+', '-',\n// '.', 0-9, A-Z, '^', '_', '`', a-z, '|', '~'\n//\n// tokenChars[32] === 0 // ' '\n// tokenChars[33] === 1 // '!'\n// tokenChars[34] === 0 // '\"'\n// ...\n//\n// prettier-ignore\nconst tokenChars = [\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 0 - 15\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 16 - 31\n  0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, // 32 - 47\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, // 48 - 63\n  0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, // 64 - 79\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, // 80 - 95\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, // 96 - 111\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0 // 112 - 127\n];\n\n/**\n * Checks if a status code is allowed in a close frame.\n *\n * @param {Number} code The status code\n * @return {Boolean} `true` if the status code is valid, else `false`\n * @public\n */\nfunction isValidStatusCode(code) {\n  return (\n    (code >= 1000 &&\n      code <= 1014 &&\n      code !== 1004 &&\n      code !== 1005 &&\n      code !== 1006) ||\n    (code >= 3000 && code <= 4999)\n  );\n}\n\n/**\n * Checks if a given buffer contains only correct UTF-8.\n * Ported from https://www.cl.cam.ac.uk/%7Emgk25/ucs/utf8_check.c by\n * Markus Kuhn.\n *\n * @param {Buffer} buf The buffer to check\n * @return {Boolean} `true` if `buf` contains only correct UTF-8, else `false`\n * @public\n */\nfunction _isValidUTF8(buf) {\n  const len = buf.length;\n  let i = 0;\n\n  while (i < len) {\n    if ((buf[i] & 0x80) === 0) {\n      // 0xxxxxxx\n      i++;\n    } else if ((buf[i] & 0xe0) === 0xc0) {\n      // 110xxxxx 10xxxxxx\n      if (\n        i + 1 === len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i] & 0xfe) === 0xc0 // Overlong\n      ) {\n        return false;\n      }\n\n      i += 2;\n    } else if ((buf[i] & 0xf0) === 0xe0) {\n      // 1110xxxx 10xxxxxx 10xxxxxx\n      if (\n        i + 2 >= len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i + 2] & 0xc0) !== 0x80 ||\n        (buf[i] === 0xe0 && (buf[i + 1] & 0xe0) === 0x80) || // Overlong\n        (buf[i] === 0xed && (buf[i + 1] & 0xe0) === 0xa0) // Surrogate (U+D800 - U+DFFF)\n      ) {\n        return false;\n      }\n\n      i += 3;\n    } else if ((buf[i] & 0xf8) === 0xf0) {\n      // 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx\n      if (\n        i + 3 >= len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i + 2] & 0xc0) !== 0x80 ||\n        (buf[i + 3] & 0xc0) !== 0x80 ||\n        (buf[i] === 0xf0 && (buf[i + 1] & 0xf0) === 0x80) || // Overlong\n        (buf[i] === 0xf4 && buf[i + 1] > 0x8f) ||\n        buf[i] > 0xf4 // > U+10FFFF\n      ) {\n        return false;\n      }\n\n      i += 4;\n    } else {\n      return false;\n    }\n  }\n\n  return true;\n}\n\n/**\n * Determines whether a value is a `Blob`.\n *\n * @param {*} value The value to be tested\n * @return {Boolean} `true` if `value` is a `Blob`, else `false`\n * @private\n */\nfunction isBlob(value) {\n  return (\n    hasBlob &&\n    typeof value === 'object' &&\n    typeof value.arrayBuffer === 'function' &&\n    typeof value.type === 'string' &&\n    typeof value.stream === 'function' &&\n    (value[Symbol.toStringTag] === 'Blob' ||\n      value[Symbol.toStringTag] === 'File')\n  );\n}\n\nmodule.exports = {\n  isBlob,\n  isValidStatusCode,\n  isValidUTF8: _isValidUTF8,\n  tokenChars\n};\n\nif (isUtf8) {\n  module.exports.isValidUTF8 = function (buf) {\n    return buf.length < 24 ? _isValidUTF8(buf) : isUtf8(buf);\n  };\n} /* istanbul ignore else  */ else if (!process.env.WS_NO_UTF_8_VALIDATE) {\n  try {\n    const isValidUTF8 = require('utf-8-validate');\n\n    module.exports.isValidUTF8 = function (buf) {\n      return buf.length < 32 ? _isValidUTF8(buf) : isValidUTF8(buf);\n    };\n  } catch (e) {\n    // Continue regardless of the error.\n  }\n}\n","'use strict';\n\nconst { Writable } = require('stream');\n\nconst PerMessageDeflate = require('./permessage-deflate');\nconst {\n  BINARY_TYPES,\n  EMPTY_BUFFER,\n  kStatusCode,\n  kWebSocket\n} = require('./constants');\nconst { concat, toArrayBuffer, unmask } = require('./buffer-util');\nconst { isValidStatusCode, isValidUTF8 } = require('./validation');\n\nconst FastBuffer = Buffer[Symbol.species];\n\nconst GET_INFO = 0;\nconst GET_PAYLOAD_LENGTH_16 = 1;\nconst GET_PAYLOAD_LENGTH_64 = 2;\nconst GET_MASK = 3;\nconst GET_DATA = 4;\nconst INFLATING = 5;\nconst DEFER_EVENT = 6;\n\n/**\n * HyBi Receiver implementation.\n *\n * @extends Writable\n */\nclass Receiver extends Writable {\n  /**\n   * Creates a Receiver instance.\n   *\n   * @param {Object} [options] Options object\n   * @param {Boolean} [options.allowSynchronousEvents=true] Specifies whether\n   *     any of the `'message'`, `'ping'`, and `'pong'` events can be emitted\n   *     multiple times in the same tick\n   * @param {String} [options.binaryType=nodebuffer] The type for binary data\n   * @param {Object} [options.extensions] An object containing the negotiated\n   *     extensions\n   * @param {Boolean} [options.isServer=false] Specifies whether to operate in\n   *     client or server mode\n   * @param {Number} [options.maxPayload=0] The maximum allowed message length\n   * @param {Boolean} [options.skipUTF8Validation=false] Specifies whether or\n   *     not to skip UTF-8 validation for text and close messages\n   */\n  constructor(options = {}) {\n    super();\n\n    this._allowSynchronousEvents =\n      options.allowSynchronousEvents !== undefined\n        ? options.allowSynchronousEvents\n        : true;\n    this._binaryType = options.binaryType || BINARY_TYPES[0];\n    this._extensions = options.extensions || {};\n    this._isServer = !!options.isServer;\n    this._maxPayload = options.maxPayload | 0;\n    this._skipUTF8Validation = !!options.skipUTF8Validation;\n    this[kWebSocket] = undefined;\n\n    this._bufferedBytes = 0;\n    this._buffers = [];\n\n    this._compressed = false;\n    this._payloadLength = 0;\n    this._mask = undefined;\n    this._fragmented = 0;\n    this._masked = false;\n    this._fin = false;\n    this._opcode = 0;\n\n    this._totalPayloadLength = 0;\n    this._messageLength = 0;\n    this._fragments = [];\n\n    this._errored = false;\n    this._loop = false;\n    this._state = GET_INFO;\n  }\n\n  /**\n   * Implements `Writable.prototype._write()`.\n   *\n   * @param {Buffer} chunk The chunk of data to write\n   * @param {String} encoding The character encoding of `chunk`\n   * @param {Function} cb Callback\n   * @private\n   */\n  _write(chunk, encoding, cb) {\n    if (this._opcode === 0x08 && this._state == GET_INFO) return cb();\n\n    this._bufferedBytes += chunk.length;\n    this._buffers.push(chunk);\n    this.startLoop(cb);\n  }\n\n  /**\n   * Consumes `n` bytes from the buffered data.\n   *\n   * @param {Number} n The number of bytes to consume\n   * @return {Buffer} The consumed bytes\n   * @private\n   */\n  consume(n) {\n    this._bufferedBytes -= n;\n\n    if (n === this._buffers[0].length) return this._buffers.shift();\n\n    if (n < this._buffers[0].length) {\n      const buf = this._buffers[0];\n      this._buffers[0] = new FastBuffer(\n        buf.buffer,\n        buf.byteOffset + n,\n        buf.length - n\n      );\n\n      return new FastBuffer(buf.buffer, buf.byteOffset, n);\n    }\n\n    const dst = Buffer.allocUnsafe(n);\n\n    do {\n      const buf = this._buffers[0];\n      const offset = dst.length - n;\n\n      if (n >= buf.length) {\n        dst.set(this._buffers.shift(), offset);\n      } else {\n        dst.set(new Uint8Array(buf.buffer, buf.byteOffset, n), offset);\n        this._buffers[0] = new FastBuffer(\n          buf.buffer,\n          buf.byteOffset + n,\n          buf.length - n\n        );\n      }\n\n      n -= buf.length;\n    } while (n > 0);\n\n    return dst;\n  }\n\n  /**\n   * Starts the parsing loop.\n   *\n   * @param {Function} cb Callback\n   * @private\n   */\n  startLoop(cb) {\n    this._loop = true;\n\n    do {\n      switch (this._state) {\n        case GET_INFO:\n          this.getInfo(cb);\n          break;\n        case GET_PAYLOAD_LENGTH_16:\n          this.getPayloadLength16(cb);\n          break;\n        case GET_PAYLOAD_LENGTH_64:\n          this.getPayloadLength64(cb);\n          break;\n        case GET_MASK:\n          this.getMask();\n          break;\n        case GET_DATA:\n          this.getData(cb);\n          break;\n        case INFLATING:\n        case DEFER_EVENT:\n          this._loop = false;\n          return;\n      }\n    } while (this._loop);\n\n    if (!this._errored) cb();\n  }\n\n  /**\n   * Reads the first two bytes of a frame.\n   *\n   * @param {Function} cb Callback\n   * @private\n   */\n  getInfo(cb) {\n    if (this._bufferedBytes < 2) {\n      this._loop = false;\n      return;\n    }\n\n    const buf = this.consume(2);\n\n    if ((buf[0] & 0x30) !== 0x00) {\n      const error = this.createError(\n        RangeError,\n        'RSV2 and RSV3 must be clear',\n        true,\n        1002,\n        'WS_ERR_UNEXPECTED_RSV_2_3'\n      );\n\n      cb(error);\n      return;\n    }\n\n    const compressed = (buf[0] & 0x40) === 0x40;\n\n    if (compressed && !this._extensions[PerMessageDeflate.extensionName]) {\n      const error = this.createError(\n        RangeError,\n        'RSV1 must be clear',\n        true,\n        1002,\n        'WS_ERR_UNEXPECTED_RSV_1'\n      );\n\n      cb(error);\n      return;\n    }\n\n    this._fin = (buf[0] & 0x80) === 0x80;\n    this._opcode = buf[0] & 0x0f;\n    this._payloadLength = buf[1] & 0x7f;\n\n    if (this._opcode === 0x00) {\n      if (compressed) {\n        const error = this.createError(\n          RangeError,\n          'RSV1 must be clear',\n          true,\n          1002,\n          'WS_ERR_UNEXPECTED_RSV_1'\n        );\n\n        cb(error);\n        return;\n      }\n\n      if (!this._fragmented) {\n        const error = this.createError(\n          RangeError,\n          'invalid opcode 0',\n          true,\n          1002,\n          'WS_ERR_INVALID_OPCODE'\n        );\n\n        cb(error);\n        return;\n      }\n\n      this._opcode = this._fragmented;\n    } else if (this._opcode === 0x01 || this._opcode === 0x02) {\n      if (this._fragmented) {\n        const error = this.createError(\n          RangeError,\n          `invalid opcode ${this._opcode}`,\n          true,\n          1002,\n          'WS_ERR_INVALID_OPCODE'\n        );\n\n        cb(error);\n        return;\n      }\n\n      this._compressed = compressed;\n    } else if (this._opcode > 0x07 && this._opcode < 0x0b) {\n      if (!this._fin) {\n        const error = this.createError(\n          RangeError,\n          'FIN must be set',\n          true,\n          1002,\n          'WS_ERR_EXPECTED_FIN'\n        );\n\n        cb(error);\n        return;\n      }\n\n      if (compressed) {\n        const error = this.createError(\n          RangeError,\n          'RSV1 must be clear',\n          true,\n          1002,\n          'WS_ERR_UNEXPECTED_RSV_1'\n        );\n\n        cb(error);\n        return;\n      }\n\n      if (\n        this._payloadLength > 0x7d ||\n        (this._opcode === 0x08 && this._payloadLength === 1)\n      ) {\n        const error = this.createError(\n          RangeError,\n          `invalid payload length ${this._payloadLength}`,\n          true,\n          1002,\n          'WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH'\n        );\n\n        cb(error);\n        return;\n      }\n    } else {\n      const error = this.createError(\n        RangeError,\n        `invalid opcode ${this._opcode}`,\n        true,\n        1002,\n        'WS_ERR_INVALID_OPCODE'\n      );\n\n      cb(error);\n      return;\n    }\n\n    if (!this._fin && !this._fragmented) this._fragmented = this._opcode;\n    this._masked = (buf[1] & 0x80) === 0x80;\n\n    if (this._isServer) {\n      if (!this._masked) {\n        const error = this.createError(\n          RangeError,\n          'MASK must be set',\n          true,\n          1002,\n          'WS_ERR_EXPECTED_MASK'\n        );\n\n        cb(error);\n        return;\n      }\n    } else if (this._masked) {\n      const error = this.createError(\n        RangeError,\n        'MASK must be clear',\n        true,\n        1002,\n        'WS_ERR_UNEXPECTED_MASK'\n      );\n\n      cb(error);\n      return;\n    }\n\n    if (this._payloadLength === 126) this._state = GET_PAYLOAD_LENGTH_16;\n    else if (this._payloadLength === 127) this._state = GET_PAYLOAD_LENGTH_64;\n    else this.haveLength(cb);\n  }\n\n  /**\n   * Gets extended payload length (7+16).\n   *\n   * @param {Function} cb Callback\n   * @private\n   */\n  getPayloadLength16(cb) {\n    if (this._bufferedBytes < 2) {\n      this._loop = false;\n      return;\n    }\n\n    this._payloadLength = this.consume(2).readUInt16BE(0);\n    this.haveLength(cb);\n  }\n\n  /**\n   * Gets extended payload length (7+64).\n   *\n   * @param {Function} cb Callback\n   * @private\n   */\n  getPayloadLength64(cb) {\n    if (this._bufferedBytes < 8) {\n      this._loop = false;\n      return;\n    }\n\n    const buf = this.consume(8);\n    const num = buf.readUInt32BE(0);\n\n    //\n    // The maximum safe integer in JavaScript is 2^53 - 1. An error is returned\n    // if payload length is greater than this number.\n    //\n    if (num > Math.pow(2, 53 - 32) - 1) {\n      const error = this.createError(\n        RangeError,\n        'Unsupported WebSocket frame: payload length > 2^53 - 1',\n        false,\n        1009,\n        'WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH'\n      );\n\n      cb(error);\n      return;\n    }\n\n    this._payloadLength = num * Math.pow(2, 32) + buf.readUInt32BE(4);\n    this.haveLength(cb);\n  }\n\n  /**\n   * Payload length has been read.\n   *\n   * @param {Function} cb Callback\n   * @private\n   */\n  haveLength(cb) {\n    if (this._payloadLength && this._opcode < 0x08) {\n      this._totalPayloadLength += this._payloadLength;\n      if (this._totalPayloadLength > this._maxPayload && this._maxPayload > 0) {\n        const error = this.createError(\n          RangeError,\n          'Max payload size exceeded',\n          false,\n          1009,\n          'WS_ERR_UNSUPPORTED_MESSAGE_LENGTH'\n        );\n\n        cb(error);\n        return;\n      }\n    }\n\n    if (this._masked) this._state = GET_MASK;\n    else this._state = GET_DATA;\n  }\n\n  /**\n   * Reads mask bytes.\n   *\n   * @private\n   */\n  getMask() {\n    if (this._bufferedBytes < 4) {\n      this._loop = false;\n      return;\n    }\n\n    this._mask = this.consume(4);\n    this._state = GET_DATA;\n  }\n\n  /**\n   * Reads data bytes.\n   *\n   * @param {Function} cb Callback\n   * @private\n   */\n  getData(cb) {\n    let data = EMPTY_BUFFER;\n\n    if (this._payloadLength) {\n      if (this._bufferedBytes < this._payloadLength) {\n        this._loop = false;\n        return;\n      }\n\n      data = this.consume(this._payloadLength);\n\n      if (\n        this._masked &&\n        (this._mask[0] | this._mask[1] | this._mask[2] | this._mask[3]) !== 0\n      ) {\n        unmask(data, this._mask);\n      }\n    }\n\n    if (this._opcode > 0x07) {\n      this.controlMessage(data, cb);\n      return;\n    }\n\n    if (this._compressed) {\n      this._state = INFLATING;\n      this.decompress(data, cb);\n      return;\n    }\n\n    if (data.length) {\n      //\n      // This message is not compressed so its length is the sum of the payload\n      // length of all fragments.\n      //\n      this._messageLength = this._totalPayloadLength;\n      this._fragments.push(data);\n    }\n\n    this.dataMessage(cb);\n  }\n\n  /**\n   * Decompresses data.\n   *\n   * @param {Buffer} data Compressed data\n   * @param {Function} cb Callback\n   * @private\n   */\n  decompress(data, cb) {\n    const perMessageDeflate = this._extensions[PerMessageDeflate.extensionName];\n\n    perMessageDeflate.decompress(data, this._fin, (err, buf) => {\n      if (err) return cb(err);\n\n      if (buf.length) {\n        this._messageLength += buf.length;\n        if (this._messageLength > this._maxPayload && this._maxPayload > 0) {\n          const error = this.createError(\n            RangeError,\n            'Max payload size exceeded',\n            false,\n            1009,\n            'WS_ERR_UNSUPPORTED_MESSAGE_LENGTH'\n          );\n\n          cb(error);\n          return;\n        }\n\n        this._fragments.push(buf);\n      }\n\n      this.dataMessage(cb);\n      if (this._state === GET_INFO) this.startLoop(cb);\n    });\n  }\n\n  /**\n   * Handles a data message.\n   *\n   * @param {Function} cb Callback\n   * @private\n   */\n  dataMessage(cb) {\n    if (!this._fin) {\n      this._state = GET_INFO;\n      return;\n    }\n\n    const messageLength = this._messageLength;\n    const fragments = this._fragments;\n\n    this._totalPayloadLength = 0;\n    this._messageLength = 0;\n    this._fragmented = 0;\n    this._fragments = [];\n\n    if (this._opcode === 2) {\n      let data;\n\n      if (this._binaryType === 'nodebuffer') {\n        data = concat(fragments, messageLength);\n      } else if (this._binaryType === 'arraybuffer') {\n        data = toArrayBuffer(concat(fragments, messageLength));\n      } else if (this._binaryType === 'blob') {\n        data = new Blob(fragments);\n      } else {\n        data = fragments;\n      }\n\n      if (this._allowSynchronousEvents) {\n        this.emit('message', data, true);\n        this._state = GET_INFO;\n      } else {\n        this._state = DEFER_EVENT;\n        setImmediate(() => {\n          this.emit('message', data, true);\n          this._state = GET_INFO;\n          this.startLoop(cb);\n        });\n      }\n    } else {\n      const buf = concat(fragments, messageLength);\n\n      if (!this._skipUTF8Validation && !isValidUTF8(buf)) {\n        const error = this.createError(\n          Error,\n          'invalid UTF-8 sequence',\n          true,\n          1007,\n          'WS_ERR_INVALID_UTF8'\n        );\n\n        cb(error);\n        return;\n      }\n\n      if (this._state === INFLATING || this._allowSynchronousEvents) {\n        this.emit('message', buf, false);\n        this._state = GET_INFO;\n      } else {\n        this._state = DEFER_EVENT;\n        setImmediate(() => {\n          this.emit('message', buf, false);\n          this._state = GET_INFO;\n          this.startLoop(cb);\n        });\n      }\n    }\n  }\n\n  /**\n   * Handles a control message.\n   *\n   * @param {Buffer} data Data to handle\n   * @return {(Error|RangeError|undefined)} A possible error\n   * @private\n   */\n  controlMessage(data, cb) {\n    if (this._opcode === 0x08) {\n      if (data.length === 0) {\n        this._loop = false;\n        this.emit('conclude', 1005, EMPTY_BUFFER);\n        this.end();\n      } else {\n        const code = data.readUInt16BE(0);\n\n        if (!isValidStatusCode(code)) {\n          const error = this.createError(\n            RangeError,\n            `invalid status code ${code}`,\n            true,\n            1002,\n            'WS_ERR_INVALID_CLOSE_CODE'\n          );\n\n          cb(error);\n          return;\n        }\n\n        const buf = new FastBuffer(\n          data.buffer,\n          data.byteOffset + 2,\n          data.length - 2\n        );\n\n        if (!this._skipUTF8Validation && !isValidUTF8(buf)) {\n          const error = this.createError(\n            Error,\n            'invalid UTF-8 sequence',\n            true,\n            1007,\n            'WS_ERR_INVALID_UTF8'\n          );\n\n          cb(error);\n          return;\n        }\n\n        this._loop = false;\n        this.emit('conclude', code, buf);\n        this.end();\n      }\n\n      this._state = GET_INFO;\n      return;\n    }\n\n    if (this._allowSynchronousEvents) {\n      this.emit(this._opcode === 0x09 ? 'ping' : 'pong', data);\n      this._state = GET_INFO;\n    } else {\n      this._state = DEFER_EVENT;\n      setImmediate(() => {\n        this.emit(this._opcode === 0x09 ? 'ping' : 'pong', data);\n        this._state = GET_INFO;\n        this.startLoop(cb);\n      });\n    }\n  }\n\n  /**\n   * Builds an error object.\n   *\n   * @param {function(new:Error|RangeError)} ErrorCtor The error constructor\n   * @param {String} message The error message\n   * @param {Boolean} prefix Specifies whether or not to add a default prefix to\n   *     `message`\n   * @param {Number} statusCode The status code\n   * @param {String} errorCode The exposed error code\n   * @return {(Error|RangeError)} The error\n   * @private\n   */\n  createError(ErrorCtor, message, prefix, statusCode, errorCode) {\n    this._loop = false;\n    this._errored = true;\n\n    const err = new ErrorCtor(\n      prefix ? `Invalid WebSocket frame: ${message}` : message\n    );\n\n    Error.captureStackTrace(err, this.createError);\n    err.code = errorCode;\n    err[kStatusCode] = statusCode;\n    return err;\n  }\n}\n\nmodule.exports = Receiver;\n","/* eslint no-unused-vars: [\"error\", { \"varsIgnorePattern\": \"^Duplex\" }] */\n\n'use strict';\n\nconst { Duplex } = require('stream');\nconst { randomFillSync } = require('crypto');\n\nconst PerMessageDeflate = require('./permessage-deflate');\nconst { EMPTY_BUFFER, kWebSocket, NOOP } = require('./constants');\nconst { isBlob, isValidStatusCode } = require('./validation');\nconst { mask: applyMask, toBuffer } = require('./buffer-util');\n\nconst kByteLength = Symbol('kByteLength');\nconst maskBuffer = Buffer.alloc(4);\nconst RANDOM_POOL_SIZE = 8 * 1024;\nlet randomPool;\nlet randomPoolPointer = RANDOM_POOL_SIZE;\n\nconst DEFAULT = 0;\nconst DEFLATING = 1;\nconst GET_BLOB_DATA = 2;\n\n/**\n * HyBi Sender implementation.\n */\nclass Sender {\n  /**\n   * Creates a Sender instance.\n   *\n   * @param {Duplex} socket The connection socket\n   * @param {Object} [extensions] An object containing the negotiated extensions\n   * @param {Function} [generateMask] The function used to generate the masking\n   *     key\n   */\n  constructor(socket, extensions, generateMask) {\n    this._extensions = extensions || {};\n\n    if (generateMask) {\n      this._generateMask = generateMask;\n      this._maskBuffer = Buffer.alloc(4);\n    }\n\n    this._socket = socket;\n\n    this._firstFragment = true;\n    this._compress = false;\n\n    this._bufferedBytes = 0;\n    this._queue = [];\n    this._state = DEFAULT;\n    this.onerror = NOOP;\n    this[kWebSocket] = undefined;\n  }\n\n  /**\n   * Frames a piece of data according to the HyBi WebSocket protocol.\n   *\n   * @param {(Buffer|String)} data The data to frame\n   * @param {Object} options Options object\n   * @param {Boolean} [options.fin=false] Specifies whether or not to set the\n   *     FIN bit\n   * @param {Function} [options.generateMask] The function used to generate the\n   *     masking key\n   * @param {Boolean} [options.mask=false] Specifies whether or not to mask\n   *     `data`\n   * @param {Buffer} [options.maskBuffer] The buffer used to store the masking\n   *     key\n   * @param {Number} options.opcode The opcode\n   * @param {Boolean} [options.readOnly=false] Specifies whether `data` can be\n   *     modified\n   * @param {Boolean} [options.rsv1=false] Specifies whether or not to set the\n   *     RSV1 bit\n   * @return {(Buffer|String)[]} The framed data\n   * @public\n   */\n  static frame(data, options) {\n    let mask;\n    let merge = false;\n    let offset = 2;\n    let skipMasking = false;\n\n    if (options.mask) {\n      mask = options.maskBuffer || maskBuffer;\n\n      if (options.generateMask) {\n        options.generateMask(mask);\n      } else {\n        if (randomPoolPointer === RANDOM_POOL_SIZE) {\n          /* istanbul ignore else  */\n          if (randomPool === undefined) {\n            //\n            // This is lazily initialized because server-sent frames must not\n            // be masked so it may never be used.\n            //\n            randomPool = Buffer.alloc(RANDOM_POOL_SIZE);\n          }\n\n          randomFillSync(randomPool, 0, RANDOM_POOL_SIZE);\n          randomPoolPointer = 0;\n        }\n\n        mask[0] = randomPool[randomPoolPointer++];\n        mask[1] = randomPool[randomPoolPointer++];\n        mask[2] = randomPool[randomPoolPointer++];\n        mask[3] = randomPool[randomPoolPointer++];\n      }\n\n      skipMasking = (mask[0] | mask[1] | mask[2] | mask[3]) === 0;\n      offset = 6;\n    }\n\n    let dataLength;\n\n    if (typeof data === 'string') {\n      if (\n        (!options.mask || skipMasking) &&\n        options[kByteLength] !== undefined\n      ) {\n        dataLength = options[kByteLength];\n      } else {\n        data = Buffer.from(data);\n        dataLength = data.length;\n      }\n    } else {\n      dataLength = data.length;\n      merge = options.mask && options.readOnly && !skipMasking;\n    }\n\n    let payloadLength = dataLength;\n\n    if (dataLength >= 65536) {\n      offset += 8;\n      payloadLength = 127;\n    } else if (dataLength > 125) {\n      offset += 2;\n      payloadLength = 126;\n    }\n\n    const target = Buffer.allocUnsafe(merge ? dataLength + offset : offset);\n\n    target[0] = options.fin ? options.opcode | 0x80 : options.opcode;\n    if (options.rsv1) target[0] |= 0x40;\n\n    target[1] = payloadLength;\n\n    if (payloadLength === 126) {\n      target.writeUInt16BE(dataLength, 2);\n    } else if (payloadLength === 127) {\n      target[2] = target[3] = 0;\n      target.writeUIntBE(dataLength, 4, 6);\n    }\n\n    if (!options.mask) return [target, data];\n\n    target[1] |= 0x80;\n    target[offset - 4] = mask[0];\n    target[offset - 3] = mask[1];\n    target[offset - 2] = mask[2];\n    target[offset - 1] = mask[3];\n\n    if (skipMasking) return [target, data];\n\n    if (merge) {\n      applyMask(data, mask, target, offset, dataLength);\n      return [target];\n    }\n\n    applyMask(data, mask, data, 0, dataLength);\n    return [target, data];\n  }\n\n  /**\n   * Sends a close message to the other peer.\n   *\n   * @param {Number} [code] The status code component of the body\n   * @param {(String|Buffer)} [data] The message component of the body\n   * @param {Boolean} [mask=false] Specifies whether or not to mask the message\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  close(code, data, mask, cb) {\n    let buf;\n\n    if (code === undefined) {\n      buf = EMPTY_BUFFER;\n    } else if (typeof code !== 'number' || !isValidStatusCode(code)) {\n      throw new TypeError('First argument must be a valid error code number');\n    } else if (data === undefined || !data.length) {\n      buf = Buffer.allocUnsafe(2);\n      buf.writeUInt16BE(code, 0);\n    } else {\n      const length = Buffer.byteLength(data);\n\n      if (length > 123) {\n        throw new RangeError('The message must not be greater than 123 bytes');\n      }\n\n      buf = Buffer.allocUnsafe(2 + length);\n      buf.writeUInt16BE(code, 0);\n\n      if (typeof data === 'string') {\n        buf.write(data, 2);\n      } else {\n        buf.set(data, 2);\n      }\n    }\n\n    const options = {\n      [kByteLength]: buf.length,\n      fin: true,\n      generateMask: this._generateMask,\n      mask,\n      maskBuffer: this._maskBuffer,\n      opcode: 0x08,\n      readOnly: false,\n      rsv1: false\n    };\n\n    if (this._state !== DEFAULT) {\n      this.enqueue([this.dispatch, buf, false, options, cb]);\n    } else {\n      this.sendFrame(Sender.frame(buf, options), cb);\n    }\n  }\n\n  /**\n   * Sends a ping message to the other peer.\n   *\n   * @param {*} data The message to send\n   * @param {Boolean} [mask=false] Specifies whether or not to mask `data`\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  ping(data, mask, cb) {\n    let byteLength;\n    let readOnly;\n\n    if (typeof data === 'string') {\n      byteLength = Buffer.byteLength(data);\n      readOnly = false;\n    } else if (isBlob(data)) {\n      byteLength = data.size;\n      readOnly = false;\n    } else {\n      data = toBuffer(data);\n      byteLength = data.length;\n      readOnly = toBuffer.readOnly;\n    }\n\n    if (byteLength > 125) {\n      throw new RangeError('The data size must not be greater than 125 bytes');\n    }\n\n    const options = {\n      [kByteLength]: byteLength,\n      fin: true,\n      generateMask: this._generateMask,\n      mask,\n      maskBuffer: this._maskBuffer,\n      opcode: 0x09,\n      readOnly,\n      rsv1: false\n    };\n\n    if (isBlob(data)) {\n      if (this._state !== DEFAULT) {\n        this.enqueue([this.getBlobData, data, false, options, cb]);\n      } else {\n        this.getBlobData(data, false, options, cb);\n      }\n    } else if (this._state !== DEFAULT) {\n      this.enqueue([this.dispatch, data, false, options, cb]);\n    } else {\n      this.sendFrame(Sender.frame(data, options), cb);\n    }\n  }\n\n  /**\n   * Sends a pong message to the other peer.\n   *\n   * @param {*} data The message to send\n   * @param {Boolean} [mask=false] Specifies whether or not to mask `data`\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  pong(data, mask, cb) {\n    let byteLength;\n    let readOnly;\n\n    if (typeof data === 'string') {\n      byteLength = Buffer.byteLength(data);\n      readOnly = false;\n    } else if (isBlob(data)) {\n      byteLength = data.size;\n      readOnly = false;\n    } else {\n      data = toBuffer(data);\n      byteLength = data.length;\n      readOnly = toBuffer.readOnly;\n    }\n\n    if (byteLength > 125) {\n      throw new RangeError('The data size must not be greater than 125 bytes');\n    }\n\n    const options = {\n      [kByteLength]: byteLength,\n      fin: true,\n      generateMask: this._generateMask,\n      mask,\n      maskBuffer: this._maskBuffer,\n      opcode: 0x0a,\n      readOnly,\n      rsv1: false\n    };\n\n    if (isBlob(data)) {\n      if (this._state !== DEFAULT) {\n        this.enqueue([this.getBlobData, data, false, options, cb]);\n      } else {\n        this.getBlobData(data, false, options, cb);\n      }\n    } else if (this._state !== DEFAULT) {\n      this.enqueue([this.dispatch, data, false, options, cb]);\n    } else {\n      this.sendFrame(Sender.frame(data, options), cb);\n    }\n  }\n\n  /**\n   * Sends a data message to the other peer.\n   *\n   * @param {*} data The message to send\n   * @param {Object} options Options object\n   * @param {Boolean} [options.binary=false] Specifies whether `data` is binary\n   *     or text\n   * @param {Boolean} [options.compress=false] Specifies whether or not to\n   *     compress `data`\n   * @param {Boolean} [options.fin=false] Specifies whether the fragment is the\n   *     last one\n   * @param {Boolean} [options.mask=false] Specifies whether or not to mask\n   *     `data`\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  send(data, options, cb) {\n    const perMessageDeflate = this._extensions[PerMessageDeflate.extensionName];\n    let opcode = options.binary ? 2 : 1;\n    let rsv1 = options.compress;\n\n    let byteLength;\n    let readOnly;\n\n    if (typeof data === 'string') {\n      byteLength = Buffer.byteLength(data);\n      readOnly = false;\n    } else if (isBlob(data)) {\n      byteLength = data.size;\n      readOnly = false;\n    } else {\n      data = toBuffer(data);\n      byteLength = data.length;\n      readOnly = toBuffer.readOnly;\n    }\n\n    if (this._firstFragment) {\n      this._firstFragment = false;\n      if (\n        rsv1 &&\n        perMessageDeflate &&\n        perMessageDeflate.params[\n          perMessageDeflate._isServer\n            ? 'server_no_context_takeover'\n            : 'client_no_context_takeover'\n        ]\n      ) {\n        rsv1 = byteLength >= perMessageDeflate._threshold;\n      }\n      this._compress = rsv1;\n    } else {\n      rsv1 = false;\n      opcode = 0;\n    }\n\n    if (options.fin) this._firstFragment = true;\n\n    const opts = {\n      [kByteLength]: byteLength,\n      fin: options.fin,\n      generateMask: this._generateMask,\n      mask: options.mask,\n      maskBuffer: this._maskBuffer,\n      opcode,\n      readOnly,\n      rsv1\n    };\n\n    if (isBlob(data)) {\n      if (this._state !== DEFAULT) {\n        this.enqueue([this.getBlobData, data, this._compress, opts, cb]);\n      } else {\n        this.getBlobData(data, this._compress, opts, cb);\n      }\n    } else if (this._state !== DEFAULT) {\n      this.enqueue([this.dispatch, data, this._compress, opts, cb]);\n    } else {\n      this.dispatch(data, this._compress, opts, cb);\n    }\n  }\n\n  /**\n   * Gets the contents of a blob as binary data.\n   *\n   * @param {Blob} blob The blob\n   * @param {Boolean} [compress=false] Specifies whether or not to compress\n   *     the data\n   * @param {Object} options Options object\n   * @param {Boolean} [options.fin=false] Specifies whether or not to set the\n   *     FIN bit\n   * @param {Function} [options.generateMask] The function used to generate the\n   *     masking key\n   * @param {Boolean} [options.mask=false] Specifies whether or not to mask\n   *     `data`\n   * @param {Buffer} [options.maskBuffer] The buffer used to store the masking\n   *     key\n   * @param {Number} options.opcode The opcode\n   * @param {Boolean} [options.readOnly=false] Specifies whether `data` can be\n   *     modified\n   * @param {Boolean} [options.rsv1=false] Specifies whether or not to set the\n   *     RSV1 bit\n   * @param {Function} [cb] Callback\n   * @private\n   */\n  getBlobData(blob, compress, options, cb) {\n    this._bufferedBytes += options[kByteLength];\n    this._state = GET_BLOB_DATA;\n\n    blob\n      .arrayBuffer()\n      .then((arrayBuffer) => {\n        if (this._socket.destroyed) {\n          const err = new Error(\n            'The socket was closed while the blob was being read'\n          );\n\n          //\n          // `callCallbacks` is called in the next tick to ensure that errors\n          // that might be thrown in the callbacks behave like errors thrown\n          // outside the promise chain.\n          //\n          process.nextTick(callCallbacks, this, err, cb);\n          return;\n        }\n\n        this._bufferedBytes -= options[kByteLength];\n        const data = toBuffer(arrayBuffer);\n\n        if (!compress) {\n          this._state = DEFAULT;\n          this.sendFrame(Sender.frame(data, options), cb);\n          this.dequeue();\n        } else {\n          this.dispatch(data, compress, options, cb);\n        }\n      })\n      .catch((err) => {\n        //\n        // `onError` is called in the next tick for the same reason that\n        // `callCallbacks` above is.\n        //\n        process.nextTick(onError, this, err, cb);\n      });\n  }\n\n  /**\n   * Dispatches a message.\n   *\n   * @param {(Buffer|String)} data The message to send\n   * @param {Boolean} [compress=false] Specifies whether or not to compress\n   *     `data`\n   * @param {Object} options Options object\n   * @param {Boolean} [options.fin=false] Specifies whether or not to set the\n   *     FIN bit\n   * @param {Function} [options.generateMask] The function used to generate the\n   *     masking key\n   * @param {Boolean} [options.mask=false] Specifies whether or not to mask\n   *     `data`\n   * @param {Buffer} [options.maskBuffer] The buffer used to store the masking\n   *     key\n   * @param {Number} options.opcode The opcode\n   * @param {Boolean} [options.readOnly=false] Specifies whether `data` can be\n   *     modified\n   * @param {Boolean} [options.rsv1=false] Specifies whether or not to set the\n   *     RSV1 bit\n   * @param {Function} [cb] Callback\n   * @private\n   */\n  dispatch(data, compress, options, cb) {\n    if (!compress) {\n      this.sendFrame(Sender.frame(data, options), cb);\n      return;\n    }\n\n    const perMessageDeflate = this._extensions[PerMessageDeflate.extensionName];\n\n    this._bufferedBytes += options[kByteLength];\n    this._state = DEFLATING;\n    perMessageDeflate.compress(data, options.fin, (_, buf) => {\n      if (this._socket.destroyed) {\n        const err = new Error(\n          'The socket was closed while data was being compressed'\n        );\n\n        callCallbacks(this, err, cb);\n        return;\n      }\n\n      this._bufferedBytes -= options[kByteLength];\n      this._state = DEFAULT;\n      options.readOnly = false;\n      this.sendFrame(Sender.frame(buf, options), cb);\n      this.dequeue();\n    });\n  }\n\n  /**\n   * Executes queued send operations.\n   *\n   * @private\n   */\n  dequeue() {\n    while (this._state === DEFAULT && this._queue.length) {\n      const params = this._queue.shift();\n\n      this._bufferedBytes -= params[3][kByteLength];\n      Reflect.apply(params[0], this, params.slice(1));\n    }\n  }\n\n  /**\n   * Enqueues a send operation.\n   *\n   * @param {Array} params Send operation parameters.\n   * @private\n   */\n  enqueue(params) {\n    this._bufferedBytes += params[3][kByteLength];\n    this._queue.push(params);\n  }\n\n  /**\n   * Sends a frame.\n   *\n   * @param {Buffer[]} list The frame to send\n   * @param {Function} [cb] Callback\n   * @private\n   */\n  sendFrame(list, cb) {\n    if (list.length === 2) {\n      this._socket.cork();\n      this._socket.write(list[0]);\n      this._socket.write(list[1], cb);\n      this._socket.uncork();\n    } else {\n      this._socket.write(list[0], cb);\n    }\n  }\n}\n\nmodule.exports = Sender;\n\n/**\n * Calls queued callbacks with an error.\n *\n * @param {Sender} sender The `Sender` instance\n * @param {Error} err The error to call the callbacks with\n * @param {Function} [cb] The first callback\n * @private\n */\nfunction callCallbacks(sender, err, cb) {\n  if (typeof cb === 'function') cb(err);\n\n  for (let i = 0; i < sender._queue.length; i++) {\n    const params = sender._queue[i];\n    const callback = params[params.length - 1];\n\n    if (typeof callback === 'function') callback(err);\n  }\n}\n\n/**\n * Handles a `Sender` error.\n *\n * @param {Sender} sender The `Sender` instance\n * @param {Error} err The error\n * @param {Function} [cb] The first pending callback\n * @private\n */\nfunction onError(sender, err, cb) {\n  callCallbacks(sender, err, cb);\n  sender.onerror(err);\n}\n","'use strict';\n\nconst { tokenChars } = require('./validation');\n\n/**\n * Adds an offer to the map of extension offers or a parameter to the map of\n * parameters.\n *\n * @param {Object} dest The map of extension offers or parameters\n * @param {String} name The extension or parameter name\n * @param {(Object|Boolean|String)} elem The extension parameters or the\n *     parameter value\n * @private\n */\nfunction push(dest, name, elem) {\n  if (dest[name] === undefined) dest[name] = [elem];\n  else dest[name].push(elem);\n}\n\n/**\n * Parses the `Sec-WebSocket-Extensions` header into an object.\n *\n * @param {String} header The field value of the header\n * @return {Object} The parsed object\n * @public\n */\nfunction parse(header) {\n  const offers = Object.create(null);\n  let params = Object.create(null);\n  let mustUnescape = false;\n  let isEscaping = false;\n  let inQuotes = false;\n  let extensionName;\n  let paramName;\n  let start = -1;\n  let code = -1;\n  let end = -1;\n  let i = 0;\n\n  for (; i < header.length; i++) {\n    code = header.charCodeAt(i);\n\n    if (extensionName === undefined) {\n      if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (\n        i !== 0 &&\n        (code === 0x20 /* ' ' */ || code === 0x09) /* '\\t' */\n      ) {\n        if (end === -1 && start !== -1) end = i;\n      } else if (code === 0x3b /* ';' */ || code === 0x2c /* ',' */) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        const name = header.slice(start, end);\n        if (code === 0x2c) {\n          push(offers, name, params);\n          params = Object.create(null);\n        } else {\n          extensionName = name;\n        }\n\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    } else if (paramName === undefined) {\n      if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (code === 0x20 || code === 0x09) {\n        if (end === -1 && start !== -1) end = i;\n      } else if (code === 0x3b || code === 0x2c) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        push(params, header.slice(start, end), true);\n        if (code === 0x2c) {\n          push(offers, extensionName, params);\n          params = Object.create(null);\n          extensionName = undefined;\n        }\n\n        start = end = -1;\n      } else if (code === 0x3d /* '=' */ && start !== -1 && end === -1) {\n        paramName = header.slice(start, i);\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    } else {\n      //\n      // The value of a quoted-string after unescaping must conform to the\n      // token ABNF, so only token characters are valid.\n      // Ref: https://tools.ietf.org/html/rfc6455#section-9.1\n      //\n      if (isEscaping) {\n        if (tokenChars[code] !== 1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n        if (start === -1) start = i;\n        else if (!mustUnescape) mustUnescape = true;\n        isEscaping = false;\n      } else if (inQuotes) {\n        if (tokenChars[code] === 1) {\n          if (start === -1) start = i;\n        } else if (code === 0x22 /* '\"' */ && start !== -1) {\n          inQuotes = false;\n          end = i;\n        } else if (code === 0x5c /* '\\' */) {\n          isEscaping = true;\n        } else {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n      } else if (code === 0x22 && header.charCodeAt(i - 1) === 0x3d) {\n        inQuotes = true;\n      } else if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (start !== -1 && (code === 0x20 || code === 0x09)) {\n        if (end === -1) end = i;\n      } else if (code === 0x3b || code === 0x2c) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        let value = header.slice(start, end);\n        if (mustUnescape) {\n          value = value.replace(/\\\\/g, '');\n          mustUnescape = false;\n        }\n        push(params, paramName, value);\n        if (code === 0x2c) {\n          push(offers, extensionName, params);\n          params = Object.create(null);\n          extensionName = undefined;\n        }\n\n        paramName = undefined;\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    }\n  }\n\n  if (start === -1 || inQuotes || code === 0x20 || code === 0x09) {\n    throw new SyntaxError('Unexpected end of input');\n  }\n\n  if (end === -1) end = i;\n  const token = header.slice(start, end);\n  if (extensionName === undefined) {\n    push(offers, token, params);\n  } else {\n    if (paramName === undefined) {\n      push(params, token, true);\n    } else if (mustUnescape) {\n      push(params, paramName, token.replace(/\\\\/g, ''));\n    } else {\n      push(params, paramName, token);\n    }\n    push(offers, extensionName, params);\n  }\n\n  return offers;\n}\n\n/**\n * Builds the `Sec-WebSocket-Extensions` header field value.\n *\n * @param {Object} extensions The map of extensions and parameters to format\n * @return {String} A string representing the given object\n * @public\n */\nfunction format(extensions) {\n  return Object.keys(extensions)\n    .map((extension) => {\n      let configurations = extensions[extension];\n      if (!Array.isArray(configurations)) configurations = [configurations];\n      return configurations\n        .map((params) => {\n          return [extension]\n            .concat(\n              Object.keys(params).map((k) => {\n                let values = params[k];\n                if (!Array.isArray(values)) values = [values];\n                return values\n                  .map((v) => (v === true ? k : `${k}=${v}`))\n                  .join('; ');\n              })\n            )\n            .join('; ');\n        })\n        .join(', ');\n    })\n    .join(', ');\n}\n\nmodule.exports = { format, parse };\n","/* eslint no-unused-vars: [\"error\", { \"varsIgnorePattern\": \"^Duplex|Readable$\", \"caughtErrors\": \"none\" }] */\n\n'use strict';\n\nconst EventEmitter = require('events');\nconst https = require('https');\nconst http = require('http');\nconst net = require('net');\nconst tls = require('tls');\nconst { randomBytes, createHash } = require('crypto');\nconst { Duplex, Readable } = require('stream');\nconst { URL } = require('url');\n\nconst PerMessageDeflate = require('./permessage-deflate');\nconst Receiver = require('./receiver');\nconst Sender = require('./sender');\nconst { isBlob } = require('./validation');\n\nconst {\n  BINARY_TYPES,\n  EMPTY_BUFFER,\n  GUID,\n  kForOnEventAttribute,\n  kListener,\n  kStatusCode,\n  kWebSocket,\n  NOOP\n} = require('./constants');\nconst {\n  EventTarget: { addEventListener, removeEventListener }\n} = require('./event-target');\nconst { format, parse } = require('./extension');\nconst { toBuffer } = require('./buffer-util');\n\nconst closeTimeout = 30 * 1000;\nconst kAborted = Symbol('kAborted');\nconst protocolVersions = [8, 13];\nconst readyStates = ['CONNECTING', 'OPEN', 'CLOSING', 'CLOSED'];\nconst subprotocolRegex = /^[!#$%&'*+\\-.0-9A-Z^_`|a-z~]+$/;\n\n/**\n * Class representing a WebSocket.\n *\n * @extends EventEmitter\n */\nclass WebSocket extends EventEmitter {\n  /**\n   * Create a new `WebSocket`.\n   *\n   * @param {(String|URL)} address The URL to which to connect\n   * @param {(String|String[])} [protocols] The subprotocols\n   * @param {Object} [options] Connection options\n   */\n  constructor(address, protocols, options) {\n    super();\n\n    this._binaryType = BINARY_TYPES[0];\n    this._closeCode = 1006;\n    this._closeFrameReceived = false;\n    this._closeFrameSent = false;\n    this._closeMessage = EMPTY_BUFFER;\n    this._closeTimer = null;\n    this._errorEmitted = false;\n    this._extensions = {};\n    this._paused = false;\n    this._protocol = '';\n    this._readyState = WebSocket.CONNECTING;\n    this._receiver = null;\n    this._sender = null;\n    this._socket = null;\n\n    if (address !== null) {\n      this._bufferedAmount = 0;\n      this._isServer = false;\n      this._redirects = 0;\n\n      if (protocols === undefined) {\n        protocols = [];\n      } else if (!Array.isArray(protocols)) {\n        if (typeof protocols === 'object' && protocols !== null) {\n          options = protocols;\n          protocols = [];\n        } else {\n          protocols = [protocols];\n        }\n      }\n\n      initAsClient(this, address, protocols, options);\n    } else {\n      this._autoPong = options.autoPong;\n      this._isServer = true;\n    }\n  }\n\n  /**\n   * For historical reasons, the custom \"nodebuffer\" type is used by the default\n   * instead of \"blob\".\n   *\n   * @type {String}\n   */\n  get binaryType() {\n    return this._binaryType;\n  }\n\n  set binaryType(type) {\n    if (!BINARY_TYPES.includes(type)) return;\n\n    this._binaryType = type;\n\n    //\n    // Allow to change `binaryType` on the fly.\n    //\n    if (this._receiver) this._receiver._binaryType = type;\n  }\n\n  /**\n   * @type {Number}\n   */\n  get bufferedAmount() {\n    if (!this._socket) return this._bufferedAmount;\n\n    return this._socket._writableState.length + this._sender._bufferedBytes;\n  }\n\n  /**\n   * @type {String}\n   */\n  get extensions() {\n    return Object.keys(this._extensions).join();\n  }\n\n  /**\n   * @type {Boolean}\n   */\n  get isPaused() {\n    return this._paused;\n  }\n\n  /**\n   * @type {Function}\n   */\n  /* istanbul ignore next */\n  get onclose() {\n    return null;\n  }\n\n  /**\n   * @type {Function}\n   */\n  /* istanbul ignore next */\n  get onerror() {\n    return null;\n  }\n\n  /**\n   * @type {Function}\n   */\n  /* istanbul ignore next */\n  get onopen() {\n    return null;\n  }\n\n  /**\n   * @type {Function}\n   */\n  /* istanbul ignore next */\n  get onmessage() {\n    return null;\n  }\n\n  /**\n   * @type {String}\n   */\n  get protocol() {\n    return this._protocol;\n  }\n\n  /**\n   * @type {Number}\n   */\n  get readyState() {\n    return this._readyState;\n  }\n\n  /**\n   * @type {String}\n   */\n  get url() {\n    return this._url;\n  }\n\n  /**\n   * Set up the socket and the internal resources.\n   *\n   * @param {Duplex} socket The network socket between the server and client\n   * @param {Buffer} head The first packet of the upgraded stream\n   * @param {Object} options Options object\n   * @param {Boolean} [options.allowSynchronousEvents=false] Specifies whether\n   *     any of the `'message'`, `'ping'`, and `'pong'` events can be emitted\n   *     multiple times in the same tick\n   * @param {Function} [options.generateMask] The function used to generate the\n   *     masking key\n   * @param {Number} [options.maxPayload=0] The maximum allowed message size\n   * @param {Boolean} [options.skipUTF8Validation=false] Specifies whether or\n   *     not to skip UTF-8 validation for text and close messages\n   * @private\n   */\n  setSocket(socket, head, options) {\n    const receiver = new Receiver({\n      allowSynchronousEvents: options.allowSynchronousEvents,\n      binaryType: this.binaryType,\n      extensions: this._extensions,\n      isServer: this._isServer,\n      maxPayload: options.maxPayload,\n      skipUTF8Validation: options.skipUTF8Validation\n    });\n\n    const sender = new Sender(socket, this._extensions, options.generateMask);\n\n    this._receiver = receiver;\n    this._sender = sender;\n    this._socket = socket;\n\n    receiver[kWebSocket] = this;\n    sender[kWebSocket] = this;\n    socket[kWebSocket] = this;\n\n    receiver.on('conclude', receiverOnConclude);\n    receiver.on('drain', receiverOnDrain);\n    receiver.on('error', receiverOnError);\n    receiver.on('message', receiverOnMessage);\n    receiver.on('ping', receiverOnPing);\n    receiver.on('pong', receiverOnPong);\n\n    sender.onerror = senderOnError;\n\n    //\n    // These methods may not be available if `socket` is just a `Duplex`.\n    //\n    if (socket.setTimeout) socket.setTimeout(0);\n    if (socket.setNoDelay) socket.setNoDelay();\n\n    if (head.length > 0) socket.unshift(head);\n\n    socket.on('close', socketOnClose);\n    socket.on('data', socketOnData);\n    socket.on('end', socketOnEnd);\n    socket.on('error', socketOnError);\n\n    this._readyState = WebSocket.OPEN;\n    this.emit('open');\n  }\n\n  /**\n   * Emit the `'close'` event.\n   *\n   * @private\n   */\n  emitClose() {\n    if (!this._socket) {\n      this._readyState = WebSocket.CLOSED;\n      this.emit('close', this._closeCode, this._closeMessage);\n      return;\n    }\n\n    if (this._extensions[PerMessageDeflate.extensionName]) {\n      this._extensions[PerMessageDeflate.extensionName].cleanup();\n    }\n\n    this._receiver.removeAllListeners();\n    this._readyState = WebSocket.CLOSED;\n    this.emit('close', this._closeCode, this._closeMessage);\n  }\n\n  /**\n   * Start a closing handshake.\n   *\n   *          +----------+   +-----------+   +----------+\n   *     - - -|ws.close()|-->|close frame|-->|ws.close()|- - -\n   *    |     +----------+   +-----------+   +----------+     |\n   *          +----------+   +-----------+         |\n   * CLOSING  |ws.close()|<--|close frame|<--+-----+       CLOSING\n   *          +----------+   +-----------+   |\n   *    |           |                        |   +---+        |\n   *                +------------------------+-->|fin| - - - -\n   *    |         +---+                      |   +---+\n   *     - - - - -|fin|<---------------------+\n   *              +---+\n   *\n   * @param {Number} [code] Status code explaining why the connection is closing\n   * @param {(String|Buffer)} [data] The reason why the connection is\n   *     closing\n   * @public\n   */\n  close(code, data) {\n    if (this.readyState === WebSocket.CLOSED) return;\n    if (this.readyState === WebSocket.CONNECTING) {\n      const msg = 'WebSocket was closed before the connection was established';\n      abortHandshake(this, this._req, msg);\n      return;\n    }\n\n    if (this.readyState === WebSocket.CLOSING) {\n      if (\n        this._closeFrameSent &&\n        (this._closeFrameReceived || this._receiver._writableState.errorEmitted)\n      ) {\n        this._socket.end();\n      }\n\n      return;\n    }\n\n    this._readyState = WebSocket.CLOSING;\n    this._sender.close(code, data, !this._isServer, (err) => {\n      //\n      // This error is handled by the `'error'` listener on the socket. We only\n      // want to know if the close frame has been sent here.\n      //\n      if (err) return;\n\n      this._closeFrameSent = true;\n\n      if (\n        this._closeFrameReceived ||\n        this._receiver._writableState.errorEmitted\n      ) {\n        this._socket.end();\n      }\n    });\n\n    setCloseTimer(this);\n  }\n\n  /**\n   * Pause the socket.\n   *\n   * @public\n   */\n  pause() {\n    if (\n      this.readyState === WebSocket.CONNECTING ||\n      this.readyState === WebSocket.CLOSED\n    ) {\n      return;\n    }\n\n    this._paused = true;\n    this._socket.pause();\n  }\n\n  /**\n   * Send a ping.\n   *\n   * @param {*} [data] The data to send\n   * @param {Boolean} [mask] Indicates whether or not to mask `data`\n   * @param {Function} [cb] Callback which is executed when the ping is sent\n   * @public\n   */\n  ping(data, mask, cb) {\n    if (this.readyState === WebSocket.CONNECTING) {\n      throw new Error('WebSocket is not open: readyState 0 (CONNECTING)');\n    }\n\n    if (typeof data === 'function') {\n      cb = data;\n      data = mask = undefined;\n    } else if (typeof mask === 'function') {\n      cb = mask;\n      mask = undefined;\n    }\n\n    if (typeof data === 'number') data = data.toString();\n\n    if (this.readyState !== WebSocket.OPEN) {\n      sendAfterClose(this, data, cb);\n      return;\n    }\n\n    if (mask === undefined) mask = !this._isServer;\n    this._sender.ping(data || EMPTY_BUFFER, mask, cb);\n  }\n\n  /**\n   * Send a pong.\n   *\n   * @param {*} [data] The data to send\n   * @param {Boolean} [mask] Indicates whether or not to mask `data`\n   * @param {Function} [cb] Callback which is executed when the pong is sent\n   * @public\n   */\n  pong(data, mask, cb) {\n    if (this.readyState === WebSocket.CONNECTING) {\n      throw new Error('WebSocket is not open: readyState 0 (CONNECTING)');\n    }\n\n    if (typeof data === 'function') {\n      cb = data;\n      data = mask = undefined;\n    } else if (typeof mask === 'function') {\n      cb = mask;\n      mask = undefined;\n    }\n\n    if (typeof data === 'number') data = data.toString();\n\n    if (this.readyState !== WebSocket.OPEN) {\n      sendAfterClose(this, data, cb);\n      return;\n    }\n\n    if (mask === undefined) mask = !this._isServer;\n    this._sender.pong(data || EMPTY_BUFFER, mask, cb);\n  }\n\n  /**\n   * Resume the socket.\n   *\n   * @public\n   */\n  resume() {\n    if (\n      this.readyState === WebSocket.CONNECTING ||\n      this.readyState === WebSocket.CLOSED\n    ) {\n      return;\n    }\n\n    this._paused = false;\n    if (!this._receiver._writableState.needDrain) this._socket.resume();\n  }\n\n  /**\n   * Send a data message.\n   *\n   * @param {*} data The message to send\n   * @param {Object} [options] Options object\n   * @param {Boolean} [options.binary] Specifies whether `data` is binary or\n   *     text\n   * @param {Boolean} [options.compress] Specifies whether or not to compress\n   *     `data`\n   * @param {Boolean} [options.fin=true] Specifies whether the fragment is the\n   *     last one\n   * @param {Boolean} [options.mask] Specifies whether or not to mask `data`\n   * @param {Function} [cb] Callback which is executed when data is written out\n   * @public\n   */\n  send(data, options, cb) {\n    if (this.readyState === WebSocket.CONNECTING) {\n      throw new Error('WebSocket is not open: readyState 0 (CONNECTING)');\n    }\n\n    if (typeof options === 'function') {\n      cb = options;\n      options = {};\n    }\n\n    if (typeof data === 'number') data = data.toString();\n\n    if (this.readyState !== WebSocket.OPEN) {\n      sendAfterClose(this, data, cb);\n      return;\n    }\n\n    const opts = {\n      binary: typeof data !== 'string',\n      mask: !this._isServer,\n      compress: true,\n      fin: true,\n      ...options\n    };\n\n    if (!this._extensions[PerMessageDeflate.extensionName]) {\n      opts.compress = false;\n    }\n\n    this._sender.send(data || EMPTY_BUFFER, opts, cb);\n  }\n\n  /**\n   * Forcibly close the connection.\n   *\n   * @public\n   */\n  terminate() {\n    if (this.readyState === WebSocket.CLOSED) return;\n    if (this.readyState === WebSocket.CONNECTING) {\n      const msg = 'WebSocket was closed before the connection was established';\n      abortHandshake(this, this._req, msg);\n      return;\n    }\n\n    if (this._socket) {\n      this._readyState = WebSocket.CLOSING;\n      this._socket.destroy();\n    }\n  }\n}\n\n/**\n * @constant {Number} CONNECTING\n * @memberof WebSocket\n */\nObject.defineProperty(WebSocket, 'CONNECTING', {\n  enumerable: true,\n  value: readyStates.indexOf('CONNECTING')\n});\n\n/**\n * @constant {Number} CONNECTING\n * @memberof WebSocket.prototype\n */\nObject.defineProperty(WebSocket.prototype, 'CONNECTING', {\n  enumerable: true,\n  value: readyStates.indexOf('CONNECTING')\n});\n\n/**\n * @constant {Number} OPEN\n * @memberof WebSocket\n */\nObject.defineProperty(WebSocket, 'OPEN', {\n  enumerable: true,\n  value: readyStates.indexOf('OPEN')\n});\n\n/**\n * @constant {Number} OPEN\n * @memberof WebSocket.prototype\n */\nObject.defineProperty(WebSocket.prototype, 'OPEN', {\n  enumerable: true,\n  value: readyStates.indexOf('OPEN')\n});\n\n/**\n * @constant {Number} CLOSING\n * @memberof WebSocket\n */\nObject.defineProperty(WebSocket, 'CLOSING', {\n  enumerable: true,\n  value: readyStates.indexOf('CLOSING')\n});\n\n/**\n * @constant {Number} CLOSING\n * @memberof WebSocket.prototype\n */\nObject.defineProperty(WebSocket.prototype, 'CLOSING', {\n  enumerable: true,\n  value: readyStates.indexOf('CLOSING')\n});\n\n/**\n * @constant {Number} CLOSED\n * @memberof WebSocket\n */\nObject.defineProperty(WebSocket, 'CLOSED', {\n  enumerable: true,\n  value: readyStates.indexOf('CLOSED')\n});\n\n/**\n * @constant {Number} CLOSED\n * @memberof WebSocket.prototype\n */\nObject.defineProperty(WebSocket.prototype, 'CLOSED', {\n  enumerable: true,\n  value: readyStates.indexOf('CLOSED')\n});\n\n[\n  'binaryType',\n  'bufferedAmount',\n  'extensions',\n  'isPaused',\n  'protocol',\n  'readyState',\n  'url'\n].forEach((property) => {\n  Object.defineProperty(WebSocket.prototype, property, { enumerable: true });\n});\n\n//\n// Add the `onopen`, `onerror`, `onclose`, and `onmessage` attributes.\n// See https://html.spec.whatwg.org/multipage/comms.html#the-websocket-interface\n//\n['open', 'error', 'close', 'message'].forEach((method) => {\n  Object.defineProperty(WebSocket.prototype, `on${method}`, {\n    enumerable: true,\n    get() {\n      for (const listener of this.listeners(method)) {\n        if (listener[kForOnEventAttribute]) return listener[kListener];\n      }\n\n      return null;\n    },\n    set(handler) {\n      for (const listener of this.listeners(method)) {\n        if (listener[kForOnEventAttribute]) {\n          this.removeListener(method, listener);\n          break;\n        }\n      }\n\n      if (typeof handler !== 'function') return;\n\n      this.addEventListener(method, handler, {\n        [kForOnEventAttribute]: true\n      });\n    }\n  });\n});\n\nWebSocket.prototype.addEventListener = addEventListener;\nWebSocket.prototype.removeEventListener = removeEventListener;\n\nmodule.exports = WebSocket;\n\n/**\n * Initialize a WebSocket client.\n *\n * @param {WebSocket} websocket The client to initialize\n * @param {(String|URL)} address The URL to which to connect\n * @param {Array} protocols The subprotocols\n * @param {Object} [options] Connection options\n * @param {Boolean} [options.allowSynchronousEvents=true] Specifies whether any\n *     of the `'message'`, `'ping'`, and `'pong'` events can be emitted multiple\n *     times in the same tick\n * @param {Boolean} [options.autoPong=true] Specifies whether or not to\n *     automatically send a pong in response to a ping\n * @param {Function} [options.finishRequest] A function which can be used to\n *     customize the headers of each http request before it is sent\n * @param {Boolean} [options.followRedirects=false] Whether or not to follow\n *     redirects\n * @param {Function} [options.generateMask] The function used to generate the\n *     masking key\n * @param {Number} [options.handshakeTimeout] Timeout in milliseconds for the\n *     handshake request\n * @param {Number} [options.maxPayload=104857600] The maximum allowed message\n *     size\n * @param {Number} [options.maxRedirects=10] The maximum number of redirects\n *     allowed\n * @param {String} [options.origin] Value of the `Origin` or\n *     `Sec-WebSocket-Origin` header\n * @param {(Boolean|Object)} [options.perMessageDeflate=true] Enable/disable\n *     permessage-deflate\n * @param {Number} [options.protocolVersion=13] Value of the\n *     `Sec-WebSocket-Version` header\n * @param {Boolean} [options.skipUTF8Validation=false] Specifies whether or\n *     not to skip UTF-8 validation for text and close messages\n * @private\n */\nfunction initAsClient(websocket, address, protocols, options) {\n  const opts = {\n    allowSynchronousEvents: true,\n    autoPong: true,\n    protocolVersion: protocolVersions[1],\n    maxPayload: 100 * 1024 * 1024,\n    skipUTF8Validation: false,\n    perMessageDeflate: true,\n    followRedirects: false,\n    maxRedirects: 10,\n    ...options,\n    socketPath: undefined,\n    hostname: undefined,\n    protocol: undefined,\n    timeout: undefined,\n    method: 'GET',\n    host: undefined,\n    path: undefined,\n    port: undefined\n  };\n\n  websocket._autoPong = opts.autoPong;\n\n  if (!protocolVersions.includes(opts.protocolVersion)) {\n    throw new RangeError(\n      `Unsupported protocol version: ${opts.protocolVersion} ` +\n        `(supported versions: ${protocolVersions.join(', ')})`\n    );\n  }\n\n  let parsedUrl;\n\n  if (address instanceof URL) {\n    parsedUrl = address;\n  } else {\n    try {\n      parsedUrl = new URL(address);\n    } catch (e) {\n      throw new SyntaxError(`Invalid URL: ${address}`);\n    }\n  }\n\n  if (parsedUrl.protocol === 'http:') {\n    parsedUrl.protocol = 'ws:';\n  } else if (parsedUrl.protocol === 'https:') {\n    parsedUrl.protocol = 'wss:';\n  }\n\n  websocket._url = parsedUrl.href;\n\n  const isSecure = parsedUrl.protocol === 'wss:';\n  const isIpcUrl = parsedUrl.protocol === 'ws+unix:';\n  let invalidUrlMessage;\n\n  if (parsedUrl.protocol !== 'ws:' && !isSecure && !isIpcUrl) {\n    invalidUrlMessage =\n      'The URL\\'s protocol must be one of \"ws:\", \"wss:\", ' +\n      '\"http:\", \"https\", or \"ws+unix:\"';\n  } else if (isIpcUrl && !parsedUrl.pathname) {\n    invalidUrlMessage = \"The URL's pathname is empty\";\n  } else if (parsedUrl.hash) {\n    invalidUrlMessage = 'The URL contains a fragment identifier';\n  }\n\n  if (invalidUrlMessage) {\n    const err = new SyntaxError(invalidUrlMessage);\n\n    if (websocket._redirects === 0) {\n      throw err;\n    } else {\n      emitErrorAndClose(websocket, err);\n      return;\n    }\n  }\n\n  const defaultPort = isSecure ? 443 : 80;\n  const key = randomBytes(16).toString('base64');\n  const request = isSecure ? https.request : http.request;\n  const protocolSet = new Set();\n  let perMessageDeflate;\n\n  opts.createConnection =\n    opts.createConnection || (isSecure ? tlsConnect : netConnect);\n  opts.defaultPort = opts.defaultPort || defaultPort;\n  opts.port = parsedUrl.port || defaultPort;\n  opts.host = parsedUrl.hostname.startsWith('[')\n    ? parsedUrl.hostname.slice(1, -1)\n    : parsedUrl.hostname;\n  opts.headers = {\n    ...opts.headers,\n    'Sec-WebSocket-Version': opts.protocolVersion,\n    'Sec-WebSocket-Key': key,\n    Connection: 'Upgrade',\n    Upgrade: 'websocket'\n  };\n  opts.path = parsedUrl.pathname + parsedUrl.search;\n  opts.timeout = opts.handshakeTimeout;\n\n  if (opts.perMessageDeflate) {\n    perMessageDeflate = new PerMessageDeflate(\n      opts.perMessageDeflate !== true ? opts.perMessageDeflate : {},\n      false,\n      opts.maxPayload\n    );\n    opts.headers['Sec-WebSocket-Extensions'] = format({\n      [PerMessageDeflate.extensionName]: perMessageDeflate.offer()\n    });\n  }\n  if (protocols.length) {\n    for (const protocol of protocols) {\n      if (\n        typeof protocol !== 'string' ||\n        !subprotocolRegex.test(protocol) ||\n        protocolSet.has(protocol)\n      ) {\n        throw new SyntaxError(\n          'An invalid or duplicated subprotocol was specified'\n        );\n      }\n\n      protocolSet.add(protocol);\n    }\n\n    opts.headers['Sec-WebSocket-Protocol'] = protocols.join(',');\n  }\n  if (opts.origin) {\n    if (opts.protocolVersion < 13) {\n      opts.headers['Sec-WebSocket-Origin'] = opts.origin;\n    } else {\n      opts.headers.Origin = opts.origin;\n    }\n  }\n  if (parsedUrl.username || parsedUrl.password) {\n    opts.auth = `${parsedUrl.username}:${parsedUrl.password}`;\n  }\n\n  if (isIpcUrl) {\n    const parts = opts.path.split(':');\n\n    opts.socketPath = parts[0];\n    opts.path = parts[1];\n  }\n\n  let req;\n\n  if (opts.followRedirects) {\n    if (websocket._redirects === 0) {\n      websocket._originalIpc = isIpcUrl;\n      websocket._originalSecure = isSecure;\n      websocket._originalHostOrSocketPath = isIpcUrl\n        ? opts.socketPath\n        : parsedUrl.host;\n\n      const headers = options && options.headers;\n\n      //\n      // Shallow copy the user provided options so that headers can be changed\n      // without mutating the original object.\n      //\n      options = { ...options, headers: {} };\n\n      if (headers) {\n        for (const [key, value] of Object.entries(headers)) {\n          options.headers[key.toLowerCase()] = value;\n        }\n      }\n    } else if (websocket.listenerCount('redirect') === 0) {\n      const isSameHost = isIpcUrl\n        ? websocket._originalIpc\n          ? opts.socketPath === websocket._originalHostOrSocketPath\n          : false\n        : websocket._originalIpc\n          ? false\n          : parsedUrl.host === websocket._originalHostOrSocketPath;\n\n      if (!isSameHost || (websocket._originalSecure && !isSecure)) {\n        //\n        // Match curl 7.77.0 behavior and drop the following headers. These\n        // headers are also dropped when following a redirect to a subdomain.\n        //\n        delete opts.headers.authorization;\n        delete opts.headers.cookie;\n\n        if (!isSameHost) delete opts.headers.host;\n\n        opts.auth = undefined;\n      }\n    }\n\n    //\n    // Match curl 7.77.0 behavior and make the first `Authorization` header win.\n    // If the `Authorization` header is set, then there is nothing to do as it\n    // will take precedence.\n    //\n    if (opts.auth && !options.headers.authorization) {\n      options.headers.authorization =\n        'Basic ' + Buffer.from(opts.auth).toString('base64');\n    }\n\n    req = websocket._req = request(opts);\n\n    if (websocket._redirects) {\n      //\n      // Unlike what is done for the `'upgrade'` event, no early exit is\n      // triggered here if the user calls `websocket.close()` or\n      // `websocket.terminate()` from a listener of the `'redirect'` event. This\n      // is because the user can also call `request.destroy()` with an error\n      // before calling `websocket.close()` or `websocket.terminate()` and this\n      // would result in an error being emitted on the `request` object with no\n      // `'error'` event listeners attached.\n      //\n      websocket.emit('redirect', websocket.url, req);\n    }\n  } else {\n    req = websocket._req = request(opts);\n  }\n\n  if (opts.timeout) {\n    req.on('timeout', () => {\n      abortHandshake(websocket, req, 'Opening handshake has timed out');\n    });\n  }\n\n  req.on('error', (err) => {\n    if (req === null || req[kAborted]) return;\n\n    req = websocket._req = null;\n    emitErrorAndClose(websocket, err);\n  });\n\n  req.on('response', (res) => {\n    const location = res.headers.location;\n    const statusCode = res.statusCode;\n\n    if (\n      location &&\n      opts.followRedirects &&\n      statusCode >= 300 &&\n      statusCode < 400\n    ) {\n      if (++websocket._redirects > opts.maxRedirects) {\n        abortHandshake(websocket, req, 'Maximum redirects exceeded');\n        return;\n      }\n\n      req.abort();\n\n      let addr;\n\n      try {\n        addr = new URL(location, address);\n      } catch (e) {\n        const err = new SyntaxError(`Invalid URL: ${location}`);\n        emitErrorAndClose(websocket, err);\n        return;\n      }\n\n      initAsClient(websocket, addr, protocols, options);\n    } else if (!websocket.emit('unexpected-response', req, res)) {\n      abortHandshake(\n        websocket,\n        req,\n        `Unexpected server response: ${res.statusCode}`\n      );\n    }\n  });\n\n  req.on('upgrade', (res, socket, head) => {\n    websocket.emit('upgrade', res);\n\n    //\n    // The user may have closed the connection from a listener of the\n    // `'upgrade'` event.\n    //\n    if (websocket.readyState !== WebSocket.CONNECTING) return;\n\n    req = websocket._req = null;\n\n    const upgrade = res.headers.upgrade;\n\n    if (upgrade === undefined || upgrade.toLowerCase() !== 'websocket') {\n      abortHandshake(websocket, socket, 'Invalid Upgrade header');\n      return;\n    }\n\n    const digest = createHash('sha1')\n      .update(key + GUID)\n      .digest('base64');\n\n    if (res.headers['sec-websocket-accept'] !== digest) {\n      abortHandshake(websocket, socket, 'Invalid Sec-WebSocket-Accept header');\n      return;\n    }\n\n    const serverProt = res.headers['sec-websocket-protocol'];\n    let protError;\n\n    if (serverProt !== undefined) {\n      if (!protocolSet.size) {\n        protError = 'Server sent a subprotocol but none was requested';\n      } else if (!protocolSet.has(serverProt)) {\n        protError = 'Server sent an invalid subprotocol';\n      }\n    } else if (protocolSet.size) {\n      protError = 'Server sent no subprotocol';\n    }\n\n    if (protError) {\n      abortHandshake(websocket, socket, protError);\n      return;\n    }\n\n    if (serverProt) websocket._protocol = serverProt;\n\n    const secWebSocketExtensions = res.headers['sec-websocket-extensions'];\n\n    if (secWebSocketExtensions !== undefined) {\n      if (!perMessageDeflate) {\n        const message =\n          'Server sent a Sec-WebSocket-Extensions header but no extension ' +\n          'was requested';\n        abortHandshake(websocket, socket, message);\n        return;\n      }\n\n      let extensions;\n\n      try {\n        extensions = parse(secWebSocketExtensions);\n      } catch (err) {\n        const message = 'Invalid Sec-WebSocket-Extensions header';\n        abortHandshake(websocket, socket, message);\n        return;\n      }\n\n      const extensionNames = Object.keys(extensions);\n\n      if (\n        extensionNames.length !== 1 ||\n        extensionNames[0] !== PerMessageDeflate.extensionName\n      ) {\n        const message = 'Server indicated an extension that was not requested';\n        abortHandshake(websocket, socket, message);\n        return;\n      }\n\n      try {\n        perMessageDeflate.accept(extensions[PerMessageDeflate.extensionName]);\n      } catch (err) {\n        const message = 'Invalid Sec-WebSocket-Extensions header';\n        abortHandshake(websocket, socket, message);\n        return;\n      }\n\n      websocket._extensions[PerMessageDeflate.extensionName] =\n        perMessageDeflate;\n    }\n\n    websocket.setSocket(socket, head, {\n      allowSynchronousEvents: opts.allowSynchronousEvents,\n      generateMask: opts.generateMask,\n      maxPayload: opts.maxPayload,\n      skipUTF8Validation: opts.skipUTF8Validation\n    });\n  });\n\n  if (opts.finishRequest) {\n    opts.finishRequest(req, websocket);\n  } else {\n    req.end();\n  }\n}\n\n/**\n * Emit the `'error'` and `'close'` events.\n *\n * @param {WebSocket} websocket The WebSocket instance\n * @param {Error} The error to emit\n * @private\n */\nfunction emitErrorAndClose(websocket, err) {\n  websocket._readyState = WebSocket.CLOSING;\n  //\n  // The following assignment is practically useless and is done only for\n  // consistency.\n  //\n  websocket._errorEmitted = true;\n  websocket.emit('error', err);\n  websocket.emitClose();\n}\n\n/**\n * Create a `net.Socket` and initiate a connection.\n *\n * @param {Object} options Connection options\n * @return {net.Socket} The newly created socket used to start the connection\n * @private\n */\nfunction netConnect(options) {\n  options.path = options.socketPath;\n  return net.connect(options);\n}\n\n/**\n * Create a `tls.TLSSocket` and initiate a connection.\n *\n * @param {Object} options Connection options\n * @return {tls.TLSSocket} The newly created socket used to start the connection\n * @private\n */\nfunction tlsConnect(options) {\n  options.path = undefined;\n\n  if (!options.servername && options.servername !== '') {\n    options.servername = net.isIP(options.host) ? '' : options.host;\n  }\n\n  return tls.connect(options);\n}\n\n/**\n * Abort the handshake and emit an error.\n *\n * @param {WebSocket} websocket The WebSocket instance\n * @param {(http.ClientRequest|net.Socket|tls.Socket)} stream The request to\n *     abort or the socket to destroy\n * @param {String} message The error message\n * @private\n */\nfunction abortHandshake(websocket, stream, message) {\n  websocket._readyState = WebSocket.CLOSING;\n\n  const err = new Error(message);\n  Error.captureStackTrace(err, abortHandshake);\n\n  if (stream.setHeader) {\n    stream[kAborted] = true;\n    stream.abort();\n\n    if (stream.socket && !stream.socket.destroyed) {\n      //\n      // On Node.js >= 14.3.0 `request.abort()` does not destroy the socket if\n      // called after the request completed. See\n      // https://github.com/websockets/ws/issues/1869.\n      //\n      stream.socket.destroy();\n    }\n\n    process.nextTick(emitErrorAndClose, websocket, err);\n  } else {\n    stream.destroy(err);\n    stream.once('error', websocket.emit.bind(websocket, 'error'));\n    stream.once('close', websocket.emitClose.bind(websocket));\n  }\n}\n\n/**\n * Handle cases where the `ping()`, `pong()`, or `send()` methods are called\n * when the `readyState` attribute is `CLOSING` or `CLOSED`.\n *\n * @param {WebSocket} websocket The WebSocket instance\n * @param {*} [data] The data to send\n * @param {Function} [cb] Callback\n * @private\n */\nfunction sendAfterClose(websocket, data, cb) {\n  if (data) {\n    const length = isBlob(data) ? data.size : toBuffer(data).length;\n\n    //\n    // The `_bufferedAmount` property is used only when the peer is a client and\n    // the opening handshake fails. Under these circumstances, in fact, the\n    // `setSocket()` method is not called, so the `_socket` and `_sender`\n    // properties are set to `null`.\n    //\n    if (websocket._socket) websocket._sender._bufferedBytes += length;\n    else websocket._bufferedAmount += length;\n  }\n\n  if (cb) {\n    const err = new Error(\n      `WebSocket is not open: readyState ${websocket.readyState} ` +\n        `(${readyStates[websocket.readyState]})`\n    );\n    process.nextTick(cb, err);\n  }\n}\n\n/**\n * The listener of the `Receiver` `'conclude'` event.\n *\n * @param {Number} code The status code\n * @param {Buffer} reason The reason for closing\n * @private\n */\nfunction receiverOnConclude(code, reason) {\n  const websocket = this[kWebSocket];\n\n  websocket._closeFrameReceived = true;\n  websocket._closeMessage = reason;\n  websocket._closeCode = code;\n\n  if (websocket._socket[kWebSocket] === undefined) return;\n\n  websocket._socket.removeListener('data', socketOnData);\n  process.nextTick(resume, websocket._socket);\n\n  if (code === 1005) websocket.close();\n  else websocket.close(code, reason);\n}\n\n/**\n * The listener of the `Receiver` `'drain'` event.\n *\n * @private\n */\nfunction receiverOnDrain() {\n  const websocket = this[kWebSocket];\n\n  if (!websocket.isPaused) websocket._socket.resume();\n}\n\n/**\n * The listener of the `Receiver` `'error'` event.\n *\n * @param {(RangeError|Error)} err The emitted error\n * @private\n */\nfunction receiverOnError(err) {\n  const websocket = this[kWebSocket];\n\n  if (websocket._socket[kWebSocket] !== undefined) {\n    websocket._socket.removeListener('data', socketOnData);\n\n    //\n    // On Node.js < 14.0.0 the `'error'` event is emitted synchronously. See\n    // https://github.com/websockets/ws/issues/1940.\n    //\n    process.nextTick(resume, websocket._socket);\n\n    websocket.close(err[kStatusCode]);\n  }\n\n  if (!websocket._errorEmitted) {\n    websocket._errorEmitted = true;\n    websocket.emit('error', err);\n  }\n}\n\n/**\n * The listener of the `Receiver` `'finish'` event.\n *\n * @private\n */\nfunction receiverOnFinish() {\n  this[kWebSocket].emitClose();\n}\n\n/**\n * The listener of the `Receiver` `'message'` event.\n *\n * @param {Buffer|ArrayBuffer|Buffer[])} data The message\n * @param {Boolean} isBinary Specifies whether the message is binary or not\n * @private\n */\nfunction receiverOnMessage(data, isBinary) {\n  this[kWebSocket].emit('message', data, isBinary);\n}\n\n/**\n * The listener of the `Receiver` `'ping'` event.\n *\n * @param {Buffer} data The data included in the ping frame\n * @private\n */\nfunction receiverOnPing(data) {\n  const websocket = this[kWebSocket];\n\n  if (websocket._autoPong) websocket.pong(data, !this._isServer, NOOP);\n  websocket.emit('ping', data);\n}\n\n/**\n * The listener of the `Receiver` `'pong'` event.\n *\n * @param {Buffer} data The data included in the pong frame\n * @private\n */\nfunction receiverOnPong(data) {\n  this[kWebSocket].emit('pong', data);\n}\n\n/**\n * Resume a readable stream\n *\n * @param {Readable} stream The readable stream\n * @private\n */\nfunction resume(stream) {\n  stream.resume();\n}\n\n/**\n * The `Sender` error event handler.\n *\n * @param {Error} The error\n * @private\n */\nfunction senderOnError(err) {\n  const websocket = this[kWebSocket];\n\n  if (websocket.readyState === WebSocket.CLOSED) return;\n  if (websocket.readyState === WebSocket.OPEN) {\n    websocket._readyState = WebSocket.CLOSING;\n    setCloseTimer(websocket);\n  }\n\n  //\n  // `socket.end()` is used instead of `socket.destroy()` to allow the other\n  // peer to finish sending queued data. There is no need to set a timer here\n  // because `CLOSING` means that it is already set or not needed.\n  //\n  this._socket.end();\n\n  if (!websocket._errorEmitted) {\n    websocket._errorEmitted = true;\n    websocket.emit('error', err);\n  }\n}\n\n/**\n * Set a timer to destroy the underlying raw socket of a WebSocket.\n *\n * @param {WebSocket} websocket The WebSocket instance\n * @private\n */\nfunction setCloseTimer(websocket) {\n  websocket._closeTimer = setTimeout(\n    websocket._socket.destroy.bind(websocket._socket),\n    closeTimeout\n  );\n}\n\n/**\n * The listener of the socket `'close'` event.\n *\n * @private\n */\nfunction socketOnClose() {\n  const websocket = this[kWebSocket];\n\n  this.removeListener('close', socketOnClose);\n  this.removeListener('data', socketOnData);\n  this.removeListener('end', socketOnEnd);\n\n  websocket._readyState = WebSocket.CLOSING;\n\n  let chunk;\n\n  //\n  // The close frame might not have been received or the `'end'` event emitted,\n  // for example, if the socket was destroyed due to an error. Ensure that the\n  // `receiver` stream is closed after writing any remaining buffered data to\n  // it. If the readable side of the socket is in flowing mode then there is no\n  // buffered data as everything has been already written and `readable.read()`\n  // will return `null`. If instead, the socket is paused, any possible buffered\n  // data will be read as a single chunk.\n  //\n  if (\n    !this._readableState.endEmitted &&\n    !websocket._closeFrameReceived &&\n    !websocket._receiver._writableState.errorEmitted &&\n    (chunk = websocket._socket.read()) !== null\n  ) {\n    websocket._receiver.write(chunk);\n  }\n\n  websocket._receiver.end();\n\n  this[kWebSocket] = undefined;\n\n  clearTimeout(websocket._closeTimer);\n\n  if (\n    websocket._receiver._writableState.finished ||\n    websocket._receiver._writableState.errorEmitted\n  ) {\n    websocket.emitClose();\n  } else {\n    websocket._receiver.on('error', receiverOnFinish);\n    websocket._receiver.on('finish', receiverOnFinish);\n  }\n}\n\n/**\n * The listener of the socket `'data'` event.\n *\n * @param {Buffer} chunk A chunk of data\n * @private\n */\nfunction socketOnData(chunk) {\n  if (!this[kWebSocket]._receiver.write(chunk)) {\n    this.pause();\n  }\n}\n\n/**\n * The listener of the socket `'end'` event.\n *\n * @private\n */\nfunction socketOnEnd() {\n  const websocket = this[kWebSocket];\n\n  websocket._readyState = WebSocket.CLOSING;\n  websocket._receiver.end();\n  this.end();\n}\n\n/**\n * The listener of the socket `'error'` event.\n *\n * @private\n */\nfunction socketOnError() {\n  const websocket = this[kWebSocket];\n\n  this.removeListener('error', socketOnError);\n  this.on('error', NOOP);\n\n  if (websocket) {\n    websocket._readyState = WebSocket.CLOSING;\n    this.destroy();\n  }\n}\n","'use strict';\n\nconst { kForOnEventAttribute, kListener } = require('./constants');\n\nconst kCode = Symbol('kCode');\nconst kData = Symbol('kData');\nconst kError = Symbol('kError');\nconst kMessage = Symbol('kMessage');\nconst kReason = Symbol('kReason');\nconst kTarget = Symbol('kTarget');\nconst kType = Symbol('kType');\nconst kWasClean = Symbol('kWasClean');\n\n/**\n * Class representing an event.\n */\nclass Event {\n  /**\n   * Create a new `Event`.\n   *\n   * @param {String} type The name of the event\n   * @throws {TypeError} If the `type` argument is not specified\n   */\n  constructor(type) {\n    this[kTarget] = null;\n    this[kType] = type;\n  }\n\n  /**\n   * @type {*}\n   */\n  get target() {\n    return this[kTarget];\n  }\n\n  /**\n   * @type {String}\n   */\n  get type() {\n    return this[kType];\n  }\n}\n\nObject.defineProperty(Event.prototype, 'target', { enumerable: true });\nObject.defineProperty(Event.prototype, 'type', { enumerable: true });\n\n/**\n * Class representing a close event.\n *\n * @extends Event\n */\nclass CloseEvent extends Event {\n  /**\n   * Create a new `CloseEvent`.\n   *\n   * @param {String} type The name of the event\n   * @param {Object} [options] A dictionary object that allows for setting\n   *     attributes via object members of the same name\n   * @param {Number} [options.code=0] The status code explaining why the\n   *     connection was closed\n   * @param {String} [options.reason=''] A human-readable string explaining why\n   *     the connection was closed\n   * @param {Boolean} [options.wasClean=false] Indicates whether or not the\n   *     connection was cleanly closed\n   */\n  constructor(type, options = {}) {\n    super(type);\n\n    this[kCode] = options.code === undefined ? 0 : options.code;\n    this[kReason] = options.reason === undefined ? '' : options.reason;\n    this[kWasClean] = options.wasClean === undefined ? false : options.wasClean;\n  }\n\n  /**\n   * @type {Number}\n   */\n  get code() {\n    return this[kCode];\n  }\n\n  /**\n   * @type {String}\n   */\n  get reason() {\n    return this[kReason];\n  }\n\n  /**\n   * @type {Boolean}\n   */\n  get wasClean() {\n    return this[kWasClean];\n  }\n}\n\nObject.defineProperty(CloseEvent.prototype, 'code', { enumerable: true });\nObject.defineProperty(CloseEvent.prototype, 'reason', { enumerable: true });\nObject.defineProperty(CloseEvent.prototype, 'wasClean', { enumerable: true });\n\n/**\n * Class representing an error event.\n *\n * @extends Event\n */\nclass ErrorEvent extends Event {\n  /**\n   * Create a new `ErrorEvent`.\n   *\n   * @param {String} type The name of the event\n   * @param {Object} [options] A dictionary object that allows for setting\n   *     attributes via object members of the same name\n   * @param {*} [options.error=null] The error that generated this event\n   * @param {String} [options.message=''] The error message\n   */\n  constructor(type, options = {}) {\n    super(type);\n\n    this[kError] = options.error === undefined ? null : options.error;\n    this[kMessage] = options.message === undefined ? '' : options.message;\n  }\n\n  /**\n   * @type {*}\n   */\n  get error() {\n    return this[kError];\n  }\n\n  /**\n   * @type {String}\n   */\n  get message() {\n    return this[kMessage];\n  }\n}\n\nObject.defineProperty(ErrorEvent.prototype, 'error', { enumerable: true });\nObject.defineProperty(ErrorEvent.prototype, 'message', { enumerable: true });\n\n/**\n * Class representing a message event.\n *\n * @extends Event\n */\nclass MessageEvent extends Event {\n  /**\n   * Create a new `MessageEvent`.\n   *\n   * @param {String} type The name of the event\n   * @param {Object} [options] A dictionary object that allows for setting\n   *     attributes via object members of the same name\n   * @param {*} [options.data=null] The message content\n   */\n  constructor(type, options = {}) {\n    super(type);\n\n    this[kData] = options.data === undefined ? null : options.data;\n  }\n\n  /**\n   * @type {*}\n   */\n  get data() {\n    return this[kData];\n  }\n}\n\nObject.defineProperty(MessageEvent.prototype, 'data', { enumerable: true });\n\n/**\n * This provides methods for emulating the `EventTarget` interface. It's not\n * meant to be used directly.\n *\n * @mixin\n */\nconst EventTarget = {\n  /**\n   * Register an event listener.\n   *\n   * @param {String} type A string representing the event type to listen for\n   * @param {(Function|Object)} handler The listener to add\n   * @param {Object} [options] An options object specifies characteristics about\n   *     the event listener\n   * @param {Boolean} [options.once=false] A `Boolean` indicating that the\n   *     listener should be invoked at most once after being added. If `true`,\n   *     the listener would be automatically removed when invoked.\n   * @public\n   */\n  addEventListener(type, handler, options = {}) {\n    for (const listener of this.listeners(type)) {\n      if (\n        !options[kForOnEventAttribute] &&\n        listener[kListener] === handler &&\n        !listener[kForOnEventAttribute]\n      ) {\n        return;\n      }\n    }\n\n    let wrapper;\n\n    if (type === 'message') {\n      wrapper = function onMessage(data, isBinary) {\n        const event = new MessageEvent('message', {\n          data: isBinary ? data : data.toString()\n        });\n\n        event[kTarget] = this;\n        callListener(handler, this, event);\n      };\n    } else if (type === 'close') {\n      wrapper = function onClose(code, message) {\n        const event = new CloseEvent('close', {\n          code,\n          reason: message.toString(),\n          wasClean: this._closeFrameReceived && this._closeFrameSent\n        });\n\n        event[kTarget] = this;\n        callListener(handler, this, event);\n      };\n    } else if (type === 'error') {\n      wrapper = function onError(error) {\n        const event = new ErrorEvent('error', {\n          error,\n          message: error.message\n        });\n\n        event[kTarget] = this;\n        callListener(handler, this, event);\n      };\n    } else if (type === 'open') {\n      wrapper = function onOpen() {\n        const event = new Event('open');\n\n        event[kTarget] = this;\n        callListener(handler, this, event);\n      };\n    } else {\n      return;\n    }\n\n    wrapper[kForOnEventAttribute] = !!options[kForOnEventAttribute];\n    wrapper[kListener] = handler;\n\n    if (options.once) {\n      this.once(type, wrapper);\n    } else {\n      this.on(type, wrapper);\n    }\n  },\n\n  /**\n   * Remove an event listener.\n   *\n   * @param {String} type A string representing the event type to remove\n   * @param {(Function|Object)} handler The listener to remove\n   * @public\n   */\n  removeEventListener(type, handler) {\n    for (const listener of this.listeners(type)) {\n      if (listener[kListener] === handler && !listener[kForOnEventAttribute]) {\n        this.removeListener(type, listener);\n        break;\n      }\n    }\n  }\n};\n\nmodule.exports = {\n  CloseEvent,\n  ErrorEvent,\n  Event,\n  EventTarget,\n  MessageEvent\n};\n\n/**\n * Call an event listener\n *\n * @param {(Function|Object)} listener The listener to call\n * @param {*} thisArg The value to use as `this`` when calling the listener\n * @param {Event} event The event to pass to the listener\n * @private\n */\nfunction callListener(listener, thisArg, event) {\n  if (typeof listener === 'object' && listener.handleEvent) {\n    listener.handleEvent.call(listener, event);\n  } else {\n    listener.call(thisArg, event);\n  }\n}\n","'use strict';\n\nconst { tokenChars } = require('./validation');\n\n/**\n * Parses the `Sec-WebSocket-Protocol` header into a set of subprotocol names.\n *\n * @param {String} header The field value of the header\n * @return {Set} The subprotocol names\n * @public\n */\nfunction parse(header) {\n  const protocols = new Set();\n  let start = -1;\n  let end = -1;\n  let i = 0;\n\n  for (i; i < header.length; i++) {\n    const code = header.charCodeAt(i);\n\n    if (end === -1 && tokenChars[code] === 1) {\n      if (start === -1) start = i;\n    } else if (\n      i !== 0 &&\n      (code === 0x20 /* ' ' */ || code === 0x09) /* '\\t' */\n    ) {\n      if (end === -1 && start !== -1) end = i;\n    } else if (code === 0x2c /* ',' */) {\n      if (start === -1) {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n\n      if (end === -1) end = i;\n\n      const protocol = header.slice(start, end);\n\n      if (protocols.has(protocol)) {\n        throw new SyntaxError(`The \"${protocol}\" subprotocol is duplicated`);\n      }\n\n      protocols.add(protocol);\n      start = end = -1;\n    } else {\n      throw new SyntaxError(`Unexpected character at index ${i}`);\n    }\n  }\n\n  if (start === -1 || end !== -1) {\n    throw new SyntaxError('Unexpected end of input');\n  }\n\n  const protocol = header.slice(start, i);\n\n  if (protocols.has(protocol)) {\n    throw new SyntaxError(`The \"${protocol}\" subprotocol is duplicated`);\n  }\n\n  protocols.add(protocol);\n  return protocols;\n}\n\nmodule.exports = { parse };\n","/* eslint no-unused-vars: [\"error\", { \"varsIgnorePattern\": \"^Duplex$\", \"caughtErrors\": \"none\" }] */\n\n'use strict';\n\nconst EventEmitter = require('events');\nconst http = require('http');\nconst { Duplex } = require('stream');\nconst { createHash } = require('crypto');\n\nconst extension = require('./extension');\nconst PerMessageDeflate = require('./permessage-deflate');\nconst subprotocol = require('./subprotocol');\nconst WebSocket = require('./websocket');\nconst { GUID, kWebSocket } = require('./constants');\n\nconst keyRegex = /^[+/0-9A-Za-z]{22}==$/;\n\nconst RUNNING = 0;\nconst CLOSING = 1;\nconst CLOSED = 2;\n\n/**\n * Class representing a WebSocket server.\n *\n * @extends EventEmitter\n */\nclass WebSocketServer extends EventEmitter {\n  /**\n   * Create a `WebSocketServer` instance.\n   *\n   * @param {Object} options Configuration options\n   * @param {Boolean} [options.allowSynchronousEvents=true] Specifies whether\n   *     any of the `'message'`, `'ping'`, and `'pong'` events can be emitted\n   *     multiple times in the same tick\n   * @param {Boolean} [options.autoPong=true] Specifies whether or not to\n   *     automatically send a pong in response to a ping\n   * @param {Number} [options.backlog=511] The maximum length of the queue of\n   *     pending connections\n   * @param {Boolean} [options.clientTracking=true] Specifies whether or not to\n   *     track clients\n   * @param {Function} [options.handleProtocols] A hook to handle protocols\n   * @param {String} [options.host] The hostname where to bind the server\n   * @param {Number} [options.maxPayload=104857600] The maximum allowed message\n   *     size\n   * @param {Boolean} [options.noServer=false] Enable no server mode\n   * @param {String} [options.path] Accept only connections matching this path\n   * @param {(Boolean|Object)} [options.perMessageDeflate=false] Enable/disable\n   *     permessage-deflate\n   * @param {Number} [options.port] The port where to bind the server\n   * @param {(http.Server|https.Server)} [options.server] A pre-created HTTP/S\n   *     server to use\n   * @param {Boolean} [options.skipUTF8Validation=false] Specifies whether or\n   *     not to skip UTF-8 validation for text and close messages\n   * @param {Function} [options.verifyClient] A hook to reject connections\n   * @param {Function} [options.WebSocket=WebSocket] Specifies the `WebSocket`\n   *     class to use. It must be the `WebSocket` class or class that extends it\n   * @param {Function} [callback] A listener for the `listening` event\n   */\n  constructor(options, callback) {\n    super();\n\n    options = {\n      allowSynchronousEvents: true,\n      autoPong: true,\n      maxPayload: 100 * 1024 * 1024,\n      skipUTF8Validation: false,\n      perMessageDeflate: false,\n      handleProtocols: null,\n      clientTracking: true,\n      verifyClient: null,\n      noServer: false,\n      backlog: null, // use default (511 as implemented in net.js)\n      server: null,\n      host: null,\n      path: null,\n      port: null,\n      WebSocket,\n      ...options\n    };\n\n    if (\n      (options.port == null && !options.server && !options.noServer) ||\n      (options.port != null && (options.server || options.noServer)) ||\n      (options.server && options.noServer)\n    ) {\n      throw new TypeError(\n        'One and only one of the \"port\", \"server\", or \"noServer\" options ' +\n          'must be specified'\n      );\n    }\n\n    if (options.port != null) {\n      this._server = http.createServer((req, res) => {\n        const body = http.STATUS_CODES[426];\n\n        res.writeHead(426, {\n          'Content-Length': body.length,\n          'Content-Type': 'text/plain'\n        });\n        res.end(body);\n      });\n      this._server.listen(\n        options.port,\n        options.host,\n        options.backlog,\n        callback\n      );\n    } else if (options.server) {\n      this._server = options.server;\n    }\n\n    if (this._server) {\n      const emitConnection = this.emit.bind(this, 'connection');\n\n      this._removeListeners = addListeners(this._server, {\n        listening: this.emit.bind(this, 'listening'),\n        error: this.emit.bind(this, 'error'),\n        upgrade: (req, socket, head) => {\n          this.handleUpgrade(req, socket, head, emitConnection);\n        }\n      });\n    }\n\n    if (options.perMessageDeflate === true) options.perMessageDeflate = {};\n    if (options.clientTracking) {\n      this.clients = new Set();\n      this._shouldEmitClose = false;\n    }\n\n    this.options = options;\n    this._state = RUNNING;\n  }\n\n  /**\n   * Returns the bound address, the address family name, and port of the server\n   * as reported by the operating system if listening on an IP socket.\n   * If the server is listening on a pipe or UNIX domain socket, the name is\n   * returned as a string.\n   *\n   * @return {(Object|String|null)} The address of the server\n   * @public\n   */\n  address() {\n    if (this.options.noServer) {\n      throw new Error('The server is operating in \"noServer\" mode');\n    }\n\n    if (!this._server) return null;\n    return this._server.address();\n  }\n\n  /**\n   * Stop the server from accepting new connections and emit the `'close'` event\n   * when all existing connections are closed.\n   *\n   * @param {Function} [cb] A one-time listener for the `'close'` event\n   * @public\n   */\n  close(cb) {\n    if (this._state === CLOSED) {\n      if (cb) {\n        this.once('close', () => {\n          cb(new Error('The server is not running'));\n        });\n      }\n\n      process.nextTick(emitClose, this);\n      return;\n    }\n\n    if (cb) this.once('close', cb);\n\n    if (this._state === CLOSING) return;\n    this._state = CLOSING;\n\n    if (this.options.noServer || this.options.server) {\n      if (this._server) {\n        this._removeListeners();\n        this._removeListeners = this._server = null;\n      }\n\n      if (this.clients) {\n        if (!this.clients.size) {\n          process.nextTick(emitClose, this);\n        } else {\n          this._shouldEmitClose = true;\n        }\n      } else {\n        process.nextTick(emitClose, this);\n      }\n    } else {\n      const server = this._server;\n\n      this._removeListeners();\n      this._removeListeners = this._server = null;\n\n      //\n      // The HTTP/S server was created internally. Close it, and rely on its\n      // `'close'` event.\n      //\n      server.close(() => {\n        emitClose(this);\n      });\n    }\n  }\n\n  /**\n   * See if a given request should be handled by this server instance.\n   *\n   * @param {http.IncomingMessage} req Request object to inspect\n   * @return {Boolean} `true` if the request is valid, else `false`\n   * @public\n   */\n  shouldHandle(req) {\n    if (this.options.path) {\n      const index = req.url.indexOf('?');\n      const pathname = index !== -1 ? req.url.slice(0, index) : req.url;\n\n      if (pathname !== this.options.path) return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Handle a HTTP Upgrade request.\n   *\n   * @param {http.IncomingMessage} req The request object\n   * @param {Duplex} socket The network socket between the server and client\n   * @param {Buffer} head The first packet of the upgraded stream\n   * @param {Function} cb Callback\n   * @public\n   */\n  handleUpgrade(req, socket, head, cb) {\n    socket.on('error', socketOnError);\n\n    const key = req.headers['sec-websocket-key'];\n    const upgrade = req.headers.upgrade;\n    const version = +req.headers['sec-websocket-version'];\n\n    if (req.method !== 'GET') {\n      const message = 'Invalid HTTP method';\n      abortHandshakeOrEmitwsClientError(this, req, socket, 405, message);\n      return;\n    }\n\n    if (upgrade === undefined || upgrade.toLowerCase() !== 'websocket') {\n      const message = 'Invalid Upgrade header';\n      abortHandshakeOrEmitwsClientError(this, req, socket, 400, message);\n      return;\n    }\n\n    if (key === undefined || !keyRegex.test(key)) {\n      const message = 'Missing or invalid Sec-WebSocket-Key header';\n      abortHandshakeOrEmitwsClientError(this, req, socket, 400, message);\n      return;\n    }\n\n    if (version !== 8 && version !== 13) {\n      const message = 'Missing or invalid Sec-WebSocket-Version header';\n      abortHandshakeOrEmitwsClientError(this, req, socket, 400, message);\n      return;\n    }\n\n    if (!this.shouldHandle(req)) {\n      abortHandshake(socket, 400);\n      return;\n    }\n\n    const secWebSocketProtocol = req.headers['sec-websocket-protocol'];\n    let protocols = new Set();\n\n    if (secWebSocketProtocol !== undefined) {\n      try {\n        protocols = subprotocol.parse(secWebSocketProtocol);\n      } catch (err) {\n        const message = 'Invalid Sec-WebSocket-Protocol header';\n        abortHandshakeOrEmitwsClientError(this, req, socket, 400, message);\n        return;\n      }\n    }\n\n    const secWebSocketExtensions = req.headers['sec-websocket-extensions'];\n    const extensions = {};\n\n    if (\n      this.options.perMessageDeflate &&\n      secWebSocketExtensions !== undefined\n    ) {\n      const perMessageDeflate = new PerMessageDeflate(\n        this.options.perMessageDeflate,\n        true,\n        this.options.maxPayload\n      );\n\n      try {\n        const offers = extension.parse(secWebSocketExtensions);\n\n        if (offers[PerMessageDeflate.extensionName]) {\n          perMessageDeflate.accept(offers[PerMessageDeflate.extensionName]);\n          extensions[PerMessageDeflate.extensionName] = perMessageDeflate;\n        }\n      } catch (err) {\n        const message =\n          'Invalid or unacceptable Sec-WebSocket-Extensions header';\n        abortHandshakeOrEmitwsClientError(this, req, socket, 400, message);\n        return;\n      }\n    }\n\n    //\n    // Optionally call external client verification handler.\n    //\n    if (this.options.verifyClient) {\n      const info = {\n        origin:\n          req.headers[`${version === 8 ? 'sec-websocket-origin' : 'origin'}`],\n        secure: !!(req.socket.authorized || req.socket.encrypted),\n        req\n      };\n\n      if (this.options.verifyClient.length === 2) {\n        this.options.verifyClient(info, (verified, code, message, headers) => {\n          if (!verified) {\n            return abortHandshake(socket, code || 401, message, headers);\n          }\n\n          this.completeUpgrade(\n            extensions,\n            key,\n            protocols,\n            req,\n            socket,\n            head,\n            cb\n          );\n        });\n        return;\n      }\n\n      if (!this.options.verifyClient(info)) return abortHandshake(socket, 401);\n    }\n\n    this.completeUpgrade(extensions, key, protocols, req, socket, head, cb);\n  }\n\n  /**\n   * Upgrade the connection to WebSocket.\n   *\n   * @param {Object} extensions The accepted extensions\n   * @param {String} key The value of the `Sec-WebSocket-Key` header\n   * @param {Set} protocols The subprotocols\n   * @param {http.IncomingMessage} req The request object\n   * @param {Duplex} socket The network socket between the server and client\n   * @param {Buffer} head The first packet of the upgraded stream\n   * @param {Function} cb Callback\n   * @throws {Error} If called more than once with the same socket\n   * @private\n   */\n  completeUpgrade(extensions, key, protocols, req, socket, head, cb) {\n    //\n    // Destroy the socket if the client has already sent a FIN packet.\n    //\n    if (!socket.readable || !socket.writable) return socket.destroy();\n\n    if (socket[kWebSocket]) {\n      throw new Error(\n        'server.handleUpgrade() was called more than once with the same ' +\n          'socket, possibly due to a misconfiguration'\n      );\n    }\n\n    if (this._state > RUNNING) return abortHandshake(socket, 503);\n\n    const digest = createHash('sha1')\n      .update(key + GUID)\n      .digest('base64');\n\n    const headers = [\n      'HTTP/1.1 101 Switching Protocols',\n      'Upgrade: websocket',\n      'Connection: Upgrade',\n      `Sec-WebSocket-Accept: ${digest}`\n    ];\n\n    const ws = new this.options.WebSocket(null, undefined, this.options);\n\n    if (protocols.size) {\n      //\n      // Optionally call external protocol selection handler.\n      //\n      const protocol = this.options.handleProtocols\n        ? this.options.handleProtocols(protocols, req)\n        : protocols.values().next().value;\n\n      if (protocol) {\n        headers.push(`Sec-WebSocket-Protocol: ${protocol}`);\n        ws._protocol = protocol;\n      }\n    }\n\n    if (extensions[PerMessageDeflate.extensionName]) {\n      const params = extensions[PerMessageDeflate.extensionName].params;\n      const value = extension.format({\n        [PerMessageDeflate.extensionName]: [params]\n      });\n      headers.push(`Sec-WebSocket-Extensions: ${value}`);\n      ws._extensions = extensions;\n    }\n\n    //\n    // Allow external modification/inspection of handshake headers.\n    //\n    this.emit('headers', headers, req);\n\n    socket.write(headers.concat('\\r\\n').join('\\r\\n'));\n    socket.removeListener('error', socketOnError);\n\n    ws.setSocket(socket, head, {\n      allowSynchronousEvents: this.options.allowSynchronousEvents,\n      maxPayload: this.options.maxPayload,\n      skipUTF8Validation: this.options.skipUTF8Validation\n    });\n\n    if (this.clients) {\n      this.clients.add(ws);\n      ws.on('close', () => {\n        this.clients.delete(ws);\n\n        if (this._shouldEmitClose && !this.clients.size) {\n          process.nextTick(emitClose, this);\n        }\n      });\n    }\n\n    cb(ws, req);\n  }\n}\n\nmodule.exports = WebSocketServer;\n\n/**\n * Add event listeners on an `EventEmitter` using a map of <event, listener>\n * pairs.\n *\n * @param {EventEmitter} server The event emitter\n * @param {Object.<String, Function>} map The listeners to add\n * @return {Function} A function that will remove the added listeners when\n *     called\n * @private\n */\nfunction addListeners(server, map) {\n  for (const event of Object.keys(map)) server.on(event, map[event]);\n\n  return function removeListeners() {\n    for (const event of Object.keys(map)) {\n      server.removeListener(event, map[event]);\n    }\n  };\n}\n\n/**\n * Emit a `'close'` event on an `EventEmitter`.\n *\n * @param {EventEmitter} server The event emitter\n * @private\n */\nfunction emitClose(server) {\n  server._state = CLOSED;\n  server.emit('close');\n}\n\n/**\n * Handle socket errors.\n *\n * @private\n */\nfunction socketOnError() {\n  this.destroy();\n}\n\n/**\n * Close the connection when preconditions are not fulfilled.\n *\n * @param {Duplex} socket The socket of the upgrade request\n * @param {Number} code The HTTP response status code\n * @param {String} [message] The HTTP response body\n * @param {Object} [headers] Additional HTTP response headers\n * @private\n */\nfunction abortHandshake(socket, code, message, headers) {\n  //\n  // The socket is writable unless the user destroyed or ended it before calling\n  // `server.handleUpgrade()` or in the `verifyClient` function, which is a user\n  // error. Handling this does not make much sense as the worst that can happen\n  // is that some of the data written by the user might be discarded due to the\n  // call to `socket.end()` below, which triggers an `'error'` event that in\n  // turn causes the socket to be destroyed.\n  //\n  message = message || http.STATUS_CODES[code];\n  headers = {\n    Connection: 'close',\n    'Content-Type': 'text/html',\n    'Content-Length': Buffer.byteLength(message),\n    ...headers\n  };\n\n  socket.once('finish', socket.destroy);\n\n  socket.end(\n    `HTTP/1.1 ${code} ${http.STATUS_CODES[code]}\\r\\n` +\n      Object.keys(headers)\n        .map((h) => `${h}: ${headers[h]}`)\n        .join('\\r\\n') +\n      '\\r\\n\\r\\n' +\n      message\n  );\n}\n\n/**\n * Emit a `'wsClientError'` event on a `WebSocketServer` if there is at least\n * one listener for it, otherwise call `abortHandshake()`.\n *\n * @param {WebSocketServer} server The WebSocket server\n * @param {http.IncomingMessage} req The request object\n * @param {Duplex} socket The socket of the upgrade request\n * @param {Number} code The HTTP response status code\n * @param {String} message The HTTP response body\n * @private\n */\nfunction abortHandshakeOrEmitwsClientError(server, req, socket, code, message) {\n  if (server.listenerCount('wsClientError')) {\n    const err = new Error(message);\n    Error.captureStackTrace(err, abortHandshakeOrEmitwsClientError);\n\n    server.emit('wsClientError', err, socket, req);\n  } else {\n    abortHandshake(socket, code, message);\n  }\n}\n","'use strict';\n\nconst WebSocket = require('./lib/websocket');\n\nWebSocket.createWebSocketStream = require('./lib/stream');\nWebSocket.Server = require('./lib/websocket-server');\nWebSocket.Receiver = require('./lib/receiver');\nWebSocket.Sender = require('./lib/sender');\n\nWebSocket.WebSocket = WebSocket;\nWebSocket.WebSocketServer = WebSocket.Server;\n\nmodule.exports = WebSocket;\n","'use strict';\n\nconst { Duplex } = require('stream');\n\n/**\n * Emits the `'close'` event on a stream.\n *\n * @param {Duplex} stream The stream.\n * @private\n */\nfunction emitClose(stream) {\n  stream.emit('close');\n}\n\n/**\n * The listener of the `'end'` event.\n *\n * @private\n */\nfunction duplexOnEnd() {\n  if (!this.destroyed && this._writableState.finished) {\n    this.destroy();\n  }\n}\n\n/**\n * The listener of the `'error'` event.\n *\n * @param {Error} err The error\n * @private\n */\nfunction duplexOnError(err) {\n  this.removeListener('error', duplexOnError);\n  this.destroy();\n  if (this.listenerCount('error') === 0) {\n    // Do not suppress the throwing behavior.\n    this.emit('error', err);\n  }\n}\n\n/**\n * Wraps a `WebSocket` in a duplex stream.\n *\n * @param {WebSocket} ws The `WebSocket` to wrap\n * @param {Object} [options] The options for the `Duplex` constructor\n * @return {Duplex} The duplex stream\n * @public\n */\nfunction createWebSocketStream(ws, options) {\n  let terminateOnDestroy = true;\n\n  const duplex = new Duplex({\n    ...options,\n    autoDestroy: false,\n    emitClose: false,\n    objectMode: false,\n    writableObjectMode: false\n  });\n\n  ws.on('message', function message(msg, isBinary) {\n    const data =\n      !isBinary && duplex._readableState.objectMode ? msg.toString() : msg;\n\n    if (!duplex.push(data)) ws.pause();\n  });\n\n  ws.once('error', function error(err) {\n    if (duplex.destroyed) return;\n\n    // Prevent `ws.terminate()` from being called by `duplex._destroy()`.\n    //\n    // - If the `'error'` event is emitted before the `'open'` event, then\n    //   `ws.terminate()` is a noop as no socket is assigned.\n    // - Otherwise, the error is re-emitted by the listener of the `'error'`\n    //   event of the `Receiver` object. The listener already closes the\n    //   connection by calling `ws.close()`. This allows a close frame to be\n    //   sent to the other peer. If `ws.terminate()` is called right after this,\n    //   then the close frame might not be sent.\n    terminateOnDestroy = false;\n    duplex.destroy(err);\n  });\n\n  ws.once('close', function close() {\n    if (duplex.destroyed) return;\n\n    duplex.push(null);\n  });\n\n  duplex._destroy = function (err, callback) {\n    if (ws.readyState === ws.CLOSED) {\n      callback(err);\n      process.nextTick(emitClose, duplex);\n      return;\n    }\n\n    let called = false;\n\n    ws.once('error', function error(err) {\n      called = true;\n      callback(err);\n    });\n\n    ws.once('close', function close() {\n      if (!called) callback(err);\n      process.nextTick(emitClose, duplex);\n    });\n\n    if (terminateOnDestroy) ws.terminate();\n  };\n\n  duplex._final = function (callback) {\n    if (ws.readyState === ws.CONNECTING) {\n      ws.once('open', function open() {\n        duplex._final(callback);\n      });\n      return;\n    }\n\n    // If the value of the `_socket` property is `null` it means that `ws` is a\n    // client websocket and the handshake failed. In fact, when this happens, a\n    // socket is never assigned to the websocket. Wait for the `'error'` event\n    // that will be emitted by the websocket.\n    if (ws._socket === null) return;\n\n    if (ws._socket._writableState.finished) {\n      callback();\n      if (duplex._readableState.endEmitted) duplex.destroy();\n    } else {\n      ws._socket.once('finish', function finish() {\n        // `duplex` is not destroyed here because the `'end'` event will be\n        // emitted on `duplex` after this `'finish'` event. The EOF signaling\n        // `null` chunk is, in fact, pushed when the websocket emits `'close'`.\n        callback();\n      });\n      ws.close();\n    }\n  };\n\n  duplex._read = function () {\n    if (ws.isPaused) ws.resume();\n  };\n\n  duplex._write = function (chunk, encoding, callback) {\n    if (ws.readyState === ws.CONNECTING) {\n      ws.once('open', function open() {\n        duplex._write(chunk, encoding, callback);\n      });\n      return;\n    }\n\n    ws.send(chunk, callback);\n  };\n\n  duplex.on('end', duplexOnEnd);\n  duplex.on('error', duplexOnError);\n  return duplex;\n}\n\nmodule.exports = createWebSocketStream;\n","\"use strict\";\n\nconst Socket = require(\"./Socket\");\nconst Connection = require(\"@xmpp/connection\");\nconst xml = require(\"@xmpp/xml\");\nconst FramedParser = require(\"./FramedParser\");\n\nconst NS_FRAMING = \"urn:ietf:params:xml:ns:xmpp-framing\";\n\n/* References\n * WebSocket protocol https://tools.ietf.org/html/rfc6455\n * WebSocket Web API https://html.spec.whatwg.org/multipage/comms.html#network\n * XMPP over WebSocket https://tools.ietf.org/html/rfc7395\n */\n\nclass ConnectionWebSocket extends Connection {\n  send(element, ...args) {\n    if (!element.attrs.xmlns && super.isStanza(element)) {\n      element.attrs.xmlns = \"jabber:client\";\n    }\n\n    return super.send(element, ...args);\n  }\n\n  async sendMany(elements) {\n    for (const element of elements) {\n      await this.send(element);\n    }\n  }\n\n  // https://tools.ietf.org/html/rfc7395#section-3.6\n  footerElement() {\n    return new xml.Element(\"close\", {\n      xmlns: NS_FRAMING,\n    });\n  }\n\n  // https://tools.ietf.org/html/rfc7395#section-3.4\n  headerElement() {\n    const el = super.headerElement();\n    el.name = \"open\";\n    el.attrs.xmlns = NS_FRAMING;\n    return el;\n  }\n\n  socketParameters(service) {\n    return /^wss?:\\/\\//.test(service) ? service : undefined;\n  }\n}\n\nConnectionWebSocket.prototype.Socket = Socket;\nConnectionWebSocket.prototype.NS = \"jabber:client\";\nConnectionWebSocket.prototype.Parser = FramedParser;\n\nmodule.exports = ConnectionWebSocket;\n","\"use strict\";\n\nconst WS = require(\"ws\");\nconst WebSocket = global.WebSocket || WS;\nconst EventEmitter = require(\"events\");\n\nconst CODE = \"ECONNERROR\";\n\nclass Socket extends EventEmitter {\n  constructor() {\n    super();\n    this.listeners = Object.create(null);\n  }\n\n  connect(url) {\n    this.url = url;\n    this._attachSocket(new WebSocket(url, [\"xmpp\"]));\n  }\n\n  _attachSocket(socket) {\n    this.socket = socket;\n    const { listeners } = this;\n    listeners.open = () => {\n      this.emit(\"connect\");\n    };\n\n    listeners.message = ({ data }) => this.emit(\"data\", data);\n    listeners.error = (event) => {\n      const { url } = this;\n      // WS\n      let { error } = event;\n      // DOM\n      if (!error) {\n        error = new Error(`WebSocket ${CODE} ${url}`);\n        error.errno = CODE;\n        error.code = CODE;\n      }\n\n      error.event = event;\n      error.url = url;\n      this.emit(\"error\", error);\n    };\n\n    listeners.close = (event) => {\n      this._detachSocket();\n      this.emit(\"close\", !event.wasClean, event);\n    };\n\n    this.socket.addEventListener(\"open\", listeners.open);\n    this.socket.addEventListener(\"message\", listeners.message);\n    this.socket.addEventListener(\"error\", listeners.error);\n    this.socket.addEventListener(\"close\", listeners.close);\n  }\n\n  _detachSocket() {\n    delete this.url;\n    const { socket, listeners } = this;\n    for (const k of Object.getOwnPropertyNames(listeners)) {\n      socket.removeEventListener(k, listeners[k]);\n      delete listeners[k];\n    }\n    delete this.socket;\n  }\n\n  end() {\n    this.socket.close();\n  }\n\n  write(data, fn) {\n    if (WebSocket === WS) {\n      this.socket.send(data, fn);\n    } else {\n      this.socket.send(data);\n      fn();\n    }\n  }\n}\n\nmodule.exports = Socket;\n","\"use strict\";\n\nconst { Parser, Element, XMLError } = require(\"@xmpp/xml\");\n\nmodule.exports = class FramedParser extends Parser {\n  onStartElement(name, attrs) {\n    const element = new Element(name, attrs);\n\n    const { cursor } = this;\n\n    if (cursor) {\n      cursor.append(element);\n    }\n\n    this.cursor = element;\n  }\n\n  onEndElement(name) {\n    const { cursor } = this;\n    if (name !== cursor.name) {\n      // <foo></bar>\n      this.emit(\"error\", new XMLError(`${cursor.name} must be closed.`));\n      return;\n    }\n\n    if (cursor.parent) {\n      this.cursor = cursor.parent;\n      return;\n    }\n\n    if (cursor.is(\"open\", \"urn:ietf:params:xml:ns:xmpp-framing\")) {\n      this.emit(\"start\", cursor);\n    } else if (cursor.is(\"close\", \"urn:ietf:params:xml:ns:xmpp-framing\")) {\n      this.emit(\"end\", cursor);\n    } else {\n      this.emit(\"element\", cursor);\n    }\n\n    this.cursor = null;\n  }\n};\n","\"use strict\";\n\nconst ConnectionWebSocket = require(\"./lib/Connection\");\n\nmodule.exports = function websocket({ entity }) {\n  entity.transports.push(ConnectionWebSocket);\n};\n","\"use strict\";\n\nmodule.exports = class Context {\n  constructor(entity, stanza) {\n    this.stanza = stanza;\n    this.entity = entity;\n\n    const { name, attrs } = stanza;\n    const { type, id } = attrs;\n\n    this.name = name;\n    this.id = id || \"\";\n\n    if (name === \"message\") {\n      this.type = type || \"normal\";\n    } else if (name === \"presence\") {\n      this.type = type || \"available\";\n    } else {\n      this.type = type || \"\";\n    }\n\n    this.from = null;\n    this.to = null;\n    this.local = \"\";\n    this.domain = \"\";\n    this.resource = \"\";\n  }\n};\n","\"use strict\";\n\nconst compose = require(\"koa-compose\");\n\nconst IncomingContext = require(\"./lib/IncomingContext\");\nconst OutgoingContext = require(\"./lib/OutgoingContext\");\n\nfunction listener(entity, middleware, Context) {\n  return (stanza) => {\n    const ctx = new Context(entity, stanza);\n    return compose(middleware)(ctx);\n  };\n}\n\nfunction errorHandler(entity) {\n  return (ctx, next) => {\n    next()\n      .then((reply) => reply && entity.send(reply))\n      .catch((err) => entity.emit(\"error\", err));\n  };\n}\n\nmodule.exports = function middleware({ entity }) {\n  const incoming = [errorHandler(entity)];\n  const outgoing = [];\n\n  const incomingListener = listener(entity, incoming, IncomingContext);\n  const outgoingListener = listener(entity, outgoing, OutgoingContext);\n\n  entity.on(\"element\", incomingListener);\n  entity.hookOutgoing = outgoingListener;\n\n  return {\n    use(fn) {\n      incoming.push(fn);\n      return fn;\n    },\n    filter(fn) {\n      outgoing.push(fn);\n      return fn;\n    },\n  };\n};\n","'use strict'\n\n/**\n * Expose compositor.\n */\n\nmodule.exports = compose\n\n/**\n * Compose `middleware` returning\n * a fully valid middleware comprised\n * of all those which are passed.\n *\n * @param {Array} middleware\n * @return {Function}\n * @api public\n */\n\nfunction compose (middleware) {\n  if (!Array.isArray(middleware)) throw new TypeError('Middleware stack must be an array!')\n  for (const fn of middleware) {\n    if (typeof fn !== 'function') throw new TypeError('Middleware must be composed of functions!')\n  }\n\n  /**\n   * @param {Object} context\n   * @return {Promise}\n   * @api public\n   */\n\n  return function (context, next) {\n    // last called middleware #\n    let index = -1\n    return dispatch(0)\n    function dispatch (i) {\n      if (i <= index) return Promise.reject(new Error('next() called multiple times'))\n      index = i\n      let fn = middleware[i]\n      if (i === middleware.length) fn = next\n      if (!fn) return Promise.resolve()\n      try {\n        return Promise.resolve(fn(context, dispatch.bind(null, i + 1)));\n      } catch (err) {\n        return Promise.reject(err)\n      }\n    }\n  }\n}\n","\"use strict\";\n\nconst Context = require(\"./Context\");\nconst JID = require(\"@xmpp/jid\");\n\nmodule.exports = class IncomingContext extends Context {\n  constructor(entity, stanza) {\n    super(entity, stanza);\n\n    const { jid, domain } = entity;\n\n    const to = stanza.attrs.to || (jid && jid.toString());\n    const from = stanza.attrs.from || domain;\n\n    if (to) this.to = new JID(to);\n\n    if (from) {\n      this.from = new JID(from);\n      this.local = this.from.local;\n      this.domain = this.from.domain;\n      this.resource = this.from.resource;\n    }\n  }\n};\n","\"use strict\";\n\nconst Context = require(\"./Context\");\nconst JID = require(\"@xmpp/jid\");\n\nmodule.exports = class OutgoingContext extends Context {\n  constructor(entity, stanza) {\n    super(entity, stanza);\n\n    const { jid, domain } = entity;\n\n    const from = stanza.attrs.from || (jid && jid.toString());\n    const to = stanza.attrs.to || domain;\n\n    if (from) this.from = new JID(from);\n\n    if (to) {\n      this.to = new JID(to);\n      this.local = this.to.local;\n      this.domain = this.to.domain;\n      this.resource = this.to.resource;\n    }\n  }\n};\n","\"use strict\";\n\nmodule.exports = function route() {\n  return async ({ stanza, entity }, next) => {\n    if (!stanza.is(\"features\", \"http://etherx.jabber.org/streams\"))\n      return next();\n\n    const prevent = await next();\n    if (!prevent && entity.jid) entity._status(\"online\", entity.jid);\n  };\n};\n","\"use strict\";\n\n/**\n * References\n * https://xmpp.org/rfcs/rfc6120.html#streams-negotiation Stream Negotiation\n * https://xmpp.org/extensions/xep-0170.html XEP-0170: Recommended Order of Stream Feature Negotiation\n * https://xmpp.org/registrar/stream-features.html XML Stream Features\n */\n\nconst route = require(\"./route\");\n\nmodule.exports = function streamFeatures({ middleware }) {\n  middleware.use(route());\n\n  function use(name, xmlns, handler) {\n    return middleware.use((ctx, next) => {\n      const { stanza } = ctx;\n      if (!stanza.is(\"features\", \"http://etherx.jabber.org/streams\"))\n        return next();\n      const feature = stanza.getChild(name, xmlns);\n      if (!feature) return next();\n      return handler(ctx, next, feature);\n    });\n  }\n\n  return {\n    use,\n  };\n};\n","\"use strict\";\n\nconst xid = require(\"@xmpp/id\");\nconst StanzaError = require(\"@xmpp/middleware/lib/StanzaError\");\nconst { Deferred } = require(\"@xmpp/events\");\nconst timeoutPromise = require(\"@xmpp/events\").timeout;\nconst xml = require(\"@xmpp/xml\");\n\nfunction isReply({ name, type }) {\n  if (name !== \"iq\") return false;\n  if (type !== \"error\" && type !== \"result\") return false;\n  return true;\n}\n\nclass IQCaller {\n  constructor({ entity, middleware }) {\n    this.handlers = new Map();\n    this.entity = entity;\n    this.middleware = middleware;\n  }\n\n  start() {\n    this.middleware.use(this._route.bind(this));\n  }\n\n  _route({ type, name, id, stanza }, next) {\n    if (!isReply({ name, type })) return next();\n\n    const deferred = this.handlers.get(id);\n\n    if (!deferred) {\n      return next();\n    }\n\n    if (type === \"error\") {\n      deferred.reject(StanzaError.fromElement(stanza.getChild(\"error\")));\n    } else {\n      deferred.resolve(stanza);\n    }\n\n    this.handlers.delete(id);\n  }\n\n  async request(stanza, timeout = 30 * 1000) {\n    if (!stanza.attrs.id) {\n      stanza.attrs.id = xid();\n    }\n\n    const deferred = new Deferred();\n    this.handlers.set(stanza.attrs.id, deferred);\n\n    try {\n      await this.entity.send(stanza);\n      await timeoutPromise(deferred.promise, timeout);\n    } catch (err) {\n      this.handlers.delete(stanza.attrs.id);\n      throw err;\n    }\n\n    return deferred.promise;\n  }\n\n  _childRequest(type, element, to, ...args) {\n    const {\n      name,\n      attrs: { xmlns },\n    } = element;\n    return this.request(xml(\"iq\", { type, to }, element), ...args).then(\n      (stanza) => stanza.getChild(name, xmlns),\n    );\n  }\n\n  async get(...args) {\n    return this._childRequest(\"get\", ...args);\n  }\n\n  async set(...args) {\n    return this._childRequest(\"set\", ...args);\n  }\n}\n\nmodule.exports = function iqCaller(...args) {\n  const iqCaller = new IQCaller(...args);\n  iqCaller.start();\n  return iqCaller;\n};\n","\"use strict\";\n\nmodule.exports = function id() {\n  let i;\n  while (!i) {\n    i = Math.random().toString(36).slice(2, 12);\n  }\n\n  return i;\n};\n","\"use strict\";\n\n/* https://xmpp.org/rfcs/rfc6120.html#stanzas-error */\n\nconst XMPPError = require(\"@xmpp/error\");\n\nclass StanzaError extends XMPPError {\n  constructor(condition, text, application, type) {\n    super(condition, text, application);\n    this.type = type;\n    this.name = \"StanzaError\";\n  }\n\n  static fromElement(element) {\n    const error = super.fromElement(element);\n    error.type = element.attrs.type;\n    return error;\n  }\n}\n\nmodule.exports = StanzaError;\n","\"use strict\";\n\n/**\n * References\n * https://xmpp.org/rfcs/rfc6120.html#stanzas-semantics-iq\n * https://xmpp.org/rfcs/rfc6120.html#stanzas-error\n */\n\nconst xml = require(\"@xmpp/xml\");\n\nconst NS_STANZA = \"urn:ietf:params:xml:ns:xmpp-stanzas\";\n\nfunction isQuery({ name, type }) {\n  if (name !== \"iq\") return false;\n  if (type === \"error\" || type === \"result\") return false;\n  return true;\n}\n\nfunction isValidQuery({ type }, children, child) {\n  if (type !== \"get\" && type !== \"set\") return false;\n  if (children.length !== 1) return false;\n  if (!child) return false;\n  return true;\n}\n\nfunction buildReply({ stanza }) {\n  return xml(\"iq\", {\n    to: stanza.attrs.from,\n    from: stanza.attrs.to,\n    id: stanza.attrs.id,\n  });\n}\n\nfunction buildReplyResult(ctx, child) {\n  const reply = buildReply(ctx);\n  reply.attrs.type = \"result\";\n  if (child) {\n    reply.append(child);\n  }\n\n  return reply;\n}\n\nfunction buildReplyError(ctx, error, child) {\n  const reply = buildReply(ctx);\n  reply.attrs.type = \"error\";\n  if (child) {\n    reply.append(child);\n  }\n\n  reply.append(error);\n  return reply;\n}\n\nfunction buildError(type, condition) {\n  return xml(\"error\", { type }, xml(condition, NS_STANZA));\n}\n\nfunction iqHandler(entity) {\n  return async function iqHandler(ctx, next) {\n    if (!isQuery(ctx)) return next();\n\n    const { stanza } = ctx;\n    const children = stanza.getChildElements();\n    const [child] = children;\n\n    if (!isValidQuery(ctx, children, child)) {\n      return buildReplyError(ctx, buildError(\"modify\", \"bad-request\"), child);\n    }\n\n    ctx.element = child;\n\n    let reply;\n    try {\n      reply = await next();\n    } catch (err) {\n      entity.emit(\"error\", err);\n      reply = buildError(\"cancel\", \"internal-server-error\");\n    }\n\n    if (!reply) {\n      reply = buildError(\"cancel\", \"service-unavailable\");\n    }\n\n    if (reply instanceof xml.Element && reply.is(\"error\")) {\n      return buildReplyError(ctx, reply, child);\n    }\n\n    return buildReplyResult(\n      ctx,\n      reply instanceof xml.Element ? reply : undefined,\n    );\n  };\n}\n\nfunction route(type, ns, name, handler) {\n  return (ctx, next) => {\n    if ((ctx.type !== type) | !ctx.element || !ctx.element.is(name, ns))\n      return next();\n    return handler(ctx, next);\n  };\n}\n\nmodule.exports = function iqCallee({ middleware, entity }) {\n  middleware.use(iqHandler(entity));\n\n  return {\n    get(ns, name, handler) {\n      middleware.use(route(\"get\", ns, name, handler));\n    },\n    set(ns, name, handler) {\n      middleware.use(route(\"set\", ns, name, handler));\n    },\n  };\n};\n","/* eslint-disable promise/no-nesting */\n\"use strict\";\n\nconst dns = require(\"dns\");\n\n// eslint-disable-next-line unicorn/prefer-set-has\nconst IGNORE_CODES = [\"ENOTFOUND\", \"ENODATA\"];\n\nfunction lookup(domain, options = {}) {\n  options.all = true;\n  return new Promise((resolve, reject) => {\n    dns.lookup(domain, options, (err, addresses) => {\n      if (err) {\n        return reject(err);\n      }\n\n      const result = [];\n      for (const { family, address } of addresses) {\n        const uri = `://${family === 4 ? address : \"[\" + address + \"]\"}:`;\n        result.push(\n          {\n            family,\n            address,\n            uri: \"xmpps\" + uri + \"5223\",\n          },\n          {\n            family,\n            address,\n            uri: \"xmpp\" + uri + \"5222\",\n          },\n        );\n      }\n      resolve(result);\n    });\n  });\n}\n\nfunction resolveSrv(domain, { service, protocol }) {\n  return new Promise((resolve, reject) => {\n    dns.resolveSrv(`_${service}._${protocol}.${domain}`, (err, records) => {\n      if (err && IGNORE_CODES.includes(err.code)) {\n        resolve([]);\n      } else if (err) {\n        reject(err);\n      } else {\n        resolve(\n          records.map((record) => {\n            return Object.assign(record, { service, protocol });\n          }),\n        );\n      }\n    });\n  });\n}\n\nfunction sortSrv(records) {\n  return records.sort((a, b) => {\n    const priority = a.priority - b.priority;\n    if (priority !== 0) {\n      return priority;\n    }\n\n    const weight = b.weight - a.weight;\n    if (weight !== 0) {\n      return weight;\n    }\n\n    return 0;\n  });\n}\n\nfunction lookupSrvs(srvs, options) {\n  const addresses = [];\n  return Promise.all(\n    srvs.map(async (srv) => {\n      const srvAddresses = await lookup(srv.name, options);\n      for (const address of srvAddresses) {\n        const { port, service } = srv;\n        const addr = address.address;\n        addresses.push({\n          ...address,\n          ...srv,\n          uri: `${service.split(\"-\")[0]}://${\n            address.family === 6 ? \"[\" + addr + \"]\" : addr\n          }:${port}`,\n        });\n      }\n    }),\n  ).then(() => addresses);\n}\n\nfunction resolve(domain, options = {}) {\n  if (!options.srv) {\n    options.srv = [\n      {\n        service: \"xmpps-client\",\n        protocol: \"tcp\",\n      },\n      {\n        service: \"xmpp-client\",\n        protocol: \"tcp\",\n      },\n      {\n        service: \"xmpps-server\",\n        protocol: \"tcp\",\n      },\n      {\n        service: \"xmpp-server\",\n        protocol: \"tcp\",\n      },\n      {\n        service: \"stun\",\n        protocol: \"tcp\",\n      },\n      {\n        service: \"stun\",\n        protocol: \"udp\",\n      },\n      {\n        service: \"stuns \",\n        protcol: \"tcp\",\n      },\n      {\n        service: \"turn\",\n        protocol: \"tcp\",\n      },\n      {\n        service: \"turn\",\n        protocol: \"udp\",\n      },\n      {\n        service: \"turns\",\n        protcol: \"tcp\",\n      },\n    ];\n  }\n\n  const family = { options };\n  return lookup(domain, options).then((addresses) => {\n    return Promise.all(\n      options.srv.map((srv) => {\n        return resolveSrv(domain, { ...srv, family }).then((records) => {\n          return lookupSrvs(records, options);\n        });\n      }),\n    ).then((srvs) => [...sortSrv(srvs.flat()), ...addresses]);\n  });\n}\n\nmodule.exports.lookup = lookup;\nmodule.exports.resolveSrv = resolveSrv;\nmodule.exports.lookupSrvs = lookupSrvs;\nmodule.exports.resolve = resolve;\nmodule.exports.sortSrv = sortSrv;\n","\"use strict\";\n\nconst Parser = require(\"./Parser\");\n\nmodule.exports = function parse(data) {\n  const p = new Parser();\n\n  let result = null;\n  let error = null;\n\n  p.on(\"start\", (el) => {\n    result = el;\n  });\n  p.on(\"element\", (el) => {\n    result.append(el);\n  });\n  p.on(\"error\", (err) => {\n    error = err;\n  });\n\n  p.write(data);\n  p.end();\n\n  if (error) {\n    throw error;\n  } else {\n    return result;\n  }\n};\n","\"use strict\";\n\nconst fetch = global.fetch || require(\"node-fetch\");\nconst parse = require(\"@xmpp/xml/lib/parse\");\nconst compareAltConnections = require(\"./alt-connections\").compare;\n\nfunction resolve(domain) {\n  return fetch(`https://${domain}/.well-known/host-meta`)\n    .then((res) => res.text())\n    .then((res) => {\n      return parse(res)\n        .getChildren(\"Link\")\n        .filter((link) =>\n          [\n            \"urn:xmpp:alt-connections:websocket\",\n            \"urn:xmpp:alt-connections:httppoll\",\n            \"urn:xmpp:alt-connections:xbosh\",\n          ].includes(link.attrs.rel),\n        )\n        .map(({ attrs }) => ({\n          rel: attrs.rel,\n          href: attrs.href,\n          method: attrs.rel.split(\":\").pop(),\n          uri: attrs.href,\n        }))\n        .sort(compareAltConnections);\n    })\n    .catch(() => {\n      return [];\n    });\n}\n\nmodule.exports.resolve = resolve;\n","\"use strict\";\n\nfunction isSecure(uri) {\n  return uri.startsWith(\"https\") || uri.startsWith(\"wss\");\n}\n\nmodule.exports.compare = function compare(a, b) {\n  let secure;\n  if (isSecure(a.uri) && !isSecure(b.uri)) {\n    secure = -1;\n  } else if (!isSecure(a.uri) && isSecure(b.uri)) {\n    secure = 1;\n  } else {\n    secure = 0;\n  }\n\n  if (secure !== 0) {\n    return secure;\n  }\n\n  let method;\n  if (a.method === b.method) {\n    method = 0;\n  } else if (a.method === \"websocket\") {\n    method = -1;\n  } else if (b.method === \"websocket\") {\n    method = 1;\n  } else if (a.method === \"xbosh\") {\n    method = -1;\n  } else if (b.method === \"xbosh\") {\n    method = 1;\n  } else if (a.method === \"httppoll\") {\n    method = -1;\n  } else if (b.method === \"httppoll\") {\n    method = 1;\n  } else {\n    method = 0;\n  }\n\n  if (method !== 0) {\n    return method;\n  }\n\n  return 0;\n};\n","\"use strict\";\n\nconst dns = require(\"./lib/dns\");\nconst http = require(\"./lib/http\");\n\nmodule.exports = function resolve(...args) {\n  return Promise.all([\n    dns.resolve ? dns.resolve(...args) : Promise.resolve([]),\n    http.resolve(...args),\n  ]).then(([records, endpoints]) => [...records, ...endpoints]);\n};\n\nif (dns.resolve) {\n  module.exports.dns = dns;\n}\n\nmodule.exports.http = http;\n","\"use strict\";\n\nconst resolve = require(\"./resolve\");\nconst { promise } = require(\"@xmpp/events\");\n\nasync function fetchURIs(domain) {\n  const result = await resolve(domain, {\n    srv: [\n      {\n        service: \"xmpps-client\",\n        protocol: \"tcp\",\n      },\n      {\n        service: \"xmpp-client\",\n        protocol: \"tcp\",\n      },\n    ],\n  });\n\n  return [\n    // Remove duplicates\n    ...new Set(result.map((record) => record.uri)),\n  ];\n}\n\nfunction filterSupportedURIs(entity, uris) {\n  return uris.filter((uri) => entity._findTransport(uri));\n}\n\nasync function fallbackConnect(entity, uris) {\n  if (uris.length === 0) {\n    throw new Error(\"Couldn't connect\");\n  }\n\n  const uri = uris.shift();\n  const Transport = entity._findTransport(uri);\n\n  if (!Transport) {\n    return fallbackConnect(entity, uris);\n  }\n\n  entity._status(\"connecting\", uri);\n  const params = Transport.prototype.socketParameters(uri);\n  const socket = new Transport.prototype.Socket();\n\n  try {\n    socket.connect(params);\n    await promise(socket, \"connect\");\n  } catch {\n    return fallbackConnect(entity, uris);\n  }\n\n  entity._attachSocket(socket);\n  socket.emit(\"connect\");\n  entity.Transport = Transport;\n  entity.Socket = Transport.prototype.Socket;\n  entity.Parser = Transport.prototype.Parser;\n}\n\nmodule.exports = function resolve({ entity }) {\n  const _connect = entity.connect;\n  entity.connect = async function connect(service) {\n    if (!service || /:\\/\\//.test(service)) {\n      return _connect.call(this, service);\n    }\n\n    const uris = filterSupportedURIs(entity, await fetchURIs(service));\n\n    if (uris.length === 0) {\n      throw new Error(\"No compatible transport found.\");\n    }\n\n    try {\n      await fallbackConnect(entity, uris);\n    } catch (err) {\n      entity._reset();\n      entity._status(\"disconnect\");\n      throw err;\n    }\n  };\n};\n","\"use strict\";\n\nconst { encode, decode } = require(\"base-64\");\n\nmodule.exports.encode = encode;\nmodule.exports.decode = decode;\n","/*! https://mths.be/base64 v1.0.0 by @mathias | MIT license */\n;(function(root) {\n\n\t// Detect free variables `exports`.\n\tvar freeExports = typeof exports == 'object' && exports;\n\n\t// Detect free variable `module`.\n\tvar freeModule = typeof module == 'object' && module &&\n\t\tmodule.exports == freeExports && module;\n\n\t// Detect free variable `global`, from Node.js or Browserified code, and use\n\t// it as `root`.\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (freeGlobal.global === freeGlobal || freeGlobal.window === freeGlobal) {\n\t\troot = freeGlobal;\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\tvar InvalidCharacterError = function(message) {\n\t\tthis.message = message;\n\t};\n\tInvalidCharacterError.prototype = new Error;\n\tInvalidCharacterError.prototype.name = 'InvalidCharacterError';\n\n\tvar error = function(message) {\n\t\t// Note: the error messages used throughout this file match those used by\n\t\t// the native `atob`/`btoa` implementation in Chromium.\n\t\tthrow new InvalidCharacterError(message);\n\t};\n\n\tvar TABLE = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\t// http://whatwg.org/html/common-microsyntaxes.html#space-character\n\tvar REGEX_SPACE_CHARACTERS = /[\\t\\n\\f\\r ]/g;\n\n\t// `decode` is designed to be fully compatible with `atob` as described in the\n\t// HTML Standard. http://whatwg.org/html/webappapis.html#dom-windowbase64-atob\n\t// The optimized base64-decoding algorithm used is based on @atks excellent\n\t// implementation. https://gist.github.com/atk/1020396\n\tvar decode = function(input) {\n\t\tinput = String(input)\n\t\t\t.replace(REGEX_SPACE_CHARACTERS, '');\n\t\tvar length = input.length;\n\t\tif (length % 4 == 0) {\n\t\t\tinput = input.replace(/==?$/, '');\n\t\t\tlength = input.length;\n\t\t}\n\t\tif (\n\t\t\tlength % 4 == 1 ||\n\t\t\t// http://whatwg.org/C#alphanumeric-ascii-characters\n\t\t\t/[^+a-zA-Z0-9/]/.test(input)\n\t\t) {\n\t\t\terror(\n\t\t\t\t'Invalid character: the string to be decoded is not correctly encoded.'\n\t\t\t);\n\t\t}\n\t\tvar bitCounter = 0;\n\t\tvar bitStorage;\n\t\tvar buffer;\n\t\tvar output = '';\n\t\tvar position = -1;\n\t\twhile (++position < length) {\n\t\t\tbuffer = TABLE.indexOf(input.charAt(position));\n\t\t\tbitStorage = bitCounter % 4 ? bitStorage * 64 + buffer : buffer;\n\t\t\t// Unless this is the first of a group of 4 characters\n\t\t\tif (bitCounter++ % 4) {\n\t\t\t\t// convert the first 8 bits to a single ASCII character.\n\t\t\t\toutput += String.fromCharCode(\n\t\t\t\t\t0xFF & bitStorage >> (-2 * bitCounter & 6)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t};\n\n\t// `encode` is designed to be fully compatible with `btoa` as described in the\n\t// HTML Standard: http://whatwg.org/html/webappapis.html#dom-windowbase64-btoa\n\tvar encode = function(input) {\n\t\tinput = String(input);\n\t\tif (/[^\\0-\\xFF]/.test(input)) {\n\t\t\t// Note: no need to special-case astral symbols here, as surrogates are\n\t\t\t// matched, and the input is supposed to only contain ASCII anyway.\n\t\t\terror(\n\t\t\t\t'The string to be encoded contains characters outside of the ' +\n\t\t\t\t'Latin1 range.'\n\t\t\t);\n\t\t}\n\t\tvar padding = input.length % 3;\n\t\tvar output = '';\n\t\tvar position = -1;\n\t\tvar a;\n\t\tvar b;\n\t\tvar c;\n\t\tvar buffer;\n\t\t// Make sure any padding is handled outside of the loop.\n\t\tvar length = input.length - padding;\n\n\t\twhile (++position < length) {\n\t\t\t// Read three bytes, i.e. 24 bits.\n\t\t\ta = input.charCodeAt(position) << 16;\n\t\t\tb = input.charCodeAt(++position) << 8;\n\t\t\tc = input.charCodeAt(++position);\n\t\t\tbuffer = a + b + c;\n\t\t\t// Turn the 24 bits into four chunks of 6 bits each, and append the\n\t\t\t// matching character for each of them to the output.\n\t\t\toutput += (\n\t\t\t\tTABLE.charAt(buffer >> 18 & 0x3F) +\n\t\t\t\tTABLE.charAt(buffer >> 12 & 0x3F) +\n\t\t\t\tTABLE.charAt(buffer >> 6 & 0x3F) +\n\t\t\t\tTABLE.charAt(buffer & 0x3F)\n\t\t\t);\n\t\t}\n\n\t\tif (padding == 2) {\n\t\t\ta = input.charCodeAt(position) << 8;\n\t\t\tb = input.charCodeAt(++position);\n\t\t\tbuffer = a + b;\n\t\t\toutput += (\n\t\t\t\tTABLE.charAt(buffer >> 10) +\n\t\t\t\tTABLE.charAt((buffer >> 4) & 0x3F) +\n\t\t\t\tTABLE.charAt((buffer << 2) & 0x3F) +\n\t\t\t\t'='\n\t\t\t);\n\t\t} else if (padding == 1) {\n\t\t\tbuffer = input.charCodeAt(position);\n\t\t\toutput += (\n\t\t\t\tTABLE.charAt(buffer >> 2) +\n\t\t\t\tTABLE.charAt((buffer << 4) & 0x3F) +\n\t\t\t\t'=='\n\t\t\t);\n\t\t}\n\n\t\treturn output;\n\t};\n\n\tvar base64 = {\n\t\t'encode': encode,\n\t\t'decode': decode,\n\t\t'version': '1.0.0'\n\t};\n\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine(function() {\n\t\t\treturn base64;\n\t\t});\n\t}\telse if (freeExports && !freeExports.nodeType) {\n\t\tif (freeModule) { // in Node.js or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = base64;\n\t\t} else { // in Narwhal or RingoJS v0.7.0-\n\t\t\tfor (var key in base64) {\n\t\t\t\tbase64.hasOwnProperty(key) && (freeExports[key] = base64[key]);\n\t\t\t}\n\t\t}\n\t} else { // in Rhino or a web browser\n\t\troot.base64 = base64;\n\t}\n\n}(this));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports,\n            module,\n            require('./lib/factory'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports',\n            'module',\n            './lib/factory'], factory);\n  }\n}(this, function(exports, module, Factory) {\n  \n  exports = module.exports = Factory;\n  exports.Factory = Factory;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports, module);\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports', 'module'], factory);\n  }\n}(this, function(exports, module) {\n  \n  /**\n   * `Factory` constructor.\n   *\n   * @api public\n   */\n  function Factory() {\n    this._mechs = [];\n  }\n  \n  /**\n   * Utilize the given `mech` with optional `name`, overridding the mechanism's\n   * default name.\n   *\n   * Examples:\n   *\n   *     factory.use(FooMechanism);\n   *\n   *     factory.use('XFOO', FooMechanism);\n   *\n   * @param {String|Mechanism} name\n   * @param {Mechanism} mech\n   * @return {Factory} for chaining\n   * @api public\n   */\n  Factory.prototype.use = function(name, mech) {\n    if (!mech) {\n      mech = name;\n      name = mech.prototype.name;\n    }\n    this._mechs.push({ name: name, mech: mech });\n    return this;\n  };\n  \n  /**\n   * Create a new mechanism from supported list of `mechs`.\n   *\n   * If no mechanisms are supported, returns `null`.\n   *\n   * Examples:\n   *\n   *     var mech = factory.create(['FOO', 'BAR']);\n   *\n   * @param {Array} mechs\n   * @return {Mechanism}\n   * @api public\n   */\n  Factory.prototype.create = function(mechs) {\n    for (var i = 0, len = this._mechs.length; i < len; i++) {\n      for (var j = 0, jlen = mechs.length; j < jlen; j++) {\n        var entry = this._mechs[i];\n        if (entry.name == mechs[j]) {\n          return new entry.mech();\n        }\n      }\n    }\n    return null;\n  };\n\n  exports = module.exports = Factory;\n  \n}));\n","\"use strict\";\n\nconst { encode, decode } = require(\"@xmpp/base64\");\nconst SASLError = require(\"./lib/SASLError\");\nconst xml = require(\"@xmpp/xml\");\nconst SASLFactory = require(\"saslmechanisms\");\n\n// https://xmpp.org/rfcs/rfc6120.html#sasl\n\nconst NS = \"urn:ietf:params:xml:ns:xmpp-sasl\";\n\nfunction getMechanismNames(features) {\n  return features.getChild(\"mechanisms\", NS).children.map((el) => el.text());\n}\n\nasync function authenticate(SASL, entity, mechname, credentials) {\n  const mech = SASL.create([mechname]);\n  if (!mech) {\n    throw new Error(\"No compatible mechanism\");\n  }\n\n  const { domain } = entity.options;\n  const creds = {\n    username: null,\n    password: null,\n    server: domain,\n    host: domain,\n    realm: domain,\n    serviceType: \"xmpp\",\n    serviceName: domain,\n    ...credentials,\n  };\n\n  return new Promise((resolve, reject) => {\n    const handler = (element) => {\n      if (element.attrs.xmlns !== NS) {\n        return;\n      }\n\n      if (element.name === \"challenge\") {\n        mech.challenge(decode(element.text()));\n        const resp = mech.response(creds);\n        entity.send(\n          xml(\n            \"response\",\n            { xmlns: NS, mechanism: mech.name },\n            typeof resp === \"string\" ? encode(resp) : \"\",\n          ),\n        );\n        return;\n      }\n\n      if (element.name === \"failure\") {\n        reject(SASLError.fromElement(element));\n      } else if (element.name === \"success\") {\n        resolve();\n      }\n\n      entity.removeListener(\"nonza\", handler);\n    };\n\n    entity.on(\"nonza\", handler);\n\n    if (mech.clientFirst) {\n      entity.send(\n        xml(\n          \"auth\",\n          { xmlns: NS, mechanism: mech.name },\n          encode(mech.response(creds)),\n        ),\n      );\n    }\n  });\n}\n\nmodule.exports = function sasl({ streamFeatures }, credentials) {\n  const SASL = new SASLFactory();\n\n  streamFeatures.use(\"mechanisms\", NS, async ({ stanza, entity }) => {\n    const offered = getMechanismNames(stanza);\n    const supported = SASL._mechs.map(({ name }) => name);\n    // eslint-disable-next-line unicorn/prefer-array-find\n    const intersection = supported.filter((mech) => {\n      return offered.includes(mech);\n    });\n    // eslint-disable-next-line prefer-destructuring\n    let mech = intersection[0];\n\n    if (typeof credentials === \"function\") {\n      await credentials(\n        (creds) => authenticate(SASL, entity, mech, creds, stanza),\n        mech,\n      );\n    } else {\n      if (!credentials.username && !credentials.password) {\n        mech = \"ANONYMOUS\";\n      }\n\n      await authenticate(SASL, entity, mech, credentials, stanza);\n    }\n\n    await entity.restart();\n  });\n\n  return {\n    use(...args) {\n      return SASL.use(...args);\n    },\n  };\n};\n","\"use strict\";\n\nconst XMPPError = require(\"@xmpp/error\");\n\n// https://xmpp.org/rfcs/rfc6120.html#sasl-errors\n\nclass SASLError extends XMPPError {\n  constructor(...args) {\n    super(...args);\n    this.name = \"SASLError\";\n  }\n}\n\nmodule.exports = SASLError;\n","\"use strict\";\n\nconst xml = require(\"@xmpp/xml\");\n\n/*\n * References\n * https://xmpp.org/rfcs/rfc6120.html#bind\n */\n\nconst NS = \"urn:ietf:params:xml:ns:xmpp-bind\";\n\nfunction makeBindElement(resource) {\n  return xml(\"bind\", { xmlns: NS }, resource && xml(\"resource\", {}, resource));\n}\n\nasync function bind(entity, iqCaller, resource) {\n  const result = await iqCaller.set(makeBindElement(resource));\n  const jid = result.getChildText(\"jid\");\n  entity._jid(jid);\n  return jid;\n}\n\nfunction route({ iqCaller }, resource) {\n  return async ({ entity }, next) => {\n    await (typeof resource === \"function\"\n      ? resource((resource) => bind(entity, iqCaller, resource))\n      : bind(entity, iqCaller, resource));\n\n    next();\n  };\n}\n\nmodule.exports = function resourceBinding(\n  { streamFeatures, iqCaller },\n  resource,\n) {\n  streamFeatures.use(\"bind\", NS, route({ iqCaller }, resource));\n};\n","\"use strict\";\n\nconst xml = require(\"@xmpp/xml\");\n\n// https://tools.ietf.org/html/draft-cridland-xmpp-session-01\n\nconst NS = \"urn:ietf:params:xml:ns:xmpp-session\";\n\nmodule.exports = function sessionEstablishment({ iqCaller, streamFeatures }) {\n  streamFeatures.use(\"session\", NS, async (context, next, feature) => {\n    if (feature.getChild(\"optional\")) return next();\n    await iqCaller.set(xml(\"session\", NS));\n    return next();\n  });\n};\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports,\n            module,\n            require('./lib/mechanism'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports',\n            'module',\n            './lib/mechanism'], factory);\n  }\n}(this, function(exports, module, Mechanism) {\n\n  exports = module.exports = Mechanism;\n  exports.Mechanism = Mechanism;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports, module);\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports', 'module'], factory);\n  }\n}(this, function(exports, module) {\n\n  /**\n   * ANONYMOUS `Mechanism` constructor.\n   *\n   * This class implements the ANONYMOUS SASL mechanism.\n   *\n   * The ANONYMOUS SASL mechanism provides support for permitting anonymous\n   * access to various services\n   *\n   * References:\n   *  - [RFC 4505](http://tools.ietf.org/html/rfc4505)\n   *\n   * @api public\n   */\n  function Mechanism() {\n  }\n  \n  Mechanism.prototype.name = 'ANONYMOUS';\n  Mechanism.prototype.clientFirst = true;\n  \n  /**\n   * Encode a response using optional trace information.\n   *\n   * Options:\n   *  - `trace`  trace information (optional)\n   *\n   * @param {Object} cred\n   * @api public\n   */\n  Mechanism.prototype.response = function(cred) {\n    return cred.trace || '';\n  };\n  \n  /**\n   * Decode a challenge issued by the server.\n   *\n   * @param {String} chal\n   * @api public\n   */\n  Mechanism.prototype.challenge = function(chal) {\n  };\n\n  exports = module.exports = Mechanism;\n  \n}));\n","\"use strict\";\n\n/**\n * [XEP-0175: Best Practices for Use of SASL ANONYMOUS](https://xmpp.org/extensions/xep-0175.html)\n * [RFC-4504: Anonymous Simple Authentication and Security Layer (SASL) Mechanism](https://tools.ietf.org/html/rfc4505)\n */\n\nconst mech = require(\"sasl-anonymous\");\n\nmodule.exports = function saslAnonymous(sasl) {\n  sasl.use(mech);\n};\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports,\n            module,\n            require('./lib/mechanism'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports',\n            'module',\n            './lib/mechanism'], factory);\n  }\n}(this, function(exports, module, Mechanism) {\n\n  exports = module.exports = Mechanism;\n  exports.Mechanism = Mechanism;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports, module);\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports', 'module'], factory);\n  }\n}(this, function(exports, module) {\n\n  /**\n   * PLAIN `Mechanism` constructor.\n   *\n   * This class implements the PLAIN SASL mechanism.\n   *\n   * The PLAIN SASL mechanism provides support for exchanging a clear-text\n   * username and password.  This mechanism should not be used without adequate\n   * security provided by an underlying transport layer. \n   *\n   * References:\n   *  - [RFC 4616](http://tools.ietf.org/html/rfc4616)\n   *\n   * @api public\n   */\n  function Mechanism() {\n  }\n  \n  Mechanism.prototype.name = 'PLAIN';\n  Mechanism.prototype.clientFirst = true;\n  \n  /**\n   * Encode a response using given credential.\n   *\n   * Options:\n   *  - `username`\n   *  - `password`\n   *  - `authzid`   authorization identity (optional)\n   *\n   * @param {Object} cred\n   * @api public\n   */\n  Mechanism.prototype.response = function(cred) {\n    var str = '';\n    str += cred.authzid || '';\n    str += '\\0';\n    str += cred.username;\n    str += '\\0';\n    str += cred.password;\n    return str;\n  };\n  \n  /**\n   * Decode a challenge issued by the server.\n   *\n   * @param {String} chal\n   * @return {Mechanism} for chaining\n   * @api public\n   */\n  Mechanism.prototype.challenge = function(chal) {\n    return this;\n  };\n\n  exports = module.exports = Mechanism;\n  \n}));\n","\"use strict\";\n\nconst mech = require(\"sasl-plain\");\n\nmodule.exports = function saslPlain(sasl) {\n  sasl.use(mech);\n};\n","import { Client as _Client, jid as _jid, xml as _xml } from '@xmpp/client-core';\nimport _connection from '@xmpp/connection';\nimport _reconnect from '@xmpp/reconnect';\nimport _websocket from '@xmpp/websocket';\nimport _middleware from '@xmpp/middleware';\nimport _streamFeatures from '@xmpp/stream-features';\nimport _iqCaller from '@xmpp/iq/caller';\nimport _iqCallee from '@xmpp/iq/callee';\nimport _resolve from '@xmpp/resolve';\nimport _sasl from '@xmpp/sasl';\nimport _resourceBinding from '@xmpp/resource-binding';\nimport _sessionEstablishment from '@xmpp/session-establishment';\nimport anonymous from '@xmpp/sasl-anonymous';\nimport plain from '@xmpp/sasl-plain';\n\nexport interface Options extends _connection.Options {\n  resource?: _resourceBinding.Resource | undefined;\n  credentials?: _sasl.Credentials | undefined;\n  username?: string | undefined;\n  password?: string | undefined;\n}\n\nexport interface XMPPClient extends _Client {\n  entity: _Client;\n  reconnect: _reconnect.Reconnect<_Client>;\n  websocket: any;\n  middleware: _middleware.Middleware<_Client>;\n  streamFeatures: _streamFeatures.StreamFeatures<_Client>;\n  iqCaller: _iqCaller.IQCaller<_Client>;\n  iqCallee: _iqCallee.IQCallee<_Client>;\n  starttls: _middleware.Middleware<_Client>;\n  resolve: any;\n  sasl: _sasl.SASL;\n  resourceBinding: any;\n  sessionEstablishment: any;\n  mechanisms: { [x: string]: any }[];\n  options: Options;\n}\n\nexport function xmppClient(options: Options): XMPPClient {\n  const { resource, credentials, username, password, ...params } = options;\n  const { domain, service } = params;\n\n  if (!domain && service) {\n    params.domain = (service.split('://')[1] || service).split(':')[0].split('/')[0];\n  }\n\n  const entity = new _Client(params);\n  const reconnect = _reconnect({ entity });\n  const websocket = _websocket({ entity });\n  const middleware = _middleware({ entity });\n  const streamFeatures = _streamFeatures({ middleware });\n  const iqCaller = _iqCaller({ middleware, entity });\n  const iqCallee = _iqCallee({ middleware, entity });\n  const starttls = _middleware({ entity });\n  const resolve = _resolve({ entity });\n  const sasl = _sasl({ streamFeatures }, credentials || { username, password });\n  const resourceBinding = _resourceBinding({ iqCaller, streamFeatures }, resource);\n  const sessionEstablishment = _sessionEstablishment({ iqCaller, streamFeatures });\n  const mechanisms = Object.entries({ plain, anonymous }).map(([k, v]) => ({\n    [k]: v(sasl),\n  }));\n\n  return Object.assign(entity, {\n    entity,\n    reconnect,\n    websocket,\n    middleware,\n    streamFeatures,\n    iqCaller,\n    iqCallee,\n    starttls,\n    resolve,\n    sasl,\n    resourceBinding,\n    sessionEstablishment,\n    mechanisms,\n  });\n}\n\nexport const jid: typeof _jid = _jid;\nexport const xml: typeof _xml = _xml;\n","import { Element, Node } from '@xmpp/xml';\nimport { ConnectyCubeDialogs } from './dialogs';\nimport { ConnectyCubeUsers } from './users';\n\nexport enum ChatType {\n  CHAT = 'chat',\n  GROUPCHAT = 'groupchat',\n}\nexport enum ChatEvent {\n  STATUS = 'status',\n  ERROR = 'error',\n  DISCONNECTED = 'disconnected',\n  RECONNECTED = 'reconnected',\n  MESSAGE = 'message',\n  SYSTEM_MESSAGE = 'system-message',\n  ERROR_MESSAGE = 'error-message',\n  TYPING_MESSAGE = 'typing-message',\n  UPDATE_MESSAGE = 'update-message',\n  DELETE_MESSAGE = 'delete-message',\n  REACTIONS_MESSAGE = 'reactions-message',\n  DELIVERED_MESSAGE = 'delivered-message',\n  READ_MESSAGE = 'read-message',\n  SENT_MESSAGE = 'sent-message',\n  USER_LAST_ACTIVITY = 'user-last-activity',\n  ROSTER_SUBSCRIBE = 'roster-subscribe',\n  ROSTER_CONFIRM = 'roster-confirm',\n  ROSTER_REJECT = 'roster-reject',\n  ROSTER_LIST = 'roster-list',\n  JOIN = 'join',\n  LEAVE = 'leave',\n  KICK = 'kick',\n}\nexport enum PrivacyListAction {\n  ALLOW = 'allow',\n  DENY = 'deny',\n}\nexport namespace ConnectyCubeChat {\n  export type XmlElement = Element;\n  export type XmlNode = Node;\n  export type StanzaCallback = (stanza?: Element) => void;\n  export type StanzasCallbacks = { [stanzaId: string]: StanzaCallback };\n  export type ConnectionParams = { userId: number; password: string };\n  export type ConnectionStatus =\n    | 'online' // indicates that xmpp is authenticated and addressable\n    | 'offline' // indicates that xmpp disconnected and no automatic attempt to reconnect will happen (after calling xmpp.stop())\n    | 'connecting' // socket is connecting\n    | 'connect' // socket is connected\n    | 'opening' // stream is opening\n    | 'open' // stream is open\n    | 'closing' // stream is closing\n    | 'close' // stream is closed\n    | 'disconnecting' // socket is disconnecting\n    | 'disconnect'; // socket is disconnected\n  export type MessageParams = {\n    id?: string;\n    type?: ChatType | string;\n    body?: string | null;\n    extension?: any;\n    markable?: 1;\n  };\n  export type Message = {\n    id: string;\n    dialog_id: string | null;\n    recipient_id: string | number | null;\n    is_forwarded: boolean;\n    type: ChatType | string;\n    body: string | null;\n    extension: any;\n    delay: any;\n    markable?: 1;\n  };\n  export type SystemMessageParams = {\n    id?: string;\n    body?: string | null;\n    extension?: any;\n  };\n  export type SystemMessage = {\n    id: string;\n    body: string;\n    userId: number;\n    extension: any;\n  };\n  export type MessageStatusParams = {\n    messageId: string;\n    dialogId: string;\n    userId: number;\n  };\n  export type EditMessageParams = {\n    to: string | number;\n    dialogId: string;\n    body: string;\n    originMessageId: string;\n    extension?: any;\n    last?: boolean;\n  };\n  export type DeleteMessageParams = {\n    to: string;\n    dialogId: string;\n    messageId: string;\n  };\n  export type LastActivity = {\n    userId: number;\n    seconds: number;\n  };\n  export type SearchParams = {\n    search_text?: string;\n    start_date?: number | string | Date;\n    end_date?: number | string | Date;\n    chat_dialog_ids?: string | string[];\n  };\n  export type SearchResult = {\n    results: {\n      dialogs: ConnectyCubeDialogs.Dialog[];\n      messages: any[];\n      users: ConnectyCubeUsers.User[];\n    };\n    [key: string]: any;\n  };\n  export type UserJIDParams = {\n    userId?: number;\n    resource?: string;\n    jid?: string;\n    [key: string]: any;\n  };\n  // XMPP client events and listeners\n  export type XMPPClientEvent = string | symbol;\n  export type XMPPClientListener = (...args: any[]) => void;\n  export type XMPPClientListeners = Map<XMPPClientEvent, XMPPClientListener>;\n  // Chat listeners\n  export type OnChatStatusListener = (status: ConnectionStatus) => void;\n  export type OnChatConnectionErrorListener = () => void;\n  export type OnChatDisconnectedListener = () => void;\n  export type OnChatReconnectedListener = () => void;\n  export type OnMessageListener = (userId: number, message: Message) => void;\n  export type OnMessageSystemListener = (message: SystemMessage) => void;\n  export type OnMessageErrorListener = (messageId: string, error: { code: number; info: string }) => void;\n  export type OnMessageTypingListener = (typing: boolean, userId: number, dialogId: string) => void;\n  export type OnMessageUpdateListener = (\n    messageId: string,\n    isLast: boolean,\n    updatedBody: string,\n    dialogId: string,\n    userId: number,\n    extraParams: object | null\n  ) => void;\n  export type OnMessageDeleteListener = (messageId: string, dialogId: string, userId: number) => void;\n  export type OnMessageReactionsListener = (\n    messageId: string,\n    userId: number,\n    dialogId: string,\n    add: string,\n    remove: string\n  ) => void;\n  export type OnMessageDeliveredListener = (messageId: string, dialogId: string, userId: number) => void;\n  export type OnMessageReadListener = (messageId: string, dialogId: string, userId: number) => void;\n  export type OnMessageSentListener = (lost: object | null, sent?: object) => void;\n  export type OnLastUserActivityListener = (userId: LastActivity['userId'], seconds: LastActivity['seconds']) => void;\n  export type OnRosterSubscribeListener = (userId: number) => void;\n  export type OnRosterConfirmListener = (userId: number) => void;\n  export type OnRosterRejectListener = (userId: number) => void;\n  export type OnRosterListListener = (userId: number, type: string) => void;\n  export type OnDialogJoinListener = (dialogId: string, userId: number) => void;\n  export type OnDialogLeaveListener = (dialogId: string, userId: number) => void;\n  export type OnDialogKickListener = (dialogId: string, initiatorId: number) => void;\n  export type Listeners =\n    | OnChatStatusListener\n    | OnChatConnectionErrorListener\n    | OnChatDisconnectedListener\n    | OnChatReconnectedListener\n    | OnMessageListener\n    | OnMessageSystemListener\n    | OnMessageErrorListener\n    | OnMessageTypingListener\n    | OnMessageUpdateListener\n    | OnMessageDeleteListener\n    | OnMessageReactionsListener\n    | OnMessageDeliveredListener\n    | OnMessageReadListener\n    | OnMessageSentListener\n    | OnLastUserActivityListener\n    | OnRosterSubscribeListener\n    | OnRosterConfirmListener\n    | OnRosterRejectListener\n    | OnRosterListListener\n    | OnDialogJoinListener\n    | OnDialogLeaveListener\n    | OnDialogKickListener;\n  // ContactList\n  export type ContactListItem = { userId: number; name?: string | null };\n  export type ContactList = {\n    [userId: number]: {\n      subscription: string;\n      ask: string | null;\n      name?: string | null;\n    };\n  };\n  export type ContactListSubscriptionPresence = { jid: string; type: string };\n  // PrivacyList\n  export type PrivacyList = {\n    name: string;\n    items: {\n      user_id: string | number;\n      action: PrivacyListAction | string;\n      mutualBlock?: boolean;\n    }[];\n  };\n  export type PrivacyListNames = {\n    default: string | null;\n    active: string | null;\n    names: string[];\n  };\n  export type PrivacyListItem = {\n    value: string;\n    action: string;\n    order: number;\n    isMutual: boolean;\n  };\n}\n","import ProxyService from '../Proxy';\nimport Utils from '../Utils';\nimport config from '../config';\nimport { Dialogs, EmptyResponse, ForceParams } from '../types';\nimport { ProxyMethod, ProxyType } from '../types/proxy';\n\nexport default class DialogsService {\n  public proxy: ProxyService;\n  readonly route = `${config.urls.chat}/Dialog`;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async list(params: Dialogs.ListParams = {}): Promise<Dialogs.ListResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async create(params: Dialogs.CreateParams = { type: null }): Promise<Dialogs.Dialog> {\n    const data = Utils.cloneObject(params);\n\n    if (Utils.isArray(data?.occupants_ids)) {\n      data.occupants_ids = data.occupants_ids.join(', ');\n    }\n\n    if (Utils.isArray(data?.admins_ids)) {\n      data.admins_ids = data.admins_ids.join(', ');\n    }\n\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: data,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async update(id: string, params: Dialogs.UpdateParams = {}): Promise<Dialogs.Dialog> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, id),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(\n    idOrIds: string | string[],\n    params: ForceParams = {}\n  ): Promise<Dialogs.DeleteResponse | EmptyResponse> {\n    const idsToDelete = typeof idOrIds === 'string' ? idOrIds.split(',').map((id) => id.trim()) : idOrIds;\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, idsToDelete.toString()),\n      dataType: idsToDelete.length === 1 ? ProxyType.TEXT : ProxyType.JSON,\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async addAdmins(id: string, admins_ids: number[]): Promise<Dialogs.Dialog> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, id, 'admins'),\n      data: { push_all: { admins_ids } },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async removeAdmins(id: string, admins_ids: number[]): Promise<Dialogs.Dialog> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, id, 'admins'),\n      data: { pull_all: { admins_ids } },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async subscribe(id: string): Promise<Dialogs.Dialog> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route, id, 'subscribe'),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public subscribeToPublic = this.subscribe;\n\n  public async unsubscribe(id: string): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, id, 'subscribe'),\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public unsubscribeFromPublic = this.unsubscribe;\n\n  public async updateNotificationsSettings(\n    id: string,\n    enabled: number | boolean\n  ): Promise<Dialogs.UpdateNotificationsSettingsResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, id, 'notifications'),\n      data: { enabled: enabled ? 1 : 0 },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getNotificationsSettings(id: string): Promise<Dialogs.GetNotificationsSettingsResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, id, 'notifications'),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getPublicOccupants(\n    id: string,\n    params: Dialogs.GetPublicOccupantsParams = {}\n  ): Promise<Dialogs.GetPublicOccupantsResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, id, 'occupants'),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async clearHistory(id: string): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, 'clearHistory', id),\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n","import ProxyService from '../Proxy';\nimport Utils from '../Utils';\nimport config from '../config';\nimport { EmptyResponse, ForceParams, Messages } from '../types';\nimport { ProxyMethod, ProxyType } from '../types/proxy';\n\nexport default class MessagesService {\n  public proxy: ProxyService;\n  readonly route = `${config.urls.chat}/Message`;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async list(params: Messages.ListParams = {}): Promise<Messages.ListResponse> {\n    const ajaxParams = {\n      url: Utils.getUrl(this.route),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async create(params: Messages.CreateParams = {}): Promise<Messages.Message> {\n    const ajaxParams = {\n      url: Utils.getUrl(this.route),\n      type: ProxyMethod.POST,\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async update(id: string, params: Messages.UpdateParams = {}): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      dataType: ProxyType.TEXT,\n      url: Utils.getUrl(this.route, id),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(id: string, params?: ForceParams): Promise<Messages.DeleteResponse> {\n    const ajaxParams = {\n      url: Utils.getUrl(this.route, id),\n      type: ProxyMethod.DELETE,\n      dataType: ProxyType.TEXT,\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async createSystem(params: Messages.CreateSystemParams): Promise<Messages.CreateSystemResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route, 'system'),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async unreadCount(params: Messages.UnreadCountParams = {}): Promise<Messages.UnreadCountResponse> {\n    const data = Utils.cloneObject(params);\n\n    if (data && data.chat_dialog_ids && Utils.isArray(data.chat_dialog_ids)) {\n      data.chat_dialog_ids = data.chat_dialog_ids.join(', ');\n    }\n\n    const ajaxParams = {\n      url: Utils.getUrl(this.route, 'unread'),\n      data: data,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async listReactions(id: string = '_'): Promise<Messages.ListReactionsResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      dataType: ProxyType.JSON,\n      url: Utils.getUrl(this.route, id, 'reactions'),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async addReaction(id: string, reaction: string): Promise<EmptyResponse> {\n    return this.updateReaction(id, reaction);\n  }\n\n  public async removeReaction(id: string, reaction: string): Promise<EmptyResponse> {\n    return this.updateReaction(id, undefined, reaction);\n  }\n\n  public async updateReaction(id: string, add?: string, remove?: string): Promise<EmptyResponse> {\n    return this.putReaction(id, { add, remove });\n  }\n\n  private async putReaction(id: string, params: Messages.PutReactionParams): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      dataType: ProxyType.TEXT,\n      url: Utils.getUrl(this.route, id, 'reactions'),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n","import config from '../config';\nimport { xml } from './xmpp';\nimport { Chat } from '../types';\n\nexport default class ChatUtils {\n  static buildUserJid(params: Chat.UserJIDParams = {}): string | void {\n    const { userId, resource, jid } = params;\n    const appId = config.creds.appId;\n    const url = config.endpoints.chat;\n\n    return userId ? `${userId}-${appId}@${url}${resource ? `/${resource}` : ''}` : jid;\n  }\n\n  static buildUserJidLocalPart(userId: string | number): string {\n    return `${userId}-${config.creds.appId}`;\n  }\n\n  static createMessageStanza(attrs?: string | { [attrName: string]: any }): Chat.XmlElement {\n    return xml('message', attrs);\n  }\n\n  static createIqStanza(attrs?: string | { [attrName: string]: any }): Chat.XmlElement {\n    return xml('iq', attrs);\n  }\n\n  static createPresenceStanza(attrs?: string | { [attrName: string]: any }): Chat.XmlElement {\n    return xml('presence', attrs);\n  }\n\n  static createNonza(name: string, attrs?: string | { [attrName: string]: any }): Chat.XmlElement {\n    return xml(name, attrs);\n  }\n\n  static getAttr(element: Chat.XmlElement, name: string): any {\n    return element?.getAttr(name) || element?.attrs[name] || null;\n  }\n\n  static getElement(element: Chat.XmlElement, name: string): Chat.XmlElement | undefined {\n    return element?.getChild(name);\n  }\n\n  static getName(element: Chat.XmlElement): string | null {\n    return element?.getName() || null;\n  }\n\n  static getText(element: Chat.XmlElement): string | null {\n    return element?.getText() || null;\n  }\n\n  static getChildElements(element: Chat.XmlElement): Chat.XmlElement[] {\n    return element?.getChildElements() || [];\n  }\n\n  static isErrorStanza(element: Chat.XmlElement): boolean {\n    return !!element?.getChild('error');\n  }\n\n  static getAllElements(element: Chat.XmlElement, name: string): Chat.XmlElement[] {\n    return element?.getChildren(name) || [];\n  }\n\n  static getElementText(element: Chat.XmlElement, name: string): string | null {\n    return element?.getChildText(name) || null;\n  }\n\n  static getElementTreePath(element: Chat.XmlElement, elementsPath: string[]): Chat.XmlElement {\n    return elementsPath.reduce(\n      (prevElement: Chat.XmlElement, name: string) =>\n        prevElement ? ChatUtils.getElement(prevElement, name) : prevElement,\n      element\n    );\n  }\n\n  static assignObjectToXml(element: Chat.XmlElement, obj: object, name: string): Chat.XmlElement {\n    element = element.c(name);\n\n    Object.keys(obj).forEach((key: string) => {\n      if (typeof obj[key] === 'object') {\n        ChatUtils.assignObjectToXml(element, obj[key], key);\n      } else {\n        element = element.c(key).t(obj[key]).up();\n      }\n    });\n\n    element = element.up();\n\n    return element;\n  }\n\n  static assignExtraParamsToXml(element: Chat.XmlElement, extension: object): Chat.XmlElement {\n    let extraParams = ChatUtils.getElement(element, 'extraParams');\n\n    Object.keys(extension).forEach((key) => {\n      if (key === 'attachments') {\n        extension[key].forEach((attachment) => {\n          extraParams.c('attachment', attachment).up();\n        });\n      } else if (typeof extension[key] === 'object') {\n        ChatUtils.assignObjectToXml(extraParams, extension[key], key);\n      } else {\n        extraParams.c(key).t(extension[key]).up();\n      }\n    });\n\n    element.up();\n\n    return element;\n  }\n\n  static assignXmlToObject(element: Chat.XmlElement, obj: any): any {\n    const { children, name } = element;\n    const item = { [name]: {} };\n\n    children.forEach((node: Chat.XmlNode) => {\n      if (typeof node === 'string') {\n        item[name] = node;\n      } else if (node.children.length > 0) {\n        ChatUtils.assignXmlToObject(node, item[name]);\n      } else {\n        item[name][node.name] = ChatUtils.getText(node);\n      }\n    });\n\n    return Object.assign(obj, item);\n  }\n\n  static parseExtraParams(element: Chat.XmlElement): { extension: any; dialogId: string | undefined } | undefined {\n    if (!element) {\n      return null;\n    }\n\n    const extension: any = { attachments: [] };\n    let dialogId: string | null = null;\n\n    element.children.forEach((node: Chat.XmlNode) => {\n      if (typeof node === 'string') {\n        return;\n      }\n\n      if (node.name === 'attachment') {\n        const attachment: any = {};\n\n        Object.keys(node.attrs).forEach((key: string) => {\n          attachment[key] = key === 'size' ? parseInt(node.attrs.size) : node.attrs[key];\n        });\n\n        extension.attachments.push(attachment);\n      } else if (node.name === 'dialog_id') {\n        dialogId = ChatUtils.getElementText(element, 'dialog_id');\n        extension.dialog_id = dialogId;\n      }\n\n      if (node.children.length) {\n        ChatUtils.assignXmlToObject(node, extension);\n      }\n    });\n\n    if (extension.attachments.length === 0) {\n      delete extension.attachments;\n    }\n    if (extension.moduleIdentifier) {\n      delete extension.moduleIdentifier;\n    }\n\n    return { extension, dialogId };\n  }\n\n  static buildErrorFromXMPPErrorStanza(errorStanza: Chat.XmlElement): { code: number; info: string } {\n    const errorElement = ChatUtils.getElement(errorStanza, 'error');\n    const code = parseInt(ChatUtils.getAttr(errorElement, 'code'));\n    const info = ChatUtils.getElementText(errorElement, 'text');\n    return { code: code, info: info };\n  }\n\n  static getUniqueId(suffix?: any): string {\n    const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n      const r = (Math.random() * 16) | 0;\n      const v = c == 'x' ? r : (r & 0x3) | 0x8;\n      return v.toString(16);\n    });\n\n    if (typeof suffix === 'string' || typeof suffix === 'number') {\n      return `${uuid}:${suffix}`;\n    } else {\n      return uuid;\n    }\n  }\n\n  static parseReactions(element: Chat.XmlElement): { add: string; remove: string } {\n    const reactions = ChatUtils.getChildElements(element).map((node: Chat.XmlElement) => ({\n      add: ChatUtils.getAttr(node, 'add') === 'true',\n      remove: ChatUtils.getAttr(node, 'remove') === 'true',\n      reaction: ChatUtils.getAttr(node, 'type'),\n    }));\n\n    return reactions.reduce(\n      (items, { add, remove, reaction }) => {\n        if (add) {\n          items['add'] = reaction;\n        } else if (remove) {\n          items['remove'] = reaction;\n        }\n        return items;\n      },\n      {} as { add: any; remove: any }\n    );\n  }\n}\n","import Utils from '../Utils';\nimport config from '../config';\nimport ChatUtils from './ChatUtils';\n\nexport default class ChatHelpers {\n  public xmppJID: string;\n\n  constructor() {\n    this.xmppJID = '';\n  }\n\n  public get userCurrentJid(): string | '' {\n    return this.xmppJID;\n  }\n\n  public set userCurrentJid(jid: string | null) {\n    this.xmppJID = jid || '';\n  }\n\n  public getUniqueId = ChatUtils.getUniqueId;\n\n  public isNumeric(value: string): boolean {\n    return /^-?\\d+$/.test(value) || /^\\d+\\.\\d+$/.test(value);\n  }\n\n  public jidOrUserId(jidOrUserId: string | number): string {\n    if (typeof jidOrUserId === 'string') {\n      return this.isNumeric(jidOrUserId)\n        ? this.getUserJid(jidOrUserId)\n        : jidOrUserId.includes('@')\n          ? jidOrUserId\n          : this.getRoomJidFromDialogId(jidOrUserId);\n    }\n\n    return this.getUserJid(jidOrUserId);\n  }\n\n  public typeChat(jidOrUserId: string | number): 'chat' | 'groupchat' {\n    switch (typeof jidOrUserId) {\n      case 'string':\n        return this.isNumeric(jidOrUserId)\n          ? 'chat'\n          : jidOrUserId.includes('@')\n            ? jidOrUserId.includes('muc')\n              ? 'groupchat'\n              : 'chat'\n            : 'groupchat';\n      case 'number':\n        return 'chat';\n      default:\n        throw new Error('Unsupported chat type');\n    }\n  }\n\n  public getUserJid(userId: string | number): string {\n    return `${userId}-${config.creds.appId}@${config.endpoints.chat}`;\n  }\n\n  public getUserNickWithMucDomain(userId: string | number): string {\n    return `${config.endpoints.muc}/${userId}`;\n  }\n\n  public getUserIdFromJID(jid: string = this.userCurrentJid): number | null {\n    return jid?.includes('@') ? parseInt(jid.split('@')[0].split('-')[0]) : null;\n  }\n\n  public getDialogIdFromJID(jid: string): string | null {\n    return jid?.includes('@') ? jid.split('@')[0].split('_')[1] : null;\n  }\n\n  public getRoomJidFromDialogId(dialogId: string): string {\n    return `${config.creds.appId}_${dialogId}@${config.endpoints.muc}`;\n  }\n\n  public getRoomJid(jid: string): string {\n    return `${jid}/${this.getUserIdFromJID(this.userCurrentJid)}`;\n  }\n\n  public getIdFromResource(jid: string): number | null {\n    const parts = jid.split('/');\n    return parts.length > 1 ? parseInt(parts.slice(1).join('/')) : null;\n  }\n\n  public getRoomJidFromRoomFullJid(jid: string): string | null {\n    const parts = jid.split('/');\n    return parts.length > 1 ? parts[0] : null;\n  }\n\n  public getBsonObjectId = Utils.getBsonObjectId;\n\n  public getUserIdFromRoomJid(roomJid: string): number | null {\n    const parts = roomJid.split('/');\n    return parts.length > 1 ? parseInt(parts[parts.length - 1]) : null;\n  }\n\n  getDialogJid(identifier: string): string {\n    return identifier.indexOf('@') > 0 ? identifier : this.getRoomJidFromDialogId(identifier);\n  }\n}\n","import { XMPPClient } from './xmpp';\nimport ChatUtils from './ChatUtils';\nimport Utils from '../Utils';\nimport { Chat } from '../types';\n\nexport default class StreamManagement {\n  readonly xmlns: string = 'urn:xmpp:sm:3';\n  private enabled: boolean = false;\n  private clientProcessedStanzasCounter: number = 0; // Counter of the incoming stanzas\n  private clientSentStanzasCounter: number = 0; // The client send stanza counter.\n  private lastAck: number = 0; // The last acknowledged stanza\n  private unackedQueue: { message: object; expect: number }[] = []; // In progress stanzas queue\n  private xmppClient: XMPPClient; // connection\n  private originalSend: XMPPClient['send']; // Original connection.send method\n  public sentMessageCallback: Chat.OnMessageSentListener;\n\n  constructor() {}\n\n  public enable(connection: XMPPClient): void {\n    if (!this.enabled) {\n      this.xmppClient = connection;\n      this.originalSend = this.xmppClient.send;\n      this.xmppClient.send = this.send.bind(this);\n    }\n\n    this.clientProcessedStanzasCounter = 0;\n    this.clientSentStanzasCounter = 0;\n    this.lastAck = 0;\n\n    this.removeElementHandler();\n    this.addElementHandler();\n\n    const stanza = ChatUtils.createNonza('enable', { xmlns: this.xmlns });\n\n    this.xmppClient.send(stanza);\n  }\n\n  public removeElementHandler(): void {\n    this.xmppClient.removeListener('element', this.incomingStanzaHandler);\n  }\n\n  public addElementHandler(): void {\n    this.xmppClient.on('element', this.incomingStanzaHandler);\n  }\n\n  public send(stanza: Chat.XmlElement, message?: object): void {\n    const type = ChatUtils.getAttr(stanza, 'type');\n    const body = ChatUtils.getElementText(stanza, 'body');\n    const attachments = ChatUtils.getAllElements(stanza, 'attachment');\n    const isMessage = stanza.name === 'message';\n    const isChat = type === 'chat' || type === 'groupchat';\n    const isContent = body || attachments.length;\n\n    this.originalSend.call(this.xmppClient, stanza);\n\n    if (this.enabled && isMessage && isChat && isContent) {\n      this.unackedQueue.push({ message, expect: this.clientSentStanzasCounter });\n\n      const r = ChatUtils.createNonza('r', { xmlns: this.xmlns });\n\n      this.originalSend.call(this.xmppClient, r);\n    }\n\n    ++this.clientSentStanzasCounter;\n  }\n\n  private incomingStanzaHandler = (stanza: Chat.XmlElement): void => {\n    if (stanza.name === 'enabled') {\n      this.enabled = true;\n      return;\n    }\n\n    if (ChatUtils.getAttr(stanza, 'xmlns') !== this.xmlns) {\n      ++this.clientProcessedStanzasCounter;\n    }\n\n    if (stanza.name === 'r') {\n      const params = { xmlns: this.xmlns, h: this.clientProcessedStanzasCounter };\n      const answerStanza = ChatUtils.createNonza('a', params);\n      this.originalSend.call(this.xmppClient, answerStanza);\n      return;\n    }\n\n    if (stanza.name === 'a') {\n      const h = parseInt(ChatUtils.getAttr(stanza, 'h'));\n      const numAcked = h - this.lastAck;\n\n      Utils.DLog('[Chat][SM][checkCounterOnIncomeStanza]', numAcked, h, this.lastAck);\n\n      for (let i = 0; i < numAcked && this.unackedQueue.length > 0; i++) {\n        this.sentMessageCallback(null, this.unackedQueue.shift().message);\n      }\n\n      this.lastAck = h;\n    }\n  };\n}\n","import ChatUtils from './ChatUtils';\nimport Utils from '../Utils';\nimport config from '../config';\nimport ChatHelpers from './Helpers';\nimport { XMPPClient } from './xmpp';\nimport { Chat } from '../types';\n\nexport default class ContactList {\n  readonly xmlns: string = 'jabber:iq:roster';\n  public contacts: Chat.ContactList = {};\n  public helpers: ChatHelpers;\n  public xmppClient: XMPPClient;\n  public stanzasCallbacks: Chat.StanzasCallbacks;\n\n  constructor(options: { helpers: ChatHelpers; xmppClient: XMPPClient; stanzasCallbacks: Chat.StanzasCallbacks }) {\n    this.helpers = options.helpers;\n    this.xmppClient = options.xmppClient;\n    this.stanzasCallbacks = options.stanzasCallbacks;\n  }\n\n  public async get(): Promise<Chat.ContactList> {\n    return new Promise((resolve, _reject) => {\n      const contacts: Chat.ContactList = {};\n      const stanzaId = ChatUtils.getUniqueId('getRoster');\n      const iqStanza = ChatUtils.createIqStanza({\n        type: 'get',\n        from: this.helpers.userCurrentJid,\n        id: stanzaId,\n      });\n\n      iqStanza.c('query', { xmlns: this.xmlns });\n\n      this.stanzasCallbacks[stanzaId] = (stanza) => {\n        const items = ChatUtils.getAllElements(stanza, 'query');\n\n        for (let i = 0, len = items.length; i < len; i++) {\n          const userId = this.helpers.getUserIdFromJID(ChatUtils.getAttr(items[i], 'jid'));\n          const ask = ChatUtils.getAttr(items[i], 'ask');\n          const subscription = ChatUtils.getAttr(items[i], 'subscription');\n          const name = ChatUtils.getAttr(items[i], 'name');\n          const isUniqName = `${userId}-${config.creds.appId}` !== name;\n\n          contacts[userId] = {\n            subscription: subscription,\n            ask: ask || null,\n            name: isUniqName ? name : null,\n          };\n        }\n\n        resolve(contacts);\n      };\n\n      this.xmppClient.send(iqStanza);\n    });\n  }\n\n  public async add(params: Chat.ContactListItem | number): Promise<void> {\n    return new Promise((resolve, _reject) => {\n      const userId = typeof params === 'object' ? params.userId : params;\n      const userName = typeof params === 'object' ? params.name : null;\n      const userJid = this.helpers.jidOrUserId(userId);\n      const stanzaId = ChatUtils.getUniqueId('addContactInRoster');\n      const iqStanza = ChatUtils.createIqStanza({\n        type: 'set',\n        from: this.helpers.userCurrentJid,\n        id: stanzaId,\n      });\n\n      iqStanza.c('query', { xmlns: this.xmlns }).c('item', { jid: userJid, name: userName });\n\n      this.contacts[userId] = {\n        subscription: 'none',\n        ask: 'subscribe',\n        name: userName,\n      };\n\n      this.stanzasCallbacks[stanzaId] = () => {\n        this.sendSubscriptionPresence({\n          jid: userJid,\n          type: 'subscribe',\n        });\n\n        resolve();\n      };\n\n      this.xmppClient.send(iqStanza);\n    });\n  }\n\n  public async confirm(params: Chat.ContactListItem | number): Promise<void> {\n    const userId = typeof params === 'object' ? params.userId : params;\n    const userJid = this.helpers.jidOrUserId(userId);\n\n    this.sendSubscriptionPresence({\n      jid: userJid,\n      type: 'subscribed',\n    });\n\n    if (config.chat.contactList.subscriptionMode.mutual) {\n      await this.add(params);\n    }\n  }\n\n  public async reject(userId: number): Promise<void> {\n    return new Promise((resolve, _reject) => {\n      const userJid = this.helpers.jidOrUserId(userId);\n\n      this.contacts[userId] = {\n        subscription: 'none',\n        ask: null,\n      };\n\n      this.sendSubscriptionPresence({\n        jid: userJid,\n        type: 'unsubscribed',\n      });\n\n      resolve();\n    });\n  }\n\n  public async updateName(params: Chat.ContactListItem): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const { userId, name = null } = params;\n      const userJid = this.helpers.jidOrUserId(userId);\n      const stanzaId = ChatUtils.getUniqueId('updateContactInRoster');\n\n      if (Utils.isObject(this.contacts[userId])) {\n        this.contacts[userId].name = name;\n      } else {\n        reject('No contact exists with provided user id');\n        return;\n      }\n\n      const iqStanza = ChatUtils.createIqStanza({\n        type: 'set',\n        from: this.helpers.userCurrentJid,\n        id: stanzaId,\n      });\n\n      iqStanza.c('query', { xmlns: this.xmlns }).c('item', { jid: userJid, name: name });\n\n      this.stanzasCallbacks[stanzaId] = (element) => {\n        ChatUtils.getAttr(element, 'type') === 'result' ? resolve() : reject(element);\n      };\n\n      this.xmppClient.send(iqStanza);\n    });\n  }\n\n  public async remove(userId: number): Promise<void> {\n    return new Promise((resolve, _reject) => {\n      const userJid = this.helpers.jidOrUserId(userId);\n      const stanzaId = ChatUtils.getUniqueId('removeContactInRoster');\n      const iqStanza = ChatUtils.createIqStanza({\n        type: 'set',\n        from: this.helpers.userCurrentJid,\n        id: stanzaId,\n      });\n\n      iqStanza.c('query', { xmlns: this.xmlns }).c('item', { jid: userJid, subscription: 'remove' });\n\n      this.stanzasCallbacks[stanzaId] = () => {\n        delete this.contacts[userId];\n        resolve();\n      };\n\n      this.xmppClient.send(iqStanza);\n    });\n  }\n\n  public sendSubscriptionPresence(params: Chat.ContactListSubscriptionPresence): void {\n    const presenceParams = {\n      to: params.jid,\n      type: params.type,\n    };\n\n    const presenceStanza = ChatUtils.createPresenceStanza(presenceParams);\n\n    this.xmppClient.send(presenceStanza);\n  }\n}\n","import ChatUtils from './ChatUtils';\nimport Utils from '../Utils';\nimport ChatHelpers from './Helpers';\nimport { XMPPClient } from './xmpp';\nimport { Chat } from '../types';\n\nexport default class PrivacyList {\n  readonly xmlns = 'jabber:iq:privacy';\n  public helpers: ChatHelpers;\n  public xmppClient: XMPPClient;\n  public stanzasCallbacks: Chat.StanzasCallbacks;\n\n  constructor(options: { helpers: ChatHelpers; xmppClient: XMPPClient; stanzasCallbacks: Chat.StanzasCallbacks }) {\n    this.helpers = options.helpers;\n    this.xmppClient = options.xmppClient;\n    this.stanzasCallbacks = options.stanzasCallbacks;\n  }\n\n  public async create(list: Chat.PrivacyList): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const privacyList = list.items.reduce((acc, { user_id, action, mutualBlock }) => {\n        acc[user_id] = { action, mutualBlock };\n        return acc;\n      }, {});\n\n      const privacyListKeys = Object.keys(privacyList);\n      const iqParams = {\n        type: 'set',\n        from: this.helpers.userCurrentJid,\n        id: ChatUtils.getUniqueId('edit'),\n      };\n\n      let iq = ChatUtils.createIqStanza(iqParams);\n\n      iq.c('query', { xmlns: this.xmlns }).c('list', { name: list.name });\n\n      for (let index = 0, j = 0, len = privacyListKeys.length; index < len; index++, j = j + 2) {\n        const userId = privacyListKeys[index];\n        const { action, mutualBlock } = privacyList[userId];\n        const isMutual = mutualBlock && action === 'deny';\n        const userJid = this.helpers.jidOrUserId(parseInt(userId, 10));\n        const userMuc = this.helpers.getUserNickWithMucDomain(userId);\n\n        this.assignPrivacyItem(iq, { order: j + 1, value: userJid, action, isMutual });\n        this.assignPrivacyItem(iq, { order: j + 2, value: userMuc, action, isMutual });\n      }\n\n      this.stanzasCallbacks[iqParams.id] = (stanza: Chat.XmlElement) => {\n        ChatUtils.isErrorStanza(stanza) ? reject(ChatUtils.buildErrorFromXMPPErrorStanza(stanza)) : resolve();\n      };\n\n      this.xmppClient.send(iq);\n    });\n  }\n\n  public async getList(name: string): Promise<Chat.PrivacyList> {\n    return new Promise((resolve, _reject) => {\n      const id = ChatUtils.getUniqueId('getlist');\n      const iq = ChatUtils.createIqStanza({\n        type: 'get',\n        from: this.helpers.userCurrentJid,\n        id,\n      });\n\n      iq.c('query', { xmlns: this.xmlns }).c('list', { name });\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement): void => {\n        const query = ChatUtils.getElement(stanza, 'query');\n        const list = ChatUtils.getElement(query, 'list');\n        const privacyList: Chat.PrivacyList = {\n          name: ChatUtils.getAttr(list, 'name'),\n          items: ChatUtils.getChildElements(list)\n            .map((item, index) => {\n              if (index % 2 === 0) {\n                const { action, value } = item.attrs;\n                return {\n                  user_id: this.helpers.getUserIdFromJID(value),\n                  action: action,\n                };\n              }\n              return null;\n            })\n            .filter((item) => item !== null),\n        };\n\n        resolve(privacyList);\n\n        delete this.stanzasCallbacks[id];\n      };\n\n      this.xmppClient.send(iq);\n    });\n  }\n\n  public async update(list: Chat.PrivacyList): Promise<void> {\n    try {\n      const existentList = await this.getList(list.name);\n      const updatedList = {\n        items: Utils.mergeArrays(existentList.items, list.items),\n        name: list.name,\n      };\n      await this.create(updatedList);\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  public async getNames(): Promise<Chat.PrivacyListNames> {\n    return new Promise((resolve, reject) => {\n      const id = ChatUtils.getUniqueId('getNames');\n      const iq = ChatUtils.createIqStanza({\n        type: 'get',\n        from: this.helpers.userCurrentJid,\n        id,\n      });\n\n      iq.c('query', { xmlns: this.xmlns });\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement) => {\n        if (!ChatUtils.isErrorStanza(stanza)) {\n          const query = ChatUtils.getElement(stanza, 'query');\n          const defaultElement = ChatUtils.getElement(query, 'default');\n          const activeElement = ChatUtils.getElement(query, 'active');\n          const defaultName = ChatUtils.getAttr(defaultElement, 'name');\n          const activeName = ChatUtils.getAttr(activeElement, 'name');\n          const allNames = ChatUtils.getChildElements(query).map((list) => ChatUtils.getAttr(list, 'name'));\n\n          const namesList = {\n            default: defaultName,\n            active: activeName,\n            names: allNames,\n          };\n\n          resolve(namesList);\n        } else {\n          reject(ChatUtils.buildErrorFromXMPPErrorStanza(stanza));\n        }\n      };\n\n      this.xmppClient.send(iq);\n    });\n  }\n\n  public async delete(name: string): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const id = ChatUtils.getUniqueId('remove');\n      const iq = ChatUtils.createIqStanza({\n        type: 'set',\n        from: this.helpers.userCurrentJid,\n        id,\n      });\n\n      iq.c('query', { xmlns: this.xmlns }).c('list', { name: name ? name : '' });\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement) => {\n        ChatUtils.isErrorStanza(stanza) ? reject(ChatUtils.buildErrorFromXMPPErrorStanza(stanza)) : resolve();\n      };\n\n      this.xmppClient.send(iq);\n    });\n  }\n\n  public async setAsDefault(name: string): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const id = ChatUtils.getUniqueId('default');\n      const iq = ChatUtils.createIqStanza({\n        type: 'set',\n        from: this.helpers.userCurrentJid,\n        id,\n      });\n\n      iq.c('query', { xmlns: this.xmlns }).c('default', name && name.length > 0 ? { name: name } : {});\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement) => {\n        ChatUtils.isErrorStanza(stanza) ? reject(ChatUtils.buildErrorFromXMPPErrorStanza(stanza)) : resolve();\n      };\n\n      this.xmppClient.send(iq);\n    });\n  }\n\n  private assignPrivacyItem(iq: Chat.XmlElement, params: Chat.PrivacyListItem): void {\n    const { value, action, order, isMutual } = params;\n    const query = ChatUtils.getElement(iq, 'query');\n    const list = ChatUtils.getElement(query, 'list');\n    const item = list.c('item', { type: 'jid', value, action, order });\n\n    if (isMutual) {\n      item.up();\n\n      if (order % 2 === 0) {\n        iq.up().up();\n      }\n    } else {\n      item.c('message', {}).up().c('presence-in', {}).up().c('presence-out', {}).up().c('iq', {}).up().up();\n    }\n  }\n}\n","import { XMPPClient } from './xmpp';\nimport ChatHelpers from './Helpers';\nimport ChatUtils from './ChatUtils';\nimport { Chat } from '../types';\n\nexport default class MultiUserChat {\n  readonly xmlns = 'http://jabber.org/protocol/muc';\n  public helpers: ChatHelpers;\n  public xmppClient: XMPPClient;\n  public stanzasCallbacks: Chat.StanzasCallbacks;\n  public joinedRooms: { [jid: string]: boolean };\n\n  constructor(options: { helpers: ChatHelpers; xmppClient: XMPPClient; stanzasCallbacks: Chat.StanzasCallbacks }) {\n    this.helpers = options.helpers;\n    this.xmppClient = options.xmppClient;\n    this.stanzasCallbacks = options.stanzasCallbacks;\n  }\n\n  public async join(dialogIdOrJid: string): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const id = ChatUtils.getUniqueId('join');\n      const dialogJid = this.helpers.getDialogJid(dialogIdOrJid);\n      const presenceStanza = ChatUtils.createPresenceStanza({\n        id: id,\n        from: this.helpers.userCurrentJid,\n        to: this.helpers.getRoomJid(dialogJid),\n      });\n\n      presenceStanza.c('x', { xmlns: this.xmlns }).c('history', { maxstanzas: 0 });\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement) => {\n        const x = ChatUtils.getElement(stanza, 'x');\n        const status = ChatUtils.getElement(x, 'status');\n        const code = ChatUtils.getAttr(status, 'code');\n\n        if (status && code == '110') {\n          this.joinedRooms[dialogJid] = true;\n          resolve();\n        } else {\n          const isJoin = ChatUtils.getAttr(x, 'xmlns') === this.xmlns && id.endsWith(':join');\n          const isError = ChatUtils.getAttr(stanza, 'type') === 'error';\n\n          if (isJoin && isError) {\n            const errorElement = ChatUtils.getElement(stanza, 'error');\n            const errorResponse = {\n              code: ChatUtils.getAttr(errorElement, 'code'),\n              message: ChatUtils.getElementText(errorElement, 'text') || 'Unknown issue',\n            };\n\n            reject(errorResponse);\n          }\n        }\n      };\n\n      this.xmppClient.send(presenceStanza);\n    });\n  }\n\n  public async leave(dialogIdOrJid: string): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const dialogJid = this.helpers.getDialogJid(dialogIdOrJid);\n      const presenceStanza = ChatUtils.createPresenceStanza({\n        type: 'unavailable',\n        from: this.helpers.userCurrentJid,\n        to: this.helpers.getRoomJid(dialogJid),\n      });\n\n      delete this.joinedRooms[dialogJid];\n\n      this.stanzasCallbacks['muc:leave'] = (_stanza: Chat.XmlElement) => {\n        resolve();\n      };\n\n      this.xmppClient.send(presenceStanza);\n    });\n  }\n\n  public async listOnlineUsers(dialogIdOrJid): Promise<(string | number)[]> {\n    return new Promise((resolve, _reject) => {\n      const id = ChatUtils.getUniqueId('muc_disco_items');\n      const iqStanza = ChatUtils.createIqStanza({\n        type: 'get',\n        to: this.helpers.getDialogJid(dialogIdOrJid),\n        from: this.helpers.userCurrentJid,\n        id,\n      });\n\n      iqStanza.c('query', { xmlns: 'http://jabber.org/protocol/disco#items' });\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement) => {\n        const stanzaId = ChatUtils.getAttr(stanza, 'id');\n\n        if (this.stanzasCallbacks[stanzaId]) {\n          const query = ChatUtils.getAttr(stanza, 'query');\n          const users = ChatUtils.getChildElements(query).map((item: Chat.XmlElement): string | number => {\n            const roomJid = ChatUtils.getAttr(item, 'jid');\n            return this.helpers.getUserIdFromRoomJid(roomJid);\n          });\n\n          resolve(users);\n        }\n      };\n\n      this.xmppClient.send(iqStanza);\n    });\n  }\n}\n","import config from '../config';\nimport { XMPPClient, xmppClient } from './xmpp';\nimport Utils from '../Utils';\nimport ProxyService from '../Proxy';\nimport DialogsService from './Dialogs';\nimport MessagesService from './Messages';\nimport ChatHelpers from './Helpers';\nimport ChatUtils from './ChatUtils';\nimport StreamManagement from './StreamManagement';\nimport ContactList from './ContactList';\nimport WebRTCSignalingProcessor from '../videocalling/WebRTCSignalingProcessor';\nimport PrivacyList from './PrivacyList';\nimport MultiUserChat from './MultiUserChat';\nimport { Chat } from '../types';\nimport { ChatEvent } from '../types/chat';\nimport { ProxyMethod } from '../types/proxy';\n\nexport default class ChatService {\n  public proxy: ProxyService;\n  public dialog: DialogsService;\n  public message: MessagesService;\n  public xmppClient: XMPPClient;\n  public helpers: ChatHelpers;\n  public contactlist: ContactList;\n  public privacylist: PrivacyList;\n  public muc: MultiUserChat;\n  public streamManagement: StreamManagement;\n  public webrtcSignalingProcessor?: WebRTCSignalingProcessor;\n\n  public isConnected: boolean = false;\n  private isConnecting: boolean = false;\n  private isLogout: boolean = false;\n  private isReconnect: boolean = false;\n\n  public stanzasCallbacks: Chat.StanzasCallbacks = {};\n  private xmppClientListeners: Chat.XMPPClientListeners = new Map<Chat.XMPPClientEvent, Chat.XMPPClientListener>();\n  private connectPromise: Promise<boolean> | null = null;\n  private earlyIncomingMessagesQueue: Chat.XmlElement[] = [];\n  private pingTimer: NodeJS.Timeout | null = null;\n\n  public onChatStatusListener: Chat.OnChatStatusListener;\n  public onConnectionErrorListener: Chat.OnChatConnectionErrorListener;\n  public onDisconnectedListener: Chat.OnChatDisconnectedListener;\n  public onReconnectListener: Chat.OnChatReconnectedListener;\n  public onMessageListener: Chat.OnMessageListener;\n  public onSystemMessageListener: Chat.OnMessageSystemListener;\n  public onMessageErrorListener: Chat.OnMessageErrorListener;\n  public onMessageTypingListener: Chat.OnMessageTypingListener;\n  public onMessageUpdateListener: Chat.OnMessageUpdateListener;\n  public onMessageDeleteListener: Chat.OnMessageDeleteListener;\n  public onMessageReactionsListener: Chat.OnMessageReactionsListener;\n  public onSentMessageCallback: Chat.OnMessageSentListener;\n  public onDeliveredStatusListener: Chat.OnMessageDeliveredListener;\n  public onReadStatusListener: Chat.OnMessageReadListener;\n  public onLastUserActivityListener: Chat.OnLastUserActivityListener;\n  public onSubscribeListener: Chat.OnRosterSubscribeListener;\n  public onConfirmSubscribeListener: Chat.OnRosterConfirmListener;\n  public onRejectSubscribeListener: Chat.OnRosterRejectListener;\n  public onContactListListener: Chat.OnRosterListListener;\n  public onJoinOccupant: Chat.OnDialogJoinListener;\n  public onLeaveOccupant: Chat.OnDialogLeaveListener;\n  public onKickOccupant: Chat.OnDialogKickListener;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n    this.dialog = new DialogsService(proxy);\n    this.message = new MessagesService(proxy);\n    this.helpers = new ChatHelpers();\n\n    this.xmppClient = xmppClient({\n      service: config.chatProtocol.websocket,\n      credentials: (auth, _mechanism) =>\n        auth({\n          username: this.xmppClient.options.username || '',\n          password: this.xmppClient.options.password || '',\n        }),\n    });\n\n    if (config.chat.reconnect.enable) {\n      this.xmppClient.reconnect.delay = config.chat.reconnect.timeInterval * 1000;\n    }\n\n    const options = {\n      xmppClient: this.xmppClient,\n      helpers: this.helpers,\n      stanzasCallbacks: this.stanzasCallbacks,\n    };\n\n    this.contactlist = new ContactList(options);\n    this.privacylist = new PrivacyList(options);\n    this.muc = new MultiUserChat(options);\n\n    if (this.isStreamManagementSupported) {\n      this.streamManagement = new StreamManagement();\n    }\n  }\n\n  get connectionStatus() {\n    return this.xmppClient.status;\n  }\n\n  public async connect(params: Chat.ConnectionParams): Promise<boolean> {\n    this.connectPromise = new Promise((resolve, reject) => {\n      Utils.DLog('[Chat]', 'Connect with parameter:', params);\n\n      if (this.isConnecting) {\n        Utils.DLog('[Chat]', 'Warning! Already in CONNECTING state');\n        resolve(false);\n        return;\n      }\n\n      if (this.isConnected) {\n        Utils.DLog('[Chat]', 'Warning! Chat is already connected!');\n        resolve(false);\n        return;\n      }\n\n      this.isConnecting = true;\n      this.isLogout = false;\n\n      this.removeAllXMPPClientListeners();\n\n      this.addXMPPClientListener('connect', () => {\n        Utils.DLog('[Chat]', this.isReconnect ? 'RECONNECTING' : 'CONNECTING');\n      });\n\n      this.addXMPPClientListener('online', () => {\n        Utils.DLog('[Chat]', 'ONLINE');\n        this.startPingTimer();\n        this.postConnectActions();\n        resolve(true);\n        this.connectPromise = null;\n      });\n\n      this.addXMPPClientListener('offline', () => {\n        Utils.DLog('[Chat]', 'OFFLINE');\n      });\n\n      this.addXMPPClientListener('disconnect', () => {\n        Utils.DLog('[Chat]', 'DISCONNECTED');\n\n        Utils.safeCallbackCall(this.onDisconnectedListener)();\n\n        if (config.chat.reconnect.enable) {\n          this.isConnected = false;\n          this.isConnecting = false;\n        } else {\n          this.disconnect();\n        }\n\n        this.stopPingTimer();\n      });\n\n      this.addXMPPClientListener('status', (status: Chat.ConnectionStatus, value: any) => {\n        Utils.DLog('[Chat]', `status - ${status}`, typeof value === 'object' ? JSON.stringify(value) : '');\n        Utils.safeCallbackCall(this.onChatStatusListener)(status);\n      });\n\n      this.addXMPPClientListener('stanza', (stanza: Chat.XmlElement) => {\n        // it can be a case,\n        // when message came after xmpp auth but before resource bindging,\n        // and it can cause some crashes, e.g.\n        // https://github.com/ConnectyCube/connectycube-js-sdk-releases/issues/28\n        if (stanza.is('message') && !this.isConnected) {\n          this.earlyIncomingMessagesQueue.push(stanza);\n          Utils.DLog('[Chat]', \"on 'stanza': enqueue incoming stanza (isConnected=false)\");\n          return;\n        }\n\n        // after 'input' and 'element' (only if stanza, not nonza)\n        if (stanza.is('presence')) {\n          this.onPresence(stanza);\n        } else if (stanza.is('iq')) {\n          this.onIQ(stanza);\n        } else if (stanza.is('message')) {\n          if (stanza.attrs.type === 'headline') {\n            this.onSystemMessage(stanza);\n          } else if (stanza.attrs.type === 'error') {\n            this.onMessageError(stanza);\n          } else {\n            this.onMessage(stanza);\n          }\n        }\n      });\n\n      this.addXMPPClientListener('error', (err) => {\n        Utils.DLog('[Chat]', 'ERROR:', err, {\n          isReconnect: this.isReconnect,\n          connectPromise: !!this.connectPromise,\n        });\n\n        if (this.connectPromise) {\n          if (!this.isReconnect) {\n            if (err.name == 'SASLError') {\n              err = err.condition;\n            }\n            reject(err);\n            this.connectPromise = null;\n          }\n        } else {\n          Utils.safeCallbackCall(this.onConnectionErrorListener)();\n        }\n      });\n\n      this.addXMPPClientListener('output', (str) => {\n        Utils.callTrafficUsageCallback('xmppDataWrite', { body: str });\n        Utils.DLog('[Chat]', 'SENT:', str);\n      });\n\n      this.addXMPPClientListener('input', (str) => {\n        Utils.callTrafficUsageCallback('xmppDataRead', { body: str });\n        Utils.DLog('[Chat]', 'RECV:', str);\n      });\n\n      // save user connection data so they will be used when authenticate (above)\n      this.xmppClient.options.username = ChatUtils.buildUserJidLocalPart(params.userId);\n      this.xmppClient.options.password = params.password;\n      // start connect\n      this.xmppClient.start().catch((err) => {\n        console.error('[Chat] xmppClient.start error', err);\n        if (this.connectPromise) {\n          reject(err);\n          this.connectPromise = null;\n        } else {\n          Utils.safeCallbackCall(this.onConnectionErrorListener)();\n        }\n      });\n    });\n\n    return this.connectPromise;\n  }\n\n  /**\n   * @deprecated Use `Chat ContactList` will be removed in the next major release.\n   */\n  public async getContacts(): Promise<Chat.ContactList> {\n    console.warn(\n      '[Deprecated][Chat][ContactList][[XMPP][Roster]]',\n      'ConnectyCube.chat.getContacts() and the ConnectyCube.chat.contactlist class will be removed in the next major release.'\n    );\n    try {\n      const contacts = await this.contactlist.get();\n      this.contactlist.contacts = contacts;\n      return contacts;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  public async ping(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const id = ChatUtils.getUniqueId('ping');\n      const iqStanza = ChatUtils.createIqStanza({ id, type: 'get', to: config.endpoints.chat });\n\n      iqStanza.c('ping', { xmlns: 'urn:xmpp:ping' });\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement) => {\n        const error = ChatUtils.getElement(stanza, 'error');\n        if (error) {\n          reject(ChatUtils.buildErrorFromXMPPErrorStanza(error));\n        } else {\n          resolve();\n        }\n      };\n\n      this.xmppClient.send(iqStanza);\n    });\n  }\n\n  public async pingWithTimeout(timeout: number = 5000): Promise<unknown> {\n    return Promise.race([\n      this.ping(),\n      new Promise((_, reject) => setTimeout(() => reject(new Error('Chat ping() timed out')), timeout)),\n    ]);\n  }\n\n  private startPingTimer(): void {\n    this.stopPingTimer();\n\n    if (config.chat.ping.enable) {\n      // Min time interval between pings is 30 seconds.\n      const validTime = config.chat.ping.timeInterval < 30 ? 30 : config.chat.ping.timeInterval;\n\n      this.pingTimer = setInterval(() => {\n        this.ping();\n      }, validTime * 1000);\n    }\n  }\n\n  private stopPingTimer(): void {\n    if (this.pingTimer) {\n      clearInterval(this.pingTimer);\n      this.pingTimer = null;\n    }\n  }\n\n  public send(jidOrUserId: string | number, message: Chat.MessageParams = {}): string {\n    const messageId = message.id ?? Utils.getBsonObjectId();\n    const messageStanza = ChatUtils.createMessageStanza({\n      from: this.helpers.userCurrentJid,\n      to: this.helpers.jidOrUserId(jidOrUserId),\n      type: message.type ?? this.helpers.typeChat(jidOrUserId),\n      id: messageId,\n    });\n\n    if (!message.id) {\n      message.id = messageId;\n    }\n\n    if (message.body) {\n      messageStanza.c('body').t(message.body).up();\n    }\n\n    if (message.markable) {\n      messageStanza.c('markable', { xmlns: 'urn:xmpp:chat-markers:0' }).up();\n    }\n\n    if (message.extension) {\n      messageStanza.c('extraParams', { xmlns: 'jabber:client' });\n      ChatUtils.assignExtraParamsToXml(messageStanza, message.extension);\n    }\n\n    if (this.isStreamManagementSupported) {\n      this.xmppClient.send(messageStanza, message);\n    } else {\n      this.xmppClient.send(messageStanza);\n    }\n\n    return messageId;\n  }\n\n  public sendSystemMessage(jidOrUserId: string | number, message: Chat.SystemMessageParams): string {\n    const messageId = message.id ?? Utils.getBsonObjectId();\n    const messageStanza = ChatUtils.createMessageStanza({\n      type: 'headline',\n      id: messageId,\n      to: this.helpers.jidOrUserId(jidOrUserId),\n    });\n\n    if (message.body) {\n      messageStanza.c('body').t(message.body).up();\n    }\n\n    if (message.extension) {\n      messageStanza.c('extraParams', { xmlns: 'jabber:client' }).c('moduleIdentifier').t('SystemNotifications').up();\n      ChatUtils.assignExtraParamsToXml(messageStanza, message.extension);\n    }\n\n    this.xmppClient.send(messageStanza);\n\n    return messageId;\n  }\n\n  public sendIsTypingStatus(jidOrUserId: string | number): void {\n    const messageStanza = ChatUtils.createMessageStanza({\n      from: this.helpers.userCurrentJid,\n      to: this.helpers.jidOrUserId(jidOrUserId),\n      type: this.helpers.typeChat(jidOrUserId),\n    });\n\n    messageStanza.c('composing', { xmlns: 'http://jabber.org/protocol/chatstates' });\n\n    this.xmppClient.send(messageStanza);\n  }\n\n  public sendIsStopTypingStatus(jidOrUserId: string | number): void {\n    const messageStanza = ChatUtils.createMessageStanza({\n      from: this.helpers.userCurrentJid,\n      to: this.helpers.jidOrUserId(jidOrUserId),\n      type: this.helpers.typeChat(jidOrUserId),\n    });\n\n    messageStanza.c('paused', { xmlns: 'http://jabber.org/protocol/chatstates' });\n\n    this.xmppClient.send(messageStanza);\n  }\n\n  public sendDeliveredStatus(params: Chat.MessageStatusParams): void {\n    const messageStanza = ChatUtils.createMessageStanza({\n      type: 'chat',\n      from: this.helpers.userCurrentJid,\n      id: Utils.getBsonObjectId(),\n      to: this.helpers.jidOrUserId(params.userId),\n    });\n\n    messageStanza.c('received', { xmlns: 'urn:xmpp:chat-markers:0', id: params.messageId }).up();\n    messageStanza.c('extraParams', { xmlns: 'jabber:client' }).c('dialog_id').t(params.dialogId);\n\n    this.xmppClient.send(messageStanza);\n  }\n\n  public sendReadStatus(params: Chat.MessageStatusParams): void {\n    const messageStanza = ChatUtils.createMessageStanza({\n      type: 'chat',\n      from: this.helpers.userCurrentJid,\n      to: this.helpers.jidOrUserId(params.userId),\n      id: Utils.getBsonObjectId(),\n    });\n\n    messageStanza.c('displayed', { xmlns: 'urn:xmpp:chat-markers:0', id: params.messageId }).up();\n    messageStanza.c('extraParams', { xmlns: 'jabber:client' }).c('dialog_id').t(params.dialogId);\n\n    this.xmppClient.send(messageStanza);\n  }\n\n  public editMessage(params: Chat.EditMessageParams): void {\n    const messageStanza = ChatUtils.createMessageStanza({\n      from: this.helpers.userCurrentJid,\n      to: this.helpers.jidOrUserId(params.to),\n      type: this.helpers.typeChat(params.to),\n      id: Utils.getBsonObjectId(),\n    });\n\n    messageStanza.c('body').t(params.body).up();\n    messageStanza\n      .c('replace', {\n        xmlns: 'urn:xmpp:message-correct:0',\n        id: params.originMessageId,\n        last: params.last ? 'true' : 'false',\n      })\n      .up();\n    messageStanza.c('extraParams', { xmlns: 'jabber:client' }).c('dialog_id').t(params.dialogId);\n\n    if (params.extension) {\n      ChatUtils.assignExtraParamsToXml(messageStanza, params.extension);\n    }\n\n    this.xmppClient.send(messageStanza);\n  }\n\n  public deleteMessage(params: Chat.DeleteMessageParams): void {\n    const messageStanza = ChatUtils.createMessageStanza({\n      from: this.helpers.userCurrentJid,\n      to: this.helpers.jidOrUserId(params.to),\n      type: this.helpers.typeChat(params.to),\n      id: Utils.getBsonObjectId(),\n    });\n\n    messageStanza.c('remove', { xmlns: 'urn:xmpp:message-delete:0', id: params.messageId }).up();\n    messageStanza.c('extraParams', { xmlns: 'jabber:client' }).c('dialog_id').t(params.dialogId);\n\n    this.xmppClient.send(messageStanza);\n  }\n\n  public getLastUserActivity(jidOrUserId: string | number): Promise<Chat.LastActivity> {\n    return new Promise((resolve, reject) => {\n      const id = ChatUtils.getUniqueId('lastActivity');\n      const iqStanza = ChatUtils.createIqStanza({\n        type: 'get',\n        from: this.helpers.userCurrentJid,\n        to: this.helpers.jidOrUserId(jidOrUserId),\n        id: id,\n      });\n\n      iqStanza.c('query', { xmlns: 'jabber:iq:last' });\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement) => {\n        if (ChatUtils.getElement(stanza, 'error')) {\n          reject(ChatUtils.buildErrorFromXMPPErrorStanza(stanza));\n        } else {\n          resolve(this.onLastActivityStanza(stanza));\n        }\n      };\n\n      this.xmppClient.send(iqStanza);\n    });\n  }\n\n  private onLastActivityStanza(stanza: Chat.XmlElement): Chat.LastActivity {\n    const from = ChatUtils.getAttr(stanza, 'from');\n    const userId = this.helpers.getUserIdFromJID(from);\n    const query = ChatUtils.getElement(stanza, 'query');\n    const seconds = query ? parseInt(ChatUtils.getAttr(query, 'seconds')) : 0;\n\n    Utils.safeCallbackCall(this.onLastUserActivityListener)(userId, seconds);\n\n    return { userId, seconds };\n  }\n\n  public markActive(): void {\n    const iqStanza = ChatUtils.createIqStanza({\n      id: this.helpers.getUniqueId('markActive'),\n      type: 'set',\n    });\n\n    iqStanza.c('mobile', {\n      xmlns: 'http://tigase.org/protocol/mobile#v2',\n      enable: 'false',\n    });\n\n    this.xmppClient.send(iqStanza);\n  }\n\n  public markInactive(): void {\n    const iqStanza = ChatUtils.createIqStanza({\n      id: this.helpers.getUniqueId('markActive'),\n      type: 'set',\n    });\n\n    iqStanza.c('mobile', {\n      xmlns: 'http://tigase.org/protocol/mobile#v2',\n      enable: 'true',\n    });\n\n    this.xmppClient.send(iqStanza);\n  }\n\n  public async disconnect(): Promise<boolean> {\n    Utils.DLog('[Chat]', 'disconnect');\n\n    if (this.isLogout) {\n      Utils.DLog('[Chat]', 'Warning! Chat is already disconnected!');\n      return true;\n    }\n\n    this.muc.joinedRooms = {};\n    this.isConnected = false;\n    this.isConnecting = false;\n    this.isLogout = true;\n    this.isReconnect = false;\n    this.helpers.userCurrentJid = '';\n\n    if (this.isStreamManagementSupported) {\n      this.streamManagement.removeElementHandler();\n    }\n\n    try {\n      await this.xmppClient.stop();\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  public async search(params: Chat.SearchParams): Promise<Chat.SearchResult> {\n    const query = Object.assign({}, params);\n\n    if (query.start_date) {\n      query.start_date = new Date(query.start_date).toISOString();\n    }\n    if (query.end_date) {\n      query.end_date = new Date(query.end_date).toISOString();\n    }\n    if (Utils.isArray(query.chat_dialog_ids)) {\n      query.chat_dialog_ids = (query.chat_dialog_ids as string[]).join(',');\n    }\n\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(`${config.urls.chat}/search`),\n      data: query,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  private onMessage(rawStanza: Chat.XmlElement): void {\n    const forwardedStanza = ChatUtils.getElementTreePath(rawStanza, ['sent', 'forwarded', 'message']);\n    const stanza = forwardedStanza || rawStanza;\n    const from = ChatUtils.getAttr(stanza, 'from');\n    const type = ChatUtils.getAttr(stanza, 'type');\n    const invite = ChatUtils.getElement(stanza, 'invite');\n    const resource = this.xmppClient.jid?.getResource() || '';\n    const isChat = type === 'chat';\n\n    // ignore private message from the same resource or invite messages from MUC\n    if ((isChat && from.includes(resource)) || invite) {\n      return;\n    }\n\n    const messageId = ChatUtils.getAttr(stanza, 'id');\n    const markable = ChatUtils.getElement(stanza, 'markable');\n    const delivered = ChatUtils.getElement(stanza, 'received');\n    const read = ChatUtils.getElement(stanza, 'displayed');\n    const replaceSubElement = ChatUtils.getElement(stanza, 'replace');\n    const reactionsSubElement = ChatUtils.getElement(stanza, 'reactions');\n    const removeSubElement = ChatUtils.getElement(stanza, 'remove');\n    const composing = Boolean(ChatUtils.getElement(stanza, 'composing'));\n    const paused = ChatUtils.getElement(stanza, 'paused');\n    const delay = ChatUtils.getElement(stanza, 'delay');\n    const extraParams = ChatUtils.getElement(stanza, 'extraParams');\n    const body = ChatUtils.getElementText(stanza, 'body');\n    const isForwarded = Boolean(forwardedStanza);\n    const isGroup = type === 'groupchat';\n    const recipient = isChat ? ChatUtils.getAttr(stanza, 'to') : null;\n    const recipientId = recipient ? this.helpers.getUserIdFromJID(recipient) : null;\n    const ext = extraParams ? ChatUtils.parseExtraParams(extraParams) : null;\n    const extension = ext ? ext.extension : null;\n    const dialogId = isGroup ? this.helpers.getDialogIdFromJID(from) : (ext?.dialogId ?? null);\n    const userId = isGroup ? this.helpers.getIdFromResource(from) : this.helpers.getUserIdFromJID(from);\n    const currentUserJid = this.xmppClient.jid?.toString();\n    const currentUserId = currentUserJid ? this.helpers.getUserIdFromJID(currentUserJid) : 0;\n\n    // typing statuses\n    if (composing || paused) {\n      if (isChat || isGroup || !delay) {\n        Utils.safeCallbackCall(this.onMessageTypingListener)(composing, userId, dialogId);\n      }\n\n      return;\n    }\n\n    // edit message\n    if (replaceSubElement) {\n      Utils.safeCallbackCall(this.onMessageUpdateListener)(\n        ChatUtils.getAttr(replaceSubElement, 'id'),\n        ChatUtils.getAttr(replaceSubElement, 'last') === 'true',\n        body,\n        dialogId,\n        userId,\n        extension\n      );\n\n      return;\n    }\n\n    // reactions\n    if (reactionsSubElement) {\n      if (isForwarded && isGroup) {\n        return;\n      }\n\n      const messageId = ChatUtils.getAttr(reactionsSubElement, 'message_id');\n      const userId = parseInt(ChatUtils.getAttr(reactionsSubElement, 'user_id'));\n      const { add, remove } = ChatUtils.parseReactions(reactionsSubElement);\n\n      Utils.safeCallbackCall(this.onMessageReactionsListener)(messageId, userId, dialogId, add, remove);\n\n      return;\n    }\n\n    // delete message\n    if (removeSubElement) {\n      const messageId = ChatUtils.getAttr(removeSubElement, 'id');\n\n      Utils.safeCallbackCall(this.onMessageDeleteListener)(messageId, dialogId, userId);\n\n      return;\n    }\n\n    // delivered / read statuses\n    if (delivered || read) {\n      if (delivered && isChat) {\n        const id = ChatUtils.getAttr(delivered, 'id');\n        Utils.safeCallbackCall(this.onDeliveredStatusListener)(id, dialogId, userId);\n      }\n      if (read && isChat) {\n        const id = ChatUtils.getAttr(read, 'id');\n        Utils.safeCallbackCall(this.onReadStatusListener)(id, dialogId, userId);\n      }\n\n      return;\n    }\n\n    // auto-send 'received' status (ignore messages from yourself)\n    if (markable && dialogId && userId && userId !== currentUserId) {\n      this.sendDeliveredStatus({ messageId, dialogId, userId });\n    }\n\n    const message: Chat.Message = {\n      id: messageId,\n      dialog_id: dialogId,\n      recipient_id: recipientId,\n      is_forwarded: isForwarded,\n      type,\n      body,\n      extension,\n      delay,\n    };\n\n    if (markable) {\n      message.markable = 1;\n    }\n\n    if (isChat || isGroup) {\n      Utils.safeCallbackCall(this.onMessageListener)(userId, message);\n    }\n  }\n\n  private onPresence(stanza: Chat.XmlElement): void {\n    const from = ChatUtils.getAttr(stanza, 'from');\n    const id = ChatUtils.getAttr(stanza, 'id');\n    const type = ChatUtils.getAttr(stanza, 'type');\n    const currentUserJid = this.xmppClient.jid?.toString();\n    const currentUserId = this.helpers.getUserIdFromJID(currentUserJid);\n    const x = ChatUtils.getElement(stanza, 'x');\n    const xmlns = x ? ChatUtils.getAttr(x, 'xmlns') : null;\n    const status = x ? ChatUtils.getElement(x, 'xmlns') : null;\n    // const statusCode = status ? ChatUtils.getElement(status, 'code') : null;\n    const statusCode = status ? ChatUtils.getElementText(status, 'code') : null;\n\n    // MUC presences\n    if (xmlns && xmlns.startsWith('http://jabber.org/protocol/muc')) {\n      // Error\n      if (type === 'error') {\n        // JOIN to dialog error\n        if (id.endsWith(':join')) {\n          Utils.safeCallbackCall(this.stanzasCallbacks[id])(stanza);\n        }\n        return;\n      }\n\n      const dialogId = this.helpers.getDialogIdFromJID(from);\n      const mucUserId = this.helpers.getUserIdFromRoomJid(from);\n\n      // self presence\n      if (status) {\n        // KICK from dialog event\n        if (statusCode === '301') {\n          const item = ChatUtils.getElement(stanza, 'item');\n          const actorElement = item ? ChatUtils.getElement(item, 'actor') : null;\n          const initiatorUserJid = actorElement ? ChatUtils.getAttr(actorElement, 'jid') : null;\n          const initiatorId = this.helpers.getUserIdFromJID(initiatorUserJid);\n          const roomJid = this.helpers.getRoomJidFromRoomFullJid(from);\n\n          Utils.safeCallbackCall(this.onKickOccupant)(dialogId, initiatorId);\n\n          if (roomJid) {\n            delete this.muc.joinedRooms[roomJid];\n          }\n\n          return;\n        } else {\n          if (type === 'unavailable') {\n            // LEAVE response\n            if (status && statusCode === '110') {\n              Utils.safeCallbackCall(this.stanzasCallbacks['muc:leave'])(null);\n            }\n            return;\n          }\n          // JOIN response\n          if (id.endsWith(':join') && status && statusCode === '110') {\n            this.stanzasCallbacks[id]?.(stanza);\n            return;\n          }\n        }\n        // Occupants JOIN/LEAVE events\n      } else if (mucUserId != currentUserId) {\n        const listenerName = type === 'unavailable' ? 'onLeaveOccupant' : 'onJoinOccupant';\n\n        Utils.safeCallbackCall(this[listenerName])(dialogId, mucUserId);\n\n        return;\n      }\n    }\n\n    // ROSTER presences\n    const userId = this.helpers.getUserIdFromJID(from) ?? 0;\n    const contact = this.contactlist.contacts[userId] ?? { ask: null, subscription: null };\n\n    switch (type) {\n      case 'subscribe':\n        if (contact?.subscription === 'to') {\n          contact.ask = null;\n          contact.subscription = 'both';\n\n          this.contactlist.sendSubscriptionPresence({\n            jid: from,\n            type: 'subscribed',\n          });\n        } else {\n          Utils.safeCallbackCall(this.onSubscribeListener)(userId);\n        }\n        break;\n      case 'subscribed':\n        if (contact?.subscription === 'from') {\n          contact.ask = null;\n          contact.subscription = 'both';\n        } else {\n          contact.ask = null;\n          contact.subscription = 'to';\n\n          Utils.safeCallbackCall(this.onConfirmSubscribeListener)(userId);\n        }\n        break;\n      case 'unsubscribed':\n        contact.ask = null;\n        contact.subscription = 'none';\n\n        Utils.safeCallbackCall(this.onRejectSubscribeListener)(userId);\n\n        break;\n      case 'unsubscribe':\n        contact.ask = null;\n        contact.subscription = 'to';\n        break;\n      case 'unavailable':\n        if (contact?.subscription !== 'none') {\n          Utils.safeCallbackCall(this.onContactListListener)(userId, 'unavailable');\n        }\n        // send initial presence if one of client (instance) goes offline\n        if (userId === currentUserId) {\n          this.xmppClient.send(ChatUtils.createPresenceStanza());\n        }\n        break;\n      case 'available':\n      default:\n        if (contact?.subscription !== 'none') {\n          Utils.safeCallbackCall(this.onContactListListener)(userId, 'available');\n        }\n\n        break;\n    }\n  }\n\n  private onIQ(stanza: Chat.XmlElement): void {\n    const stanzaId = ChatUtils.getAttr(stanza, 'id');\n\n    if (this.stanzasCallbacks[stanzaId]) {\n      Utils.safeCallbackCall(this.stanzasCallbacks[stanzaId])(stanza);\n      delete this.stanzasCallbacks[stanzaId];\n    } else {\n      const from = ChatUtils.getAttr(stanza, 'from');\n      const query = ChatUtils.getElement(stanza, 'query');\n      if (from && query) {\n        this.onLastActivityStanza(stanza);\n      }\n    }\n  }\n\n  private onSystemMessage(rawStanza: Chat.XmlElement): void {\n    const forwardedStanza = ChatUtils.getElementTreePath(rawStanza, ['sent', 'forwarded', 'message']);\n    const stanza = forwardedStanza || rawStanza;\n    const from = ChatUtils.getAttr(stanza, 'from');\n    const messageId = ChatUtils.getAttr(stanza, 'id');\n    const extraParams = ChatUtils.getElement(stanza, 'extraParams');\n    const userId = this.helpers.getUserIdFromJID(from);\n    const delay = ChatUtils.getElement(stanza, 'delay');\n    const moduleIdentifier = extraParams ? ChatUtils.getElementText(extraParams, 'moduleIdentifier') : null;\n    const body = ChatUtils.getElementText(stanza, 'body');\n    const ext = extraParams ? ChatUtils.parseExtraParams(extraParams) : null;\n    const extension = ext ? ext.extension : null;\n\n    switch (moduleIdentifier) {\n      case 'SystemNotifications':\n        Utils.safeCallbackCall(this.onSystemMessageListener)({ id: messageId, userId, body, extension });\n        break;\n      case 'WebRTCVideoChat':\n        if (this.webrtcSignalingProcessor && !delay) {\n          Utils.safeCallbackCall(this.webrtcSignalingProcessor.onMessage)(userId, extraParams);\n        }\n        break;\n      default:\n        break;\n    }\n  }\n\n  private onMessageError(stanza: Chat.XmlElement): void {\n    // <error code=\"503\" type=\"cancel\">\n    //   <service-unavailable xmlns=\"urn:ietf:params:xml:ns:xmpp-stanzas\"/>\n    //   <text xmlns=\"urn:ietf:params:xml:ns:xmpp-stanzas\" xml:lang=\"en\">Service not available.</text>\n    // </error>\n    const messageId = ChatUtils.getAttr(stanza, 'id');\n    const error = ChatUtils.buildErrorFromXMPPErrorStanza(stanza);\n\n    Utils.safeCallbackCall(this.onMessageErrorListener)(messageId, error);\n  }\n\n  private postConnectActions(): void {\n    Utils.DLog('[Chat]', this.isReconnect ? 'RECONNECTED' : 'CONNECTED');\n\n    const presence = ChatUtils.createPresenceStanza();\n\n    if (this.isStreamManagementSupported) {\n      this.streamManagement.enable(this.xmppClient);\n      this.streamManagement.sentMessageCallback = (messageLost, messageSent) => {\n        Utils.safeCallbackCall(this.onSentMessageCallback)(messageSent ? null : messageLost, messageSent);\n      };\n    }\n\n    this.helpers.userCurrentJid = this.xmppClient.jid?.toString() ?? null;\n    this.isConnected = true;\n    this.isConnecting = false;\n    this.enableCarbons();\n    this.xmppClient.send(presence); // initial presence\n\n    if (this.isReconnect) {\n      // reconnect\n      Utils.safeCallbackCall(this.onReconnectListener)();\n    } else {\n      this.isReconnect = true;\n    }\n\n    if (this.earlyIncomingMessagesQueue.length > 0) {\n      Utils.DLog('[Chat]', `Flush 'earlyIncomingMessagesQueue' (length=${this.earlyIncomingMessagesQueue.length})`);\n\n      const stanzasCallback = this.xmppClientListeners.get('stanza');\n\n      this.earlyIncomingMessagesQueue.forEach((stanza) => {\n        stanzasCallback?.(stanza);\n      });\n      this.earlyIncomingMessagesQueue = [];\n    }\n  }\n\n  private enableCarbons(): void {\n    const iqStanza = ChatUtils.createIqStanza({\n      type: 'set',\n      from: this.helpers.userCurrentJid,\n      id: ChatUtils.getUniqueId('enableCarbons'),\n    });\n\n    iqStanza.c('enable', { xmlns: 'urn:xmpp:carbons:2' });\n\n    this.xmppClient.send(iqStanza);\n  }\n\n  private setSubscriptionToUserLastActivity(jidOrUserId: string | number, enable: boolean): void {\n    const iqStanza = ChatUtils.createIqStanza({\n      id: this.helpers.getUniqueId('statusStreaming'),\n      type: 'set',\n    });\n\n    iqStanza.c('subscribe', {\n      xmlns: 'https://connectycube.com/protocol/status_streaming',\n      user_jid: this.helpers.jidOrUserId(jidOrUserId),\n      enable,\n    });\n\n    this.xmppClient.send(iqStanza);\n  }\n\n  subscribeToUserLastActivityStatus(jidOrUserId: string | number) {\n    this.setSubscriptionToUserLastActivity(jidOrUserId, true);\n  }\n\n  unsubscribeFromUserLastActivityStatus(jidOrUserId: string | number) {\n    this.setSubscriptionToUserLastActivity(jidOrUserId, false);\n  }\n\n  private get isStreamManagementSupported(): boolean {\n    const isEnabled = config.chat.streamManagement?.enable ? true : false;\n    const isWebsocket = config.chatProtocol.active === 2;\n\n    if (isEnabled && !isWebsocket) {\n      Utils.DLog('[Chat]', 'Stream Management is disabled for BOSH');\n    }\n\n    return isEnabled && isWebsocket;\n  }\n\n  private addXMPPClientListener(name: Chat.XMPPClientEvent, listener: Chat.XMPPClientListener): void {\n    this.xmppClient.on(name, listener);\n    this.xmppClientListeners.set(name, listener);\n  }\n\n  private removeXMPPClientListener(name: Chat.XMPPClientEvent): void {\n    const listener = this.xmppClientListeners.get(name);\n    if (listener) {\n      this.xmppClient.removeListener(name, listener);\n    }\n    this.xmppClientListeners.delete(name);\n  }\n\n  private removeAllXMPPClientListeners(): void {\n    this.xmppClientListeners.forEach((_, name) => this.removeXMPPClientListener(name));\n  }\n\n  private getListenerByName(name: ChatEvent): string | null {\n    switch (name) {\n      case ChatEvent.STATUS:\n        return 'onChatStatusListener';\n      case ChatEvent.ERROR:\n        return 'onConnectionErrorListener';\n      case ChatEvent.DISCONNECTED:\n        return 'onDisconnectedListener';\n      case ChatEvent.RECONNECTED:\n        return 'onReconnectListener';\n      case ChatEvent.MESSAGE:\n        return 'onMessageListener';\n      case ChatEvent.SYSTEM_MESSAGE:\n        return 'onSystemMessageListener';\n      case ChatEvent.ERROR_MESSAGE:\n        return 'onMessageErrorListener';\n      case ChatEvent.TYPING_MESSAGE:\n        return 'onMessageTypingListener';\n      case ChatEvent.UPDATE_MESSAGE:\n        return 'onMessageUpdateListener';\n      case ChatEvent.DELETE_MESSAGE:\n        return 'onMessageDeleteListener';\n      case ChatEvent.REACTIONS_MESSAGE:\n        return 'onMessageReactionsListener';\n      case ChatEvent.DELIVERED_MESSAGE:\n        return 'onDeliveredStatusListener';\n      case ChatEvent.READ_MESSAGE:\n        return 'onReadStatusListener';\n      case ChatEvent.SENT_MESSAGE:\n        return 'onSentMessageCallback';\n      case ChatEvent.USER_LAST_ACTIVITY:\n        return 'onLastUserActivityListener';\n      case ChatEvent.ROSTER_SUBSCRIBE:\n        return 'onSubscribeListener';\n      case ChatEvent.ROSTER_CONFIRM:\n        return 'onConfirmSubscribeListener';\n      case ChatEvent.ROSTER_REJECT:\n        return 'onRejectSubscribeListener';\n      case ChatEvent.ROSTER_LIST:\n        return 'onContactListListener';\n      case ChatEvent.JOIN:\n        return 'onJoinOccupant';\n      case ChatEvent.LEAVE:\n        return 'onLeaveOccupant';\n      case ChatEvent.KICK:\n        return 'onKickOccupant';\n      default:\n        return null;\n    }\n  }\n\n  public addListener(name: ChatEvent, listener: Chat.Listeners): () => void {\n    const listenerName = this.getListenerByName(name);\n    if (listenerName) {\n      this[listenerName] = listener;\n    }\n    return this.removeListener.bind(this, name);\n  }\n\n  public removeListener(name: ChatEvent): void {\n    const listenerName = this.getListenerByName(name);\n    if (listenerName) {\n      this[listenerName] = undefined;\n    }\n  }\n\n  public removeAllListeners(): void {\n    Object.keys(this).forEach((key) => {\n      if (key.startsWith('on') && key.endsWith('Listener') && typeof this[key] === 'function') {\n        this[key] = undefined;\n      }\n    });\n  }\n}\n","import ConferenceSession from '../videocalling_conference/ConferenceSession';\n\nexport enum CallType {\n  VIDEO = 'video',\n  AUDIO = 'audio',\n}\nexport enum DeviceInputType {\n  VIDEO = 'videoinput',\n  AUDIO = 'audioinput',\n}\nexport enum JanusEvent {\n  PARTICIPANT_JOINED = 'participant_joined',\n  PARTICIPANT_LEFT = 'participant_left',\n  LOCAL_STREAM = 'local_stream',\n  REMOTE_STREAM = 'remote_stream',\n  REMOTE_TRACKS_UPDATED = 'remote_tracks_updated',\n  DATA_CHANNEL_OPEN = 'data_channel_open',\n  DATA_CHANNEL_MESSAGE = 'data_channel_message',\n  ERROR = 'error',\n}\nexport enum JanusMediaTrackReason {\n  CREATED = 'created',\n  ENDED = 'ended',\n  MUTE = 'mute',\n  UNMUTE = 'unmute',\n}\nexport enum ConferenceEvent {\n  JOIN = 'join',\n  LEFT = 'left',\n  SLOW_LINK = 'slow-link',\n  REMOTE_TRACKS_UPDATED = 'remote-tracks',\n  REMOTE_STREAM = 'remote-stream',\n  REMOTE_CONNECTION_STATE = 'remote-connection-state',\n  DATA_CHANNEL_OPENED = 'data-channel-opened',\n  DATA_CHANNEL_MESSAGE = 'data-channel-message',\n  SESSION_CONNECTION_STATE = 'session-connection-state',\n  ERROR = 'error',\n}\n\nexport namespace ConnectyCubeJanus {\n  export interface SuccessErrorCallbacks {\n    success?: (...args: any[]) => void;\n    error?: (error: any) => void;\n  }\n  export interface InitCallbacks extends SuccessErrorCallbacks {\n    destroyed?: () => void;\n    timeoutSessionCallback?: () => void;\n  }\n  export interface PluginCallbacks extends SuccessErrorCallbacks {\n    localStream?: MediaStream;\n    displayName?: string;\n    iceState?: (iceState: any) => void;\n    slowLink?: (uplink: any, nacks: any) => void;\n    consentDialog?: (on: any) => void;\n    mediaState?: (medium: any, on: any) => void;\n    webrtcState?: (on: any) => void;\n    oncleanup?: () => void;\n  }\n  export interface RequestCallbacks extends SuccessErrorCallbacks {\n    displayName?: string;\n  }\n  // Listeners\n  export type OnParticipantJoinedListener = (\n    session: ConferenceSession,\n    userId: number,\n    userName: string,\n    isExist: boolean\n  ) => void;\n  export type OnParticipantLeftListener = (session: ConferenceSession, ...args: any[]) => void;\n  export type OnSlowLinkListener = (session: ConferenceSession, userId: number | null, uplink: any, nacks: any) => void;\n  export type OnRemoteStreamListener = (session: ConferenceSession, userId: number, stream: MediaStream) => void;\n  export type OnRemoteTracksUpdatedListener = (\n    session: ConferenceSession,\n    userId: number,\n    track: MediaStreamTrack,\n    eventType: any\n  ) => void;\n  export type OnRemoteConnectionStateChangedListener = (\n    session: ConferenceSession,\n    userId: number,\n    iceState: any\n  ) => void;\n  export type OnDataChannelOpenedListener = (session: ConferenceSession, label: any) => void;\n  export type OnDataChannelMessageListener = (session: ConferenceSession, label: any, data: any) => void;\n  export type OnSessionConnectionStateChangedListener = (session: ConferenceSession, iceState: any) => void;\n  export type OnErrorListener = (session: ConferenceSession, error: any) => void;\n  export type Listeners =\n    | OnParticipantJoinedListener\n    | OnParticipantLeftListener\n    | OnSlowLinkListener\n    | OnRemoteStreamListener\n    | OnRemoteTracksUpdatedListener\n    | OnRemoteConnectionStateChangedListener\n    | OnDataChannelOpenedListener\n    | OnDataChannelMessageListener\n    | OnSessionConnectionStateChangedListener\n    | OnErrorListener;\n}\n","const {\n  adapter,\n  navigator,\n  MediaStream,\n  MediaStreamTrack,\n  RTCPeerConnection,\n  RTCRtpReceiver,\n  RTCRtpSender,\n  isReactNative\n} = require('../platform');\n\n('use strict');\n/*\n  The MIT License (MIT)\n\n  Copyright (c) 2016 Meetecho\n\n  Permission is hereby granted, free of charge, to any person obtaining\n  a copy of this software and associated documentation files (the \"Software\"),\n  to deal in the Software without restriction, including without limitation\n  the rights to use, copy, modify, merge, publish, distribute, sublicense,\n  and/or sell copies of the Software, and to permit persons to whom the\n  Software is furnished to do so, subject to the following conditions:\n\n  The above copyright notice and this permission notice shall be included\n  in all copies or substantial portions of the Software.\n\n  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n  OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n  THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR\n  OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,\n  ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n  OTHER DEALINGS IN THE SOFTWARE.\n */\n\n// List of sessions\nJanus.sessions = {};\n\nJanus.mobile = isReactNative;\n\nJanus.isExtensionEnabled = function () {\n  if (Janus.mobile) {\n    return false;\n  }\n  if (navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia) {\n    // No need for the extension, getDisplayMedia is supported\n    return true;\n  }\n  if (window.navigator.userAgent.match('Chrome')) {\n    let chromever = parseInt(window.navigator.userAgent.match(/Chrome\\/(.*) /)[1], 10);\n    let maxver = 33;\n    if (window.navigator.userAgent.match('Linux')) maxver = 35; // \"known\" crash in chrome 34 and 35 on linux\n    if (chromever >= 26 && chromever <= maxver) {\n      // Older versions of Chrome don't support this extension-based approach, so lie\n      return true;\n    }\n    return Janus.extension.isInstalled();\n  } else {\n    // Firefox and others, no need for the extension (but this doesn't mean it will work)\n    return true;\n  }\n};\n\nconst defaultExtension = {\n  // Screensharing Chrome Extension ID\n  extensionId: 'hapfgfdkleiggjjpfpenajgdnfckjpaj',\n  isInstalled: function () {\n    if (Janus.mobile) {\n      return false;\n    } else {\n      return document.querySelector('#janus-extension-installed') !== null;\n    }\n  },\n  getScreen: function (callback) {\n    if (Janus.mobile) {\n      callback();\n    } else {\n      let pending = window.setTimeout(function () {\n        let error = new Error('NavigatorUserMediaError');\n        error.name =\n          'The required Chrome extension is not installed: click <a href=\"#\">here</a> to install it. (NOTE: this will need you to refresh the page)';\n        return callback(error);\n      }, 1000);\n      this.cache[pending] = callback;\n      window.postMessage({ type: 'janusGetScreen', id: pending }, '*');\n    }\n  },\n  init: function () {\n    let cache = {};\n    this.cache = cache;\n    // Wait for events from the Chrome Extension\n    if (!Janus.mobile) {\n      window.addEventListener('message', function (event) {\n        if (event.origin != window.location.origin) return;\n        if (event.data.type == 'janusGotScreen' && cache[event.data.id]) {\n          let callback = cache[event.data.id];\n          delete cache[event.data.id];\n          if (event.data.sourceId === '') {\n            // user canceled\n            let error = new Error('NavigatorUserMediaError');\n            error.name = 'You cancelled the request for permission, giving up...';\n            callback(error);\n          } else {\n            callback(null, event.data.sourceId);\n          }\n        } else if (event.data.type == 'janusGetScreenPending') {\n          window.clearTimeout(event.data.id);\n        }\n      });\n    }\n  },\n};\n\nJanus.useDefaultDependencies = function (deps) {\n  let f = (deps && deps.fetch) || fetch;\n  let p = (deps && deps.Promise) || Promise;\n  let socketCls = (deps && deps.WebSocket) || WebSocket;\n\n  return {\n    newWebSocket: function (server, proto) {\n      return new socketCls(server, proto);\n    },\n    extension: (deps && deps.extension) || defaultExtension,\n    isArray: function (arr) {\n      return Array.isArray(arr);\n    },\n    webRTCAdapter: (deps && deps.adapter) || adapter,\n    httpAPICall: function (url, options) {\n      let fetchOptions = {\n        method: options.verb,\n        headers: {\n          Accept: 'application/json, text/plain, */*',\n        },\n        cache: 'no-cache',\n      };\n      if (options.verb === 'POST') {\n        fetchOptions.headers['Content-Type'] = 'application/json';\n      }\n      if (typeof options.withCredentials !== 'undefined') {\n        fetchOptions.credentials =\n          options.withCredentials === true ? 'include' : options.withCredentials ? options.withCredentials : 'omit';\n      }\n      if (options.body) {\n        fetchOptions.body = JSON.stringify(options.body);\n      }\n\n      let fetching = f(url, fetchOptions).catch(function (error) {\n        return p.reject({\n          message: 'Probably a network error, is the server down?',\n          error: error,\n        });\n      });\n\n      /*\n       * fetch() does not natively support timeouts.\n       * Work around this by starting a timeout manually, and racing it agains the fetch() to see which thing resolves first.\n       */\n\n      if (options.timeout) {\n        let timeout = new p(function (resolve, reject) {\n          let timerId = setTimeout(function () {\n            clearTimeout(timerId);\n            return reject({\n              message: 'Request timed out',\n              timeout: options.timeout,\n            });\n          }, options.timeout);\n        });\n        fetching = p.race([fetching, timeout]);\n      }\n\n      fetching\n        .then(function (response) {\n          if (response.ok) {\n            if (typeof options.success === typeof Janus.noop) {\n              return response.json().then(\n                function (parsed) {\n                  try {\n                    options.success(parsed);\n                  } catch (error) {\n                    Janus.error('Unhandled httpAPICall success callback error', error);\n                  }\n                },\n                function (error) {\n                  return p.reject({\n                    message: 'Failed to parse response body',\n                    error: error,\n                    response: response,\n                  });\n                }\n              );\n            }\n          } else {\n            return p.reject({ message: 'API call failed', response: response });\n          }\n        })\n        .catch(function (error) {\n          if (typeof options.error === typeof Janus.noop) {\n            options.error(error.message || '<< internal error >>', error);\n          }\n        });\n\n      return fetching;\n    },\n  };\n};\n\nJanus.useOldDependencies = function (deps) {\n  let jq = (deps && deps.jQuery) || jQuery;\n  let socketCls = (deps && deps.WebSocket) || WebSocket;\n  return {\n    newWebSocket: function (server, proto) {\n      return new socketCls(server, proto);\n    },\n    isArray: function (arr) {\n      return jq.isArray(arr);\n    },\n    extension: (deps && deps.extension) || defaultExtension,\n    webRTCAdapter: (deps && deps.adapter) || adapter,\n    httpAPICall: function (url, options) {\n      let payload =\n        typeof options.body !== 'undefined'\n          ? {\n            contentType: 'application/json',\n            data: JSON.stringify(options.body),\n          }\n          : {};\n      let credentials =\n        typeof options.withCredentials !== 'undefined'\n          ? { xhrFields: { withCredentials: options.withCredentials } }\n          : {};\n\n      return jq.ajax(\n        jq.extend(payload, credentials, {\n          url: url,\n          type: options.verb,\n          cache: false,\n          dataType: 'json',\n          async: options.async,\n          timeout: options.timeout,\n          success: function (result) {\n            if (typeof options.success === typeof Janus.noop) {\n              options.success(result);\n            }\n          },\n          error: function (xhr, status, err) {\n            if (typeof options.error === typeof Janus.noop) {\n              options.error(status, err);\n            }\n          },\n        })\n      );\n    },\n  };\n};\n\n// Helper function to convert a deprecated media object to a tracks array\nJanus.mediaToTracks = function (media) {\n  let tracks = [];\n  if (!media) {\n    // Default is bidirectional audio and video, using default devices\n    tracks.push({ type: 'audio', capture: true, recv: true });\n    tracks.push({ type: 'video', capture: true, recv: true });\n  } else {\n    if (\n      !media.keepAudio &&\n      media.audio !== false &&\n      (typeof media.audio === 'undefined' ||\n        media.audio ||\n        media.audioSend ||\n        media.audioRecv ||\n        media.addAudio ||\n        media.replaceAudio ||\n        media.removeAudio)\n    ) {\n      // We may need an audio track\n      let track = { type: 'audio' };\n      if (media.removeAudio) {\n        track.remove = true;\n      } else {\n        if (media.addAudio) track.add = true;\n        else if (media.replaceAudio) track.replace = true;\n        // Check if we need to capture an audio device\n        if (media.audioSend !== false) track.capture = media.audio || true;\n        // Check if we need to receive audio\n        if (media.audioRecv !== false) track.recv = true;\n      }\n      // Add an audio track if needed\n      if (track.remove || track.capture || track.recv) tracks.push(track);\n    }\n    if (\n      !media.keepVideo &&\n      media.video !== false &&\n      (typeof media.video === 'undefined' ||\n        media.video ||\n        media.videoSend ||\n        media.videoRecv ||\n        media.addVideo ||\n        media.replaceVideo ||\n        media.removeVideo)\n    ) {\n      // We may need a video track\n      let track = { type: 'video' };\n      if (media.removeVideo) {\n        track.remove = true;\n      } else {\n        if (media.addVideo) track.add = true;\n        else if (media.replaceVideo) track.replace = true;\n        // Check if we need to capture a video device\n        if (media.videoSend !== false) {\n          track.capture = media.video || true;\n          if (['screen', 'window', 'desktop'].includes(track.capture)) {\n            // Change the type to 'screen'\n            track.type = 'screen';\n            track.capture = { video: {} };\n            // Check if there's constraints\n            if (media.screenshareFrameRate) track.capture.frameRate = media.screenshareFrameRate;\n            if (media.screenshareHeight) track.capture.height = media.screenshareHeight;\n            if (media.screenshareWidth) track.capture.width = media.screenshareWidth;\n          }\n        }\n        // Check if we need to receive video\n        if (media.videoRecv !== false) track.recv = true;\n      }\n      // Add a video track if needed\n      if (track.remove || track.capture || track.recv) tracks.push(track);\n    }\n    if (media.data) {\n      // We need a data channel\n      tracks.push({ type: 'data' });\n    }\n  }\n  // Done\n  return tracks;\n};\n\n// Helper function to convert a track object to a set of constraints\nJanus.trackConstraints = function (track) {\n  let constraints = {};\n  if (!track || !track.capture) return constraints;\n  if (track.type === 'audio') {\n    // Just put the capture part in the constraints\n    constraints.audio = track.capture;\n  } else if (track.type === 'video') {\n    // Check if one of the keywords was passed\n    if ((track.simulcast || track.svc) && track.capture === true) track.capture = 'hires';\n    if (track.capture === true || typeof track.capture === 'object') {\n      // Use the provided capture object as video constraint\n      constraints.video = track.capture;\n    } else {\n      let width = 0;\n      let height = 0;\n      if (track.capture === 'lowres') {\n        // Small resolution, 4:3\n        width = 320;\n        height = 240;\n      } else if (track.capture === 'lowres-16:9') {\n        // Small resolution, 16:9\n        width = 320;\n        height = 180;\n      } else if (track.capture === 'hires' || track.capture === 'hires-16:9' || track.capture === 'hdres') {\n        // High(HD) resolution is only 16:9\n        width = 1280;\n        height = 720;\n      } else if (track.capture === 'fhdres') {\n        // Full HD resolution is only 16:9\n        width = 1920;\n        height = 1080;\n      } else if (track.capture === '4kres') {\n        // 4K resolution is only 16:9\n        width = 3840;\n        height = 2160;\n      } else if (track.capture === 'stdres') {\n        // Normal resolution, 4:3\n        width = 640;\n        height = 480;\n      } else if (track.capture === 'stdres-16:9') {\n        // Normal resolution, 16:9\n        width = 640;\n        height = 360;\n      } else {\n        Janus.log('Default video setting is stdres 4:3');\n        width = 640;\n        height = 480;\n      }\n      constraints.video = {\n        width: { ideal: width },\n        height: { ideal: height },\n      };\n    }\n  } else if (track.type === 'screen') {\n    // Use the provided capture object as video constraint\n    constraints.video = track.capture;\n  }\n  return constraints;\n};\n\nJanus.noop = function () { };\n\nJanus.dataChanDefaultLabel = 'JanusDataChannel';\n\n// Note: in the future we may want to change this, e.g., as was\n// attempted in https://github.com/meetecho/janus-gateway/issues/1670\nJanus.endOfCandidates = null;\n\n// Stop all tracks from a given stream\nJanus.stopAllTracks = function (stream) {\n  try {\n    // Try a MediaStreamTrack.stop() for each track\n    let tracks = stream.getTracks();\n    for (let mst of tracks) {\n      Janus.log(mst);\n      if (mst && mst.dontStop !== true) {\n        mst.stop();\n      }\n    }\n  } catch (e) {\n    // Do nothing if this fails\n  }\n};\n\n// Initialization\nJanus.init = function (options) {\n  options = options || {};\n  options.callback = typeof options.callback == 'function' ? options.callback : Janus.noop;\n  if (Janus.initDone) {\n    // Already initialized\n    options.callback();\n  } else {\n    if (typeof console.log == 'undefined') {\n      console.log = function () { };\n    }\n    // Console logging (all debugging disabled by default)\n    Janus.trace = Janus.noop;\n    Janus.debug = Janus.noop;\n    Janus.vdebug = Janus.noop;\n    Janus.log = Janus.noop;\n    Janus.warn = Janus.noop;\n    Janus.error = Janus.noop;\n    if (options.debug === true || options.debug === 'all') {\n      // Enable all debugging levels\n      Janus.trace = console.trace.bind(console);\n      Janus.debug = console.debug.bind(console);\n      Janus.vdebug = console.debug.bind(console);\n      Janus.log = console.log.bind(console);\n      Janus.warn = console.warn.bind(console);\n      Janus.error = console.error.bind(console);\n    } else if (Array.isArray(options.debug)) {\n      for (let d of options.debug) {\n        switch (d) {\n          case 'trace':\n            Janus.trace = console.trace.bind(console);\n            break;\n          case 'debug':\n            Janus.debug = console.debug.bind(console);\n            break;\n          case 'vdebug':\n            Janus.vdebug = console.debug.bind(console);\n            break;\n          case 'log':\n            Janus.log = console.log.bind(console);\n            break;\n          case 'warn':\n            Janus.warn = console.warn.bind(console);\n            break;\n          case 'error':\n            Janus.error = console.error.bind(console);\n            break;\n          default:\n            console.error(\n              \"Unknown debugging option '\" + d + \"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')\"\n            );\n            break;\n        }\n      }\n    }\n    Janus.log('Initializing library');\n\n    let usedDependencies = options.dependencies || Janus.useDefaultDependencies();\n    Janus.isArray = usedDependencies.isArray;\n    Janus.webRTCAdapter = usedDependencies.webRTCAdapter;\n    Janus.httpAPICall = usedDependencies.httpAPICall;\n    Janus.newWebSocket = usedDependencies.newWebSocket;\n    Janus.extension = usedDependencies.extension;\n    Janus.extension.init();\n\n    // Helper method to enumerate devices\n    Janus.listDevices = function (callback, config) {\n      callback = typeof callback == 'function' ? callback : Janus.noop;\n      if (!config) config = { audio: true, video: true };\n      if (Janus.isGetUserMediaAvailable()) {\n        navigator.mediaDevices\n          .getUserMedia(config)\n          .then(function (stream) {\n            navigator.mediaDevices.enumerateDevices().then(function (devices) {\n              Janus.debug(devices);\n              callback(devices);\n              // Get rid of the now useless stream\n              Janus.stopAllTracks(stream);\n            });\n          })\n          .catch(function (err) {\n            Janus.error(err);\n            callback([]);\n          });\n      } else {\n        Janus.warn('navigator.mediaDevices unavailable');\n        callback([]);\n      }\n    };\n    // Helper methods to attach/reattach a stream to a video element (previously part of adapter.js)\n    // Janus.attachMediaStream = function(element, stream) {\n    // \ttry {\n    // \t\telement.srcObject = stream;\n    // \t} catch (e) {\n    // \t\ttry {\n    // \t\t\telement.src = URL.createObjectURL(stream);\n    // \t\t} catch (e) {\n    // \t\t\tJanus.error(\"Error attaching stream to element\", e);\n    // \t\t}\n    // \t}\n    // };\n    // Janus.reattachMediaStream = function(to, from) {\n    // \ttry {\n    // \t\tto.srcObject = from.srcObject;\n    // \t} catch (e) {\n    // \t\ttry {\n    // \t\t\tto.src = from.src;\n    // \t\t} catch (e) {\n    // \t\t\tJanus.error(\"Error reattaching stream to element\", e);\n    // \t\t}\n    // \t}\n    // };\n    // Detect tab close: make sure we don't loose existing onbeforeunload handlers\n    // (note: for iOS we need to subscribe to a different event, 'pagehide', see\n    // https://gist.github.com/thehunmonkgroup/6bee8941a49b86be31a787fe8f4b8cfe)\n    // let iOS = ['iPad', 'iPhone', 'iPod'].indexOf(navigator.platform) >= 0;\n    // let eventName = iOS ? 'pagehide' : 'beforeunload';\n    // let oldOBF = window[\"on\" + eventName];\n    // window.addEventListener(eventName, function() {\n    // \tJanus.log(\"Closing window\");\n    // \tfor(let s in Janus.sessions) {\n    // \t\tif(Janus.sessions[s] && Janus.sessions[s].destroyOnUnload) {\n    // \t\t\tJanus.log(\"Destroying session \" + s);\n    // \t\t\tJanus.sessions[s].destroy({unload: true, notifyDestroyed: false});\n    // \t\t}\n    // \t}\n    // \tif(oldOBF && typeof oldOBF == \"function\") {\n    // \t\toldOBF();\n    // \t}\n    // });\n    // If this is a Safari Technology Preview, check if VP8 is supported\n    Janus.safariVp8 = false;\n    if (Janus.webRTCAdapter.browserDetails.browser === 'safari' && Janus.webRTCAdapter.browserDetails.version >= 605) {\n      // Let's see if RTCRtpSender.getCapabilities() is there\n      if (\n        RTCRtpSender &&\n        RTCRtpSender.getCapabilities &&\n        RTCRtpSender.getCapabilities('video') &&\n        RTCRtpSender.getCapabilities('video').codecs &&\n        RTCRtpSender.getCapabilities('video').codecs.length\n      ) {\n        for (let codec of RTCRtpSender.getCapabilities('video').codecs) {\n          if (codec && codec.mimeType && codec.mimeType.toLowerCase() === 'video/vp8') {\n            Janus.safariVp8 = true;\n            break;\n          }\n        }\n        if (Janus.safariVp8) {\n          Janus.log('This version of Safari supports VP8');\n        } else {\n          Janus.warn(\n            \"This version of Safari does NOT support VP8: if you're using a Technology Preview, \" +\n            \"try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu\"\n          );\n        }\n      } else {\n        // We do it in a very ugly way, as there's no alternative...\n        // We create a PeerConnection to see if VP8 is in an offer\n        let testpc = new RTCPeerConnection({});\n        testpc.createOffer({ offerToReceiveVideo: true }).then(function (offer) {\n          Janus.safariVp8 = offer.sdp.indexOf('VP8') !== -1;\n          if (Janus.safariVp8) {\n            Janus.log('This version of Safari supports VP8');\n          } else {\n            Janus.warn(\n              \"This version of Safari does NOT support VP8: if you're using a Technology Preview, \" +\n              \"try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu\"\n            );\n          }\n          testpc.close();\n          testpc = null;\n        });\n      }\n    }\n    Janus.initDone = true;\n    options.callback();\n  }\n};\n\n// Helper method to check whether WebRTC is supported by this browser\nJanus.isWebrtcSupported = function () {\n  return !!RTCPeerConnection;\n};\n// Helper method to check whether devices can be accessed by this browser (e.g., not possible via plain HTTP)\nJanus.isGetUserMediaAvailable = function () {\n  return navigator.mediaDevices && navigator.mediaDevices.getUserMedia;\n};\n\n// Helper method to create random identifiers (e.g., transaction)\nJanus.randomString = function (len) {\n  let charSet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  let randomString = '';\n  for (let i = 0; i < len; i++) {\n    let randomPoz = Math.floor(Math.random() * charSet.length);\n    randomString += charSet.charAt(randomPoz);\n  }\n  return randomString;\n};\n\nfunction Janus(gatewayCallbacks) {\n  gatewayCallbacks = gatewayCallbacks || {};\n  gatewayCallbacks.success = typeof gatewayCallbacks.success == 'function' ? gatewayCallbacks.success : Janus.noop;\n  gatewayCallbacks.error = typeof gatewayCallbacks.error == 'function' ? gatewayCallbacks.error : Janus.noop;\n  gatewayCallbacks.destroyed =\n    typeof gatewayCallbacks.destroyed == 'function' ? gatewayCallbacks.destroyed : Janus.noop;\n  if (!Janus.initDone) {\n    gatewayCallbacks.error('Library not initialized');\n    return {};\n  }\n  if (!Janus.isWebrtcSupported()) {\n    gatewayCallbacks.error('WebRTC not supported by this browser');\n    return {};\n  }\n  Janus.log('Library initialized: ' + Janus.initDone);\n  if (!gatewayCallbacks.server) {\n    gatewayCallbacks.error('Invalid server url');\n    return {};\n  }\n  let websockets = false;\n  let ws = null;\n  let wsHandlers = {};\n  let wsKeepaliveTimeoutId = null;\n  let servers = null;\n  let serversIndex = 0;\n  let server = gatewayCallbacks.server;\n  if (Janus.isArray(server)) {\n    Janus.log('Multiple servers provided (' + server.length + '), will use the first that works');\n    server = null;\n    servers = gatewayCallbacks.server;\n    Janus.debug(servers);\n  } else {\n    if (server.indexOf('ws') === 0) {\n      websockets = true;\n      Janus.log('Using WebSockets to contact Janus: ' + server);\n    } else {\n      websockets = false;\n      Janus.log('Using REST API to contact Janus: ' + server);\n    }\n  }\n  let iceServers = gatewayCallbacks.iceServers || [{ urls: 'stun:stun.l.google.com:19302' }];\n  let iceTransportPolicy = gatewayCallbacks.iceTransportPolicy;\n  let bundlePolicy = gatewayCallbacks.bundlePolicy;\n  // Whether we should enable the withCredentials flag for XHR requests\n  let withCredentials = false;\n  if (typeof gatewayCallbacks.withCredentials !== 'undefined' && gatewayCallbacks.withCredentials !== null)\n    withCredentials = gatewayCallbacks.withCredentials === true;\n  // Optional max events\n  let maxev = 10;\n  if (typeof gatewayCallbacks.max_poll_events !== 'undefined' && gatewayCallbacks.max_poll_events !== null)\n    maxev = gatewayCallbacks.max_poll_events;\n  if (maxev < 1) maxev = 1;\n  // Token to use (only if the token based authentication mechanism is enabled)\n  let token = null;\n  if (typeof gatewayCallbacks.token !== 'undefined' && gatewayCallbacks.token !== null) token = gatewayCallbacks.token;\n  // API secret to use (only if the shared API secret is enabled)\n  let apisecret = null;\n  if (typeof gatewayCallbacks.apisecret !== 'undefined' && gatewayCallbacks.apisecret !== null)\n    apisecret = gatewayCallbacks.apisecret;\n  // Whether we should destroy this session when onbeforeunload is called\n  this.destroyOnUnload = true;\n  if (typeof gatewayCallbacks.destroyOnUnload !== 'undefined' && gatewayCallbacks.destroyOnUnload !== null)\n    this.destroyOnUnload = gatewayCallbacks.destroyOnUnload === true;\n  // Some timeout-related values\n  let keepAlivePeriod = 25000;\n  if (typeof gatewayCallbacks.keepAlivePeriod !== 'undefined' && gatewayCallbacks.keepAlivePeriod !== null)\n    keepAlivePeriod = gatewayCallbacks.keepAlivePeriod;\n  if (isNaN(keepAlivePeriod)) keepAlivePeriod = 25000;\n  let longPollTimeout = 60000;\n  if (typeof gatewayCallbacks.longPollTimeout !== 'undefined' && gatewayCallbacks.longPollTimeout !== null)\n    longPollTimeout = gatewayCallbacks.longPollTimeout;\n  if (isNaN(longPollTimeout)) longPollTimeout = 60000;\n\n  // overrides for default maxBitrate values for simulcasting\n  function getMaxBitrates(simulcastMaxBitrates) {\n    let maxBitrates = {\n      high: 900000,\n      medium: 300000,\n      low: 100000,\n    };\n\n    if (typeof simulcastMaxBitrates !== 'undefined' && simulcastMaxBitrates !== null) {\n      if (simulcastMaxBitrates.high) maxBitrates.high = simulcastMaxBitrates.high;\n      if (simulcastMaxBitrates.medium) maxBitrates.medium = simulcastMaxBitrates.medium;\n      if (simulcastMaxBitrates.low) maxBitrates.low = simulcastMaxBitrates.low;\n    }\n\n    return maxBitrates;\n  }\n\n  let connected = false;\n  let sessionId = null;\n  let pluginHandles = {};\n  let that = this;\n  let retries = 0;\n  let transactions = {};\n  createSession(gatewayCallbacks);\n\n  // Public methods\n  this.getServer = function () {\n    return server;\n  };\n  this.isConnected = function () {\n    return connected;\n  };\n  this.reconnect = function (callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    callbacks['reconnect'] = true;\n    createSession(callbacks);\n  };\n  this.getSessionId = function () {\n    return sessionId;\n  };\n  this.getInfo = function (callbacks) {\n    getInfo(callbacks);\n  };\n  this.destroy = function (callbacks) {\n    destroySession(callbacks);\n  };\n  this.attach = function (callbacks) {\n    createHandle(callbacks);\n  };\n\n  function eventHandler() {\n    if (sessionId == null) return;\n    Janus.debug('Long poll...');\n    if (!connected) {\n      Janus.warn('Is the server down? (connected=false)');\n      return;\n    }\n    let longpoll = server + '/' + sessionId + '?rid=' + new Date().getTime();\n    if (maxev) longpoll = longpoll + '&maxev=' + maxev;\n    if (token) longpoll = longpoll + '&token=' + encodeURIComponent(token);\n    if (apisecret) longpoll = longpoll + '&apisecret=' + encodeURIComponent(apisecret);\n    Janus.httpAPICall(longpoll, {\n      verb: 'GET',\n      withCredentials: withCredentials,\n      success: handleEvent,\n      timeout: longPollTimeout,\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown);\n        retries++;\n        if (retries > 3) {\n          // Did we just lose the server? :-(\n          connected = false;\n          gatewayCallbacks.error('Lost connection to the server (is it down?)');\n          return;\n        }\n        eventHandler();\n      },\n    });\n  }\n\n  // Private event handler: this will trigger plugin callbacks, if set\n  function handleEvent(json, skipTimeout) {\n    retries = 0;\n    if (!websockets && typeof sessionId !== 'undefined' && sessionId !== null && skipTimeout !== true) eventHandler();\n    if (!websockets && Janus.isArray(json)) {\n      // We got an array: it means we passed a maxev > 1, iterate on all objects\n      for (let i = 0; i < json.length; i++) {\n        handleEvent(json[i], true);\n      }\n      return;\n    }\n    if (json['janus'] === 'keepalive') {\n      // Nothing happened\n      Janus.vdebug('Got a keepalive on session ' + sessionId);\n      return;\n    } else if (json['janus'] === 'server_info') {\n      // Just info on the Janus instance\n      Janus.debug('Got info on the Janus instance');\n      Janus.debug(json);\n      const transaction = json['transaction'];\n      if (transaction) {\n        const reportSuccess = transactions[transaction];\n        if (reportSuccess) reportSuccess(json);\n        delete transactions[transaction];\n      }\n      return;\n    } else if (json['janus'] === 'ack') {\n      // Just an ack, we can probably ignore\n      Janus.debug('Got an ack on session ' + sessionId);\n      Janus.debug(json);\n      const transaction = json['transaction'];\n      if (transaction) {\n        const reportSuccess = transactions[transaction];\n        if (reportSuccess) reportSuccess(json);\n        delete transactions[transaction];\n      }\n      return;\n    } else if (json['janus'] === 'success') {\n      // Success!\n      Janus.debug('Got a success on session ' + sessionId);\n      Janus.debug(json);\n      const transaction = json['transaction'];\n      if (transaction) {\n        const reportSuccess = transactions[transaction];\n        if (reportSuccess) reportSuccess(json);\n        delete transactions[transaction];\n      }\n      return;\n    } else if (json['janus'] === 'trickle') {\n      // We got a trickle candidate from Janus\n      const sender = json['sender'];\n      if (!sender) {\n        Janus.warn('Missing sender...');\n        return;\n      }\n      const pluginHandle = pluginHandles[sender];\n      if (!pluginHandle) {\n        Janus.debug('This handle is not attached to this session');\n        return;\n      }\n      let candidate = json['candidate'];\n      Janus.debug('Got a trickled candidate on session ' + sessionId);\n      Janus.debug(candidate);\n      let config = pluginHandle.webrtcStuff;\n      if (config.pc && config.remoteSdp) {\n        // Add candidate right now\n        Janus.debug('Adding remote candidate:', candidate);\n        if (!candidate || candidate.completed === true) {\n          // end-of-candidates\n          config.pc.addIceCandidate(Janus.endOfCandidates);\n        } else {\n          // New candidate\n          config.pc.addIceCandidate(candidate);\n        }\n      } else {\n        // We didn't do setRemoteDescription (trickle got here before the offer?)\n        Janus.debug(\"We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate\");\n        if (!config.candidates) config.candidates = [];\n        config.candidates.push(candidate);\n        Janus.debug(config.candidates);\n      }\n    } else if (json['janus'] === 'webrtcup') {\n      // The PeerConnection with the server is up! Notify this\n      Janus.debug('Got a webrtcup event on session ' + sessionId);\n      Janus.debug(json);\n      const sender = json['sender'];\n      if (!sender) {\n        Janus.warn('Missing sender...');\n        return;\n      }\n      const pluginHandle = pluginHandles[sender];\n      if (!pluginHandle) {\n        Janus.debug('This handle is not attached to this session');\n        return;\n      }\n      pluginHandle.webrtcState(true);\n      return;\n    } else if (json['janus'] === 'hangup') {\n      // A plugin asked the core to hangup a PeerConnection on one of our handles\n      Janus.debug('Got a hangup event on session ' + sessionId);\n      Janus.debug(json);\n      const sender = json['sender'];\n      if (!sender) {\n        Janus.warn('Missing sender...');\n        return;\n      }\n      const pluginHandle = pluginHandles[sender];\n      if (!pluginHandle) {\n        Janus.debug('This handle is not attached to this session');\n        return;\n      }\n      pluginHandle.webrtcState(false, json['reason']);\n      pluginHandle.hangup();\n    } else if (json['janus'] === 'detached') {\n      // A plugin asked the core to detach one of our handles\n      Janus.debug('Got a detached event on session ' + sessionId);\n      Janus.debug(json);\n      const sender = json['sender'];\n      if (!sender) {\n        Janus.warn('Missing sender...');\n        return;\n      }\n      const pluginHandle = pluginHandles[sender];\n      if (!pluginHandle) {\n        // Don't warn here because destroyHandle causes this situation.\n        return;\n      }\n      pluginHandle.ondetached();\n      pluginHandle.detach();\n    } else if (json['janus'] === 'media') {\n      // Media started/stopped flowing\n      Janus.debug('Got a media event on session ' + sessionId);\n      Janus.debug(json);\n      const sender = json['sender'];\n      if (!sender) {\n        Janus.warn('Missing sender...');\n        return;\n      }\n      const pluginHandle = pluginHandles[sender];\n      if (!pluginHandle) {\n        Janus.debug('This handle is not attached to this session');\n        return;\n      }\n      pluginHandle.mediaState(json['type'], json['receiving'], json['mid']);\n    } else if (json['janus'] === 'slowlink') {\n      Janus.debug('Got a slowlink event on session ' + sessionId);\n      Janus.debug(json);\n      // Trouble uplink or downlink\n      const sender = json['sender'];\n      if (!sender) {\n        Janus.warn('Missing sender...');\n        return;\n      }\n      const pluginHandle = pluginHandles[sender];\n      if (!pluginHandle) {\n        Janus.debug('This handle is not attached to this session');\n        return;\n      }\n      pluginHandle.slowLink(json['uplink'], json['lost'], json['mid']);\n    } else if (json['janus'] === 'error') {\n      // Oops, something wrong happened\n      Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n      Janus.debug(json);\n      let transaction = json['transaction'];\n      if (transaction) {\n        let reportSuccess = transactions[transaction];\n        if (reportSuccess) {\n          reportSuccess(json);\n        }\n        delete transactions[transaction];\n      }\n      return;\n    } else if (json['janus'] === 'event') {\n      Janus.debug('Got a plugin event on session ' + sessionId);\n      Janus.debug(json);\n      const sender = json['sender'];\n      if (!sender) {\n        Janus.warn('Missing sender...');\n        return;\n      }\n      let plugindata = json['plugindata'];\n      if (!plugindata) {\n        Janus.warn('Missing plugindata...');\n        return;\n      }\n      Janus.debug('  -- Event is coming from ' + sender + ' (' + plugindata['plugin'] + ')');\n      let data = plugindata['data'];\n      Janus.debug(data);\n      const pluginHandle = pluginHandles[sender];\n      if (!pluginHandle) {\n        Janus.warn('This handle is not attached to this session');\n        return;\n      }\n      let jsep = json['jsep'];\n      if (jsep) {\n        Janus.debug('Handling SDP as well...');\n        Janus.debug(jsep);\n      }\n      let callback = pluginHandle.onmessage;\n      if (callback) {\n        Janus.debug('Notifying application...');\n        // Send to callback specified when attaching plugin handle\n        callback(data, jsep);\n      } else {\n        // Send to generic callback (?)\n        Janus.debug('No provided notification callback');\n      }\n    } else if (json['janus'] === 'timeout') {\n      Janus.error('Timeout on session ' + sessionId);\n      Janus.debug(json);\n      if (websockets) {\n        ws.close(3504, 'Gateway timeout');\n      }\n      return;\n    } else {\n      Janus.warn(\"Unknown message/event  '\" + json['janus'] + \"' on session \" + sessionId);\n      Janus.debug(json);\n    }\n  }\n\n  // Private helper to send keep-alive messages on WebSockets\n  function keepAlive() {\n    if (!server || !websockets || !connected) return;\n    wsKeepaliveTimeoutId = setTimeout(keepAlive, keepAlivePeriod);\n    let request = {\n      janus: 'keepalive',\n      session_id: sessionId,\n      transaction: Janus.randomString(12),\n    };\n    if (token) request['token'] = token;\n    if (apisecret) request['apisecret'] = apisecret;\n    ws.send(JSON.stringify(request));\n  }\n\n  // Private method to create a session\n  function createSession(callbacks) {\n    let transaction = Janus.randomString(12);\n    let request = { janus: 'create', transaction: transaction };\n    if (callbacks['reconnect']) {\n      // We're reconnecting, claim the session\n      connected = false;\n      request['janus'] = 'claim';\n      request['session_id'] = sessionId;\n      // If we were using websockets, ignore the old connection\n      if (ws) {\n        ws.onopen = null;\n        ws.onerror = null;\n        ws.onclose = null;\n        if (wsKeepaliveTimeoutId) {\n          clearTimeout(wsKeepaliveTimeoutId);\n          wsKeepaliveTimeoutId = null;\n        }\n      }\n    }\n    if (token) request['token'] = token;\n    if (apisecret) request['apisecret'] = apisecret;\n    if (!server && Janus.isArray(servers)) {\n      // We still need to find a working server from the list we were given\n      server = servers[serversIndex];\n      if (server.indexOf('ws') === 0) {\n        websockets = true;\n        Janus.log('Server #' + (serversIndex + 1) + ': trying WebSockets to contact Janus (' + server + ')');\n      } else {\n        websockets = false;\n        Janus.log('Server #' + (serversIndex + 1) + ': trying REST API to contact Janus (' + server + ')');\n      }\n    }\n    if (websockets) {\n      ws = Janus.newWebSocket(server, 'janus-protocol');\n      wsHandlers = {\n        error: function () {\n          Janus.error('Error connecting to the Janus WebSockets server... ' + server);\n          if (Janus.isArray(servers) && !callbacks['reconnect']) {\n            serversIndex++;\n            if (serversIndex === servers.length) {\n              // We tried all the servers the user gave us and they all failed\n              callbacks.error('Error connecting to any of the provided Janus servers: Is the server down?');\n              return;\n            }\n            // Let's try the next server\n            server = null;\n            setTimeout(function () {\n              createSession(callbacks);\n            }, 200);\n            return;\n          }\n          callbacks.error('Error connecting to the Janus WebSockets server: Is the server down?');\n        },\n\n        open: function () {\n          // We need to be notified about the success\n          transactions[transaction] = function (json) {\n            Janus.debug(json);\n            if (json['janus'] !== 'success') {\n              Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n              callbacks.error(json['error'].reason);\n              return;\n            }\n            wsKeepaliveTimeoutId = setTimeout(keepAlive, keepAlivePeriod);\n            connected = true;\n            sessionId = json['session_id'] ? json['session_id'] : json.data['id'];\n            if (callbacks['reconnect']) {\n              Janus.log('Claimed session: ' + sessionId);\n            } else {\n              Janus.log('Created session: ' + sessionId);\n            }\n            Janus.sessions[sessionId] = that;\n            callbacks.success();\n          };\n          ws.send(JSON.stringify(request));\n        },\n\n        message: function (event) {\n          handleEvent(JSON.parse(event.data));\n        },\n\n        close: function () {\n          if (!server || !connected) {\n            return;\n          }\n          connected = false;\n          // FIXME What if this is called when the page is closed?\n          gatewayCallbacks.error('Lost connection to the server (is it down?)');\n        },\n      };\n\n      for (let eventName in wsHandlers) {\n        ws.addEventListener(eventName, wsHandlers[eventName]);\n      }\n\n      return;\n    }\n    Janus.httpAPICall(server, {\n      verb: 'POST',\n      withCredentials: withCredentials,\n      body: request,\n      success: function (json) {\n        Janus.debug(json);\n        if (json['janus'] !== 'success') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n          callbacks.error(json['error'].reason);\n          return;\n        }\n        connected = true;\n        sessionId = json['session_id'] ? json['session_id'] : json.data['id'];\n        if (callbacks['reconnect']) {\n          Janus.log('Claimed session: ' + sessionId);\n        } else {\n          Janus.log('Created session: ' + sessionId);\n        }\n        Janus.sessions[sessionId] = that;\n        eventHandler();\n        callbacks.success();\n      },\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown); // FIXME\n        if (Janus.isArray(servers) && !callbacks['reconnect']) {\n          serversIndex++;\n          if (serversIndex === servers.length) {\n            // We tried all the servers the user gave us and they all failed\n            callbacks.error('Error connecting to any of the provided Janus servers: Is the server down?');\n            return;\n          }\n          // Let's try the next server\n          server = null;\n          setTimeout(function () {\n            createSession(callbacks);\n          }, 200);\n          return;\n        }\n        if (errorThrown === '') callbacks.error(textStatus + ': Is the server down?');\n        else if (errorThrown && errorThrown.error) callbacks.error(textStatus + ': ' + errorThrown.error.message);\n        else callbacks.error(textStatus + ': ' + errorThrown);\n      },\n    });\n  }\n\n  // Private method to get info on the server\n  function getInfo(callbacks) {\n    callbacks = callbacks || {};\n    // FIXME This method triggers a success even when we fail\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    Janus.log('Getting info on Janus instance');\n    if (!connected) {\n      Janus.warn('Is the server down? (connected=false)');\n      callbacks.error('Is the server down? (connected=false)');\n      return;\n    }\n    // We just need to send an \"info\" request\n    let transaction = Janus.randomString(12);\n    let request = { janus: 'info', transaction: transaction };\n    if (token) request['token'] = token;\n    if (apisecret) request['apisecret'] = apisecret;\n    if (websockets) {\n      transactions[transaction] = function (json) {\n        Janus.log('Server info:');\n        Janus.debug(json);\n        if (json['janus'] !== 'server_info') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n        }\n        callbacks.success(json);\n      };\n      ws.send(JSON.stringify(request));\n      return;\n    }\n    Janus.httpAPICall(server, {\n      verb: 'POST',\n      withCredentials: withCredentials,\n      body: request,\n      success: function (json) {\n        Janus.log('Server info:');\n        Janus.debug(json);\n        if (json['janus'] !== 'server_info') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n        }\n        callbacks.success(json);\n      },\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown); // FIXME\n        if (errorThrown === '') callbacks.error(textStatus + ': Is the server down?');\n        else callbacks.error(textStatus + ': ' + errorThrown);\n      },\n    });\n  }\n\n  // Private method to destroy a session\n  function destroySession(callbacks) {\n    callbacks = callbacks || {};\n    // FIXME This method triggers a success even when we fail\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    let unload = callbacks.unload === true;\n    let notifyDestroyed = true;\n    if (typeof callbacks.notifyDestroyed !== 'undefined' && callbacks.notifyDestroyed !== null)\n      notifyDestroyed = callbacks.notifyDestroyed === true;\n    let cleanupHandles = callbacks.cleanupHandles === true;\n    Janus.log('Destroying session ' + sessionId + ' (unload=' + unload + ')');\n    if (!sessionId) {\n      Janus.warn('No session to destroy');\n      callbacks.success();\n      if (notifyDestroyed) gatewayCallbacks.destroyed();\n      return;\n    }\n    if (cleanupHandles) {\n      for (let handleId in pluginHandles) destroyHandle(handleId, { noRequest: true });\n    }\n    if (!connected) {\n      Janus.warn('Is the server down? (connected=false)');\n      sessionId = null;\n      callbacks.success();\n      return;\n    }\n    // No need to destroy all handles first, Janus will do that itself\n    let request = { janus: 'destroy', transaction: Janus.randomString(12) };\n    if (token) request['token'] = token;\n    if (apisecret) request['apisecret'] = apisecret;\n    if (unload) {\n      // We're unloading the page: use sendBeacon for HTTP instead,\n      // or just close the WebSocket connection if we're using that\n      if (websockets) {\n        ws.onclose = null;\n        ws.close();\n        ws = null;\n      } else {\n        navigator.sendBeacon(server + '/' + sessionId, JSON.stringify(request));\n      }\n      Janus.log('Destroyed session:');\n      sessionId = null;\n      connected = false;\n      callbacks.success();\n      if (notifyDestroyed) gatewayCallbacks.destroyed();\n      return;\n    }\n    if (websockets) {\n      request['session_id'] = sessionId;\n\n      let unbindWebSocket = function () {\n        for (let eventName in wsHandlers) {\n          ws.removeEventListener(eventName, wsHandlers[eventName]);\n        }\n        ws.removeEventListener('message', onUnbindMessage);\n        ws.removeEventListener('error', onUnbindError);\n        if (wsKeepaliveTimeoutId) {\n          clearTimeout(wsKeepaliveTimeoutId);\n        }\n        ws.close();\n      };\n\n      let onUnbindMessage = function (event) {\n        let data = JSON.parse(event.data);\n        if (data.session_id == request.session_id && data.transaction == request.transaction) {\n          unbindWebSocket();\n          callbacks.success();\n          if (notifyDestroyed) gatewayCallbacks.destroyed();\n        }\n      };\n      let onUnbindError = function () {\n        unbindWebSocket();\n        callbacks.error('Failed to destroy the server: Is the server down?');\n        if (notifyDestroyed) gatewayCallbacks.destroyed();\n      };\n\n      ws.addEventListener('message', onUnbindMessage);\n      ws.addEventListener('error', onUnbindError);\n\n      if (ws.readyState === 1) {\n        ws.send(JSON.stringify(request));\n      } else {\n        onUnbindError();\n      }\n\n      return;\n    }\n    Janus.httpAPICall(server + '/' + sessionId, {\n      verb: 'POST',\n      withCredentials: withCredentials,\n      body: request,\n      success: function (json) {\n        Janus.log('Destroyed session:');\n        Janus.debug(json);\n        sessionId = null;\n        connected = false;\n        if (json['janus'] !== 'success') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n        }\n        callbacks.success();\n        if (notifyDestroyed) gatewayCallbacks.destroyed();\n      },\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown); // FIXME\n        // Reset everything anyway\n        sessionId = null;\n        connected = false;\n        callbacks.success();\n        if (notifyDestroyed) gatewayCallbacks.destroyed();\n      },\n    });\n  }\n\n  // Private method to create a plugin handle\n  function createHandle(callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    callbacks.dataChannelOptions = callbacks.dataChannelOptions || {\n      ordered: true,\n    };\n    callbacks.consentDialog = typeof callbacks.consentDialog == 'function' ? callbacks.consentDialog : Janus.noop;\n    callbacks.iceState = typeof callbacks.iceState == 'function' ? callbacks.iceState : Janus.noop;\n    callbacks.mediaState = typeof callbacks.mediaState == 'function' ? callbacks.mediaState : Janus.noop;\n    callbacks.webrtcState = typeof callbacks.webrtcState == 'function' ? callbacks.webrtcState : Janus.noop;\n    callbacks.slowLink = typeof callbacks.slowLink == 'function' ? callbacks.slowLink : Janus.noop;\n    callbacks.onmessage = typeof callbacks.onmessage == 'function' ? callbacks.onmessage : Janus.noop;\n    callbacks.onlocaltrack = typeof callbacks.onlocaltrack == 'function' ? callbacks.onlocaltrack : Janus.noop;\n    callbacks.onremotetrack = typeof callbacks.onremotetrack == 'function' ? callbacks.onremotetrack : Janus.noop;\n    callbacks.ondata = typeof callbacks.ondata == 'function' ? callbacks.ondata : Janus.noop;\n    callbacks.ondataopen = typeof callbacks.ondataopen == 'function' ? callbacks.ondataopen : Janus.noop;\n    callbacks.oncleanup = typeof callbacks.oncleanup == 'function' ? callbacks.oncleanup : Janus.noop;\n    callbacks.ondetached = typeof callbacks.ondetached == 'function' ? callbacks.ondetached : Janus.noop;\n    if (!connected) {\n      Janus.warn('Is the server down? (connected=false)');\n      callbacks.error('Is the server down? (connected=false)');\n      return;\n    }\n    let plugin = callbacks.plugin;\n    if (!plugin) {\n      Janus.error('Invalid plugin');\n      callbacks.error('Invalid plugin');\n      return;\n    }\n    let opaqueId = callbacks.opaqueId;\n    let loopIndex = callbacks.loopIndex;\n    let handleToken = callbacks.token ? callbacks.token : token;\n    let transaction = Janus.randomString(12);\n    let request = {\n      janus: 'attach',\n      plugin: plugin,\n      opaque_id: opaqueId,\n      loop_index: loopIndex,\n      transaction: transaction,\n    };\n    if (handleToken) request['token'] = handleToken;\n    if (apisecret) request['apisecret'] = apisecret;\n    if (websockets) {\n      transactions[transaction] = function (json) {\n        Janus.debug(json);\n        if (json['janus'] !== 'success') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n          callbacks.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason);\n          return;\n        }\n        let handleId = json.data['id'];\n        Janus.log('Created handle: ' + handleId);\n        let pluginHandle = {\n          session: that,\n          plugin: plugin,\n          id: handleId,\n          token: handleToken,\n          detached: false,\n          webrtcStuff: {\n            started: false,\n            myStream: null,\n            streamExternal: false,\n            mySdp: null,\n            mediaConstraints: null,\n            pc: null,\n            dataChannelOptions: callbacks.dataChannelOptions,\n            dataChannel: {},\n            dtmfSender: null,\n            trickle: true,\n            iceDone: false,\n            bitrate: {},\n          },\n          getId: function () {\n            return handleId;\n          },\n          getPlugin: function () {\n            return plugin;\n          },\n          getVolume: function (mid, result) {\n            return getVolume(handleId, mid, true, result);\n          },\n          getRemoteVolume: function (mid, result) {\n            return getVolume(handleId, mid, true, result);\n          },\n          getLocalVolume: function (mid, result) {\n            return getVolume(handleId, mid, false, result);\n          },\n          isAudioMuted: function (mid) {\n            return isMuted(handleId, mid, false);\n          },\n          muteAudio: function (mid) {\n            return mute(handleId, mid, false, true);\n          },\n          unmuteAudio: function (mid) {\n            return mute(handleId, mid, false, false);\n          },\n          isVideoMuted: function (mid) {\n            return isMuted(handleId, mid, true);\n          },\n          muteVideo: function (mid) {\n            return mute(handleId, mid, true, true);\n          },\n          unmuteVideo: function (mid) {\n            return mute(handleId, mid, true, false);\n          },\n          getBitrate: function (mid) {\n            return getBitrate(handleId, mid);\n          },\n          setMaxBitrate: function (mid, bitrate) {\n            return setBitrate(handleId, mid, bitrate);\n          },\n          send: function (callbacks) {\n            sendMessage(handleId, callbacks);\n          },\n          data: function (callbacks) {\n            sendData(handleId, callbacks);\n          },\n          dtmf: function (callbacks) {\n            sendDtmf(handleId, callbacks);\n          },\n          consentDialog: callbacks.consentDialog,\n          iceState: callbacks.iceState,\n          mediaState: callbacks.mediaState,\n          webrtcState: callbacks.webrtcState,\n          slowLink: callbacks.slowLink,\n          onmessage: callbacks.onmessage,\n          createOffer: function (callbacks) {\n            prepareWebrtc(handleId, true, callbacks);\n          },\n          createAnswer: function (callbacks) {\n            prepareWebrtc(handleId, false, callbacks);\n          },\n          handleRemoteJsep: function (callbacks) {\n            prepareWebrtcPeer(handleId, callbacks);\n          },\n          replaceTracks: function (callbacks) {\n            replaceTracks(handleId, callbacks);\n          },\n          getLocalTracks: function () {\n            return getLocalTracks(handleId);\n          },\n          getRemoteTracks: function () {\n            return getRemoteTracks(handleId);\n          },\n          onlocaltrack: callbacks.onlocaltrack,\n          onremotetrack: callbacks.onremotetrack,\n          ondata: callbacks.ondata,\n          ondataopen: callbacks.ondataopen,\n          oncleanup: callbacks.oncleanup,\n          ondetached: callbacks.ondetached,\n          hangup: function (sendRequest) {\n            cleanupWebrtc(handleId, sendRequest === true);\n          },\n          detach: function (callbacks) {\n            destroyHandle(handleId, callbacks);\n          },\n        };\n        pluginHandles[handleId] = pluginHandle;\n        callbacks.success(pluginHandle);\n      };\n      request['session_id'] = sessionId;\n      ws.send(JSON.stringify(request));\n      return;\n    }\n    Janus.httpAPICall(server + '/' + sessionId, {\n      verb: 'POST',\n      withCredentials: withCredentials,\n      body: request,\n      success: function (json) {\n        Janus.debug(json);\n        if (json['janus'] !== 'success') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n          callbacks.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason);\n          return;\n        }\n        let handleId = json.data['id'];\n        Janus.log('Created handle: ' + handleId);\n        let pluginHandle = {\n          session: that,\n          plugin: plugin,\n          id: handleId,\n          token: handleToken,\n          detached: false,\n          webrtcStuff: {\n            started: false,\n            myStream: null,\n            streamExternal: false,\n            mySdp: null,\n            mediaConstraints: null,\n            pc: null,\n            dataChannelOptions: callbacks.dataChannelOptions,\n            dataChannel: {},\n            dtmfSender: null,\n            trickle: true,\n            iceDone: false,\n            bitrate: {},\n          },\n          getId: function () {\n            return handleId;\n          },\n          getPlugin: function () {\n            return plugin;\n          },\n          getVolume: function (mid, result) {\n            return getVolume(handleId, mid, true, result);\n          },\n          getRemoteVolume: function (mid, result) {\n            return getVolume(handleId, mid, true, result);\n          },\n          getLocalVolume: function (mid, result) {\n            return getVolume(handleId, mid, false, result);\n          },\n          isAudioMuted: function (mid) {\n            return isMuted(handleId, mid, false);\n          },\n          muteAudio: function (mid) {\n            return mute(handleId, mid, false, true);\n          },\n          unmuteAudio: function (mid) {\n            return mute(handleId, mid, false, false);\n          },\n          isVideoMuted: function (mid) {\n            return isMuted(handleId, mid, true);\n          },\n          muteVideo: function (mid) {\n            return mute(handleId, mid, true, true);\n          },\n          unmuteVideo: function (mid) {\n            return mute(handleId, mid, true, false);\n          },\n          getBitrate: function (mid) {\n            return getBitrate(handleId, mid);\n          },\n          setMaxBitrate: function (mid, bitrate) {\n            return setBitrate(handleId, mid, bitrate);\n          },\n          send: function (callbacks) {\n            sendMessage(handleId, callbacks);\n          },\n          data: function (callbacks) {\n            sendData(handleId, callbacks);\n          },\n          dtmf: function (callbacks) {\n            sendDtmf(handleId, callbacks);\n          },\n          consentDialog: callbacks.consentDialog,\n          iceState: callbacks.iceState,\n          mediaState: callbacks.mediaState,\n          webrtcState: callbacks.webrtcState,\n          slowLink: callbacks.slowLink,\n          onmessage: callbacks.onmessage,\n          createOffer: function (callbacks) {\n            prepareWebrtc(handleId, true, callbacks);\n          },\n          createAnswer: function (callbacks) {\n            prepareWebrtc(handleId, false, callbacks);\n          },\n          handleRemoteJsep: function (callbacks) {\n            prepareWebrtcPeer(handleId, callbacks);\n          },\n          replaceTracks: function (callbacks) {\n            replaceTracks(handleId, callbacks);\n          },\n          getLocalTracks: function () {\n            return getLocalTracks(handleId);\n          },\n          getRemoteTracks: function () {\n            return getRemoteTracks(handleId);\n          },\n          onlocaltrack: callbacks.onlocaltrack,\n          onremotetrack: callbacks.onremotetrack,\n          ondata: callbacks.ondata,\n          ondataopen: callbacks.ondataopen,\n          oncleanup: callbacks.oncleanup,\n          ondetached: callbacks.ondetached,\n          hangup: function (sendRequest) {\n            cleanupWebrtc(handleId, sendRequest === true);\n          },\n          detach: function (callbacks) {\n            destroyHandle(handleId, callbacks);\n          },\n        };\n        pluginHandles[handleId] = pluginHandle;\n        callbacks.success(pluginHandle);\n      },\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown); // FIXME\n        if (errorThrown === '') callbacks.error(textStatus + ': Is the server down?');\n        else callbacks.error(textStatus + ': ' + errorThrown);\n      },\n    });\n  }\n\n  // Private method to send a message\n  function sendMessage(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    if (!connected) {\n      Janus.warn('Is the server down? (connected=false)');\n      callbacks.error('Is the server down? (connected=false)');\n      return;\n    }\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      callbacks.error('Invalid handle');\n      return;\n    }\n    let message = callbacks.message;\n    let jsep = callbacks.jsep;\n    let transaction = Janus.randomString(12);\n    let request = { janus: 'message', body: message, transaction: transaction };\n    if (pluginHandle.token) request['token'] = pluginHandle.token;\n    if (apisecret) request['apisecret'] = apisecret;\n    if (jsep) {\n      request.jsep = {\n        type: jsep.type,\n        sdp: jsep.sdp,\n      };\n      if (jsep.e2ee) request.jsep.e2ee = true;\n      if (jsep.rid_order === 'hml' || jsep.rid_order === 'lmh') request.jsep.rid_order = jsep.rid_order;\n      if (jsep.force_relay) request.jsep.force_relay = true;\n    }\n    Janus.debug('Sending message to plugin (handle=' + handleId + '):');\n    Janus.debug(request);\n    if (websockets) {\n      request['session_id'] = sessionId;\n      request['handle_id'] = handleId;\n      transactions[transaction] = function (json) {\n        Janus.debug('Message sent!');\n        Janus.debug(json);\n        if (json['janus'] === 'success') {\n          // We got a success, must have been a synchronous transaction\n          let plugindata = json['plugindata'];\n          if (!plugindata) {\n            Janus.warn('Request succeeded, but missing plugindata...');\n            callbacks.success();\n            return;\n          }\n          Janus.log('Synchronous transaction successful (' + plugindata['plugin'] + ')');\n          let data = plugindata['data'];\n          Janus.debug(data);\n          callbacks.success(data);\n          return;\n        } else if (json['janus'] !== 'ack') {\n          // Not a success and not an ack, must be an error\n          if (json['error']) {\n            Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n            callbacks.error(json['error'].code + ' ' + json['error'].reason);\n          } else {\n            Janus.error('Unknown error'); // FIXME\n            callbacks.error('Unknown error');\n          }\n          return;\n        }\n        // If we got here, the plugin decided to handle the request asynchronously\n        callbacks.success();\n      };\n      ws.send(JSON.stringify(request));\n      return;\n    }\n    Janus.httpAPICall(server + '/' + sessionId + '/' + handleId, {\n      verb: 'POST',\n      withCredentials: withCredentials,\n      body: request,\n      success: function (json) {\n        Janus.debug('Message sent!');\n        Janus.debug(json);\n        if (json['janus'] === 'success') {\n          // We got a success, must have been a synchronous transaction\n          let plugindata = json['plugindata'];\n          if (!plugindata) {\n            Janus.warn('Request succeeded, but missing plugindata...');\n            callbacks.success();\n            return;\n          }\n          Janus.log('Synchronous transaction successful (' + plugindata['plugin'] + ')');\n          let data = plugindata['data'];\n          Janus.debug(data);\n          callbacks.success(data);\n          return;\n        } else if (json['janus'] !== 'ack') {\n          // Not a success and not an ack, must be an error\n          if (json['error']) {\n            Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n            callbacks.error(json['error'].code + ' ' + json['error'].reason);\n          } else {\n            Janus.error('Unknown error'); // FIXME\n            callbacks.error('Unknown error');\n          }\n          return;\n        }\n        // If we got here, the plugin decided to handle the request asynchronously\n        callbacks.success();\n      },\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown); // FIXME\n        callbacks.error(textStatus + ': ' + errorThrown);\n      },\n    });\n  }\n\n  // Private method to send a trickle candidate\n  function sendTrickleCandidate(handleId, candidate) {\n    if (!connected) {\n      Janus.warn('Is the server down? (connected=false)');\n      return;\n    }\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return;\n    }\n    let request = {\n      janus: 'trickle',\n      candidate: candidate,\n      transaction: Janus.randomString(12),\n    };\n    if (pluginHandle.token) request['token'] = pluginHandle.token;\n    if (apisecret) request['apisecret'] = apisecret;\n    Janus.vdebug('Sending trickle candidate (handle=' + handleId + '):');\n    Janus.vdebug(request);\n    if (websockets) {\n      request['session_id'] = sessionId;\n      request['handle_id'] = handleId;\n      ws.send(JSON.stringify(request));\n      return;\n    }\n    Janus.httpAPICall(server + '/' + sessionId + '/' + handleId, {\n      verb: 'POST',\n      withCredentials: withCredentials,\n      body: request,\n      success: function (json) {\n        Janus.vdebug('Candidate sent!');\n        Janus.vdebug(json);\n        if (json['janus'] !== 'ack') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n          return;\n        }\n      },\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown); // FIXME\n      },\n    });\n  }\n\n  // Private method to create a data channel\n  function createDataChannel(handleId, dclabel, dcprotocol, incoming, pendingData) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) {\n      Janus.warn('Invalid PeerConnection');\n      return;\n    }\n    let onDataChannelMessage = function (event) {\n      Janus.log('Received message on data channel:', event);\n      let label = event.target.label;\n      pluginHandle.ondata(event.data, label);\n    };\n    let onDataChannelStateChange = function (event) {\n      Janus.log('Received state change on data channel:', event);\n      let label = event.target.label;\n      let protocol = event.target.protocol;\n      let dcState = config.dataChannel[label] ? config.dataChannel[label].readyState : 'null';\n      Janus.log('State change on <' + label + '> data channel: ' + dcState);\n      if (dcState === 'open') {\n        // Any pending messages to send?\n        if (config.dataChannel[label].pending && config.dataChannel[label].pending.length > 0) {\n          Janus.log('Sending pending messages on <' + label + '>:', config.dataChannel[label].pending.length);\n          for (let data of config.dataChannel[label].pending) {\n            Janus.log('Sending data on data channel <' + label + '>');\n            Janus.debug(data);\n            config.dataChannel[label].send(data);\n          }\n          config.dataChannel[label].pending = [];\n        }\n        // Notify the open data channel\n        pluginHandle.ondataopen(label, protocol);\n      }\n    };\n    let onDataChannelError = function (error) {\n      Janus.error('Got error on data channel:', error);\n      // TODO\n    };\n    if (!incoming) {\n      // FIXME Add options (ordered, maxRetransmits, etc.)\n      let dcoptions = config.dataChannelOptions;\n      if (dcprotocol) dcoptions.protocol = dcprotocol;\n      config.dataChannel[dclabel] = config.pc.createDataChannel(dclabel, dcoptions);\n    } else {\n      // The channel was created by Janus\n      config.dataChannel[dclabel] = incoming;\n    }\n    config.dataChannel[dclabel].onmessage = onDataChannelMessage;\n    config.dataChannel[dclabel].onopen = onDataChannelStateChange;\n    config.dataChannel[dclabel].onclose = onDataChannelStateChange;\n    config.dataChannel[dclabel].onerror = onDataChannelError;\n    config.dataChannel[dclabel].pending = [];\n    if (pendingData) config.dataChannel[dclabel].pending.push(pendingData);\n  }\n\n  // Private method to send a data channel message\n  function sendData(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      callbacks.error('Invalid handle');\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    let data = callbacks.text || callbacks.data;\n    if (!data) {\n      Janus.warn('Invalid data');\n      callbacks.error('Invalid data');\n      return;\n    }\n    let label = callbacks.label ? callbacks.label : Janus.dataChanDefaultLabel;\n    if (!config.dataChannel[label]) {\n      // Create new data channel and wait for it to open\n      createDataChannel(handleId, label, callbacks.protocol, false, data, callbacks.protocol);\n      callbacks.success();\n      return;\n    }\n    if (config.dataChannel[label].readyState !== 'open') {\n      config.dataChannel[label].pending.push(data);\n      callbacks.success();\n      return;\n    }\n    Janus.log('Sending data on data channel <' + label + '>');\n    Janus.debug(data);\n    config.dataChannel[label].send(data);\n    callbacks.success();\n  }\n\n  // Private method to send a DTMF tone\n  function sendDtmf(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      callbacks.error('Invalid handle');\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.dtmfSender) {\n      // Create the DTMF sender the proper way, if possible\n      if (config.pc) {\n        let senders = config.pc.getSenders();\n        let audioSender = senders.find(function (sender) {\n          return sender.track && sender.track.kind === 'audio';\n        });\n        if (!audioSender) {\n          Janus.warn('Invalid DTMF configuration (no audio track)');\n          callbacks.error('Invalid DTMF configuration (no audio track)');\n          return;\n        }\n        config.dtmfSender = audioSender.dtmf;\n        if (config.dtmfSender) {\n          Janus.log('Created DTMF Sender');\n          config.dtmfSender.ontonechange = function (tone) {\n            Janus.debug('Sent DTMF tone: ' + tone.tone);\n          };\n        }\n      }\n      if (!config.dtmfSender) {\n        Janus.warn('Invalid DTMF configuration');\n        callbacks.error('Invalid DTMF configuration');\n        return;\n      }\n    }\n    let dtmf = callbacks.dtmf;\n    if (!dtmf) {\n      Janus.warn('Invalid DTMF parameters');\n      callbacks.error('Invalid DTMF parameters');\n      return;\n    }\n    let tones = dtmf.tones;\n    if (!tones) {\n      Janus.warn('Invalid DTMF string');\n      callbacks.error('Invalid DTMF string');\n      return;\n    }\n    let duration = typeof dtmf.duration === 'number' ? dtmf.duration : 500; // We choose 500ms as the default duration for a tone\n    let gap = typeof dtmf.gap === 'number' ? dtmf.gap : 50; // We choose 50ms as the default gap between tones\n    Janus.debug('Sending DTMF string ' + tones + ' (duration ' + duration + 'ms, gap ' + gap + 'ms)');\n    config.dtmfSender.insertDTMF(tones, duration, gap);\n    callbacks.success();\n  }\n\n  // Private method to destroy a plugin handle\n  function destroyHandle(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    let noRequest = callbacks.noRequest === true;\n    Janus.log('Destroying handle ' + handleId + ' (only-locally=' + noRequest + ')');\n    cleanupWebrtc(handleId);\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || pluginHandle.detached) {\n      // Plugin was already detached by Janus, calling detach again will return a handle not found error, so just exit here\n      delete pluginHandles[handleId];\n      callbacks.success();\n      return;\n    }\n    pluginHandle.detached = true;\n    if (noRequest) {\n      // We're only removing the handle locally\n      delete pluginHandles[handleId];\n      callbacks.success();\n      return;\n    }\n    if (!connected) {\n      Janus.warn('Is the server down? (connected=false)');\n      callbacks.error('Is the server down? (connected=false)');\n      return;\n    }\n    let request = { janus: 'detach', transaction: Janus.randomString(12) };\n    if (pluginHandle.token) request['token'] = pluginHandle.token;\n    if (apisecret) request['apisecret'] = apisecret;\n    if (websockets) {\n      request['session_id'] = sessionId;\n      request['handle_id'] = handleId;\n      ws.send(JSON.stringify(request));\n      delete pluginHandles[handleId];\n      callbacks.success();\n      return;\n    }\n    Janus.httpAPICall(server + '/' + sessionId + '/' + handleId, {\n      verb: 'POST',\n      withCredentials: withCredentials,\n      body: request,\n      success: function (json) {\n        Janus.log('Destroyed handle:');\n        Janus.debug(json);\n        if (json['janus'] !== 'success') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n        }\n        delete pluginHandles[handleId];\n        callbacks.success();\n      },\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown); // FIXME\n        // We cleanup anyway\n        delete pluginHandles[handleId];\n        callbacks.success();\n      },\n    });\n  }\n\n  // WebRTC stuff\n  // Helper function to create a new PeerConnection, if we need one\n  function createPeerconnectionIfNeeded(handleId, callbacks) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      throw 'Invalid handle';\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (config.pc) {\n      // Nothing to do, we have a PeerConnection already\n      return;\n    }\n    let pc_config = {\n      iceServers: iceServers,\n      iceTransportPolicy: iceTransportPolicy,\n      bundlePolicy: bundlePolicy,\n    };\n    pc_config.sdpSemantics = 'unified-plan';\n    // Check if a sender or receiver transform has been provided\n    let insertableStreams = false;\n    if (callbacks.tracks) {\n      for (let track of callbacks.tracks) {\n        if (track.transforms && (track.transforms.sender || track.transforms.receiver)) {\n          insertableStreams = true;\n          break;\n        }\n      }\n    }\n    if (\n      RTCRtpSender &&\n      (RTCRtpSender.prototype.createEncodedStreams ||\n        (RTCRtpSender.prototype.createEncodedAudioStreams && RTCRtpSender.prototype.createEncodedVideoStreams)) &&\n      insertableStreams\n    ) {\n      config.insertableStreams = true;\n      pc_config.forceEncodedAudioInsertableStreams = true;\n      pc_config.forceEncodedVideoInsertableStreams = true;\n      pc_config.encodedInsertableStreams = true;\n    }\n    Janus.log('Creating PeerConnection');\n    config.pc = new RTCPeerConnection(pc_config);\n    Janus.debug(config.pc);\n    if (config.pc.getStats) {\n      // FIXME\n      config.volume = {};\n      config.bitrate.value = '0 kbits/sec';\n    }\n    Janus.log('Preparing local SDP and gathering candidates (trickle=' + config.trickle + ')');\n    config.pc.oniceconnectionstatechange = function () {\n      if (config.pc) pluginHandle.iceState(config.pc.iceConnectionState);\n    };\n    config.pc.onicecandidate = function (event) {\n      if (!event.candidate || (event.candidate.candidate && event.candidate.candidate.indexOf('endOfCandidates') > 0)) {\n        Janus.log('End of candidates.');\n        config.iceDone = true;\n        if (config.trickle === true) {\n          // Notify end of candidates\n          sendTrickleCandidate(handleId, { completed: true });\n        } else {\n          // No trickle, time to send the complete SDP (including all candidates)\n          sendSDP(handleId, callbacks);\n        }\n      } else {\n        // JSON.stringify doesn't work on some WebRTC objects anymore\n        // See https://code.google.com/p/chromium/issues/detail?id=467366\n        let candidate = {\n          candidate: event.candidate.candidate,\n          sdpMid: event.candidate.sdpMid,\n          sdpMLineIndex: event.candidate.sdpMLineIndex,\n        };\n        if (config.trickle === true) {\n          // Send candidate\n          sendTrickleCandidate(handleId, candidate);\n        }\n      }\n    };\n    config.pc.ontrack = function (event) {\n      Janus.log('Handling Remote Track', event);\n      if (!event.streams) return;\n      if (!event.track) return;\n      // Notify about the new track event\n      let mid = event.transceiver ? event.transceiver.mid || event.transceiver._mid : event.track.id;\n      try {\n        pluginHandle.onremotetrack(event.track, mid, true, {\n          reason: 'created',\n        });\n      } catch (e) {\n        Janus.error('Error calling onremotetrack', e);\n      }\n      if (event.track.onended) return;\n      let trackMutedTimeoutId = null;\n      Janus.log('Adding onended callback to track:', event.track);\n      event.track.onended = function (ev) {\n        Janus.log('Remote track removed:', ev);\n        clearTimeout(trackMutedTimeoutId);\n        // Notify the application\n        let transceivers = config.pc ? config.pc.getTransceivers() : null;\n        let transceiver = transceivers\n          ? transceivers.find((transceiver) => {\n            const receiver = transceiver.receiver || transceiver._receiver;\n            const track = receiver.track || receiver._track;\n            return track === ev.target;\n          })\n          : null;\n        let mid = transceiver ? transceiver.mid || transceiver._mid : ev.target.id;\n        try {\n          pluginHandle.onremotetrack(ev.target, mid, false, {\n            reason: 'ended',\n          });\n        } catch (e) {\n          Janus.error('Error calling onremotetrack on removal', e);\n        }\n      };\n      event.track.onmute = function (ev) {\n        Janus.log('Remote track muted:', ev);\n        if (!trackMutedTimeoutId) {\n          const target = ev.target;\n          trackMutedTimeoutId = setTimeout(function () {\n            Janus.log('Removing remote track');\n            // Notify the application the track is gone\n            let transceivers = config.pc ? config.pc.getTransceivers() : null;\n            let transceiver = transceivers\n              ? transceivers.find((transceiver) => {\n                const receiver = transceiver.receiver || transceiver._receiver;\n                const track = receiver.track || receiver._track;\n                return track === target;\n              })\n              : null;\n            let mid = transceiver ? transceiver.mid || transceiver._mid : target.id;\n            try {\n              pluginHandle.onremotetrack(target, mid, false, {\n                reason: 'mute',\n              });\n            } catch (e) {\n              Janus.error('Error calling onremotetrack on mute', e);\n            }\n            trackMutedTimeoutId = null;\n            // Chrome seems to raise mute events only at multiples of 834ms;\n            // we set the timeout to three times this value (rounded to 840ms);\n          }, 3 * 840);\n        }\n      };\n      event.track.onunmute = function (ev) {\n        Janus.log('Remote track flowing again:', ev);\n        if (trackMutedTimeoutId != null) {\n          clearTimeout(trackMutedTimeoutId);\n          trackMutedTimeoutId = null;\n        } else {\n          try {\n            // Notify the application the track is back\n            let transceivers = config.pc ? config.pc.getTransceivers() : null;\n            let transceiver = transceivers\n              ? transceivers.find((transceiver) => {\n                const receiver = transceiver.receiver || transceiver._receiver;\n                const track = receiver.track || receiver._track;\n                return track === ev.target;\n              })\n              : null;\n            let mid = transceiver ? transceiver.mid || transceiver._mid : ev.target.id;\n            pluginHandle.onremotetrack(ev.target, mid, true, {\n              reason: 'unmute',\n            });\n          } catch (e) {\n            Janus.error('Error calling onremotetrack on unmute', e);\n          }\n        }\n      };\n    };\n  }\n\n  // Helper function used when creating either an offer or answer: it\n  // prepares what needs to be prepared, including creating a new\n  // PeerConnection (if needed) and updating the tracks configuration,\n  // before invoking the function to actually generate the offer/answer\n  async function prepareWebrtc(handleId, offer, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : webrtcError;\n    let jsep = callbacks.jsep;\n    if (offer && jsep) {\n      Janus.error('Provided a JSEP to a createOffer');\n      callbacks.error('Provided a JSEP to a createOffer');\n      return;\n    } else if (!offer && (!jsep || !jsep.type || !jsep.sdp)) {\n      Janus.error('A valid JSEP is required for createAnswer');\n      callbacks.error('A valid JSEP is required for createAnswer');\n      return;\n    }\n    // If the deprecated media was provided instead of tracks, translate it\n    if (callbacks.media && !callbacks.tracks) {\n      callbacks.tracks = Janus.mediaToTracks(callbacks.media);\n      if (callbacks.simulcast === true || callbacks.simulcast2 === true || callbacks.svc) {\n        // Find the video track and add simulcast/SVC info there\n        for (let track of callbacks.tracks) {\n          if (track.type === 'video') {\n            if (callbacks.simulcast === true || callbacks.simulcast2 === true) track.simulcast = true;\n            else if (callbacks.svc) track.svc = callbacks.svc;\n            break;\n          }\n        }\n      }\n      Janus.warn('Deprecated media object passed, use tracks instead. Automatically translated to:', callbacks.tracks);\n    }\n    // Check that callbacks.array is a valid array\n    if (callbacks.tracks && !Array.isArray(callbacks.tracks)) {\n      Janus.error('Tracks must be an array');\n      callbacks.error('Tracks must be an array');\n      return;\n    }\n    // Get the plugin handle\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      callbacks.error('Invalid handle');\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    config.trickle = isTrickleEnabled(callbacks.trickle);\n    try {\n      // Create a PeerConnection, if needed\n      createPeerconnectionIfNeeded(handleId, callbacks);\n      if (offer) {\n        // Capture devices and setup tracks, if needed\n        await captureDevices(handleId, callbacks);\n      }\n      // Create offer or answer now (depending on the context)\n      if (!jsep) {\n        let offer = await createOffer(handleId, callbacks);\n        callbacks.success(offer);\n      } else {\n        await config.pc.setRemoteDescription(jsep);\n        Janus.log('Remote description accepted!');\n        config.remoteSdp = jsep.sdp;\n        // Any trickle candidate we cached?\n        if (config.candidates && config.candidates.length > 0) {\n          for (let i = 0; i < config.candidates.length; i++) {\n            let candidate = config.candidates[i];\n            Janus.debug('Adding remote candidate:', candidate);\n            if (!candidate || candidate.completed === true) {\n              // end-of-candidates\n              config.pc.addIceCandidate(Janus.endOfCandidates);\n            } else {\n              // New candidate\n              config.pc.addIceCandidate(candidate);\n            }\n          }\n          config.candidates = [];\n        }\n        // Capture devices and setup tracks, if needed\n        await captureDevices(handleId, callbacks);\n        // Create the answer now\n        let answer = await createAnswer(handleId, callbacks);\n        callbacks.success(answer);\n      }\n    } catch (err) {\n      Janus.error(err);\n      callbacks.error(err);\n    }\n  }\n\n  function prepareWebrtcPeer(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : webrtcError;\n    callbacks.customizeSdp = typeof callbacks.customizeSdp == 'function' ? callbacks.customizeSdp : Janus.noop;\n    let jsep = callbacks.jsep;\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      callbacks.error('Invalid handle');\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (jsep) {\n      if (!config.pc) {\n        Janus.warn('Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep');\n        callbacks.error('No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep');\n        return;\n      }\n      callbacks.customizeSdp(jsep);\n      config.pc.setRemoteDescription(jsep).then(function () {\n        Janus.log('Remote description accepted!');\n        config.remoteSdp = jsep.sdp;\n        // Any trickle candidate we cached?\n        if (config.candidates && config.candidates.length > 0) {\n          for (let i = 0; i < config.candidates.length; i++) {\n            let candidate = config.candidates[i];\n            Janus.debug('Adding remote candidate:', candidate);\n            if (!candidate || candidate.completed === true) {\n              // end-of-candidates\n              config.pc.addIceCandidate(Janus.endOfCandidates);\n            } else {\n              // New candidate\n              config.pc.addIceCandidate(candidate);\n            }\n          }\n          config.candidates = [];\n        }\n        // Done\n        callbacks.success();\n      }, callbacks.error);\n    } else {\n      callbacks.error('Invalid JSEP');\n    }\n  }\n\n  async function createOffer(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.customizeSdp = typeof callbacks.customizeSdp == 'function' ? callbacks.customizeSdp : Janus.noop;\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      throw 'Invalid handle';\n    }\n    let config = pluginHandle.webrtcStuff;\n    Janus.log('Creating offer (iceDone=' + config.iceDone + ')');\n    // https://code.google.com/p/webrtc/issues/detail?id=3508\n    let mediaConstraints = {};\n    let iceRestart = callbacks.iceRestart === true;\n    // If we need an ICE restart, set the related constraint\n    if (iceRestart) mediaConstraints.iceRestart = true;\n    Janus.debug(mediaConstraints);\n    let offer = await config.pc.createOffer(mediaConstraints);\n    Janus.debug(offer);\n    // JSON.stringify doesn't work on some WebRTC objects anymore\n    // See https://code.google.com/p/chromium/issues/detail?id=467366\n    let jsep = {\n      type: 'offer',\n      sdp: offer.sdp,\n    };\n    callbacks.customizeSdp(jsep);\n    offer.sdp = jsep.sdp;\n    Janus.log('Setting local description');\n    config.mySdp = {\n      type: 'offer',\n      sdp: offer.sdp,\n    };\n    await config.pc.setLocalDescription(offer);\n    config.mediaConstraints = mediaConstraints;\n    if (!config.iceDone && !config.trickle) {\n      // FIXME Don't do anything until we have all candidates\n      Janus.log('Waiting for all candidates...');\n      return null;\n    }\n    // If transforms are present, notify Janus that the media is end-to-end encrypted\n    if (config.insertableStreams) offer.e2ee = true;\n    return offer;\n  }\n\n  async function createAnswer(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.customizeSdp = typeof callbacks.customizeSdp == 'function' ? callbacks.customizeSdp : Janus.noop;\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      throw 'Invalid handle';\n    }\n    let config = pluginHandle.webrtcStuff;\n    Janus.log('Creating answer (iceDone=' + config.iceDone + ')');\n    let answer = await config.pc.createAnswer();\n    Janus.debug(answer);\n    // JSON.stringify doesn't work on some WebRTC objects anymore\n    // See https://code.google.com/p/chromium/issues/detail?id=467366\n    let jsep = {\n      type: 'answer',\n      sdp: answer.sdp,\n    };\n    callbacks.customizeSdp(jsep);\n    answer.sdp = jsep.sdp;\n    Janus.log('Setting local description');\n    config.mySdp = {\n      type: 'answer',\n      sdp: answer.sdp,\n    };\n    await config.pc.setLocalDescription(answer);\n    if (!config.iceDone && !config.trickle) {\n      // FIXME Don't do anything until we have all candidates\n      Janus.log('Waiting for all candidates...');\n      return null;\n    }\n    // If transforms are present, notify Janus that the media is end-to-end encrypted\n    if (config.insertableStreams) answer.e2ee = true;\n    return answer;\n  }\n\n  function sendSDP(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle, not sending anything');\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    Janus.log('Sending offer/answer SDP...');\n    if (!config.mySdp) {\n      Janus.warn('Local SDP instance is invalid, not sending anything...');\n      return;\n    }\n    config.mySdp = {\n      type: config.pc.localDescription.type,\n      sdp: config.pc.localDescription.sdp,\n    };\n    if (config.trickle === false) config.mySdp['trickle'] = false;\n    Janus.debug(callbacks);\n    config.sdpSent = true;\n    callbacks.success(config.mySdp);\n  }\n\n  async function replaceTracks(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    // Check that callbacks.array is a valid array\n    if (callbacks.tracks && !Array.isArray(callbacks.tracks)) {\n      Janus.error('Tracks must be an array');\n      callbacks.error('Tracks must be an array');\n      return;\n    }\n    // Add the replace:true if it's missing\n    for (let track of callbacks.tracks) {\n      if (track.add || (!track.replace && !track.remove)) track.replace = true;\n    }\n    try {\n      await captureDevices(handleId, callbacks);\n      callbacks.success();\n    } catch (err) {\n      Janus.error(err);\n      callbacks.error(err);\n    }\n  }\n\n  async function captureDevices(handleId, callbacks) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle, not sending anything');\n      throw 'Invalid handle';\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) {\n      Janus.warn('Invalid PeerConnection');\n      throw 'Invalid PeerConnection';\n    }\n    let tracks = callbacks.tracks;\n    if (!tracks || !Array.isArray(tracks) || tracks.length === 0) {\n      // Nothing to do\n      return;\n    }\n    let openedConsentDialog = false;\n    // Check if we can/should group getUserMedia calls\n    let groups = {};\n    for (let track of tracks) {\n      delete track.gumGroup;\n      if (!track.type || !['audio', 'video'].includes(track.type)) continue;\n      if (!track.capture || track.capture instanceof MediaStreamTrack) continue;\n      let group = track.group ? track.group : 'default';\n      if (!groups[group]) groups[group] = {};\n      if (groups[group][track.type]) continue;\n      track.gumGroup = group;\n      groups[group][track.type] = track;\n    }\n    let keys = Object.keys(groups);\n    for (let key of keys) {\n      let group = groups[key];\n      if (!group.audio || !group.video) {\n        if (group.audio) delete group.audio.gumGroup;\n        if (group.video) delete group.video.gumGroup;\n        delete groups[key];\n      }\n    }\n    let answer = callbacks.jsep ? true : false;\n    for (let track of tracks) {\n      if (!track.type) {\n        Janus.warn('Missing track type:', track);\n        continue;\n      }\n      if (track.type === 'data') {\n        // Easy enough: create a datachannel if we don't have one already\n        if (config.pc.ondatachannel) {\n          Janus.warn('Data channel exists already, not creating another one');\n          continue;\n        }\n        Janus.log('Creating default data channel');\n        createDataChannel(handleId, Janus.dataChanDefaultLabel, null, false);\n        config.pc.ondatachannel = function (event) {\n          Janus.log('Data channel created by Janus:', event);\n          createDataChannel(handleId, event.channel.label, event.channel.protocol, event.channel);\n        };\n        continue;\n      }\n      if (\n        typeof track.add === 'undefined' &&\n        track.add === null &&\n        typeof track.remove === 'undefined' &&\n        track.remove === null &&\n        typeof track.replace === 'undefined' &&\n        track.replace === null\n      ) {\n        // Let's default to 'add'\n        track.add = true;\n      }\n      if ((track.add && track.remove) || (track.add && track.remove && track.replace)) {\n        Janus.warn('Conflicting actions for track, ignoring:', track);\n        continue;\n      }\n      if (track.add && track.replace) {\n        Janus.warn('Both add and replace provided, falling back to replace:', track);\n        delete track.add;\n      } else if (track.remove && track.replace) {\n        Janus.warn('Both remove and replace provided, falling back to remove:', track);\n        delete track.replace;\n      }\n      let kind = track.type;\n      if (track.type === 'screen') kind = 'video'; // FIXME\n      let transceiver = null,\n        sender = null;\n      if (track.mid) {\n        // Search by mid\n        transceiver = config.pc.getTransceivers().find((t) => t.mid === track.mid && t.receiver.track.kind === kind);\n      } else {\n        // Find the first track of this type\n        transceiver = config.pc.getTransceivers().find((t) => t.receiver.track.kind === kind);\n      }\n      if (track.replace || track.remove) {\n        if (!transceiver) {\n          Janus.warn(\"Couldn't find a transceiver for track:\", track);\n          continue;\n        }\n        if (!transceiver.sender) {\n          Janus.warn('No sender in the transceiver for track:', track);\n          continue;\n        }\n        sender = transceiver.sender;\n      }\n      if (answer && !transceiver) {\n        transceiver = config.pc.getTransceivers().find((t) => t.receiver.track.kind === kind);\n        if (!transceiver) {\n          Janus.warn(\"Couldn't find a transceiver for track:\", track);\n          continue;\n        }\n      }\n      // Capture the new track, if we need to\n      let nt = null,\n        trackId = null;\n      if (track.remove) {\n        Janus.log('Removing track from PeerConnection', track);\n        trackId = sender.track ? sender.track.id : null;\n        await sender.replaceTrack(null);\n      } else if (track.capture) {\n        if (track.gumGroup && groups[track.gumGroup] && groups[track.gumGroup].stream) {\n          // We did a getUserMedia before already\n          let stream = groups[track.gumGroup].stream;\n          nt = track.type === 'audio' ? stream.getAudioTracks()[0] : stream.getVideoTracks()[0];\n          delete groups[track.gumGroup].stream;\n          delete groups[track.gumGroup];\n          delete track.gumGroup;\n        } else if (track.capture instanceof MediaStreamTrack) {\n          // An external track was provided, use that\n          nt = track.capture;\n        } else {\n          if (!openedConsentDialog) {\n            openedConsentDialog = true;\n            pluginHandle.consentDialog(true);\n          }\n          let constraints = Janus.trackConstraints(track),\n            stream = null;\n          if (track.type === 'audio' || track.type === 'video') {\n            // Use getUserMedia: check if we need to group audio and video together\n            if (track.gumGroup) {\n              let otherType = track.type === 'audio' ? 'video' : 'audio';\n              if (groups[track.gumGroup] && groups[track.gumGroup][otherType]) {\n                let otherTrack = groups[track.gumGroup][otherType];\n                let otherConstraints = Janus.trackConstraints(otherTrack);\n                constraints[otherType] = otherConstraints[otherType];\n              }\n            }\n            stream = await navigator.mediaDevices.getUserMedia(constraints);\n            if (track.gumGroup && constraints.audio && constraints.video) {\n              // We just performed a grouped getUserMedia, keep track of the\n              // stream so that we can immediately assign the track later\n              groups[track.gumGroup].stream = stream;\n              delete track.gumGroup;\n            }\n          } else {\n            // Use getDisplayMedia\n            stream = await navigator.mediaDevices.getDisplayMedia(constraints);\n          }\n          nt = track.type === 'audio' ? stream.getAudioTracks()[0] : stream.getVideoTracks()[0];\n        }\n        if (track.replace) {\n          // Replace the track\n          await sender.replaceTrack(nt);\n          // Update the transceiver direction\n          let newDirection = 'sendrecv';\n          if (track.recv === false || transceiver.direction === 'inactive' || transceiver.direction === 'sendonly')\n            newDirection = 'sendonly';\n          if (transceiver.setDirection) transceiver.setDirection(newDirection);\n          else transceiver.direction = newDirection;\n        } else {\n          // FIXME Add as a new track\n          if (!config.myStream) config.myStream = new MediaStream();\n          if (kind === 'audio' || (!track.simulcast && !track.svc)) {\n            sender = config.pc.addTrack(nt, config.myStream);\n            transceiver = config.pc.getTransceivers().find((t) => t.sender === sender);\n          } else if (track.simulcast) {\n            if (Janus.webRTCAdapter.browserDetails.browser !== 'firefox') {\n              // Standard RID\n              Janus.log('Enabling rid-based simulcasting:', nt);\n              let maxBitrates = getMaxBitrates(track.simulcastMaxBitrates);\n              transceiver = config.pc.addTransceiver(nt, {\n                direction: 'sendrecv',\n                streams: [config.myStream],\n                sendEncodings: track.sendEncodings || [\n                  { rid: 'h', active: true, maxBitrate: maxBitrates.high },\n                  {\n                    rid: 'm',\n                    active: true,\n                    maxBitrate: maxBitrates.medium,\n                    scaleResolutionDownBy: 2,\n                  },\n                  {\n                    rid: 'l',\n                    active: true,\n                    maxBitrate: maxBitrates.low,\n                    scaleResolutionDownBy: 4,\n                  },\n                ],\n              });\n            } else {\n              // Firefox-based RID, based on https://gist.github.com/voluntas/088bc3cc62094730647b\n              Janus.log('Enabling Simulcasting for Firefox (RID)');\n              transceiver = config.pc.addTransceiver(nt, {\n                direction: 'sendrecv',\n                streams: [config.myStream],\n              });\n              sender = transceiver ? transceiver.sender : null;\n              if (sender) {\n                let parameters = sender.getParameters();\n                if (!parameters) parameters = {};\n                let maxBitrates = getMaxBitrates(track.simulcastMaxBitrates);\n                parameters.encodings = track.sendEncodings || [\n                  { rid: 'h', active: true, maxBitrate: maxBitrates.high },\n                  {\n                    rid: 'm',\n                    active: true,\n                    maxBitrate: maxBitrates.medium,\n                    scaleResolutionDownBy: 2,\n                  },\n                  {\n                    rid: 'l',\n                    active: true,\n                    maxBitrate: maxBitrates.low,\n                    scaleResolutionDownBy: 4,\n                  },\n                ];\n                sender.setParameters(parameters);\n              }\n            }\n          } else {\n            Janus.log('Enabling SVC (' + track.svc + '):', nt);\n            transceiver = config.pc.addTransceiver(nt, {\n              direction: 'sendrecv',\n              streams: [config.myStream],\n              sendEncodings: [{ scalabilityMode: track.svc }],\n            });\n          }\n          if (!sender) sender = transceiver ? transceiver.sender : null;\n          // Check if we need to override some settings\n          if (track.codec) {\n            if (Janus.webRTCAdapter.browserDetails.browser === 'firefox') {\n              Janus.warn('setCodecPreferences not supported in Firefox, ignoring codec for track:', track);\n            } else if (typeof track.codec !== 'string') {\n              Janus.warn('Invalid codec value, ignoring for track:', track);\n            } else {\n              let mimeType = kind + '/' + track.codec.toLowerCase();\n              let codecs = RTCRtpReceiver.getCapabilities(kind).codecs.filter(function (codec) {\n                return codec.mimeType.toLowerCase() === mimeType;\n              });\n              if (!codecs || codecs.length === 0) {\n                Janus.warn('Codec not supported in this browser for this track, ignoring:', track);\n              } else if (transceiver) {\n                try {\n                  transceiver.setCodecPreferences(codecs);\n                } catch (err) {\n                  Janus.warn('Failed enforcing codec for this ' + kind + ' track:', err);\n                }\n              }\n            }\n          }\n          if (track.bitrate) {\n            // Override maximum bitrate\n            if (track.simulcast || track.svc) {\n              Janus.warn('Ignoring bitrate for simulcast/SVC track, use sendEncodings for that');\n            } else if (isNaN(track.bitrate) || track.bitrate < 0) {\n              Janus.warn('Ignoring invalid bitrate for track:', track);\n            } else if (sender) {\n              let params = sender.getParameters();\n              if (!params || !params.encodings || params.encodings.length === 0) {\n                Janus.warn('No encodings in the sender parameters, ignoring bitrate for track:', track);\n              } else {\n                params.encodings[0].maxBitrate = track.bitrate;\n                await sender.setParameters(params);\n              }\n            }\n          }\n          if (kind === 'video' && track.framerate) {\n            // Override maximum framerate\n            if (track.simulcast || track.svc) {\n              Janus.warn('Ignoring framerate for simulcast/SVC track, use sendEncodings for that');\n            } else if (isNaN(track.framerate) || track.framerate < 0) {\n              Janus.warn('Ignoring invalid framerate for track:', track);\n            } else if (sender) {\n              let params = sender.getParameters();\n              if (!params || !params.encodings || params.encodings.length === 0) {\n                Janus.warn('No encodings in the sender parameters, ignoring framerate for track:', track);\n              } else {\n                params.encodings[0].maxFramerate = track.framerate;\n                await sender.setParameters(params);\n              }\n            }\n          }\n          // Check if insertable streams are involved\n          if (track.transforms) {\n            if (sender && track.transforms.sender) {\n              // There's a sender transform, set it on the transceiver sender\n              let senderStreams = null;\n              if (RTCRtpSender.prototype.createEncodedStreams) {\n                senderStreams = sender.createEncodedStreams();\n              } else if (\n                RTCRtpSender.prototype.createAudioEncodedStreams ||\n                RTCRtpSender.prototype.createEncodedVideoStreams\n              ) {\n                if (kind === 'audio') {\n                  senderStreams = sender.createEncodedAudioStreams();\n                } else if (kind === 'video') {\n                  senderStreams = sender.createEncodedVideoStreams();\n                }\n              }\n              if (senderStreams) {\n                Janus.log('Insertable Streams sender transform:', senderStreams);\n                if (senderStreams.readableStream && senderStreams.writableStream) {\n                  senderStreams.readableStream\n                    .pipeThrough(track.transforms.sender)\n                    .pipeTo(senderStreams.writableStream);\n                } else if (senderStreams.readable && senderStreams.writable) {\n                  senderStreams.readable.pipeThrough(track.transforms.sender).pipeTo(senderStreams.writable);\n                }\n              }\n            }\n            if (transceiver && transceiver.receiver && track.transforms.receiver) {\n              // There's a receiver transform, set it on the transceiver receiver\n              let receiverStreams = null;\n              if (RTCRtpReceiver.prototype.createEncodedStreams) {\n                receiverStreams = transceiver.receiver.createEncodedStreams();\n              } else if (\n                RTCRtpReceiver.prototype.createAudioEncodedStreams ||\n                RTCRtpReceiver.prototype.createEncodedVideoStreams\n              ) {\n                if (kind === 'audio') {\n                  receiverStreams = transceiver.receiver.createEncodedAudioStreams();\n                } else if (kind === 'video') {\n                  receiverStreams = transceiver.receiver.createEncodedVideoStreams();\n                }\n              }\n              if (receiverStreams) {\n                Janus.log('Insertable Streams receiver transform:', receiverStreams);\n                if (receiverStreams.readableStream && receiverStreams.writableStream) {\n                  receiverStreams.readableStream\n                    .pipeThrough(track.transforms.receiver)\n                    .pipeTo(receiverStreams.writableStream);\n                } else if (receiverStreams.readable && receiverStreams.writable) {\n                  receiverStreams.readable.pipeThrough(track.transforms.receiver).pipeTo(receiverStreams.writable);\n                }\n              }\n            }\n          }\n        }\n        if (nt && track.dontStop === true) nt.dontStop = true;\n      } else if (track.recv && !transceiver) {\n        // Maybe a new recvonly track\n        transceiver = config.pc.addTransceiver(kind);\n        if (transceiver) {\n          // Check if we need to override some settings\n          if (track.codec) {\n            if (Janus.webRTCAdapter.browserDetails.browser === 'firefox') {\n              Janus.warn('setCodecPreferences not supported in Firefox, ignoring codec for track:', track);\n            } else if (typeof track.codec !== 'string') {\n              Janus.warn('Invalid codec value, ignoring for track:', track);\n            } else {\n              let mimeType = kind + '/' + track.codec.toLowerCase();\n              let codecs = RTCRtpReceiver.getCapabilities(kind).codecs.filter(function (codec) {\n                return codec.mimeType.toLowerCase() === mimeType;\n              });\n              if (!codecs || codecs.length === 0) {\n                Janus.warn('Codec not supported in this browser for this track, ignoring:', track);\n              } else {\n                try {\n                  transceiver.setCodecPreferences(codecs);\n                } catch (err) {\n                  Janus.warn('Failed enforcing codec for this ' + kind + ' track:', err);\n                }\n              }\n            }\n          }\n          // Check if insertable streams are involved\n          if (transceiver.receiver && track.transforms && track.transforms.receiver) {\n            // There's a receiver transform, set it on the transceiver receiver\n            let receiverStreams = null;\n            if (RTCRtpReceiver.prototype.createEncodedStreams) {\n              receiverStreams = transceiver.receiver.createEncodedStreams();\n            } else if (\n              RTCRtpReceiver.prototype.createAudioEncodedStreams ||\n              RTCRtpReceiver.prototype.createEncodedVideoStreams\n            ) {\n              if (kind === 'audio') {\n                receiverStreams = transceiver.receiver.createEncodedAudioStreams();\n              } else if (kind === 'video') {\n                receiverStreams = transceiver.receiver.createEncodedVideoStreams();\n              }\n            }\n            if (receiverStreams) {\n              Janus.log('Insertable Streams receiver transform:', receiverStreams);\n              if (receiverStreams.readableStream && receiverStreams.writableStream) {\n                receiverStreams.readableStream\n                  .pipeThrough(track.transforms.receiver)\n                  .pipeTo(receiverStreams.writableStream);\n              } else if (receiverStreams.readable && receiverStreams.writable) {\n                receiverStreams.readable.pipeThrough(track.transforms.receiver).pipeTo(receiverStreams.writable);\n              }\n            }\n          }\n        }\n      }\n      // Get rid of the old track\n      // FIXME We should probably do this *before* capturing the new\n      // track, since this prevents, for instance, just changing the\n      // resolution of the same webcam we're capturing already (the\n      // existing resolution would be returned, or an overconstrained\n      // error). On the other end, closing the track before we capture\n      // the new device means we'd end up with a period of time where\n      // no video is sent (changing device takes some time), and\n      // media would be stopped entirely in case capturing the new\n      // device results in an error. To keep things simpler, we're\n      // doing it after: we can make this configurable in the future.\n      if (trackId && config.myStream) {\n        let rt = null;\n        if (kind === 'audio' && config.myStream.getAudioTracks() && config.myStream.getAudioTracks().length) {\n          for (let t of config.myStream.getAudioTracks()) {\n            if (t.id === trackId) {\n              rt = t;\n              Janus.log('Removing audio track:', rt);\n            }\n          }\n        } else if (kind === 'video' && config.myStream.getVideoTracks() && config.myStream.getVideoTracks().length) {\n          for (let t of config.myStream.getVideoTracks()) {\n            if (t.id === trackId) {\n              rt = t;\n              Janus.log('Removing video track:', rt);\n            }\n          }\n        }\n        if (rt) {\n          // Remove the track and notify the application\n          try {\n            config.myStream.removeTrack(rt);\n            pluginHandle.onlocaltrack(rt, false);\n          } catch (e) {\n            Janus.error('Error calling onlocaltrack on removal for renegotiation', e);\n          }\n          // Close the old track (unless we've been asked not to)\n          if (rt.dontStop !== true) {\n            try {\n              rt.stop();\n            } catch (e) { }\n          }\n        }\n      }\n      if (nt) {\n        // FIXME Add the new track locally\n        config.myStream.addTrack(nt);\n        // Notify the application about the new local track, if any\n        nt.onended = function (ev) {\n          Janus.log('Local track removed:', ev);\n          try {\n            pluginHandle.onlocaltrack(ev.target, false);\n          } catch (e) {\n            Janus.error('Error calling onlocaltrack following end', e);\n          }\n        };\n        try {\n          pluginHandle.onlocaltrack(nt, true);\n        } catch (e) {\n          Janus.error('Error calling onlocaltrack for track add', e);\n        }\n      }\n      // Update the direction of the transceiver\n      if (transceiver) {\n        let curdir = transceiver.direction,\n          newdir = null;\n        let send = nt && transceiver.sender.track,\n          recv = track.recv !== false && transceiver.receiver.track;\n        if (send && recv) newdir = 'sendrecv';\n        else if (send && !recv) newdir = 'sendonly';\n        else if (!send && recv) newdir = 'recvonly';\n        else if (!send && !recv) newdir = 'inactive';\n        if (newdir && newdir !== curdir) {\n          Janus.warn('Changing direction of transceiver to ' + newdir + ' (was ' + curdir + ')', track);\n          if (transceiver.setDirection) transceiver.setDirection(newdir);\n          else transceiver.direction = newdir;\n        }\n      }\n    }\n    if (openedConsentDialog) pluginHandle.consentDialog(false);\n  }\n\n  function getLocalTracks(handleId) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return null;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) {\n      Janus.warn('Invalid PeerConnection');\n      return null;\n    }\n    let tracks = [];\n    let transceivers = config.pc.getTransceivers();\n    for (let tr of transceivers) {\n      let track = null;\n      if (tr.sender && tr.sender.track) {\n        track = { mid: tr.mid };\n        track.type = tr.sender.track.kind;\n        track.id = tr.sender.track.id;\n        track.label = tr.sender.track.label;\n      }\n      if (track) tracks.push(track);\n    }\n    return tracks;\n  }\n\n  function getRemoteTracks(handleId) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return null;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) {\n      Janus.warn('Invalid PeerConnection');\n      return null;\n    }\n    let tracks = [];\n    let transceivers = config.pc.getTransceivers();\n    for (let tr of transceivers) {\n      let track = null;\n      if (tr.receiver && tr.receiver.track) {\n        track = { mid: tr.mid };\n        track.type = tr.receiver.track.kind;\n        track.id = tr.receiver.track.id;\n        track.label = tr.receiver.track.label;\n      }\n      if (track) tracks.push(track);\n    }\n    return tracks;\n  }\n\n  function getVolume(handleId, mid, remote, result) {\n    result = typeof result == 'function' ? result : Janus.noop;\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      result(0);\n      return;\n    }\n    let stream = remote ? 'remote' : 'local';\n    let config = pluginHandle.webrtcStuff;\n    if (!config.volume[stream]) config.volume[stream] = { value: 0 };\n    // Start getting the volume, if audioLevel in getStats is supported (apparently\n    // they're only available in Chrome/Safari right now: https://webrtc-stats.callstats.io/)\n    if (\n      config.pc &&\n      config.pc.getStats &&\n      (Janus.webRTCAdapter.browserDetails.browser === 'chrome' ||\n        Janus.webRTCAdapter.browserDetails.browser === 'safari')\n    ) {\n      // Are we interested in a mid in particular?\n      let query = config.pc;\n      if (mid) {\n        let transceiver = config.pc.getTransceivers().find((t) => t.mid === mid && t.receiver.track.kind === 'audio');\n        if (!transceiver) {\n          Janus.warn('No audio transceiver with mid ' + mid);\n          result(0);\n          return;\n        }\n        if (remote && !transceiver.receiver) {\n          Janus.warn('Remote transceiver track unavailable');\n          result(0);\n          return;\n        } else if (!remote && !transceiver.sender) {\n          Janus.warn('Local transceiver track unavailable');\n          result(0);\n          return;\n        }\n        query = remote ? transceiver.receiver : transceiver.sender;\n      }\n      query.getStats().then(function (stats) {\n        stats.forEach(function (res) {\n          if (!res || res.kind !== 'audio') return;\n          if ((remote && !res.remoteSource) || (!remote && res.type !== 'media-source')) return;\n          result(res.audioLevel ? res.audioLevel : 0);\n        });\n      });\n      return config.volume[stream].value;\n    } else {\n      // audioInputLevel and audioOutputLevel seem only available in Chrome? audioLevel\n      // seems to be available on Chrome and Firefox, but they don't seem to work\n      Janus.warn('Getting the ' + stream + ' volume unsupported by browser');\n      result(0);\n      return;\n    }\n  }\n\n  function isMuted(handleId, mid, video) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return true;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) {\n      Janus.warn('Invalid PeerConnection');\n      return true;\n    }\n    if (!config.myStream) {\n      Janus.warn('Invalid local MediaStream');\n      return true;\n    }\n    if (video) {\n      // Check video track\n      if (!config.myStream.getVideoTracks() || config.myStream.getVideoTracks().length === 0) {\n        Janus.warn('No video track');\n        return true;\n      }\n      if (mid) {\n        let transceiver = config.pc.getTransceivers().find((t) => t.mid === mid && t.receiver.track.kind === 'video');\n        if (!transceiver) {\n          Janus.warn('No video transceiver with mid ' + mid);\n          return true;\n        }\n        if (!transceiver.sender || !transceiver.sender.track) {\n          Janus.warn('No video sender with mid ' + mid);\n          return true;\n        }\n        return !transceiver.sender.track.enabled;\n      } else {\n        return !config.myStream.getVideoTracks()[0].enabled;\n      }\n    } else {\n      // Check audio track\n      if (!config.myStream.getAudioTracks() || config.myStream.getAudioTracks().length === 0) {\n        Janus.warn('No audio track');\n        return true;\n      }\n      if (mid) {\n        let transceiver = config.pc.getTransceivers().find((t) => t.mid === mid && t.receiver.track.kind === 'audio');\n        if (!transceiver) {\n          Janus.warn('No audio transceiver with mid ' + mid);\n          return true;\n        }\n        if (!transceiver.sender || !transceiver.sender.track) {\n          Janus.warn('No audio sender with mid ' + mid);\n          return true;\n        }\n        return !transceiver.sender.track.enabled;\n      } else {\n        return !config.myStream.getAudioTracks()[0].enabled;\n      }\n    }\n  }\n\n  function mute(handleId, mid, video, mute) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return false;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) {\n      Janus.warn('Invalid PeerConnection');\n      return false;\n    }\n    if (!config.myStream) {\n      Janus.warn('Invalid local MediaStream');\n      return false;\n    }\n    if (video) {\n      // Mute/unmute video track\n      if (!config.myStream.getVideoTracks() || config.myStream.getVideoTracks().length === 0) {\n        Janus.warn('No video track');\n        return false;\n      }\n      if (mid) {\n        let transceiver = config.pc.getTransceivers().find((t) => t.mid === mid && t.receiver.track.kind === 'video');\n        if (!transceiver) {\n          Janus.warn('No video transceiver with mid ' + mid);\n          return false;\n        }\n        if (!transceiver.sender || !transceiver.sender.track) {\n          Janus.warn('No video sender with mid ' + mid);\n          return false;\n        }\n        transceiver.sender.track.enabled = mute ? false : true;\n      } else {\n        for (const videostream of config.myStream.getVideoTracks()) {\n          videostream.enabled = !mute;\n        }\n      }\n    } else {\n      // Mute/unmute audio track\n      if (!config.myStream.getAudioTracks() || config.myStream.getAudioTracks().length === 0) {\n        Janus.warn('No audio track');\n        return false;\n      }\n      if (mid) {\n        let transceiver = config.pc.getTransceivers().find((t) => t.mid === mid && t.receiver.track.kind === 'audio');\n        if (!transceiver) {\n          Janus.warn('No audio transceiver with mid ' + mid);\n          return false;\n        }\n        if (!transceiver.sender || !transceiver.sender.track) {\n          Janus.warn('No audio sender with mid ' + mid);\n          return false;\n        }\n        transceiver.sender.track.enabled = mute ? false : true;\n      } else {\n        for (const audiostream of config.myStream.getAudioTracks()) {\n          audiostream.enabled = !mute;\n        }\n      }\n    }\n    return true;\n  }\n\n  function getBitrate(handleId, mid) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return 'Invalid handle';\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) return 'Invalid PeerConnection';\n    // Start getting the bitrate, if getStats is supported\n    if (config.pc.getStats) {\n      let query = config.pc;\n      let target = mid ? mid : 'default';\n      if (mid) {\n        let transceiver = config.pc.getTransceivers().find((t) => t.mid === mid && t.receiver.track.kind === 'video');\n        if (!transceiver) {\n          Janus.warn('No video transceiver with mid ' + mid);\n          return 'No video transceiver with mid ' + mid;\n        }\n        if (!transceiver.receiver) {\n          Janus.warn('No video receiver with mid ' + mid);\n          return 'No video receiver with mid ' + mid;\n        }\n        query = transceiver.receiver;\n      }\n      if (!config.bitrate[target]) {\n        config.bitrate[target] = {\n          timer: null,\n          bsnow: null,\n          bsbefore: null,\n          tsnow: null,\n          tsbefore: null,\n          value: '0 kbits/sec',\n        };\n      }\n      if (!config.bitrate[target].timer) {\n        Janus.log('Starting bitrate timer' + (mid ? ' for mid ' + mid : '') + ' (via getStats)');\n        config.bitrate[target].timer = setInterval(function () {\n          query.getStats().then(function (stats) {\n            stats.forEach(function (res) {\n              if (!res) return;\n              let inStats = false;\n              // Check if these are statistics on incoming media\n              if (\n                (res.mediaType === 'video' || res.id.toLowerCase().indexOf('video') > -1) &&\n                res.type === 'inbound-rtp' &&\n                res.id.indexOf('rtcp') < 0\n              ) {\n                // New stats\n                inStats = true;\n              } else if (\n                res.type == 'ssrc' &&\n                res.bytesReceived &&\n                (res.googCodecName === 'VP8' || res.googCodecName === '')\n              ) {\n                // Older Chromer versions\n                inStats = true;\n              }\n              // Parse stats now\n              if (inStats) {\n                config.bitrate[target].bsnow = res.bytesReceived;\n                config.bitrate[target].tsnow = res.timestamp;\n                if (config.bitrate[target].bsbefore === null || config.bitrate[target].tsbefore === null) {\n                  // Skip this round\n                  config.bitrate[target].bsbefore = config.bitrate[target].bsnow;\n                  config.bitrate[target].tsbefore = config.bitrate[target].tsnow;\n                } else {\n                  // Calculate bitrate\n                  let timePassed = config.bitrate[target].tsnow - config.bitrate[target].tsbefore;\n                  if (Janus.webRTCAdapter.browserDetails.browser === 'safari') timePassed = timePassed / 1000; // Apparently the timestamp is in microseconds, in Safari\n                  let bitRate = Math.round(\n                    ((config.bitrate[target].bsnow - config.bitrate[target].bsbefore) * 8) / timePassed\n                  );\n                  if (Janus.webRTCAdapter.browserDetails.browser === 'safari') bitRate = parseInt(bitRate / 1000);\n                  config.bitrate[target].value = bitRate + ' kbits/sec';\n                  //~ Janus.log(\"Estimated bitrate is \" + config.bitrate.value);\n                  config.bitrate[target].bsbefore = config.bitrate[target].bsnow;\n                  config.bitrate[target].tsbefore = config.bitrate[target].tsnow;\n                }\n              }\n            });\n          });\n        }, 1000);\n        return '0 kbits/sec'; // We don't have a bitrate value yet\n      }\n      return config.bitrate[target].value;\n    } else {\n      Janus.warn('Getting the video bitrate unsupported by browser');\n      return 'Feature unsupported by browser';\n    }\n  }\n\n  function setBitrate(handleId, mid, bitrate) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) {\n      Janus.warn('Invalid PeerConnection');\n      return;\n    }\n    let transceiver = config.pc.getTransceivers().find((t) => t.mid === mid);\n    if (!transceiver) {\n      Janus.warn('No transceiver with mid', mid);\n      return;\n    }\n    if (!transceiver.sender) {\n      Janus.warn('No sender for transceiver with mid', mid);\n      return;\n    }\n    let params = transceiver.sender.getParameters();\n    if (!params || !params.encodings || params.encodings.length === 0) {\n      Janus.warn('No parameters encodings');\n    } else if (params.encodings.length > 1) {\n      Janus.warn('Ignoring bitrate for simulcast track, use sendEncodings for that');\n    } else if (isNaN(bitrate) || bitrate < 0) {\n      Janus.warn('Invalid bitrate (must be a positive integer)');\n    } else {\n      params.encodings[0].maxBitrate = bitrate;\n      transceiver.sender.setParameters(params);\n    }\n  }\n\n  function webrtcError(error) {\n    Janus.error('WebRTC error:', error);\n  }\n\n  function cleanupWebrtc(handleId, hangupRequest) {\n    Janus.log('Cleaning WebRTC stuff');\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle) {\n      // Nothing to clean\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (config) {\n      if (hangupRequest === true) {\n        // Send a hangup request (we don't really care about the response)\n        let request = { janus: 'hangup', transaction: Janus.randomString(12) };\n        if (pluginHandle.token) request['token'] = pluginHandle.token;\n        if (apisecret) request['apisecret'] = apisecret;\n        Janus.debug('Sending hangup request (handle=' + handleId + '):');\n        Janus.debug(request);\n        if (websockets) {\n          request['session_id'] = sessionId;\n          request['handle_id'] = handleId;\n          ws.send(JSON.stringify(request));\n        } else {\n          Janus.httpAPICall(server + '/' + sessionId + '/' + handleId, {\n            verb: 'POST',\n            withCredentials: withCredentials,\n            body: request,\n          });\n        }\n      }\n      // Cleanup stack\n      if (config.volume) {\n        if (config.volume['local'] && config.volume['local'].timer) clearInterval(config.volume['local'].timer);\n        if (config.volume['remote'] && config.volume['remote'].timer) clearInterval(config.volume['remote'].timer);\n      }\n      for (let i in config.bitrate) {\n        if (config.bitrate[i].timer) clearInterval(config.bitrate[i].timer);\n      }\n      config.bitrate = {};\n      if (!config.streamExternal && config.myStream) {\n        Janus.log('Stopping local stream tracks');\n        Janus.stopAllTracks(config.myStream);\n      }\n      config.streamExternal = false;\n      config.myStream = null;\n      // Close PeerConnection\n      try {\n        config.pc.close();\n      } catch (e) {\n        // Do nothing\n      }\n      config.pc = null;\n      config.candidates = null;\n      config.mySdp = null;\n      config.remoteSdp = null;\n      config.iceDone = false;\n      config.dataChannel = {};\n      config.dtmfSender = null;\n      config.insertableStreams = false;\n    }\n    pluginHandle.oncleanup();\n  }\n\n  function isTrickleEnabled(trickle) {\n    Janus.debug('isTrickleEnabled:', trickle);\n    return trickle === false ? false : true;\n  }\n}\n\nmodule.exports = Janus;\n","import EventEmitter from 'eventemitter3';\nimport { adapter, MediaStream } from '../platform';\nimport config from '../config';\nimport JanusEngine from './janus';\nimport Utils from '../Utils';\nimport { Config, Janus } from '../types';\nimport { JanusDebugMode } from '../types/config';\nimport { JanusEvent, JanusMediaTrackReason } from '../types/janus';\n\nexport default class JanusClient {\n  public token: Config.Credentials['token'];\n  public server: Config.Conference['server'];\n  public debug: Config.JanusDebug;\n  public engine: JanusEngine;\n  public videoRoomPlugin: any = null;\n  public isOnlyAudio: boolean = false;\n  public currentRoomId: string | null = null;\n  public currentUserId: number | string | null = null;\n  public remoteFeeds: { [userId: number | string]: any } = {};\n  public remoteJseps: { [userId: number | string]: any } = {};\n  public remoteFeedsAttachingInProgress: { [userId: number | string]: any } = {};\n  public bitrateTimers: { [userId: number | string]: NodeJS.Timeout | null } = {};\n  public emitter: EventEmitter = new EventEmitter();\n\n  constructor(token: Config.Credentials['token']) {\n    if (!Utils.env.isReactNative && !adapter) {\n      throw 'Error: in order to use this library please connect adapter.js. More info https://github.com/webrtc/adapter';\n    }\n\n    this.token = token;\n    this.server = config.conference.server;\n    this.debug = config.conference.debug ?? JanusDebugMode.ALL;\n\n    if (!this.server) {\n      throw \"'server' parameter is mandatory\";\n    } else if (this.server.includes('http')) {\n      this.server += '/janus';\n    }\n  }\n\n  public createSession({\n    success = () => {},\n    error = () => {},\n    destroyed = () => {},\n    timeoutSessionCallback = () => {},\n  }: Janus.InitCallbacks): void {\n    JanusEngine.init({\n      debug: this.debug,\n      callback: () => {\n        if (!JanusEngine.isWebrtcSupported()) {\n          Utils.safeCallbackCall(error)(`Your browser does not support WebRTC, so you can't use this functionality.`);\n          return;\n        }\n\n        this.engine = new JanusEngine({\n          server: this.server,\n          iceServers: config.videochat.iceServers,\n          token: this.token,\n          success: () => Utils.safeCallbackCall(success)(),\n          error: (err) => Utils.safeCallbackCall(error)(err),\n          destroyed: () => Utils.safeCallbackCall(destroyed)(),\n          timeoutSessionCallback: () => Utils.safeCallbackCall(timeoutSessionCallback)(),\n        });\n      },\n    });\n  }\n\n  public getSessionId(): string | null {\n    return this.engine?.getSessionId() ?? null;\n  }\n\n  public destroySession({ success = () => {}, error = () => {} }: Janus.SuccessErrorCallbacks): void {\n    this.engine.destroy({\n      success: () => Utils.safeCallbackCall(success)(),\n      error: (err) => Utils.safeCallbackCall(error)(err),\n    });\n  }\n\n  public attachVideoConferencingPlugin(\n    isRemote: boolean,\n    userId: number,\n    skipMedia: boolean,\n    callbacks: Janus.PluginCallbacks\n  ): void {\n    let remoteFeed: any = null;\n\n    const localStream = callbacks.localStream;\n    delete callbacks.localStream;\n\n    const displayName = callbacks.displayName;\n    delete callbacks.displayName;\n\n    this.engine.attach({\n      plugin: 'janus.plugin.videoroom',\n      success: (pluginHandle) => {\n        if (isRemote) {\n          remoteFeed = pluginHandle;\n          remoteFeed.userId = userId;\n          this.remoteFeedsAttachingInProgress[userId] = remoteFeed;\n\n          const listen = {\n            request: 'join',\n            room: this.currentRoomId,\n            ptype: 'listener',\n            feed: userId,\n            display: displayName,\n          };\n\n          remoteFeed?.send({ message: listen });\n        } else {\n          this.videoRoomPlugin = pluginHandle;\n        }\n\n        Utils.safeCallbackCall(callbacks.success)();\n      },\n      error: (error) => {\n        Utils.safeCallbackCall(callbacks.error)(error);\n      },\n      consentDialog: (on) => {\n        Utils.safeCallbackCall(callbacks.consentDialog)(on);\n      },\n      mediaState: (medium, on) => {\n        Utils.safeCallbackCall(callbacks.mediaState)(medium, on);\n      },\n      webrtcState: (on) => {\n        Utils.safeCallbackCall(callbacks.webrtcState)(on);\n      },\n      slowLink: (uplink, nacks) => {\n        Utils.safeCallbackCall(callbacks.slowLink)(uplink, nacks);\n      },\n      iceState: (iceConnectionState) => {\n        Utils.safeCallbackCall(callbacks.iceState)(iceConnectionState);\n      },\n      onmessage: (msg, jsep) => {\n        const event = msg['videoroom'];\n\n        if (isRemote) {\n          if (event) {\n            // Remote feed attached\n            if (event === 'attached') {\n              const feedId = msg['id'];\n              this.remoteFeeds[feedId] = this.remoteFeedsAttachingInProgress[feedId];\n              this.remoteFeedsAttachingInProgress[feedId] = null;\n            } else if (msg['error']) {\n              Utils.safeCallbackCall(callbacks.error)(msg['error']);\n            }\n          }\n\n          if (jsep) {\n            const feedId = msg['id'];\n\n            // ICE restart case\n            if (!feedId) {\n            }\n\n            this.remoteJseps[feedId] = jsep;\n\n            this.createAnswer(\n              {\n                remoteFeed: this.remoteFeeds[feedId],\n                jsep,\n              },\n              localStream as MediaStream,\n              {\n                success: () => {},\n                error: (error) => {\n                  Utils.safeCallbackCall(callbacks.error)(error);\n                },\n              }\n            );\n          }\n\n          // local feed\n        } else {\n          if (event) {\n            // We JOINED\n            if (event === 'joined') {\n              const media = skipMedia ? { audio: false, video: false } : { audio: true, video: true };\n              const existedStream = skipMedia ? undefined : localStream;\n              const offerParams = { media, stream: existedStream };\n              this.createOffer(offerParams, {\n                success: () => {\n                  if (msg['publishers']) {\n                    const publishers = msg['publishers'];\n                    for (const f in publishers) {\n                      const userId = publishers[f]['id'];\n                      const userDisplayName = publishers[f]['display'];\n                      this.emitter.emit(JanusEvent.PARTICIPANT_JOINED, userId, userDisplayName, true);\n                    }\n                  }\n                },\n                error: (error) => {\n                  Utils.safeCallbackCall(callbacks.error)(error);\n                },\n              });\n\n              // We JOINED and now receiving who is online\n            } else if (event === 'event') {\n              // Any new feed to attach to?\n              if (msg['publishers']) {\n                const publishers = msg['publishers'];\n\n                for (const f in publishers) {\n                  const userId = publishers[f]['id'];\n                  const userDisplayName = publishers[f]['display'];\n\n                  this.emitter.emit(JanusEvent.PARTICIPANT_JOINED, userId, userDisplayName, false);\n                }\n\n                // Someone is LEAVING\n              } else if (msg['leaving']) {\n                // One of the publishers has gone away?\n                const feedId = msg['leaving'];\n                const success = this.detachRemoteFeed(feedId);\n                if (success) {\n                  this.emitter.emit(JanusEvent.PARTICIPANT_LEFT, feedId, null);\n                }\n              } else if (msg['unpublished']) {\n                // One of the publishers has gone away?\n                const feedId = msg['unpublished'];\n                if (feedId != 'ok') {\n                  const success = this.detachRemoteFeed(feedId);\n                  if (success) {\n                    this.emitter.emit(JanusEvent.PARTICIPANT_LEFT, feedId, null);\n                  }\n                }\n              } else if (msg['error']) {\n                Utils.DLog('[janus error message]', msg['error']);\n                // #define VIDEOROOM_ERROR_ID_EXISTS\t\t\t436\n                // #define VIDEOROOM_ERROR_UNAUTHORIZED\t\t433\n                //\n                this.emitter.emit(JanusEvent.ERROR, msg);\n                Utils.safeCallbackCall(callbacks.error)(msg['error']);\n              }\n            }\n          }\n\n          if (jsep) {\n            this.videoRoomPlugin.handleRemoteJsep({ jsep: jsep });\n\n            // TODO:\n            // handle wrong or unsupported codecs here...\n            // const video = msg['video_codec']\n            // if(mystream && mystream.getVideoTracks() && mystream.getVideoTracks().length > 0 && !video) {\n            // \t\t'Our video stream has been rejected, viewers won't see us'\n            // }\n          }\n        }\n      },\n      onlocaltrack: (track, on) => {\n        Utils.DLog('[onlocaltrack]', track, on);\n        this.onLocalTrack(track, on);\n      },\n      onremotetrack: (track, mid, on, metadata) => {\n        Utils.DLog('[onremotetrack]', track, mid, on, metadata);\n        this.onRemoteTrack(remoteFeed, track, mid, on, metadata);\n      },\n      ondataopen: (channelLabel) => {\n        Utils.DLog('[ondataopen]', channelLabel);\n        this.emitter.emit(JanusEvent.DATA_CHANNEL_OPEN, channelLabel);\n      },\n      ondata: (data, channelLabel) => {\n        Utils.DLog('[ondata]', channelLabel, data);\n        this.emitter.emit(JanusEvent.DATA_CHANNEL_MESSAGE, channelLabel, data);\n      },\n      oncleanup: () => {\n        Utils.safeCallbackCall(callbacks.oncleanup)();\n      },\n      detached: () => {},\n    });\n  }\n\n  public onLocalTrack(track: MediaStreamTrack, on: any): void {\n    // this.emitter.emit(JanusEvent.LOCAL_STREAM, track);\n  }\n\n  public onRemoteTrack(remoteFeed: any, track: MediaStreamTrack, mid: any, on: any, metadata: any): void {\n    const eventType = metadata && metadata.reason;\n\n    if (eventType === JanusMediaTrackReason.CREATED) {\n      const isStreamNoExistedBefore = !remoteFeed.stream || !remoteFeed.tracks;\n      if (isStreamNoExistedBefore) {\n        remoteFeed.tracks = { [mid]: track };\n        remoteFeed.stream = new MediaStream([track]);\n      } else {\n        remoteFeed.tracks[mid] = track;\n        remoteFeed.stream.addTrack(track);\n      }\n      if (isStreamNoExistedBefore) {\n        this.emitter.emit(JanusEvent.REMOTE_STREAM, remoteFeed.userId, remoteFeed.stream);\n      }\n    } else if (eventType === JanusMediaTrackReason.ENDED) {\n      delete remoteFeed.tracks[mid];\n\n      const trackToRemove = remoteFeed.stream.getTracks().find((streamTrack) => streamTrack.kind === track.kind);\n      remoteFeed.stream.removeTrack(trackToRemove);\n    }\n\n    this.emitter.emit(JanusEvent.REMOTE_TRACKS_UPDATED, remoteFeed.userId, track, eventType);\n  }\n\n  public getPluginId(): string | null {\n    return this.videoRoomPlugin?.getId() ?? null;\n  }\n\n  public detachVideoConferencingPlugin(callbacks: Janus.SuccessErrorCallbacks): void {\n    const clean = () => {\n      this.videoRoomPlugin = null;\n\n      // detach all remote feeds\n      Object.keys(this.remoteFeeds).forEach((userId) => {\n        this.detachRemoteFeed(Number(userId));\n      });\n\n      this.remoteFeeds = {};\n      this.remoteJseps = {};\n      /*\n       * Deprecated\n      this.currentMediaDeviceId = null\n       */\n    };\n\n    this.videoRoomPlugin.detach({\n      success: () => {\n        clean();\n\n        Utils.safeCallbackCall(callbacks.success)();\n      },\n      error: (error) => {\n        clean();\n\n        Utils.safeCallbackCall(callbacks.error)(error);\n      },\n    });\n  }\n\n  public join(roomId: string, userId: number, isOnlyAudio: boolean, callbacks: Janus.RequestCallbacks): void {\n    const displayName = callbacks.displayName;\n    delete callbacks.displayName;\n\n    this.isOnlyAudio = isOnlyAudio;\n\n    Utils.DLog('isOnlyAudio: ' + this.isOnlyAudio);\n\n    const joinEvent = {\n      request: 'join',\n      room: roomId,\n      ptype: 'publisher',\n      id: userId,\n      display: displayName,\n    };\n\n    this.videoRoomPlugin.send({\n      message: joinEvent,\n      success: (resp) => {\n        this.currentRoomId = roomId;\n        this.currentUserId = userId;\n        Utils.safeCallbackCall(callbacks.success)();\n      },\n      error: (error) => {\n        Utils.safeCallbackCall(callbacks.error)(error);\n      },\n    });\n  }\n\n  public leave(callbacks: Janus.RequestCallbacks): void {\n    Utils.DLog('leave');\n\n    if (!this.engine.isConnected()) {\n      Utils.safeCallbackCall(callbacks.success)();\n      return;\n    }\n\n    const leaveEvent = {\n      request: 'leave',\n      room: this.currentRoomId,\n      id: this.currentUserId,\n    };\n\n    if (this.videoRoomPlugin) {\n      this.videoRoomPlugin.send({ message: leaveEvent });\n    }\n    this.currentRoomId = null;\n    this.currentUserId = null;\n\n    Utils.safeCallbackCall(callbacks.success)();\n  }\n\n  public listOnlineParticipants(roomId: string, callbacks: Janus.SuccessErrorCallbacks): void {\n    const listRequest = { request: 'listparticipants', room: roomId };\n\n    this.videoRoomPlugin.send({\n      message: listRequest,\n      success: (data) => {\n        const participants = data ? data.participants : [];\n        Utils.safeCallbackCall(callbacks.success)(participants);\n      },\n      error: (error) => {\n        Utils.safeCallbackCall(callbacks.error)(error);\n      },\n    });\n  }\n\n  public toggleAudioMute(): boolean {\n    const muted = this.videoRoomPlugin.isAudioMuted();\n    if (muted) {\n      this.videoRoomPlugin.unmuteAudio();\n    } else {\n      this.videoRoomPlugin.muteAudio();\n    }\n    return this.videoRoomPlugin.isAudioMuted();\n  }\n\n  public isAudioMuted(): boolean {\n    return this.videoRoomPlugin.isAudioMuted();\n  }\n\n  public toggleRemoteAudioMute(userId: number): boolean {\n    const remoteFeed = this.remoteFeeds[userId];\n    if (!remoteFeed) {\n      return false;\n    }\n\n    const audioTracks = remoteFeed.stream.getAudioTracks();\n    if (audioTracks && audioTracks.length > 0) {\n      for (let i = 0; i < audioTracks.length; ++i) {\n        audioTracks[i].enabled = !audioTracks[i].enabled;\n      }\n      return !audioTracks[0].enabled;\n    }\n\n    return false;\n  }\n\n  public isRemoteAudioMuted(userId: number): boolean {\n    const remoteFeed = this.remoteFeeds[userId];\n    if (!remoteFeed) {\n      return false;\n    }\n\n    const audioTracks = remoteFeed.stream.getAudioTracks();\n    if (audioTracks && audioTracks.length > 0) {\n      return !audioTracks[0].enabled;\n    }\n\n    return false;\n  }\n\n  public toggleVideoMute(): boolean {\n    const muted = this.videoRoomPlugin.isVideoMuted();\n    if (muted) {\n      this.videoRoomPlugin.unmuteVideo();\n    } else {\n      this.videoRoomPlugin.muteVideo();\n    }\n    return this.videoRoomPlugin.isVideoMuted();\n  }\n\n  public isVideoMuted(): boolean {\n    return this.videoRoomPlugin.isVideoMuted();\n  }\n\n  public toggleRemoteVideoMute(userId: number): boolean {\n    const remoteFeed = this.remoteFeeds[userId];\n    if (!remoteFeed) {\n      return false;\n    }\n\n    const videoTracks = remoteFeed.stream.getVideoTracks();\n    if (videoTracks && videoTracks.length > 0) {\n      for (let i = 0; i < videoTracks.length; ++i) {\n        videoTracks[i].enabled = !videoTracks[i].enabled;\n      }\n      return !videoTracks[0].enabled;\n    }\n\n    return false;\n  }\n\n  public isRemoteVideoMuted(userId: number): boolean {\n    const remoteFeed = this.remoteFeeds[userId];\n    if (!remoteFeed) {\n      return false;\n    }\n\n    const videoTracks = remoteFeed.stream.getVideoTracks();\n    if (videoTracks && videoTracks.length > 0) {\n      return !videoTracks[0].enabled;\n    }\n\n    return false;\n  }\n\n  public sendKeyframeRequest(roomId: string, callbacks: Janus.SuccessErrorCallbacks): void {\n    const configureRequest = {\n      request: 'configure',\n      room: roomId,\n      keyframe: true,\n    };\n\n    this.videoRoomPlugin.send({\n      message: configureRequest,\n      success: (response) => {\n        Utils.safeCallbackCall(callbacks.success)(response);\n      },\n      error: (error) => {\n        Utils.safeCallbackCall(callbacks.error)(error);\n      },\n    });\n  }\n\n  public getTracksFromStream(stream: MediaStream): { type: string; capture: MediaStreamTrack; recv: boolean }[] {\n    const tracks: { type: string; capture: MediaStreamTrack; recv: boolean }[] = [];\n\n    const audioTracks = stream.getAudioTracks();\n    if (audioTracks.length) {\n      const audioTrack = audioTracks[0];\n      tracks.push({ type: 'audio', capture: audioTrack, recv: false });\n    }\n\n    const videoTracks = stream.getVideoTracks();\n    if (videoTracks.length) {\n      const videoTrack = videoTracks[0];\n      tracks.push({ type: 'video', capture: videoTrack, recv: false });\n    }\n\n    return tracks;\n  }\n\n  public createOffer(\n    mediaParams: { stream?: MediaStream; media: { audio: boolean; video: boolean }; replace?: boolean },\n    callbacks: Janus.SuccessErrorCallbacks\n  ): void {\n    Utils.DLog('[JanusWrapper][createOffer]', mediaParams);\n\n    const { stream: existedStream, media, replace } = mediaParams;\n\n    const createOfferParams: any = { tracks: [{ type: 'data' }] };\n\n    if (existedStream) {\n      const tracksFromStream = this.getTracksFromStream(existedStream);\n      createOfferParams.tracks = createOfferParams.tracks.concat(tracksFromStream);\n    } else if (media) {\n      const tracksFromParams: { type: string; capture: boolean; recv: boolean; replace: boolean }[] = [];\n      if (media.audio) {\n        tracksFromParams.push({\n          type: 'audio',\n          capture: media.audio,\n          recv: false,\n          replace: !!replace,\n        });\n      }\n      if (media.video) {\n        tracksFromParams.push({\n          type: 'video',\n          capture: media.video,\n          recv: false,\n          replace: !!replace,\n        });\n      }\n      createOfferParams.tracks = createOfferParams.tracks.concat(tracksFromParams);\n    } else {\n      createOfferParams.tracks = createOfferParams.tracks.concat([\n        { type: 'audio', capture: true, recv: false, replace: !!replace },\n        { type: 'video', capture: true, recv: false, replace: !!replace },\n      ]);\n    }\n\n    Utils.DLog('[JanusWrapper][createOffer][params]', createOfferParams);\n\n    createOfferParams.customizeSdp = (jsep) => {};\n\n    createOfferParams.success = (jsep) => {\n      const publish = {\n        request: 'configure',\n        audio: !!media.audio,\n        video: !!media.video,\n      };\n      Utils.DLog('[JanusWrapper][createOffer][success]', publish);\n\n      this.videoRoomPlugin.send({ message: publish, jsep: jsep });\n\n      Utils.safeCallbackCall(callbacks.success)();\n    };\n\n    createOfferParams.error = (error) => {\n      Utils.DLog('[JanusWrapper][createOffer][error]', error);\n      if (media.audio) {\n        this.createOffer({ media: { video: false, audio: false } }, callbacks);\n      } else {\n        Utils.safeCallbackCall(callbacks.error)(error);\n      }\n    };\n\n    this.videoRoomPlugin.createOffer(createOfferParams);\n  }\n\n  public getTracksMidsFromStream(stream: MediaStream): { type: string; mid: string; recv: boolean }[] {\n    const tracks: { type: string; mid: string; recv: boolean }[] = [];\n\n    const audioTracks = stream.getAudioTracks();\n    if (audioTracks.length) {\n      const audioTrack = audioTracks[0];\n      tracks.push({ type: 'audio', mid: audioTrack.id, recv: true });\n    }\n\n    const videoTracks = stream.getVideoTracks();\n    if (videoTracks.length) {\n      const videoTrack = videoTracks[0];\n      tracks.push({ type: 'video', mid: videoTrack.id, recv: true });\n    }\n\n    return tracks;\n  }\n\n  public createAnswer(\n    { remoteFeed, jsep }: any,\n    existedStream: MediaStream,\n    callbacks: Janus.SuccessErrorCallbacks\n  ): void {\n    Utils.DLog('[JanusWrapper][createAnswer]', jsep, existedStream);\n    let tracks: any = [{ type: 'data' }];\n\n    if (existedStream) {\n      const tracksFromStream = this.getTracksMidsFromStream(existedStream);\n      tracks = tracks.concat(tracksFromStream);\n    }\n\n    Utils.DLog('[JanusWrapper][createAnswer][tracks]', tracks);\n\n    remoteFeed.createAnswer({\n      jsep: jsep,\n      tracks: tracks,\n      success: (jsep) => {\n        const body = { request: 'start', room: this.currentRoomId };\n        Utils.DLog('[JanusWrapper][createAnswer][success]', body);\n\n        remoteFeed.send({ message: body, jsep: jsep });\n\n        Utils.safeCallbackCall(callbacks.success)();\n      },\n      error: (error) => {\n        Utils.DLog('[JanusWrapper][createAnswer][error]', error);\n        Utils.safeCallbackCall(callbacks.error)(error);\n      },\n    });\n  }\n\n  public detachRemoteFeed(userId: number): boolean {\n    const remoteFeed = this.remoteFeeds[userId];\n    if (remoteFeed) {\n      remoteFeed.detach();\n      this.remoteFeeds[userId] = null;\n      this.remoteJseps[userId] = null;\n      return true;\n    }\n    return false;\n  }\n\n  public getUserBitrate(userId: number): any {\n    const remoteFeed = this.remoteFeeds[userId];\n    return remoteFeed.getBitrate();\n  }\n\n  public getVolume(resultCallback: (value: any) => void): void {\n    return this.videoRoomPlugin.getLocalVolume(null, resultCallback);\n  }\n\n  public getUserVolume(userId: number, resultCallback: (value: any) => void): void {\n    const remoteFeed = this.remoteFeeds[userId];\n    return remoteFeed.getRemoteVolume(null, resultCallback);\n  }\n\n  public showBitrate(userId: number, element: any): void {\n    const remoteFeed = this.remoteFeeds[userId];\n\n    if (\n      !Utils.env.isReactNative &&\n      (adapter.browserDetails.browser === 'chrome' || adapter.browserDetails.browser === 'firefox')\n    ) {\n      this.bitrateTimers[userId] = setInterval(() => {\n        const bitrate = remoteFeed.getBitrate();\n        element.text(bitrate);\n      }, 1000);\n    }\n  }\n\n  public hideBitrate(userId: number, element: any): void {\n    if (this.bitrateTimers[userId]) {\n      clearInterval(this.bitrateTimers[userId]);\n    }\n    this.bitrateTimers[userId] = null;\n    element.text = null;\n  }\n\n  public on(eventType: JanusEvent, listener: (...args: any[]) => void): EventEmitter {\n    return this.emitter.addListener(eventType, listener);\n  }\n\n  public removeAllListeners(eventType?: JanusEvent): EventEmitter {\n    return this.emitter.removeAllListeners(eventType);\n  }\n}\n","import WebRTCSession from '../videocalling/WebRTCSession';\nimport WebRTCSignalingProvider from '../videocalling/WebRTCSignalingProvider';\n\nexport const SignalingModuleIdentifier = 'WebRTCVideoChat';\n\nexport enum SignalingType {\n  CALL = 'call',\n  ACCEPT = 'accept',\n  REJECT = 'reject',\n  STOP = 'hangUp',\n  RESTART = 'iceRestart',\n  RESTART_ACCEPT = 'iceRestartAccept',\n  CANDIDATE = 'iceCandidates',\n}\nexport enum SessionConnectionState {\n  UNDEFINED = 0,\n  CONNECTING = 1,\n  CONNECTED = 2,\n  FAILED = 3,\n  DISCONNECTED = 4,\n  CLOSED = 5,\n  COMPLETED = 6,\n}\nexport enum SessionState {\n  NEW = 1,\n  ACTIVE = 2,\n  HUNGUP = 3,\n  REJECTED = 4,\n  CLOSED = 5,\n}\nexport enum PeerConnectionState {\n  NEW = 1,\n  CONNECTING = 2,\n  CHECKING = 3,\n  CONNECTED = 4,\n  DISCONNECTED = 5,\n  FAILED = 6,\n  CLOSED = 7,\n  COMPLETED = 8,\n}\nexport enum CallType {\n  VIDEO = 1,\n  AUDIO = 2,\n}\nexport enum CallsEvent {\n  CALL = 'call',\n  ACCEPT = 'accept',\n  REJECT = 'reject',\n  HUNG_UP = 'hang-up',\n  INVALID = 'invalid',\n  NOT_ANSWER = 'not-answer',\n  REMOTE_STREAM = 'remote-stream',\n  CONNECTION_STATE = 'connection-state',\n  CLOSE = 'close',\n  STATS_REPORT = 'stats-report',\n  DEVICES = 'devices',\n}\n\nexport namespace ConnectyCubeCalls {\n  export type UserInfo = {\n    maxBandwidth?: number;\n    bandwidth?: number;\n    [key: string]: any;\n  };\n  export type ExtensionParams = {\n    callType?: CallType;\n    callerID?: number;\n    iceCandidates?: RTCIceCandidateInit[] | any[];\n    opponentsIDs?: number[];\n    userInfo?: UserInfo;\n    sessionID?: string;\n    [key: string]: any;\n  };\n  export type WebRTCSessionParams = {\n    ID: string | null;\n    initiatorID: number;\n    opponentsIDs: number[];\n    callType: CallType;\n    signalingProvider: WebRTCSignalingProvider;\n    currentUserID: number;\n    maxBandwidth: number;\n  };\n  // Listeners\n  export type OnCallListener = (session: WebRTCSession, userInfo: UserInfo) => void;\n  export type OnAcceptCallListener = (session: WebRTCSession, userID: number, userInfo: UserInfo) => void;\n  export type OnRejectCallListener = (session: WebRTCSession, userID: number, userInfo: UserInfo) => void;\n  export type OnStopCallListener = (session: WebRTCSession, userID: number, userInfo: UserInfo) => void;\n  export type OnInvalidEventsListener = (session: WebRTCSession, userID: number, userInfo: UserInfo) => void;\n  export type OnUserNotAnswerListener = (session: WebRTCSession, userID: number) => void;\n  export type OnRemoteStreamListener = (session: WebRTCSession, userID: number, stream: MediaStream) => void;\n  export type OnSessionConnectionStateChangedListener = (\n    session: WebRTCSession,\n    userID: number,\n    connectionState: SessionConnectionState\n  ) => void;\n  export type OnSessionCloseListener = (session: WebRTCSession) => void;\n  export type OnCallStatsReportListener = (session: WebRTCSession, userID: number, stats: any, error: Error) => void;\n  export type OnDevicesChangeListener = (this: MediaDevices, ev: Event) => any;\n  export type Listeners =\n    | OnCallListener\n    | OnAcceptCallListener\n    | OnRejectCallListener\n    | OnStopCallListener\n    | OnInvalidEventsListener\n    | OnUserNotAnswerListener\n    | OnRemoteStreamListener\n    | OnSessionConnectionStateChangedListener\n    | OnSessionCloseListener\n    | OnCallStatsReportListener\n    | OnDevicesChangeListener;\n}\n","import { mediaDevices } from '../platform';\nimport Utils from '../Utils';\nimport JanusClient from './JanusClient';\nimport { Auth, Janus, Media } from '../types';\nimport { CallType, JanusEvent } from '../types/janus';\n\nexport default class ConferenceSession {\n  private client: JanusClient;\n  public id: string = `${Math.random()}`;\n  public currentUserDisplayName?: string;\n  public localStream?: MediaStream;\n  public mediaParams: MediaStreamConstraints = {};\n  public onParticipantJoinedListener: Janus.OnParticipantJoinedListener;\n  public onParticipantLeftListener: Janus.OnParticipantLeftListener;\n  public onSlowLinkListener: Janus.OnSlowLinkListener;\n  public onRemoteStreamListener: Janus.OnRemoteStreamListener;\n  public onRemoteTracksUpdatedListener: Janus.OnRemoteTracksUpdatedListener;\n  public onRemoteConnectionStateChangedListener: Janus.OnRemoteConnectionStateChangedListener;\n  public onDataChannelOpenedListener: Janus.OnDataChannelOpenedListener;\n  public onDataChannelMessageListener: Janus.OnDataChannelMessageListener;\n  public onSessionConnectionStateChangedListener: Janus.OnSessionConnectionStateChangedListener;\n  public onErrorListener: Janus.OnErrorListener;\n\n  constructor(token: Auth.Session['token']) {\n    this.client = new JanusClient(token);\n    this.client.on(JanusEvent.PARTICIPANT_JOINED, this.onParticipantJoined);\n    this.client.on(JanusEvent.PARTICIPANT_LEFT, this.onParticipantLeft);\n    this.client.on(JanusEvent.REMOTE_STREAM, this.onRemoteStream);\n    this.client.on(JanusEvent.REMOTE_TRACKS_UPDATED, this.onRemoteTracksUpdated);\n    this.client.on(JanusEvent.DATA_CHANNEL_OPEN, this.onDataChannelOpen);\n    this.client.on(JanusEvent.DATA_CHANNEL_MESSAGE, this.onDataChannelMessage);\n    this.client.on(JanusEvent.ERROR, this.onError);\n  }\n\n  get currentRoomId(): string | null {\n    return this.client.currentRoomId;\n  }\n\n  set currentRoomId(roomId: string | null) {\n    this.client.currentRoomId = roomId;\n  }\n\n  get currentPublisherPC() {\n    return this.client.videoRoomPlugin.webrtcStuff.pc;\n  }\n\n  private async createSession(): Promise<void> {\n    let isResolved = false;\n\n    return new Promise((resolve, reject) => {\n      this.client.createSession({\n        success: () => {\n          isResolved = true;\n          resolve(void 0);\n        },\n        error: (error) => {\n          if (isResolved) {\n            this.onError(error);\n          } else {\n            reject(error);\n          }\n        },\n      });\n    });\n  }\n\n  // joinAsPublisher+Listener\n  public async join(roomId: string, user_id: number, userDisplayName: string): Promise<void> {\n    this.currentUserDisplayName = userDisplayName;\n    this.currentRoomId = roomId;\n    await this.createSession();\n    await this.createHandler(user_id, false, false);\n    await this.joinInternal(this.currentRoomId, user_id);\n  }\n\n  public async joinAsListener(roomId: string, user_id: number, userDisplayName: string): Promise<void> {\n    this.currentUserDisplayName = userDisplayName;\n    this.currentRoomId = roomId;\n    await this.createSession();\n    await this.createHandler(user_id, false, true);\n    await this.joinInternal(this.currentRoomId, user_id);\n  }\n\n  public async sendKeyframeRequest(roomId: string): Promise<any> {\n    return new Promise((resolve, reject) => {\n      this.client.sendKeyframeRequest(roomId, {\n        success: resolve,\n        error: reject,\n      });\n    });\n  }\n\n  private async createHandler(user_id: number, isRemote: boolean, skipMedia: boolean = false): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.client.attachVideoConferencingPlugin(isRemote, user_id, skipMedia, {\n        success: resolve,\n        error: reject,\n        iceState: isRemote\n          ? (iceState) => this.onRemoteIceStateChanged(user_id, iceState)\n          : (iceState) => this.onLocalIceStateChanged(iceState),\n        slowLink: isRemote\n          ? (uplink, nacks) => this.onSlowLink(user_id, uplink, nacks)\n          : (uplink, nacks) => this.onSlowLink(null, uplink, nacks),\n        localStream: this.localStream,\n        displayName: this.currentUserDisplayName,\n      });\n    });\n  }\n\n  private async joinInternal(roomId: string, user_id: number): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.client.join(roomId, user_id, false, {\n        success: resolve,\n        error: reject,\n        displayName: this.currentUserDisplayName,\n      });\n    });\n  }\n\n  private onParticipantJoined = (user_id: number, userDisplayName: string, isExistingParticipant: boolean): void => {\n    Utils.DLog('[onParticipantJoined]', user_id, userDisplayName, isExistingParticipant);\n    this.createHandler(user_id, true, false);\n    Utils.safeCallbackCall(this.onParticipantJoinedListener)(this, user_id, userDisplayName, isExistingParticipant);\n  };\n\n  private onParticipantLeft = (user_id: number, userDisplayName: string): void => {\n    Utils.DLog('[onParticipantLeft]', user_id, userDisplayName);\n    Utils.safeCallbackCall(this.onParticipantLeftListener)(this, user_id, userDisplayName);\n  };\n\n  private onError = (error: any): void => {\n    Utils.DLog('[onError]', JSON.stringify(error));\n    Utils.safeCallbackCall(this.onErrorListener)(this, error);\n  };\n\n  private onDataChannelOpen = (label): void => {\n    Utils.DLog('[onDataChannelOpen]', label);\n    Utils.safeCallbackCall(this.onDataChannelOpenedListener)(this, label);\n  };\n\n  private onDataChannelMessage = (user_id: number, data): void => {\n    Utils.DLog('[onDataChannelMessage]', user_id, data);\n    Utils.safeCallbackCall(this.onDataChannelMessageListener)(this, user_id, data);\n  };\n\n  private onLocalIceStateChanged = (iceState): void => {\n    Utils.DLog('[onLocalIceStateChanged]', iceState);\n    Utils.safeCallbackCall(this.onSessionConnectionStateChangedListener)(this, iceState);\n  };\n\n  private onRemoteIceStateChanged = (user_id: number, iceState): void => {\n    Utils.DLog('[onRemoteIceStateChanged]', user_id, iceState);\n    Utils.safeCallbackCall(this.onRemoteConnectionStateChangedListener)(this, user_id, iceState);\n  };\n\n  private onRemoteStream = (user_id: number, stream: MediaStream): void => {\n    Utils.DLog('[onRemoteStream]', user_id, stream);\n    Utils.safeCallbackCall(this.onRemoteStreamListener)(this, user_id, stream);\n  };\n\n  private onRemoteTracksUpdated = (user_id: number, track: MediaStreamTrack, eventType): void => {\n    Utils.DLog('[onRemoteTracksUpdated]', user_id, track, eventType);\n    Utils.safeCallbackCall(this.onRemoteTracksUpdatedListener)(this, user_id, track, eventType);\n  };\n\n  private onSlowLink = (user_id: number | null, uplink, nacks): void => {\n    Utils.DLog('[onSlowLink]', user_id, uplink, nacks);\n    Utils.safeCallbackCall(this.onSlowLinkListener)(this, user_id, uplink, nacks);\n  };\n\n  public async listOfOnlineParticipants(): Promise<any> {\n    return new Promise((resolve, reject) => {\n      if (this.currentRoomId) {\n        this.client.listOnlineParticipants(this.currentRoomId, {\n          success: resolve,\n          error: reject,\n        });\n      } else {\n        reject('Room ID is not set');\n      }\n    });\n  }\n\n  public async leave(): Promise<void> {\n    this.currentRoomId = null;\n    this.currentUserDisplayName = undefined;\n    await this.leaveGroup();\n    await this.detachVideoConferencingPlugin();\n    await this.destroy();\n\n    if (this.localStream) {\n      this.localStream.getTracks().forEach((track) => track.stop());\n      this.localStream = undefined;\n      this.mediaParams = {};\n    }\n  }\n\n  public async leaveGroup(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.client.leave({\n        success: resolve,\n        error: reject,\n      });\n    });\n  }\n\n  public async destroy(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.client.destroySession({\n        success: resolve,\n        error: reject,\n      });\n    });\n  }\n\n  public async detachVideoConferencingPlugin(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.client.detachVideoConferencingPlugin({\n        success: resolve,\n        error: reject,\n      });\n    });\n  }\n\n  public async getDisplayMedia(params: Media.DisplayParams): Promise<MediaStream> {\n    if (!mediaDevices.getDisplayMedia) {\n      throw new Error(\"Your environment does not support 'getDisplayMedia' API\");\n    }\n\n    const elementId = params && params.elementId;\n    const options = params && params.options;\n    const mediaParams = { ...params };\n\n    this.mediaParams = mediaParams;\n    delete mediaParams.elementId;\n    delete mediaParams.options;\n\n    try {\n      const stream = await mediaDevices.getDisplayMedia(mediaParams);\n      return this.upsertStream(stream, elementId, options);\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  public async getUserMedia(params: Media.UserParams): Promise<MediaStream> {\n    const elementId = params && params.elementId;\n    const options = params && params.options;\n    const mediaParams = { ...params };\n\n    this.mediaParams = mediaParams;\n    delete mediaParams.elementId;\n    delete mediaParams.options;\n\n    try {\n      const stream = await mediaDevices.getUserMedia(mediaParams);\n      return this.upsertStream(stream, elementId, options);\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  private upsertStream(\n    stream: MediaStream,\n    elementId: string | null = null,\n    options: Media.ElementOptions = {}\n  ): MediaStream {\n    const shouldUpdateCurrentStream = !!this.localStream;\n\n    if (shouldUpdateCurrentStream) {\n      this.replaceTracks(stream);\n    } else {\n      this.localStream = stream;\n    }\n\n    if (!this.localStream) {\n      throw new Error('Local stream is not defined');\n    }\n\n    if (elementId) {\n      if (shouldUpdateCurrentStream) {\n        this.detachMediaStream(elementId, options);\n      }\n      this.attachMediaStream(elementId, this.localStream, options);\n    }\n\n    return this.localStream;\n  }\n\n  private replaceTracks(stream: MediaStream): MediaStream {\n    this.localStream?.getTracks().forEach((localTrack) => {\n      if (localTrack.kind === CallType.AUDIO && stream.getAudioTracks().length === 0) {\n        return;\n      } else {\n        localTrack.stop();\n        this.localStream?.removeTrack(localTrack);\n      }\n    });\n\n    stream.getTracks().forEach((newTrack) => {\n      const pcSenders = this.currentPublisherPC.getSenders();\n      const sender = pcSenders.find(({ track }) => newTrack.kind === track.kind);\n\n      if (newTrack.kind === CallType.AUDIO) {\n        newTrack.enabled = this.localStream?.getAudioTracks().every(({ enabled }) => enabled) ?? true;\n      } else {\n        newTrack.enabled = this.localStream?.getVideoTracks().every(({ enabled }) => enabled) ?? true;\n      }\n\n      if (sender) {\n        sender.replaceTrack(newTrack);\n        this.localStream?.addTrack(newTrack);\n      } else {\n        console.warn(`No sender found for track kind: ${newTrack.kind}`);\n      }\n    });\n\n    if (!this.localStream) {\n      throw new Error('Local stream is not defined');\n    }\n\n    return this.localStream;\n  }\n\n  public async switchMediaTracks(options: Media.TrackConstraintsOrDeviceIds): Promise<MediaStream> {\n    [CallType.AUDIO, CallType.VIDEO].forEach((type) => {\n      const device = type === CallType.AUDIO ? options.audio : type === CallType.VIDEO ? options.video : {};\n      const deviceId = typeof device === 'string' ? device : (device?.deviceId ?? null);\n\n      if (deviceId) {\n        if (typeof this.mediaParams[type] === 'object') {\n          this.mediaParams[type].deviceId = deviceId;\n        } else {\n          this.mediaParams[type] = { deviceId };\n        }\n      }\n    });\n\n    try {\n      const mediaParams = {\n        audio: this.mediaParams?.audio ?? false,\n        video: this.mediaParams?.video ?? false,\n      };\n      const stream = await mediaDevices.getDisplayMedia(mediaParams);\n      return this.replaceTracks(stream);\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  public muteVideo(): void {\n    if (!this.isVideoMuted()) {\n      this.client.toggleVideoMute();\n    }\n  }\n\n  public unmuteVideo(): void {\n    if (this.isVideoMuted()) {\n      this.client.toggleVideoMute();\n    }\n  }\n\n  public muteAudio(): void {\n    if (!this.isAudioMuted()) {\n      this.client.toggleAudioMute();\n    }\n  }\n\n  public unmuteAudio(): void {\n    if (this.isAudioMuted()) {\n      this.client.toggleAudioMute();\n    }\n  }\n\n  public isVideoMuted(): boolean {\n    return this.client.isVideoMuted();\n  }\n\n  public isAudioMuted(): boolean {\n    return this.client.isAudioMuted();\n  }\n\n  public async getUserVolume(): Promise<any> {\n    return new Promise((resolve, _reject) => {\n      return this.client.getVolume(resolve);\n    });\n  }\n\n  public getRemoteUserBitrate(userId: number): any {\n    return this.client.getUserBitrate(userId);\n  }\n\n  public async getRemoteUserVolume(userId: number): Promise<any> {\n    return new Promise((resolve, reject) => {\n      return this.client.getUserVolume(userId, resolve);\n    });\n  }\n\n  public attachMediaStream(elementId: string, stream: MediaStream, opt?: Media.ElementOptions): void {\n    const mediaElement = document.getElementById(elementId) as HTMLMediaElement;\n\n    if ('srcObject' in mediaElement) {\n      mediaElement.srcObject = stream;\n      mediaElement.style.transform = opt?.mirror ? 'scaleX(-1)' : 'none';\n      if (typeof opt?.muted === 'boolean') {\n        mediaElement.muted = opt?.muted;\n      }\n      mediaElement.onloadedmetadata = (_event: Event) => {\n        mediaElement.play();\n      };\n    } else {\n      throw new Error(`Unable to attach media stream, element #${elementId} is undefined`);\n    }\n  }\n\n  public detachMediaStream(elementId: string, opt?: Media.ElementOptions) {\n    const mediaElement = document.getElementById(elementId) as HTMLMediaElement;\n\n    if ('srcObject' in mediaElement) {\n      mediaElement.pause();\n      mediaElement.srcObject = null;\n      mediaElement.style.transform = opt?.mirror ? 'scaleX(-1)' : 'none';\n      if (typeof opt?.muted === 'boolean') {\n        mediaElement.muted = opt?.muted;\n      }\n    } else {\n      throw new Error(`Unable to attach media stream, element #${elementId} is undefined`);\n    }\n  }\n\n  public async sendData(data: any, label: any): Promise<any> {\n    return new Promise((resolve, reject) => {\n      this.client.videoRoomPlugin.data({\n        data,\n        label,\n        success: resolve,\n        error: reject,\n      });\n    });\n  }\n}\n","import { mediaDevices } from '../platform';\nimport ConferenceSession from './ConferenceSession';\nimport ProxyService from '../Proxy';\nimport { Janus } from '../types';\nimport { CallType, ConferenceEvent, DeviceInputType } from '../types/janus';\n\nexport default class ConferenceClient {\n  public proxy: ProxyService;\n  public DeviceInputType: typeof DeviceInputType = DeviceInputType;\n  public CallType: typeof CallType = CallType;\n  public sessionsStore: { [id: ConferenceSession['id']]: ConferenceSession } = {};\n  public onParticipantJoinedListener: Janus.OnParticipantJoinedListener;\n  public onParticipantLeftListener: Janus.OnParticipantLeftListener;\n  public onSlowLinkListener: Janus.OnSlowLinkListener;\n  public onRemoteStreamListener: Janus.OnRemoteStreamListener;\n  public onRemoteTracksUpdatedListener: Janus.OnRemoteTracksUpdatedListener;\n  public onRemoteConnectionStateChangedListener: Janus.OnRemoteConnectionStateChangedListener;\n  public onDataChannelOpenedListener: Janus.OnDataChannelOpenedListener;\n  public onDataChannelMessageListener: Janus.OnDataChannelMessageListener;\n  public onSessionConnectionStateChangedListener: Janus.OnSessionConnectionStateChangedListener;\n  public onErrorListener: Janus.OnErrorListener;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  createNewSession() {\n    const session = new ConferenceSession(this.getCurrentSessionToken());\n\n    this.sessionsStore[session.id] = session;\n    session.onParticipantJoinedListener = this.onParticipantJoinedListener;\n    session.onParticipantLeftListener = this.onParticipantLeftListener;\n    session.onSlowLinkListener = this.onSlowLinkListener;\n    session.onRemoteStreamListener = this.onRemoteStreamListener;\n    session.onRemoteTracksUpdatedListener = this.onRemoteTracksUpdatedListener;\n    session.onRemoteConnectionStateChangedListener = this.onRemoteConnectionStateChangedListener;\n    session.onDataChannelOpenedListener = this.onDataChannelOpenedListener;\n    session.onDataChannelMessageListener = this.onDataChannelMessageListener;\n    session.onSessionConnectionStateChangedListener = this.onSessionConnectionStateChangedListener;\n    session.onErrorListener = this.onErrorListener;\n\n    return session;\n  }\n\n  public async getMediaDevices(kind?: DeviceInputType): Promise<MediaDeviceInfo[]> {\n    if (mediaDevices?.enumerateDevices) {\n      const devices = await mediaDevices.enumerateDevices();\n      return kind ? devices.filter((device) => device.kind === kind) : devices;\n    } else {\n      throw new Error(\"No 'enumerateDevices' API supported\");\n    }\n  }\n\n  public clearSession(session_id: ConferenceSession['id']): void {\n    delete this.sessionsStore[session_id];\n  }\n\n  public getCurrentSessionToken(): string {\n    const currentSession = this.proxy.getSession();\n\n    if (currentSession?.token) {\n      return currentSession.token;\n    } else {\n      throw new Error('Session does not exist');\n    }\n  }\n\n  private getListenerByName(name: ConferenceEvent): string | null {\n    switch (name) {\n      case ConferenceEvent.JOIN:\n        return 'onParticipantJoinedListener';\n      case ConferenceEvent.LEFT:\n        return 'onParticipantLeftListener';\n      case ConferenceEvent.SLOW_LINK:\n        return 'onSlowLinkListener';\n      case ConferenceEvent.REMOTE_STREAM:\n        return 'onRemoteStreamListener';\n      case ConferenceEvent.REMOTE_TRACKS_UPDATED:\n        return 'onRemoteTracksUpdatedListener';\n      case ConferenceEvent.REMOTE_CONNECTION_STATE:\n        return 'onRemoteConnectionStateChangedListener';\n      case ConferenceEvent.DATA_CHANNEL_OPENED:\n        return 'onDataChannelOpenedListener';\n      case ConferenceEvent.DATA_CHANNEL_MESSAGE:\n        return 'onDataChannelMessageListener';\n      case ConferenceEvent.SESSION_CONNECTION_STATE:\n        return 'onSessionConnectionStateChangedListener';\n      case ConferenceEvent.ERROR:\n        return 'onErrorListener';\n      default:\n        return null;\n    }\n  }\n\n  public addListener(name: ConferenceEvent, listener: Janus.Listeners): () => void {\n    const listenerName = this.getListenerByName(name);\n    if (listenerName) {\n      this[listenerName] = listener;\n    }\n    return this.removeListener.bind(this, name);\n  }\n\n  public removeListener(name: ConferenceEvent): void {\n    const listenerName = this.getListenerByName(name);\n    if (listenerName) {\n      this[listenerName] = undefined;\n    }\n  }\n\n  public removeAllListeners(): void {\n    Object.keys(this).forEach((key) => {\n      if (key.startsWith('on') && key.endsWith('Listener') && typeof this[key] === 'function') {\n        this[key] = undefined;\n      }\n    });\n  }\n}\n","import ProxyService from './Proxy';\nimport Utils from './Utils';\nimport config from './config';\nimport { Data, EmptyResponse, SearchCondition } from './types';\nimport { ProxyMethod, ProxyType } from './types/proxy';\n\nexport default class DataService {\n  public proxy: ProxyService;\n  readonly route = config.urls.data;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async create(className: string, params: Data.CreateParams = {}): Promise<Data.DataRecord> {\n    const isMany = Utils.isArray(params);\n    const multi = isMany ? 'multi' : undefined;\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route, className, multi),\n      data: isMany ? { record: this.createRecord(params) } : params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async list(className: string, params: Data.ListParams = {}): Promise<Data.ListResponse> {\n    const ext = typeof params === 'string' ? params : Utils.isArray(params) ? params.toString() : undefined;\n    const ajaxParams = {\n      url: Utils.getUrl(this.route, className, ext),\n      data: ext ? undefined : params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async readPermissions(className: string, id: string): Promise<Data.ReadPermissionsResponse> {\n    const ajaxParams = {\n      url: Utils.getUrl(this.route, className, id),\n      data: { permissions: 1 },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async update(\n    className: string,\n    params: Data.UpdateOptions | Data.UpdateOptions[] = {}\n  ): Promise<Data.UpdateResponse | Data.DataRecord> {\n    const isMany = Utils.isArray(params);\n    const isSearch = !isMany && params.search_criteria;\n    const ext = isMany ? 'multi' : isSearch ? 'by_criteria' : params.id || params._id;\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, className, ext),\n      data: isMany ? { record: this.createRecord(params) } : params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(\n    className: string,\n    params: string | string[] | SearchCondition<any>\n  ): Promise<Data.DeleteResponse | EmptyResponse> {\n    const isCriteria = Utils.isObject(params);\n    const isOne = typeof params === 'string' || (Utils.isArray(params) && params.length === 1);\n    const ext = isCriteria ? 'by_criteria' : params.toString();\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, className, ext),\n      data: isCriteria ? params : undefined,\n      dataType: isOne ? ProxyType.TEXT : undefined,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  private createRecord(params: Data.CreateRecord[] = []): object {\n    return params.reduce((items, item, index) => {\n      const key = index + 1;\n      const id = item.id || item._id;\n      const record = id ? { ...item, id } : item;\n\n      return { ...items, [key]: record };\n    }, {});\n  }\n}\n","import ProxyService from './Proxy';\nimport Utils from './Utils';\nimport config from './config';\nimport { EmptyResponse, Meetings } from './types';\nimport { ProxyMethod, ProxyType } from './types/proxy';\n\nexport default class MeetingsService {\n  public proxy: ProxyService;\n  readonly route = config.urls.meetings;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async get(params: Meetings.GetParams = {}): Promise<Meetings.Meeting | Meetings.Meeting[]> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async create(params: Meetings.CreateParams = {}): Promise<Meetings.Meeting> {\n    const MINUTE = 60;\n    const startTimestamp = Math.ceil(Date.now() / 1000);\n    const endTimestamp = startTimestamp + 60 * MINUTE;\n    const defaultName = new Date(startTimestamp).toLocaleString('en', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n      hour: 'numeric',\n      minute: 'numeric',\n    });\n    const defaultParams = {\n      name: defaultName,\n      start_date: startTimestamp,\n      end_date: endTimestamp,\n      attendees: [],\n      record: false,\n      chat: false,\n    };\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: { ...defaultParams, ...params },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async update(id: string | number, params?): Promise<Meetings.Meeting> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, id),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(id: string | number): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, id),\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getRecordings(id: string | number): Promise<Meetings.Recording[]> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, 'recordings', id),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n","import { fetchImpl, formDataImpl } from './platform';\nimport config from './config';\nimport Utils from './Utils';\nimport { ProxyMethod, ProxyType } from './types/proxy';\nimport { Proxy } from './types';\n\nexport default class ProxyService {\n  public sdkInstance: Proxy.SDKInstance = {\n    config,\n    session: null,\n  };\n  public requestsNumber: number = 0;\n  public fetchImpl = fetchImpl;\n  private currentUserId: number | undefined;\n  private abortControllersMap: Proxy.AbortControllersMap = {};\n  public requestMethod: typeof ProxyMethod = ProxyMethod;\n  public responseType: typeof ProxyType = ProxyType;\n\n  public setSession(session: Proxy.SDKInstance['session']): void {\n    this.sdkInstance.session = session;\n\n    if (session && session.user_id) {\n      this.setCurrentUserId(session.user_id);\n    }\n  }\n\n  public getSession(): Proxy.SDKInstance['session'] {\n    return this.sdkInstance.session;\n  }\n\n  public setCurrentUserId(userId?: number | null): void {\n    this.currentUserId = userId || undefined;\n  }\n\n  public getCurrentUserId(): number | undefined {\n    return this.currentUserId;\n  }\n\n  public logRequest(params: Proxy.Params, requestId: number): void {\n    Utils.DLog(`[Request][${requestId}]`, `${params.type || 'GET'} ${params.url}`, params);\n  }\n\n  public logResponse(response: any, requestId: number): void {\n    Utils.DLog(`[Response][${requestId}]`, response);\n  }\n\n  public buildRequestAndURL(params: Proxy.Params): [any, string] {\n    const isGetOrHeadType = !params.type || params.type === 'GET' || params.type === 'HEAD';\n    const isPostOrPutType = params.type ? params.type === 'POST' || params.type === 'PUT' : false;\n    const token = this.sdkInstance && this.sdkInstance.session && this.sdkInstance.session.token;\n    const isInternalRequest = params.url.indexOf('s3.amazonaws.com') === -1;\n    const isMultipartFormData = params.contentType === false;\n    const authKey = params.authKey;\n\n    let requestBody;\n    let requestURL = params.url;\n    const requestObject: any = {};\n\n    requestObject.method = params.type || 'GET';\n\n    if (params.data) {\n      requestBody = this.buildRequestBody(params, isMultipartFormData, isPostOrPutType);\n\n      if (isGetOrHeadType) {\n        requestURL += `?${requestBody}`;\n      } else {\n        requestObject.body = requestBody;\n      }\n    }\n\n    if (!isMultipartFormData) {\n      requestObject.headers = {\n        'Content-Type': isPostOrPutType\n          ? 'application/json;charset=utf-8'\n          : 'application/x-www-form-urlencoded; charset=UTF-8',\n      };\n    }\n\n    if (isInternalRequest) {\n      if (!requestObject.headers) {\n        requestObject.headers = {};\n      }\n\n      requestObject.headers['CB-SDK'] = `JS ${config.version} - Client`;\n\n      if (token) {\n        requestObject.headers['CB-Token'] = token;\n      } else if (authKey) {\n        requestObject.headers['CB-AuthKey'] = authKey;\n      }\n    }\n\n    if (config.timeout) {\n      requestObject.timeout = config.timeout;\n    }\n\n    return [requestObject, requestURL];\n  }\n\n  public buildRequestBody(\n    params: Proxy.Params,\n    isMultipartFormData: boolean,\n    isPostOrPutType: boolean\n  ): typeof formDataImpl | string | any {\n    const data = params.data;\n    const useArrayQuery = params.useArrayQuery;\n\n    let dataObject;\n\n    if (isMultipartFormData) {\n      dataObject = new formDataImpl();\n\n      Object.keys(data).forEach(function (item) {\n        if (params.fileToCustomObject && item === 'file') {\n          dataObject.append(item, data[item].data, data[item].name);\n        } else {\n          dataObject.append(item, params.data[item]);\n        }\n      });\n    } else if (isPostOrPutType) {\n      dataObject = JSON.stringify(data);\n    } else {\n      dataObject = this.serializeQueryParams(data, '', useArrayQuery, 0);\n    }\n\n    return dataObject;\n  }\n\n  public serializeQueryParams(obj: any, prefix: string, useArrayQuery: any, level = 0): string {\n    const parts: string[] = [];\n\n    for (let propName in obj) {\n      let propQueryName = this.encodeURIComponent(propName);\n      if (Utils.isArray(obj)) {\n        propQueryName = '';\n      }\n\n      const key = prefix ? prefix + `[${propQueryName}]` : propQueryName;\n      let value = obj[propName];\n\n      const isArrayVal = Utils.isArray(value);\n\n      if ((isArrayVal && (useArrayQuery || level === 0)) || Utils.isObject(value)) {\n        parts.push(this.serializeQueryParams(value, key, useArrayQuery, ++level));\n      } else {\n        value = isArrayVal ? value.sort().join(',') : value;\n        parts.push(`${key}=${this.encodeURIComponent(value)}`);\n      }\n    }\n\n    return parts.sort().join('&');\n  }\n\n  public encodeURIComponent(uriComponent: string | number | boolean): string {\n    return encodeURIComponent(uriComponent).replace(/[#$&+,/:;=?@\\[\\]]/g, (c) => `%${c.charCodeAt(0).toString(16)}`);\n  }\n\n  public abortRequest(abortId: string | number): void {\n    if (this.abortControllersMap[abortId]) {\n      const controllers = this.abortControllersMap[abortId].controllers || [];\n\n      controllers.forEach((controller) => {\n        controller.abort();\n      });\n    }\n  }\n\n  public processSuccessfulOrFailedRequest(abort_id?: string | number): void {\n    if (!abort_id || !this.abortControllersMap[abort_id]) {\n      return;\n    }\n\n    const controllers = this.abortControllersMap[abort_id].controllers || [];\n\n    if (!this.abortControllersMap[abort_id].doneRequestsCount) {\n      this.abortControllersMap[abort_id].doneRequestsCount = 1;\n    } else {\n      this.abortControllersMap[abort_id].doneRequestsCount += 1;\n    }\n\n    const doneRequestsCount = this.abortControllersMap[abort_id].doneRequestsCount;\n\n    if (doneRequestsCount === controllers.length) {\n      delete this.abortControllersMap[abort_id];\n    }\n  }\n\n  public async ajax<T>(params: Proxy.Params): Promise<T> {\n    const requestId = ++this.requestsNumber;\n\n    return new Promise((resolve, reject) => {\n      this.logRequest(params, requestId);\n\n      const requestAndURL = this.buildRequestAndURL(params);\n      const requestObject = requestAndURL[0];\n      const requestURL = requestAndURL[1];\n      const abort_id = params.abort_id;\n\n      if (abort_id) {\n        let index = 0;\n\n        if (this.abortControllersMap[abort_id]) {\n          const controllers = this.abortControllersMap[abort_id].controllers || [];\n          this.abortControllersMap[abort_id].controllers.push(new AbortController());\n          index = controllers.length - 1;\n        } else {\n          this.abortControllersMap[abort_id] = {\n            controllers: [new AbortController()],\n          };\n        }\n        const signal = this.abortControllersMap[abort_id].controllers[index].signal;\n        Object.assign(requestObject, { signal });\n      }\n\n      let response;\n\n      // The Promise returned from fetch() wont reject on HTTP error\n      // status even if the response is an HTTP 404 or 500.\n      // Instead, it will resolve normally (with ok status set to false),\n      // and it will only reject on network failure or if anything prevented the request from completing.\n      fetchImpl(requestURL, requestObject)\n        .then((resp) => {\n          response = resp;\n          const dataType = params.dataType || ProxyType.JSON;\n          return dataType === ProxyType.TEXT ? response.text() : response.json();\n        })\n        .then((body) => {\n          this.processSuccessfulOrFailedRequest(abort_id);\n          if (!response.ok) {\n            this.processAjaxError(response, body, null, reject, resolve, params, requestId);\n          } else {\n            this.processAjaxResponse(body, resolve, requestId);\n          }\n        })\n        .catch((error) => {\n          this.processSuccessfulOrFailedRequest(abort_id);\n          this.processAjaxError(response, ' ', error, reject, resolve, params, requestId);\n        });\n    });\n  }\n\n  public processAjaxResponse(body: any, resolve: (value: any) => void, requestId: number): void {\n    const responseBody = body && body !== ' ' ? body : 'empty body';\n    this.logResponse(responseBody, requestId);\n\n    resolve(body);\n  }\n\n  public processAjaxError(\n    response: Response | null,\n    body: any,\n    error: any,\n    reject: (reason?: any) => void,\n    resolve: (value: any) => void,\n    params: Proxy.Params,\n    requestId: number\n  ): void {\n    if (!response && error && !error.code) {\n      reject(error);\n      return;\n    }\n\n    const statusCode = response?.status;\n    const errorObject = {\n      code: (response && statusCode) || (error && error.code),\n      info: (body && typeof body === 'string' && body !== ' ' ? JSON.parse(body) : body) || (error && error.errno),\n    };\n\n    const responseBody = body || error || body.errors;\n    this.logResponse(responseBody, requestId);\n\n    if (response?.url.indexOf(config.urls.session) === -1) {\n      if (this.isExpiredSessionError(errorObject) && typeof config.on.sessionExpired === 'function') {\n        this.handleExpiredSessionResponse(errorObject, null, reject, resolve, params);\n      } else {\n        reject(errorObject);\n      }\n    } else {\n      reject(errorObject);\n    }\n  }\n\n  public handleExpiredSessionResponse(\n    error: any,\n    response: any,\n    reject: (reason?: any) => void,\n    resolve: (value: any) => void,\n    params: Proxy.Params\n  ): void {\n    const handleResponse = () => {\n      if (error) {\n        reject(error);\n      } else {\n        resolve(response);\n      }\n    };\n\n    const retryCallback = (session: Proxy.SDKInstance['session']) => {\n      if (session) {\n        this.setSession(session);\n        this.ajax(params).then(resolve).catch(reject);\n      }\n    };\n\n    if (typeof config.on.sessionExpired === 'function') {\n      config.on.sessionExpired(handleResponse, retryCallback);\n    }\n  }\n\n  private isExpiredSessionError(error: { code?: number; info?: { errors?: { base?: string[] } } }): boolean {\n    try {\n      return error && error.code === 401 && error.info?.errors?.base?.[0] === 'Required session does not exist';\n    } catch {\n      return false;\n    }\n  }\n}\n","import { base64Encode } from './platform';\nimport config from './config';\nimport ProxyService from './Proxy';\nimport Utils from './Utils';\nimport { EmptyResponse, PushNotifications } from './types';\nimport { ProxyMethod, ProxyType } from './types/proxy';\n\nexport default class PushNotificationsService {\n  public proxy: ProxyService;\n  public subscriptions: SubscriptionsService;\n  public events: EventsService;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n    this.subscriptions = new SubscriptionsService(proxy);\n    this.events = new EventsService(proxy);\n  }\n\n  public base64Encode = base64Encode;\n}\n\nclass SubscriptionsService {\n  public proxy: ProxyService;\n  readonly route = config.urls.subscriptions;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async create(params: PushNotifications.SubscriptionsCreateParams): Promise<PushNotifications.Subscription> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async list(): Promise<PushNotifications.Subscription[]> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(id: string | number): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      dataType: ProxyType.TEXT,\n      url: Utils.getUrl(this.route, id),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n\nclass EventsService {\n  public proxy: ProxyService;\n  readonly route = config.urls.events;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async create(event: PushNotifications.EventsCreateParams): Promise<PushNotifications.Event[]> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: { event },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n","import ProxyService from './Proxy';\nimport Utils from './Utils';\nimport config from './config';\nimport { EmptyResponse, Proxy, Storage } from './types';\nimport { ProxyMethod, ProxyType } from './types/proxy';\n\nexport default class StorageService {\n  public proxy: ProxyService;\n  readonly route = config.urls.blobs;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async list(params: Storage.ListParams = {}): Promise<Storage.ListResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async create(params?: Storage.CreateParams): Promise<Storage.BlobResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: { blob: params },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(id: number | string): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, id),\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async createAndUpload(params: Storage.CreateAndUploadParams): Promise<Storage.Blob> {\n    const { name, file, size, abort_id, type: content_type, public: isPublic = true } = params;\n    const createParams = { name, content_type, public: isPublic };\n\n    let blob: Storage.Blob;\n\n    return this.create(createParams)\n      .then(({ blob: blobObject }) => {\n        blob = blobObject;\n        const uri = this.parseUri(blob.blob_object_access?.params);\n        const uploadUrl = `${uri.protocol}://${uri.authority}${uri.path}`;\n        const uploadParams: Proxy.Params = { url: uploadUrl, data: {} };\n\n        if (abort_id) {\n          uploadParams.abort_id = abort_id;\n        }\n\n        Object.keys(uri.queryKey).forEach((key) => {\n          uploadParams.data[key] = decodeURIComponent(uri.queryKey[key]);\n        });\n\n        uploadParams.data.file = file;\n\n        return this.upload(uploadParams).then(() => blob);\n      })\n      .then((blob) => this.markUploaded({ id: blob.id, size }).then(() => blob))\n      .then((blob) => ({ ...blob, size }));\n  }\n\n  public async upload(params: Proxy.Params): Promise<any> {\n    const ajaxParams = {\n      ...params,\n      type: ProxyMethod.POST,\n      dataType: ProxyType.TEXT,\n      contentType: false,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async markUploaded(params: Storage.MarkUploadedParams): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, params.id, 'complete'),\n      data: {\n        size: params.size,\n      },\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getInfo(id: number | string): Promise<Storage.BlobResponse> {\n    const ajaxParams = {\n      url: Utils.getUrl(this.route, id),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getFile(uid: string): Promise<Storage.BlobResponse> {\n    const ajaxParams = {\n      url: Utils.getUrl(this.route, uid),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getFileObject(uid: string, params: Storage.GetFileObjectParams): Promise<Storage.BlobResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, uid, 'object'),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async update(params: Storage.UpdateParams): Promise<Storage.BlobResponse> {\n    const data = { blob: {} as any };\n\n    if (typeof params.name !== 'undefined') {\n      data.blob.name = params.name;\n    }\n\n    const ajaxParams = {\n      url: Utils.getUrl(this.route, params.id),\n      data: data,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public privateUrl(fileUID: string = ''): string {\n    return `https://${config.endpoints.api}/blobs/${fileUID}?token=${this.proxy.getSession()?.token}`;\n  }\n\n  public publicUrl(fileUID: string = ''): string {\n    return `https://${config.endpoints.api}/blobs/${fileUID}`;\n  }\n\n  // parseUri 1.2.2\n  // (c) Steven Levithan <stevenlevithan.com>\n  // MIT License\n  // http://blog.stevenlevithan.com/archives/parseuri\n  private parseUri(str: string = ''): any {\n    const options = {\n      strictMode: false,\n      key: [\n        'source',\n        'protocol',\n        'authority',\n        'userInfo',\n        'user',\n        'password',\n        'host',\n        'port',\n        'relative',\n        'path',\n        'directory',\n        'file',\n        'query',\n        'anchor',\n      ],\n      q: {\n        name: 'queryKey',\n        parser: /(?:^|&)([^&=]*)=?([^&]*)/g,\n      },\n      parser: {\n        strict:\n          /^(?:([^:\\/?#]+):)?(?:\\/\\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?))?((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,\n        loose:\n          /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/,\n      },\n    };\n    const m = options.parser[options.strictMode ? 'strict' : 'loose'].exec(str) ?? {};\n\n    const uri = {};\n    let i = 14;\n\n    while (i--) {\n      uri[options.key[i]] = m[i] || '';\n    }\n\n    uri[options.q.name] = {};\n    uri[options.key[12]].replace(options.q.parser, ($0, $1, $2) => {\n      if ($1) {\n        uri[options.q.name][$1] = $2;\n      }\n    });\n\n    return uri;\n  }\n}\n","import config from './config';\nimport ProxyService from './Proxy';\nimport { EmptyResponse, Users } from './types';\nimport { ProxyMethod, ProxyType } from './types/proxy';\nimport Utils from './Utils';\n\nexport default class UsersService {\n  public proxy: ProxyService;\n  readonly route = config.urls.users;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async getV2(params: Users.GetV2Params): Promise<Users.GetV2Response> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, 'v2'),\n      useArrayQuery: true,\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async signup(user: Users.SignUpParams, auth_key?: string): Promise<Users.UserResponse> {\n    const ajaxParams = {\n      authKey: auth_key ?? config.creds.authKey,\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: { user },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async update(user: Users.UpdateParams = {}): Promise<Users.UserResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, this.proxy.getCurrentUserId()),\n      data: { user },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, this.proxy.getCurrentUserId()),\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async resetPassword(email: string = ''): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route, 'password', 'reset'),\n      data: { email },\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  /**\n   * @deprecated Use `getV2(params)` instead.\n   */\n  public async get(params: any): Promise<Users.OldGetResponse | Users.UserResponse> {\n    let data = Utils.cloneObject(params);\n    let url: string | number = '';\n\n    const filters: string[] = [];\n    const dateFields = ['created_at', 'updated_at', 'last_request_at'];\n    const numberFields = ['id', 'external_user_id'];\n    const extensions = {\n      login: 'by_login',\n      full_name: 'by_full_name',\n      facebook_id: 'by_facebook_id',\n      twitter_id: 'by_twitter_id',\n      phone: 'phone',\n      email: 'by_email',\n      tags: 'by_tags',\n      external: 'external',\n    };\n\n    function generateFilter(filter: any): string {\n      const obj = Utils.cloneObject(filter);\n      let type = dateFields.includes(obj.field) ? 'date' : typeof obj.value;\n\n      if (Utils.isArray(obj.value)) {\n        if (type === 'object') {\n          type = typeof obj.value[0];\n        }\n        obj.value = obj.value.toString();\n      }\n\n      return [type, obj.field, obj.param, obj.value].join(' ');\n    }\n\n    if (data.order) {\n      const type = data.order.field in dateFields ? 'date' : data.order.field in numberFields ? 'number' : 'string';\n      data.order = [data.order.sort, type, data.order.field].join(' ');\n    }\n\n    if (data && data.filter) {\n      if (Utils.isArray(data.filter)) {\n        data.filter.forEach((filter) => {\n          filters.push(generateFilter(filter));\n        });\n      } else {\n        filters.push(generateFilter(data.filter));\n      }\n      data.filter = filters;\n    }\n\n    if (typeof data === 'number') {\n      url = data;\n      data = undefined;\n    } else {\n      for (const key in extensions) {\n        if (data[key]) {\n          url = extensions[key];\n\n          if (key === extensions.external) {\n            url += `/${data[extensions.external]}`;\n            data = undefined;\n          }\n\n          break;\n        }\n      }\n    }\n\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, url),\n      data,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n","import config from '../config';\n\nexport default class WebRTCHelpers {\n  static getUserJid(id: string | number): string {\n    return `${id}-${config.creds.appId}@${config.endpoints.chat}`;\n  }\n\n  static getUserIdFromJID(jid: string): number | null {\n    return jid?.includes('@') ? parseInt(jid.split('@')[0].split('-')[0]) : null;\n  }\n\n  static trace(text: string): void {\n    if (config.debug) {\n      console.log('[VideoChat]:', text);\n    }\n  }\n\n  static traceWarning(text: string): void {\n    if (config.debug) {\n      console.warn('[VideoChat]:', text);\n    }\n  }\n\n  static traceError(text: string): void {\n    if (config.debug) {\n      console.error('[VideoChat]:', text);\n    }\n  }\n\n  static get getVersionFirefox(): number {\n    const ua = navigator?.userAgent ?? null;\n    let version = 0;\n    if (ua) {\n      const ffInfo = ua.match(/(?:firefox)[ \\/](\\d+)/i) || [];\n      version = ffInfo[1] ? +ffInfo[1] : 0;\n    }\n    return typeof version === 'string' ? parseInt(version) : version;\n  }\n\n  static get getVersionSafari(): number {\n    const ua = navigator?.userAgent ?? null;\n    let version = 0;\n    if (ua) {\n      const sInfo = ua.match(/(?:safari)[ \\/](\\d+)/i) || [];\n      if (sInfo.length) {\n        const sVer = ua.match(/(?:version)[ \\/](\\d+)/i) || [];\n        if (sVer) {\n          version = sVer[1] ? +sVer[1] : 0;\n        }\n      }\n    }\n\n    return typeof version === 'string' ? parseInt(version) : version;\n  }\n}\n","import { RTCPeerConnection, RTCSessionDescription, RTCIceCandidate, MediaStream } from '../platform';\nimport config from '../config';\nimport WebRTCSession from './WebRTCSession';\nimport WebRTCHelpers from './WebRTCHelpers';\nimport { PeerConnectionState, SessionConnectionState } from '../types/calls';\nimport { Calls, Config } from '../types';\n\nexport default class WebRTCPeerConnection {\n  public original: RTCPeerConnection;\n  public session: WebRTCSession;\n  public userID: number;\n  public type: RTCSdpType;\n  public remoteSDP: string | null = null;\n  public state: PeerConnectionState = PeerConnectionState.NEW;\n  public iceCandidates: RTCIceCandidateInit[] = [];\n  public remoteStream: MediaStream = new MediaStream();\n  public answerTimeInterval: number = 0;\n  public onStatusClosedChecker: NodeJS.Timeout | null = null;\n  public dialingTimer: NodeJS.Timeout | null = null;\n  public statsReportTimer: NodeJS.Timeout | null = null;\n  public waitingReconnectTimeoutCallback: NodeJS.Timeout | null = null;\n  public released: boolean = false;\n\n  constructor(session: WebRTCSession, userID: number, type: RTCSdpType) {\n    this.create();\n    this.setup(session, userID, type);\n  }\n\n  private create() {\n    const rtcConfiguration: RTCConfiguration = {\n      iceTransportPolicy: (config.videochat.alwaysRelayCalls ? 'relay' : 'all') as RTCIceTransportPolicy,\n      iceServers: config.videochat.iceServers.map(\n        (item: Config.VideochatIceServer): RTCIceServer => ({\n          urls: item.urls ?? item.url,\n          username: item.username,\n          credential: item.credential,\n        })\n      ) as RTCIceServer[],\n    };\n\n    this.original = RTCPeerConnection ? new RTCPeerConnection(rtcConfiguration) : ({} as any);\n\n    WebRTCHelpers.trace(`new RTCPeerConnection(${JSON.stringify(rtcConfiguration, null, 2)})`);\n  }\n\n  private setup(session: WebRTCSession, userID: number, type: RTCSdpType): void {\n    this.type = type;\n    this.userID = userID;\n    this.session = session;\n    this.session.startCallTime = new Date();\n\n    this.original.ontrack = this.onMediaTrackHandler;\n    this.original.onicecandidate = this.onIceCandidateHandler;\n    this.original.onsignalingstatechange = this.onSignalingStateHandler;\n    this.original.oniceconnectionstatechange = this.onIceConnectionStateHandler;\n\n    WebRTCHelpers.trace(`RTCPeerConnection init. userID: ${userID}, sessionID: ${session.ID}, type: ${type}`);\n  }\n\n  private onMediaTrackHandler = (event: RTCTrackEvent): void => {\n    this.remoteStream.addTrack(event.track);\n\n    if (\n      (this.session.callType == 1 && this.remoteStream.getVideoTracks().length) ||\n      (this.session.callType == 2 && this.remoteStream.getAudioTracks().length)\n    ) {\n      this.session.onRemoteStream(this.userID, this.remoteStream);\n    }\n\n    this.getWrappedStats();\n  };\n\n  private onIceCandidateHandler = (event: RTCPeerConnectionIceEvent): void => {\n    if (event.candidate) {\n      const { sdpMLineIndex, sdpMid, candidate } = event.candidate;\n      const iceCandidate: RTCIceCandidateInit = { sdpMLineIndex, sdpMid, candidate };\n\n      if (this.signalingState === 'stable') {\n        this.session.processIceCandidates(this.userID, [iceCandidate]);\n      } else {\n        this.iceCandidates.push(iceCandidate);\n      }\n    }\n  };\n\n  private onSignalingStateHandler = (): void => {\n    WebRTCHelpers.trace(`onSignalingStateHandler: ${this.signalingState}`);\n\n    if (this.signalingState === 'stable' && this.iceCandidates.length > 0) {\n      this.session.processIceCandidates(this.userID, this.iceCandidates);\n      this.iceCandidates.length = 0;\n    }\n  };\n\n  /** handler of remote media stream */\n  private onIceConnectionStateHandler = (): void => {\n    WebRTCHelpers.trace(`onIceConnectionStateHandler: ${this.iceConnectionState}`);\n\n    if (this.onStatusClosedChecker && WebRTCHelpers.getVersionSafari >= 11) {\n      clearTimeout(this.onStatusClosedChecker);\n    }\n\n    switch (this.iceConnectionState) {\n      case 'checking':\n        this.state = PeerConnectionState.CHECKING;\n        this.session.onSessionConnectionStateChanged(this.userID, SessionConnectionState.CONNECTING);\n        break;\n      case 'connected':\n        this.state = PeerConnectionState.CONNECTED;\n        this.clearWaitingReconnectTimer();\n        this.session.onSessionConnectionStateChanged(this.userID, SessionConnectionState.CONNECTED);\n        break;\n      case 'completed':\n        this.state = PeerConnectionState.COMPLETED;\n        this.clearWaitingReconnectTimer();\n        this.session.onSessionConnectionStateChanged(this.userID, SessionConnectionState.COMPLETED);\n        break;\n      case 'failed':\n        this.state = PeerConnectionState.FAILED;\n        this.session.onSessionConnectionStateChanged(this.userID, SessionConnectionState.FAILED);\n        break;\n      case 'disconnected':\n        this.state = PeerConnectionState.DISCONNECTED;\n        this.startWaitingReconnectTimer();\n        this.session.onSessionConnectionStateChanged(this.userID, SessionConnectionState.DISCONNECTED);\n        if (WebRTCHelpers.getVersionSafari >= 11) {\n          this.onStatusClosedChecker = setTimeout(() => {\n            this.onIceConnectionStateHandler(); // repeat to get status \"closed\"\n          }, 500);\n        }\n        break;\n      case 'closed': // TODO: this state doesn't fires on Safari 11\n        this.state = PeerConnectionState.CLOSED;\n        this.clearWaitingReconnectTimer();\n        this.session.onSessionConnectionStateChanged(this.userID, SessionConnectionState.CLOSED);\n        break;\n      default:\n        break;\n    }\n  };\n\n  private clearWaitingReconnectTimer(): void {\n    if (this.waitingReconnectTimeoutCallback) {\n      WebRTCHelpers.trace('clearWaitingReconnectTimer');\n      clearTimeout(this.waitingReconnectTimeoutCallback);\n      this.waitingReconnectTimeoutCallback = null;\n    }\n  }\n\n  private startWaitingReconnectTimer(): void {\n    const timeout = config.videochat.disconnectTimeInterval * 1000;\n    WebRTCHelpers.trace(`startWaitingReconnectTimer, timeout: ${timeout}`);\n\n    this.waitingReconnectTimeoutCallback = setTimeout(() => {\n      WebRTCHelpers.trace('waitingReconnectTimeoutCallback');\n      if (this.waitingReconnectTimeoutCallback) {\n        clearTimeout(this.waitingReconnectTimeoutCallback);\n      }\n      this.release();\n      this.session.closeSessionIfAllConnectionsClosed();\n    }, timeout);\n  }\n\n  private clearStatsReportTimer(): void {\n    if (this.statsReportTimer) {\n      clearInterval(this.statsReportTimer);\n      this.statsReportTimer = null;\n    }\n  }\n\n  public async addCandidates(iceCandidates: RTCIceCandidateInit[]): Promise<void[]> {\n    const addIceCandidatesPromises = iceCandidates.reduce(\n      (promises: Promise<void>[], { sdpMLineIndex, sdpMid, candidate }: RTCIceCandidateInit) => {\n        if (candidate) {\n          const iceCandidate = new RTCIceCandidate({ sdpMLineIndex, sdpMid, candidate });\n          const addIceCandidatePromise = this.addIceCandidate(iceCandidate).catch((error) => {\n            WebRTCHelpers.traceError(`Error on 'addIceCandidate': ${error}`);\n          });\n          promises.push(addIceCandidatePromise);\n        }\n        return promises;\n      },\n      []\n    );\n\n    return Promise.all(addIceCandidatesPromises);\n  }\n\n  public release(): void {\n    this.clearDialingTimer();\n    this.clearStatsReportTimer();\n    this.close();\n    if (WebRTCHelpers.getVersionSafari >= 11) {\n      this.onIceConnectionStateHandler(); // TODO: 'closed' state doesn't fires on Safari 11 (do it manually)\n    }\n    this.released = true;\n  }\n\n  public clearDialingTimer(): void {\n    if (this.dialingTimer) {\n      WebRTCHelpers.trace('clearDialingTimer');\n      clearInterval(this.dialingTimer);\n      this.dialingTimer = null;\n      this.answerTimeInterval = 0;\n    }\n  }\n\n  public async getAndSetLocalSessionDescription(\n    maxBandwidth: number,\n    iceRestart: boolean = false\n  ): Promise<RTCSessionDescriptionInit> {\n    this.state = PeerConnectionState.CONNECTING;\n\n    try {\n      const offerOptions = iceRestart ? { iceRestart } : undefined;\n      const sessionDescription =\n        this.type === 'offer' ? await this.createOffer(offerOptions) : await this.createAnswer();\n\n      await this.setLocalDescription(sessionDescription);\n      await this.setRTCRtpSenderMaxBandwidth(maxBandwidth);\n\n      return sessionDescription;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  public async setRTCRtpSenderMaxBandwidth(maxBandwidth: number): Promise<any> {\n    const senders = this.getSenders() || [];\n    const setParamsPromises = senders.reduce((promises: Promise<void>[], sender: RTCRtpSender) => {\n      if (sender.track?.kind === 'video') {\n        const params = sender.getParameters();\n\n        if (!params.encodings) {\n          params.encodings = [];\n        }\n\n        if (!maxBandwidth) {\n          delete params.encodings[0]?.maxBitrate;\n        } else {\n          params.encodings[0].maxBitrate = maxBandwidth * 1000;\n        }\n\n        promises.push(\n          sender\n            .setParameters(params)\n            .then(() => {\n              WebRTCHelpers.trace(`Set maxBandwidth success [${this.userID}]: ${maxBandwidth} kbps`);\n            })\n            .catch((error) => {\n              WebRTCHelpers.trace(`Set maxBandwidth error [${this.userID}]: ${error}`);\n            })\n        );\n      }\n\n      return promises;\n    }, []);\n\n    return Promise.all(setParamsPromises);\n  }\n\n  public startDialingTimer(extension: Calls.ExtensionParams, withOnNotAnswerCallback: boolean): void {\n    const dialingTimeInterval = config.videochat.dialingTimeInterval * 1000;\n\n    WebRTCHelpers.trace(`startDialingTimer, dialingTimeInterval: ${JSON.stringify(dialingTimeInterval)}`);\n\n    const dialingCallback = (extension, withOnNotAnswerCallback, skipIncrement) => {\n      if (!skipIncrement) {\n        this.answerTimeInterval += config.videochat.dialingTimeInterval * 1000;\n      }\n\n      WebRTCHelpers.trace(`dialingCallback, extension: ${JSON.stringify(extension)}`);\n\n      if (this.answerTimeInterval >= config.videochat.answerTimeInterval * 1000) {\n        this.clearDialingTimer();\n\n        if (withOnNotAnswerCallback) {\n          this.session.processOnNotAnswer(this);\n        }\n      } else {\n        this.session.processCall(this, extension);\n      }\n    };\n\n    this.dialingTimer = setInterval(dialingCallback, dialingTimeInterval, extension, withOnNotAnswerCallback, false);\n\n    dialingCallback(extension, withOnNotAnswerCallback, true); // call for the 1st time\n  }\n\n  public async setRemoteSessionDescription(type: RTCSdpType, sdp: string): Promise<void> {\n    const desc = new RTCSessionDescription({ sdp, type });\n    return this.setRemoteDescription(desc);\n  }\n\n  private getWrappedStats(): void {\n    if (config.videochat.statsReportTimeInterval) {\n      let lastResult;\n\n      WebRTCHelpers.trace('Stats tracker has been started');\n\n      this.statsReportTimer = setInterval(() => {\n        this.getStatsCustom(\n          lastResult,\n          (results, lastResults) => {\n            lastResult = lastResults;\n            this.session.onCallStatsReport(this.userID, results);\n          },\n          (err) => {\n            WebRTCHelpers.traceError(`Get stats error. ${err.name}: ${err.message}`);\n            this.session.onCallStatsReport(this.userID, null, err);\n          }\n        );\n      }, config.videochat.statsReportTimeInterval * 1000);\n    }\n  }\n\n  set sdpRemote(sdp: string) {\n    if (sdp) {\n      this.remoteSDP = sdp;\n    }\n  }\n\n  get sdpRemote(): string | null {\n    return this.remoteSDP;\n  }\n\n  toString(): string {\n    return `sessionID: ${this.session.ID}, userID: ${this.userID}, type: ${this.type}, state: ${this.state}`;\n  }\n\n  private getStatsCustom(\n    lastResults: RTCStatsReport,\n    onSuccess: (results: any, lastResults: any) => void,\n    onFail: (err: Error) => void\n  ) {\n    const obj = { audio: {} as any, video: {} as any, candidate: {} as any };\n    const statistic = { local: Object.assign({}, obj), remote: Object.assign({}, obj) };\n\n    if (WebRTCHelpers.getVersionFirefox) {\n      const localStream = this.session.localStream;\n      const localVideoSettings = localStream?.getVideoTracks()[0].getSettings();\n\n      if (localVideoSettings) {\n        statistic.local.video.frameHeight = localVideoSettings.height;\n        statistic.local.video.frameWidth = localVideoSettings.width;\n      }\n    }\n\n    this.getStats().then((results: RTCStatsReport) => {\n      results.forEach((result) => {\n        let item;\n\n        if (result.bytesReceived && result.type === 'inbound-rtp') {\n          item = statistic.remote[result.mediaType];\n          item.bitrate = this.getBitratePerSecond(result, lastResults, false);\n          item.bytesReceived = result.bytesReceived;\n          item.packetsReceived = result.packetsReceived;\n          item.timestamp = result.timestamp;\n          if (result.mediaType === 'video' && result.framerateMean) {\n            item.framesPerSecond = Math.round(result.framerateMean * 10) / 10;\n          }\n        } else if (result.bytesSent && result.type === 'outbound-rtp') {\n          item = statistic.local[result.mediaType];\n          item.bitrate = this.getBitratePerSecond(result, lastResults, true);\n          item.bytesSent = result.bytesSent;\n          item.packetsSent = result.packetsSent;\n          item.timestamp = result.timestamp;\n          if (result.mediaType === 'video' && result.framerateMean) {\n            item.framesPerSecond = Math.round(result.framerateMean * 10) / 10;\n          }\n        } else if (result.type === 'local-candidate') {\n          item = statistic.local.candidate;\n          if (result.candidateType === 'host' && result.mozLocalTransport === 'udp' && result.transport === 'udp') {\n            item.protocol = result.transport;\n            item.ip = result.ipAddress;\n            item.port = result.portNumber;\n          } else if (!WebRTCHelpers.getVersionFirefox) {\n            item.protocol = result.protocol;\n            item.ip = result.ip;\n            item.port = result.port;\n          }\n        } else if (result.type === 'remote-candidate') {\n          item = statistic.remote.candidate;\n          item.protocol = result.protocol || result.transport;\n          item.ip = result.ip || result.ipAddress;\n          item.port = result.port || result.portNumber;\n        } else if (result.type === 'track' && result.kind === 'video' && !WebRTCHelpers.getVersionFirefox) {\n          if (result.remoteSource) {\n            item = statistic.remote.video;\n            item.frameHeight = result.frameHeight;\n            item.frameWidth = result.frameWidth;\n            item.framesPerSecond = this.getFramesPerSecond(result, lastResults, false);\n          } else {\n            item = statistic.local.video;\n            item.frameHeight = result.frameHeight;\n            item.frameWidth = result.frameWidth;\n            item.framesPerSecond = this.getFramesPerSecond(result, lastResults, true);\n          }\n        }\n      });\n      onSuccess(statistic, results);\n    }, onFail);\n  }\n\n  private getBitratePerSecond(result: any, lastResults: any, isLocal: boolean): number {\n    const lastResult = lastResults.get(result.id);\n    const seconds = lastResult ? (result.timestamp - lastResult.timestamp) / 1000 : 5;\n    const kilo = 1024;\n    const bit = 8;\n    const bitrate = !lastResult\n      ? 0\n      : isLocal\n        ? (bit * (result.bytesSent - lastResult.bytesSent)) / (kilo * seconds)\n        : (bit * (result.bytesReceived - lastResult.bytesReceived)) / (kilo * seconds);\n\n    return Math.round(bitrate);\n  }\n\n  private getFramesPerSecond(result: any, lastResults: any, isLocal: boolean): number {\n    const lastResult = lastResults && lastResults.get(result.id);\n    const seconds = lastResult ? (result.timestamp - lastResult.timestamp) / 1000 : 5;\n    const framesPerSecond = !lastResult\n      ? 0\n      : isLocal\n        ? (result.framesSent - lastResult.framesSent) / seconds\n        : (result.framesReceived - lastResult.framesReceived) / seconds;\n\n    return Math.round(framesPerSecond * 10) / 10;\n  }\n\n  // original RTCPeerConnection methods\n  getSenders(): RTCRtpSender[] {\n    return this.original.getSenders?.() ?? [];\n  }\n  createOffer(options?: RTCOfferOptions | any): Promise<RTCSessionDescriptionInit> {\n    return this.original.createOffer?.(options) ?? Promise.resolve({} as RTCSessionDescriptionInit);\n  }\n  createAnswer(options?: RTCOfferOptions | any): Promise<RTCSessionDescriptionInit> {\n    return this.original.createAnswer?.(options) ?? Promise.resolve({} as RTCSessionDescriptionInit);\n  }\n  setRemoteDescription(description: RTCSessionDescriptionInit | any): Promise<void> {\n    return this.original.setRemoteDescription?.(description) ?? Promise.resolve();\n  }\n  setLocalDescription(description: RTCSessionDescriptionInit | any): Promise<void> {\n    return this.original.setLocalDescription?.(description) ?? Promise.resolve();\n  }\n  getStats(): Promise<RTCStatsReport> {\n    return this.original.getStats?.() ?? Promise.resolve(new Map() as any);\n  }\n  close(): void {\n    this.original.close?.();\n  }\n  addIceCandidate(candidate: RTCIceCandidateInit | any): Promise<void> {\n    return this.original.addIceCandidate?.(candidate) ?? Promise.resolve();\n  }\n  addTrack(track: MediaStreamTrack, stream: MediaStream): RTCRtpSender | any {\n    return this.original.addTrack?.(track, stream) ?? {};\n  }\n  get localDescription(): RTCSessionDescription | { type: string; sdp: any } {\n    return this.original.localDescription ?? { type: '', sdp: '' };\n  }\n  get signalingState(): RTCSignalingState | any {\n    return this.original.signalingState ?? 'closed';\n  }\n  get iceConnectionState(): RTCIceConnectionState | any {\n    return this.original.iceConnectionState ?? 'closed';\n  }\n}\n","import { mediaDevices } from '../platform';\nimport config from '../config';\nimport WebRTCPeerConnection from './WebRTCPeerConnection';\nimport WebRTCSignalingProvider from './WebRTCSignalingProvider';\nimport WebRTCHelpers from './WebRTCHelpers';\nimport Utils from '../Utils';\nimport { SignalingType, SessionState, PeerConnectionState, CallType, SessionConnectionState } from '../types/calls';\nimport { Calls, Media } from '../types';\n\nexport default class WebRTCSession {\n  public ID: string | null = null;\n  public state: SessionState = SessionState.NEW;\n  public callType: CallType;\n  public initiatorID: number;\n  public currentUserID: number;\n  public opponentsIDs: number[];\n  public maxBandwidth: number = 0;\n  public peerConnections: { [userID: number]: WebRTCPeerConnection } = {};\n  public localStream?: MediaStream;\n  public mediaParams: MediaStreamConstraints = {};\n  public signalingProvider: WebRTCSignalingProvider;\n  public answerTimer: NodeJS.Timeout | null = null;\n  public waitingOfferOrAnswerTimer: NodeJS.Timeout | null = null;\n  public startCallDate: Date;\n  public acceptCallDate: Date;\n  public onUserNotAnswerListener: Calls.OnUserNotAnswerListener;\n  public onRemoteStreamListener: Calls.OnRemoteStreamListener;\n  public onSessionCloseListener: Calls.OnSessionCloseListener;\n  public onCallStatsReportListener: Calls.OnCallStatsReportListener;\n  public onSessionConnectionStateChangedListener: Calls.OnSessionConnectionStateChangedListener;\n\n  constructor(params: Calls.WebRTCSessionParams) {\n    Object.assign(this, params, { ID: params.ID ?? generateUUID() });\n  }\n\n  public async getDisplayMedia(params: Media.DisplayParams): Promise<MediaStream> {\n    if (!mediaDevices.getDisplayMedia) {\n      throw new Error(\"Your environment does not support 'getDisplayMedia' API\");\n    }\n\n    const elementId = params && params.elementId;\n    const options = params && params.options;\n    const mediaParams = { ...params };\n\n    this.mediaParams = mediaParams;\n\n    delete mediaParams.elementId;\n    delete mediaParams.options;\n\n    try {\n      const stream = await mediaDevices.getDisplayMedia(mediaParams);\n      const localStream = this.upsertStream(stream, elementId, options);\n      return localStream;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  public async getUserMedia(params: Media.UserParams): Promise<MediaStream> {\n    const elementId = params && params.elementId;\n    const options = params && params.options;\n    const mediaParams = { ...params };\n\n    this.mediaParams = mediaParams;\n\n    delete mediaParams.elementId;\n    delete mediaParams.options;\n\n    try {\n      const stream = await mediaDevices.getUserMedia(mediaParams);\n      const localStream = this.upsertStream(stream, elementId, options);\n      return localStream;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  private upsertStream(stream: MediaStream, elementId?: string, options?: Media.ElementOptions): MediaStream {\n    const shouldUpdateCurrentStream = !!this.localStream;\n\n    if (shouldUpdateCurrentStream) {\n      this.replaceTracks(stream);\n    } else {\n      this.localStream = stream;\n    }\n\n    if (!this.localStream) {\n      throw new Error('Local stream is not defined');\n    }\n\n    if (elementId) {\n      if (shouldUpdateCurrentStream) {\n        this.detachMediaStream(elementId, options);\n      }\n      this.attachMediaStream(elementId, this.localStream, options);\n    }\n\n    return this.localStream;\n  }\n\n  private replaceTracks(stream: MediaStream): MediaStream {\n    this.localStream?.getTracks().forEach((localTrack) => {\n      if (localTrack.kind === 'audio' && stream.getAudioTracks().length === 0) {\n        return;\n      } else {\n        localTrack.stop();\n        this.localStream?.removeTrack(localTrack);\n      }\n    });\n\n    stream.getTracks().forEach((newTrack) => {\n      if (newTrack.kind === 'audio') {\n        newTrack.enabled = this.localStream?.getAudioTracks().every(({ enabled }) => enabled) ?? true;\n      } else {\n        newTrack.enabled = this.localStream?.getVideoTracks().every(({ enabled }) => enabled) ?? true;\n      }\n\n      if (newTrack) {\n        Object.values(this.peerConnections).forEach((pc) => {\n          pc\n            .getSenders()\n            .find(({ track }) => newTrack.kind === track?.kind)\n            ?.replaceTrack(newTrack);\n        });\n        this.localStream?.addTrack(newTrack);\n      }\n    });\n\n    if (!this.localStream) {\n      throw new Error('Local stream is not defined');\n    }\n\n    return this.localStream;\n  }\n\n  public async setMaxBandwidth(maxBandwidth: number): Promise<any> {\n    const peers = this.peerConnections;\n    const peersKeys = Object.keys(peers);\n\n    if (peersKeys.length < 1) {\n      WebRTCHelpers.trace(\"No 'RTCPeerConnection' to set 'maxBandwidth'\");\n      return;\n    }\n\n    return Promise.all(peersKeys.map((userID) => peers[userID].setRTCRtpSenderMaxBandwidth(maxBandwidth)));\n  }\n\n  public connectionStateForUser(userID: number): PeerConnectionState | null {\n    const peerConnection = this.peerConnections[userID];\n    return peerConnection ? peerConnection.state : null;\n  }\n\n  public attachMediaStream(elementId: string, stream: MediaStream, opt?: Media.ElementOptions): void {\n    const mediaElement = document.getElementById(elementId) as HTMLMediaElement;\n\n    if ('srcObject' in mediaElement) {\n      mediaElement.srcObject = stream;\n      mediaElement.style.transform = opt?.mirror ? 'scaleX(-1)' : 'none';\n      if (typeof opt?.muted === 'boolean') {\n        mediaElement.muted = opt?.muted;\n      }\n      mediaElement.onloadedmetadata = (_event: Event) => {\n        mediaElement.play();\n      };\n    } else {\n      throw new Error(`Unable to attach media stream, element #${elementId} is undefined`);\n    }\n  }\n\n  public detachMediaStream(elementId: string, opt?: Media.ElementOptions): void {\n    const mediaElement = document.getElementById(elementId) as HTMLMediaElement;\n\n    if ('srcObject' in mediaElement) {\n      mediaElement.pause();\n      mediaElement.srcObject = null;\n      mediaElement.style.transform = opt?.mirror ? 'scaleX(-1)' : 'none';\n      if (typeof opt?.muted === 'boolean') {\n        mediaElement.muted = opt?.muted;\n      }\n    } else {\n      throw new Error(`Unable to attach media stream, element #${elementId} is undefined`);\n    }\n  }\n\n  public async switchMediaTracks(options: Media.TrackConstraintsOrDeviceIds = {}): Promise<MediaStream> {\n    Utils.DLog('switchMediaTracks:', options);\n\n    ['audio', 'video'].forEach((type) => {\n      const device = type === 'audio' ? options.audio : type === 'audio' ? options.video : {};\n      const deviceId = typeof device === 'string' ? device : device?.deviceId;\n\n      if (deviceId) {\n        if (typeof this.mediaParams[type] !== 'object') {\n          this.mediaParams[type].deviceId = deviceId;\n        } else {\n          this.mediaParams[type] = { deviceId };\n        }\n      }\n    });\n\n    try {\n      const constrains = { audio: this.mediaParams.audio || false, video: this.mediaParams.video || false };\n      const stream = await mediaDevices.getUserMedia(constrains);\n      const localStream = this.replaceTracks(stream);\n      return localStream;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  public call(extension: Calls.UserInfo = {}): void {\n    const ext = prepareExtension(extension);\n\n    WebRTCHelpers.trace(`Call, extension: ${JSON.stringify(ext)}`);\n\n    this.state = SessionState.ACTIVE;\n    this.maxBandwidth = Number(ext.userInfo?.maxBandwidth ?? 0);\n    this.opponentsIDs.forEach((userID) => {\n      this.callInternal(userID, ext, true);\n    });\n  }\n\n  private async callInternal(\n    userID: number,\n    extension: Calls.ExtensionParams,\n    withOnNotAnswerCallback: boolean\n  ): Promise<void> {\n    const pc = new WebRTCPeerConnection(this, userID, 'offer');\n\n    this.localStream?.getTracks().forEach((track) => {\n      if (this.localStream) {\n        pc.addTrack(track, this.localStream);\n      }\n    });\n    this.peerConnections[userID] = pc;\n\n    try {\n      await pc.getAndSetLocalSessionDescription(this.maxBandwidth);\n      pc.startDialingTimer(extension, withOnNotAnswerCallback); // call requests to user\n      WebRTCHelpers.trace('getAndSetLocalSessionDescription success');\n    } catch (error) {\n      WebRTCHelpers.traceError(`getAndSetLocalSessionDescription error: ${error}`);\n    }\n  }\n\n  public accept(extension: Calls.UserInfo = {}): void {\n    const ext = prepareExtension(extension);\n\n    WebRTCHelpers.trace(`Accept, extension: ${JSON.stringify(ext)}`);\n\n    if (this.state === SessionState.ACTIVE) {\n      WebRTCHelpers.traceError(\"Can't accept, the session is already active, return\");\n      return;\n    }\n\n    if (this.state === SessionState.CLOSED) {\n      WebRTCHelpers.traceError(\"Can't accept, the session is already closed, return\");\n      this.stop({});\n      return;\n    }\n\n    this.state = SessionState.ACTIVE;\n    this.acceptCallTime = new Date();\n    this.clearAnswerTimer();\n    this.acceptInternal(this.initiatorID, ext);\n\n    // group call\n    const opponentsIDs = this.opponentsIDs.filter((userID) => userID !== this.initiatorID);\n\n    if (opponentsIDs.length > 0) {\n      this.startWaitingOfferOrAnswerTimer();\n      opponentsIDs.forEach((opponentID) => {\n        if (this.currentUserID > opponentID) {\n          this.callInternal(opponentID, extension, true);\n        }\n      });\n    }\n  }\n\n  private async acceptInternal(userID: number, extension: Calls.ExtensionParams): Promise<void> {\n    const pc = this.peerConnections[userID];\n\n    if (!pc || !pc.sdpRemote) {\n      WebRTCHelpers.traceError(\"Can't accept the call, there is no information about peer connection by some reason\");\n      return;\n    }\n\n    this.localStream?.getTracks().forEach((track) => {\n      if (this.localStream) {\n        pc.addTrack(track, this.localStream);\n      }\n    });\n\n    try {\n      await pc.setRemoteSessionDescription('offer', pc.sdpRemote);\n      await pc.getAndSetLocalSessionDescription(this.maxBandwidth);\n\n      const ext = Object.assign({}, extension, {\n        sessionID: this.ID,\n        callType: this.callType,\n        callerID: this.initiatorID,\n        opponentsIDs: this.opponentsIDs,\n        sdp: pc.localDescription.sdp,\n      });\n\n      this.signalingProvider.sendMessage(userID, ext, SignalingType.ACCEPT);\n    } catch (error) {\n      WebRTCHelpers.traceError(`[acceptInternal] Error: ${error}`);\n    }\n  }\n\n  public reject(extension: Calls.UserInfo = {}): void {\n    const ext = prepareExtension(extension);\n\n    WebRTCHelpers.trace(`Reject, extension: ${JSON.stringify(ext.userInfo)}`);\n\n    this.state = SessionState.REJECTED;\n    this.clearAnswerTimer();\n    Object.assign(ext, {\n      sessionID: this.ID,\n      callType: this.callType,\n      callerID: this.initiatorID,\n      opponentsIDs: this.opponentsIDs,\n    });\n\n    Object.keys(this.peerConnections).forEach((userID) => {\n      this.signalingProvider.sendMessage(Number(userID), ext, SignalingType.REJECT);\n    });\n\n    this.close();\n  }\n\n  public stop(extension: Calls.UserInfo = {}): void {\n    const ext = prepareExtension(extension);\n\n    WebRTCHelpers.trace(`Stop, extension: ${JSON.stringify(ext.userInfo)}`);\n\n    this.state = SessionState.HUNGUP;\n\n    if (this.answerTimer) {\n      this.clearAnswerTimer();\n    }\n\n    Object.assign(ext, {\n      sessionID: this.ID,\n      callType: this.callType,\n      callerID: this.initiatorID,\n      opponentsIDs: this.opponentsIDs,\n    });\n\n    Object.keys(this.peerConnections).forEach((userID) => {\n      this.signalingProvider.sendMessage(Number(userID), ext, SignalingType.STOP);\n    });\n\n    this.close();\n  }\n\n  public canInitiateIceRestart(userID: number): boolean {\n    return this.peerConnections[userID]?.type === 'offer';\n  }\n\n  public async iceRestart(userID: number): Promise<void> {\n    const pc = this.peerConnections[userID];\n\n    if (!pc) {\n      WebRTCHelpers.traceError(\"Can't restart ice, there is no information about peer connection by some reason\");\n      return;\n    }\n\n    try {\n      const { sdp } = await pc.getAndSetLocalSessionDescription(this.maxBandwidth, true);\n      const ext = { sessionID: this.ID ?? '', sdp };\n      this.signalingProvider.sendMessage(userID, ext, SignalingType.RESTART);\n      WebRTCHelpers.trace('[iceRestart] OK');\n    } catch (error) {\n      WebRTCHelpers.traceError(`[iceRestart] Error: ${error}`);\n    }\n  }\n\n  public processOnCall(callerID: number, extension: Calls.ExtensionParams): void {\n    const opponentsIDs = [this.initiatorID, ...this.opponentsIDs.filter((userID) => userID !== this.currentUserID)];\n\n    opponentsIDs.forEach((opponentID) => {\n      const pc = this.peerConnections[opponentID];\n\n      if (pc) {\n        if (opponentID === callerID) {\n          pc.sdpRemote = extension.sdp;\n          /** The group call logic starts here */\n          if (callerID !== this.initiatorID && this.state === SessionState.ACTIVE) {\n            this.acceptInternal(callerID, extension);\n          }\n        }\n      } else {\n        /** create peer connections for each opponent */\n        const rtcSdpType = opponentID !== callerID && this.currentUserID > opponentID ? 'offer' : 'answer';\n        const pc = new WebRTCPeerConnection(this, opponentID, rtcSdpType);\n\n        if (opponentID === callerID) {\n          pc.sdpRemote = extension.sdp;\n          this.startAnswerTimer();\n        }\n\n        this.peerConnections[opponentID] = pc;\n      }\n    });\n  }\n\n  public async processOnAccept(userID: number, extension: Calls.ExtensionParams): Promise<void> {\n    const pc = this.peerConnections[userID];\n\n    if (!pc) {\n      WebRTCHelpers.traceWarning(\"Ignore 'OnAccept', there is no information about peer connection by some reason\");\n    }\n\n    try {\n      pc.clearDialingTimer();\n      await pc.setRemoteSessionDescription('answer', extension.sdp);\n      WebRTCHelpers.trace(\"'setRemoteSessionDescription' success\");\n    } catch (error) {\n      WebRTCHelpers.traceError(`'setRemoteSessionDescription' error: ${error}`);\n    }\n  }\n\n  public processOnReject(userID: number): void {\n    const pc = this.peerConnections[userID];\n\n    this.clearWaitingOfferOrAnswerTimer();\n\n    if (pc) {\n      pc.release();\n    } else {\n      WebRTCHelpers.traceWarning(\"Ignore 'OnReject', there is no information about peer connection by some reason\");\n    }\n\n    this.closeSessionIfAllConnectionsClosed();\n  }\n\n  public processOnStop(userID: number): void {\n    this.clearAnswerTimer();\n\n    /** drop the call if the initiator did it */\n    if (userID === this.initiatorID) {\n      const pcKeys = Object.keys(this.peerConnections);\n      if (pcKeys.length > 0) {\n        pcKeys.forEach((key) => {\n          this.peerConnections[key].release();\n        });\n      } else {\n        WebRTCHelpers.traceWarning(\"Ignore 'OnStop', there is no information about peer connections by some reason\");\n      }\n    } else {\n      const pc = this.peerConnections[userID];\n      if (pc) {\n        pc.release();\n      } else {\n        WebRTCHelpers.traceWarning('Ignore \"OnStop\", there is no information about peer connection by some reason');\n      }\n    }\n\n    this.closeSessionIfAllConnectionsClosed();\n  }\n\n  public async processOnIceCandidates(userID: number, extension: Calls.ExtensionParams): Promise<void> {\n    const pc = this.peerConnections[userID];\n\n    if (!pc) {\n      WebRTCHelpers.traceWarning(\n        'Ignore \"OnIceCandidates\", there is no information about peer connection by some reason'\n      );\n    }\n\n    if (extension.iceCandidates) {\n      await pc.addCandidates(extension.iceCandidates);\n    }\n  }\n\n  public async processOnIceRestart(userID: number, extension: Calls.ExtensionParams): Promise<void> {\n    const pc = this.peerConnections[userID];\n\n    if (!pc) {\n      WebRTCHelpers.traceWarning('Ignore \"OnIceRestart\", there is no information about peer connection by some reason');\n    }\n\n    try {\n      await pc.setRemoteSessionDescription('offer', extension.sdp);\n      const { sdp } = await pc.getAndSetLocalSessionDescription(this.maxBandwidth);\n      const ext = { sessionID: this.ID ?? '', sdp };\n      this.signalingProvider.sendMessage(userID, ext, SignalingType.RESTART_ACCEPT);\n      WebRTCHelpers.trace('[processOnIceRestart] Success');\n    } catch (error) {\n      WebRTCHelpers.traceError(`[processOnIceRestart] Error: ${error}`);\n    }\n  }\n\n  public async processOnIceRestartAccept(userID: number, extension: Calls.ExtensionParams): Promise<void> {\n    const pc = this.peerConnections[userID];\n\n    if (!pc) {\n      WebRTCHelpers.traceWarning(\n        'Ignore \"OnIceRestartAccept\", there is no information about peer connection by some reason'\n      );\n    }\n\n    try {\n      await pc.setRemoteSessionDescription('answer', extension.sdp);\n      WebRTCHelpers.trace('[processOnIceRestartAccept] Success');\n    } catch (error) {\n      WebRTCHelpers.traceError(`[processOnIceRestartAccept] Error: ${error}`);\n    }\n  }\n\n  public processCall(peerConnection: WebRTCPeerConnection, extension: Calls.ExtensionParams = {}): void {\n    const ext = Object.assign({ userInfo: {} }, extension, {\n      sessionID: this.ID,\n      callType: this.callType,\n      callerID: this.initiatorID,\n      opponentsIDs: this.opponentsIDs,\n      sdp: peerConnection.localDescription.sdp,\n    });\n\n    this.signalingProvider.sendMessage(peerConnection.userID, ext, SignalingType.CALL);\n  }\n\n  public processIceCandidates(userID: number, iceCandidates: RTCIceCandidateInit[]): void {\n    const extension = {\n      sessionID: this.ID ?? '',\n      callType: this.callType,\n      callerID: this.initiatorID,\n      opponentsIDs: this.opponentsIDs,\n    };\n\n    this.signalingProvider.sendCandidate(userID, iceCandidates, extension);\n  }\n\n  public processOnNotAnswer(peerConnection: WebRTCPeerConnection): void {\n    WebRTCHelpers.trace(`Answer timeout callback for session ${this.ID} for user ${peerConnection.userID}`);\n\n    this.clearWaitingOfferOrAnswerTimer();\n    peerConnection.release();\n    Utils.safeCallbackCall(this.onUserNotAnswerListener)(this, peerConnection.userID);\n    this.closeSessionIfAllConnectionsClosed();\n  }\n\n  public onRemoteStream(userID: number, stream: MediaStream): void {\n    Utils.safeCallbackCall(this.onRemoteStreamListener)(this, userID, stream);\n  }\n\n  public onCallStatsReport(userID: number, stats: any, error?: Error): void {\n    Utils.safeCallbackCall(this.onCallStatsReportListener)(this, userID, stats, error);\n  }\n\n  public onSessionConnectionStateChanged(userID: number, connectionState: SessionConnectionState): void {\n    Utils.safeCallbackCall(this.onSessionConnectionStateChangedListener)(this, userID, connectionState);\n  }\n\n  private close(): void {\n    Object.values(this.peerConnections).forEach((pc) => {\n      try {\n        pc.release();\n      } catch (e) {\n        Utils.DLog(`Peer close error: ${e}`);\n      }\n    });\n\n    this.closeLocalMediaStream();\n    this.state = SessionState.CLOSED;\n    Utils.safeCallbackCall(this.onSessionCloseListener)(this);\n  }\n\n  public closeSessionIfAllConnectionsClosed(): void {\n    let isAllClosed = true;\n\n    Object.values(this.peerConnections).forEach((pc) => {\n      let isClosed = false;\n      try {\n        /*\n         * TODO:\n         * Uses RTCPeerConnection.signalingState instead RTCPeerConnection.iceConnectionState,\n         * because state 'closed' comes after few time from Safari, but signaling state comes instantly\n         */\n        isClosed = pc.iceConnectionState === 'closed' || pc.signalingState === 'closed' || pc.released;\n      } catch (err) {\n        WebRTCHelpers.traceError(err);\n        // need to set peerState to 'closed' on error. FF will crashed without this part.\n        isClosed = true;\n      }\n\n      isAllClosed = isClosed;\n    });\n\n    WebRTCHelpers.trace(`All peer connections closed: ${isAllClosed}`);\n\n    if (isAllClosed) {\n      this.closeLocalMediaStream();\n      Utils.safeCallbackCall(this.onSessionCloseListener)(this);\n      this.state = SessionState.CLOSED;\n    }\n  }\n\n  private closeLocalMediaStream(): void {\n    if (this.localStream) {\n      this.localStream.getTracks().forEach((track) => track.stop());\n      this.localStream = undefined;\n      this.mediaParams = {};\n    }\n  }\n\n  public mute(type: 'audio' | 'video'): void {\n    this.muteStream(false, type);\n  }\n\n  public unmute(type: 'audio' | 'video'): void {\n    this.muteStream(true, type);\n  }\n\n  private muteStream(enabled: boolean, type: 'audio' | 'video' | 'none' = 'none'): void {\n    const tracks =\n      type === 'audio'\n        ? this.localStream?.getAudioTracks()\n        : type === 'video'\n          ? this.localStream?.getVideoTracks()\n          : [];\n\n    tracks?.forEach((track) => {\n      track.enabled = enabled;\n    });\n  }\n\n  private clearAnswerTimer(): void {\n    if (this.answerTimer) {\n      WebRTCHelpers.trace('clearAnswerTimer');\n      clearTimeout(this.answerTimer);\n      this.answerTimer = null;\n    }\n  }\n\n  private startAnswerTimer(): void {\n    WebRTCHelpers.trace('startAnswerTimer');\n\n    this.answerTimer = setTimeout(() => {\n      WebRTCHelpers.trace('answerTimeoutCallback');\n      this.close();\n      this.answerTimer = null;\n    }, config.videochat.answerTimeInterval * 1000);\n  }\n\n  private clearWaitingOfferOrAnswerTimer(): void {\n    if (this.waitingOfferOrAnswerTimer) {\n      WebRTCHelpers.trace('clearWaitingOfferOrAnswerTimer');\n      clearTimeout(this.waitingOfferOrAnswerTimer);\n      this.waitingOfferOrAnswerTimer = null;\n    }\n  }\n\n  private startWaitingOfferOrAnswerTimer(): void {\n    const timeDiff = (this.acceptCallTime - this.startCallTime) / 1000;\n    const timeout = Math.max(config.videochat.answerTimeInterval - timeDiff, 1);\n\n    WebRTCHelpers.trace(`startWaitingOfferOrAnswerTimer, timeout: ${timeout}`);\n\n    this.waitingOfferOrAnswerTimer = setTimeout(() => {\n      WebRTCHelpers.trace('waitingOfferOrAnswerTimeoutCallback');\n\n      Object.values(this.peerConnections).forEach((pc) => {\n        if (pc.state === PeerConnectionState.CONNECTING || pc.state === PeerConnectionState.NEW) {\n          this.processOnNotAnswer(pc);\n        }\n      });\n\n      this.waitingOfferOrAnswerTimer = null;\n    }, timeout * 1000);\n  }\n\n  public toString(): string {\n    return `ID: ${this.ID}, initiatorID: ${this.initiatorID}, opponentsIDs: ${this.opponentsIDs}, state: ${this.state}, callType: ${this.callType}`;\n  }\n\n  set startCallTime(date: Date) {\n    this.startCallDate = date;\n  }\n\n  get startCallTime(): number {\n    return this.startCallDate.getTime();\n  }\n\n  set acceptCallTime(date: Date) {\n    this.acceptCallDate = date;\n  }\n\n  get acceptCallTime(): number {\n    return this.acceptCallDate.getTime();\n  }\n}\n\nfunction generateUUID(): string {\n  let d = new Date().getTime();\n  const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n    const r = (d + Math.random() * 16) % 16 | 0;\n    d = Math.floor(d / 16);\n    return (c == 'x' ? r : (r & 0x3) | 0x8).toString(16);\n  });\n  return uuid;\n}\n\nfunction prepareExtension(extension: Calls.UserInfo = {}): Calls.ExtensionParams {\n  const ext = { userInfo: extension };\n\n  try {\n    if (Utils.isObject(extension)) {\n      ext.userInfo = Utils.cloneObject(extension, true);\n    } else {\n      WebRTCHelpers.traceWarning('Ignore \"prepareExtension\", must be an object');\n    }\n  } catch (err) {\n    WebRTCHelpers.traceWarning(err.message);\n  }\n\n  return ext;\n}\n","import WebRTCClient from './WebRTCClient';\nimport ChatHelpers from '../messaging/ChatUtils';\nimport ChatUtils from '../messaging/ChatUtils';\nimport { CallType, SignalingType } from '../types/calls';\nimport { Calls, Chat } from '../types';\n\nexport default class WebRTCSignalingProcessor {\n  public delegate: WebRTCClient;\n\n  constructor(delegate: WebRTCClient) {\n    this.delegate = delegate;\n  }\n\n  public onMessage = (userID: number, extraParams: Chat.XmlElement): void => {\n    const extension = this.getExtension(extraParams);\n    const sessionId = extension?.sessionID ?? '';\n    const signalType = extension?.signalType;\n    /** cleanup */\n    delete extension?.moduleIdentifier;\n    delete extension?.sessionID;\n    delete extension?.signalType;\n\n    switch (signalType) {\n      case SignalingType.CALL:\n        this.delegate.onCallHandler(userID, sessionId, extension);\n        break;\n      case SignalingType.ACCEPT:\n        this.delegate.onAcceptHandler(userID, sessionId, extension);\n        break;\n      case SignalingType.REJECT:\n        this.delegate.onRejectHandler(userID, sessionId, extension);\n        break;\n      case SignalingType.STOP:\n        this.delegate.onStopHandler(userID, sessionId, extension);\n        break;\n      case SignalingType.CANDIDATE:\n        this.delegate.onIceCandidatesHandler(userID, sessionId, extension);\n        break;\n      case SignalingType.RESTART:\n        this.delegate.onIceRestartHandler(userID, sessionId, extension);\n        break;\n      case SignalingType.RESTART_ACCEPT:\n        this.delegate.onIceRestartAcceptHandler(userID, sessionId, extension);\n        break;\n    }\n  };\n\n  private getExtension(extraParams?: Chat.XmlElement): Calls.ExtensionParams {\n    if (!extraParams) {\n      return {};\n    }\n\n    const extension: Calls.ExtensionParams = { iceCandidates: [], opponentsIDs: [] };\n    const elements = ChatUtils.getChildElements(extraParams);\n\n    elements.forEach((element: Chat.XmlElement) => {\n      const items = ChatUtils.getChildElements(element);\n      const key = ChatUtils.getName(element) ?? '';\n\n      switch (key) {\n        case 'callerID':\n          extension[key] = parseInt(ChatUtils.getText(element) || '0');\n          break;\n\n        case 'callType':\n          const type = ChatUtils.getText(element);\n          extension[key] = type === '1' ? CallType.VIDEO : type === '2' ? CallType.AUDIO : undefined;\n          break;\n\n        case 'iceCandidates':\n          items.forEach((item) => {\n            const candidate = {};\n            ChatUtils.getChildElements(item).forEach((child) => {\n              const childName = ChatUtils.getName(child) || '';\n              const childText = ChatUtils.getText(child);\n              candidate[childName] = childName === 'sdpMLineIndex' ? parseInt(childText || '0') : childText;\n            });\n            extension.iceCandidates?.push(candidate);\n          });\n          break;\n\n        case 'opponentsIDs':\n          items.forEach((item) => {\n            extension.opponentsIDs?.push(parseInt(ChatUtils.getText(item) || '0'));\n          });\n          break;\n\n        default:\n          if (items.length > 1) {\n            if ((ChatUtils.getText(element) || '').length > 4096) {\n              extension[key] = items.reduce((acc, item) => acc + ChatUtils.getText(item), '');\n            } else {\n              ChatHelpers.assignXmlToObject(element, extension);\n            }\n          } else {\n            if (key === 'userInfo') {\n              ChatHelpers.assignXmlToObject(element, extension);\n            } else {\n              extension[key] = ChatUtils.getText(element);\n            }\n          }\n          break;\n      }\n    });\n\n    if (extension.iceCandidates?.length === 0) {\n      delete extension.iceCandidates;\n    }\n\n    if (extension.opponentsIDs?.length === 0) {\n      delete extension.opponentsIDs;\n    }\n\n    return extension;\n  }\n}\n","import Utils from '../Utils';\nimport { XMPPClient } from '../messaging/xmpp';\nimport ChatUtils from '../messaging/ChatUtils';\nimport WebRTCHelpers from './WebRTCHelpers';\nimport { Calls } from '../types';\nimport { SignalingModuleIdentifier, SignalingType } from '../types/calls';\n\nexport default class WebRTCSignalingProvider {\n  public signalingConnection: XMPPClient;\n\n  constructor(signalingConnection: XMPPClient) {\n    this.signalingConnection = signalingConnection;\n  }\n\n  public sendCandidate(userID: number, iceCandidates: RTCIceCandidateInit[], ext: Calls.ExtensionParams = {}): void {\n    const extension = Object.assign({}, ext, { iceCandidates });\n\n    this.sendMessage(userID, extension, SignalingType.CANDIDATE);\n  }\n\n  public sendMessage(userID: number, ext: Calls.ExtensionParams, signalingType: SignalingType): void {\n    const extension = Object.assign({}, ext);\n    /** basic parameters */\n    extension.moduleIdentifier = SignalingModuleIdentifier;\n    extension.signalType = signalingType;\n    /** extension.sessionID */\n    /** extension.callType */\n    extension.platform = Utils.env.isBrowser ? 'web' : Utils.env.isReactNative || Utils.env.isExpo ? 'mobile' : 'node';\n    /** extension.callerID */\n    /** extension.opponentsIDs */\n    /** extension.sdp */\n\n    if (extension.userInfo) {\n      if (!Object.keys(extension.userInfo).length) {\n        delete extension.userInfo;\n      } else if (extension.userInfo.maxBandwidth === 0) {\n        delete extension.userInfo.maxBandwidth;\n      }\n    }\n\n    let messageStanza = ChatUtils.createMessageStanza({\n      to: WebRTCHelpers.getUserJid(userID),\n      type: 'headline',\n      id: Utils.getBsonObjectId(),\n    }).c('extraParams', { xmlns: 'jabber:client' });\n\n    Object.keys(extension).forEach((name) => {\n      const item = extension[name];\n\n      if (name === 'iceCandidates') {\n        messageStanza = messageStanza.c('iceCandidates');\n        item.forEach((candidate) => {\n          messageStanza = messageStanza.c('iceCandidate');\n          Object.keys(candidate).forEach((key) => {\n            messageStanza = messageStanza.c(key).t(candidate[key]).up();\n          });\n          messageStanza = messageStanza.up();\n        });\n        messageStanza = messageStanza.up();\n      } else if (name === 'opponentsIDs') {\n        messageStanza = messageStanza.c('opponentsIDs');\n        item.forEach((opponentId) => {\n          messageStanza = messageStanza.c('opponentID').t(opponentId).up();\n        });\n        messageStanza = messageStanza.up();\n      } else if (typeof item === 'object') {\n        ChatUtils.assignObjectToXml(messageStanza, item, name);\n      } else {\n        messageStanza = messageStanza.c(name).t(item).up();\n      }\n    });\n\n    messageStanza = messageStanza.up();\n\n    this.signalingConnection.send(messageStanza);\n  }\n}\n","import { mediaDevices } from '../platform';\nimport config from '../config';\nimport ProxyService from '../Proxy';\nimport Utils from '../Utils';\nimport WebRTCSession from './WebRTCSession';\nimport WebRTCSignalingProcessor from './WebRTCSignalingProcessor';\nimport WebRTCSignalingProvider from './WebRTCSignalingProvider';\nimport WebRTCHelpers from './WebRTCHelpers';\nimport { XMPPClient } from '../messaging/xmpp';\nimport { CallsEvent, CallType, PeerConnectionState, SessionConnectionState, SessionState } from '../types/calls';\nimport { Calls } from '../types';\nimport { ProxyMethod } from '../types/proxy';\n\nexport default class WebRTCClient {\n  public connection: XMPPClient;\n  public proxy: ProxyService;\n  public signalingProcessor: WebRTCSignalingProcessor;\n  public signalingProvider: WebRTCSignalingProvider;\n  public SessionConnectionState: typeof SessionConnectionState = SessionConnectionState;\n  public PeerConnectionState: typeof PeerConnectionState = PeerConnectionState;\n  public CallType: typeof CallType = CallType;\n  public sessions: { [key: string]: WebRTCSession } = {};\n  public onCallListener: Calls.OnCallListener;\n  public onAcceptCallListener: Calls.OnAcceptCallListener;\n  public onRejectCallListener: Calls.OnRejectCallListener;\n  public onStopCallListener: Calls.OnStopCallListener;\n  public onInvalidEventsListener: Calls.OnInvalidEventsListener;\n  public onUserNotAnswerListener: Calls.OnUserNotAnswerListener;\n  public onRemoteStreamListener: Calls.OnRemoteStreamListener;\n  public onSessionConnectionStateChangedListener: Calls.OnSessionConnectionStateChangedListener;\n  public onSessionCloseListener: Calls.OnSessionCloseListener;\n  public onCallStatsReport: Calls.OnCallStatsReportListener;\n  public onDevicesChangeListener: Calls.OnDevicesChangeListener = () => {};\n\n  constructor(connection: XMPPClient, proxy: ProxyService) {\n    this.connection = connection;\n    this.proxy = proxy;\n\n    this.signalingProcessor = new WebRTCSignalingProcessor(this);\n    this.signalingProvider = new WebRTCSignalingProvider(connection);\n\n    if (mediaDevices) {\n      mediaDevices.ondevicechange = Utils.safeCallbackCall(this.onDevicesChangeListener);\n    }\n  }\n\n  public async getMediaDevices(kind?: MediaDeviceKind): Promise<MediaDeviceInfo[]> {\n    if (mediaDevices?.enumerateDevices) {\n      const devices = await mediaDevices.enumerateDevices();\n      return kind ? devices.filter((device) => device.kind === kind) : devices;\n    } else {\n      throw new Error(\"No 'enumerateDevices' API supported\");\n    }\n  }\n\n  public createNewSession(\n    opponentsIDs: number[],\n    callType: number,\n    options?: { maxBandwidth?: number; bandwidth?: number }\n  ): WebRTCSession {\n    const callerJID = this.connection.jid?.toString() ?? '';\n    const callerID = WebRTCHelpers.getUserIdFromJID(callerJID) ?? 0;\n    const maxBandwidth = (options?.maxBandwidth || options?.bandwidth) ?? 0;\n\n    if (!opponentsIDs) {\n      throw new Error(\"Can't create a session without opponentsIDs\");\n    }\n\n    return this.createAndStoreSession(null, callerID, opponentsIDs, callType, maxBandwidth);\n  }\n\n  private createAndStoreSession(\n    sessionID: string | null,\n    initiatorID: number,\n    opponentsIDs: number[],\n    callType: CallType,\n    maxBandwidth: number = 0\n  ): WebRTCSession {\n    const currentUserJID = this.connection.jid?.toString() ?? '';\n    const currentUserID = WebRTCHelpers.getUserIdFromJID(currentUserJID) ?? 0;\n    const webRTCSession = new WebRTCSession({\n      ID: sessionID,\n      initiatorID,\n      opponentsIDs,\n      callType,\n      signalingProvider: this.signalingProvider,\n      currentUserID,\n      maxBandwidth,\n    });\n\n    webRTCSession.onUserNotAnswerListener = this.onUserNotAnswerListener;\n    webRTCSession.onRemoteStreamListener = this.onRemoteStreamListener;\n    webRTCSession.onSessionConnectionStateChangedListener = this.onSessionConnectionStateChangedListener;\n    webRTCSession.onSessionCloseListener = this.onSessionCloseListener;\n    webRTCSession.onCallStatsReportListener = this.onCallStatsReport;\n\n    if (webRTCSession?.ID) {\n      this.sessions[webRTCSession.ID] = webRTCSession;\n    }\n\n    return webRTCSession;\n  }\n\n  public clearSession(sessionId: string): void {\n    delete this.sessions[sessionId];\n  }\n\n  /// Reject call by http request\n  public callRejectRequest(params: {\n    sessionID: string;\n    recipientId: number;\n    platform: 'web' | 'android' | 'ios';\n    userInfo?: any;\n  }): Promise<any> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(config.urls.calls, 'reject'),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  /// DELEGATE (signaling)\n\n  public onCallHandler(userID: number, sessionID: string, extension: Calls.ExtensionParams): void {\n    const userInfo = extension.userInfo || {};\n    const maxBandwidth = Number(userInfo.maxBandwidth ?? 0);\n\n    let session = this.sessions[sessionID];\n\n    WebRTCHelpers.trace(`onCall. userID: ${userID}, sessionID: ${sessionID}, extension: ${JSON.stringify(extension)}`);\n\n    if (!session) {\n      session = this.createAndStoreSession(\n        sessionID,\n        extension.callerID || 0,\n        extension.opponentsIDs || [],\n        extension.callType || CallType.VIDEO,\n        maxBandwidth\n      );\n\n      Utils.safeCallbackCall(this.onCallListener)(session, userInfo);\n    }\n\n    session.processOnCall(userID, extension);\n  }\n\n  public onAcceptHandler(userID: number, sessionID: string, extension: Calls.ExtensionParams): void {\n    const session = this.sessions[sessionID];\n    const userInfo = extension.userInfo || {};\n\n    WebRTCHelpers.trace(\n      `onAccept. UserID: ${userID}, sessionID: ${sessionID}, extension: ${JSON.stringify(extension)}`\n    );\n\n    if (session && (session.state === SessionState.ACTIVE || session.state === SessionState.NEW)) {\n      Utils.safeCallbackCall(this.onAcceptCallListener)(session, userID, userInfo);\n      session.processOnAccept(userID, extension);\n    } else {\n      WebRTCHelpers.traceWarning(`Ignore 'onAccept', there is no information about session ${sessionID}`);\n    }\n  }\n\n  public onRejectHandler(userID: number, sessionID: string, extension: Calls.ExtensionParams): void {\n    const session = this.sessions[sessionID];\n\n    WebRTCHelpers.trace(\n      `onReject. UserID: ${userID}, sessionID: ${sessionID}, extension: ${JSON.stringify(extension)}`\n    );\n\n    if (session) {\n      const userInfo = extension.userInfo || {};\n\n      Utils.safeCallbackCall(this.onRejectCallListener)(session, userID, userInfo);\n      session.processOnReject(userID);\n    } else {\n      WebRTCHelpers.traceWarning(`Ignore 'onReject', there is no information about session ${sessionID}`);\n    }\n  }\n\n  public onStopHandler(userID: number, sessionID: string, extension: Calls.ExtensionParams) {\n    WebRTCHelpers.trace(`onStop. UserID: ${userID}, sessionID: ${sessionID}, extension: ${JSON.stringify(extension)}`);\n\n    const session = this.sessions[sessionID];\n    const userInfo = extension.userInfo || {};\n\n    if (session && (session.state === SessionState.ACTIVE || session.state === SessionState.NEW)) {\n      session.processOnStop(userID);\n      Utils.safeCallbackCall(this.onStopCallListener)(session, userID, userInfo);\n    } else {\n      Utils.safeCallbackCall(this.onInvalidEventsListener)(session, userID, userInfo);\n      WebRTCHelpers.traceWarning(`Ignore 'onStop', there is no information about session ${sessionID} by some reason`);\n    }\n  }\n\n  public onIceCandidatesHandler(userID: number, sessionID: string, extension: Calls.ExtensionParams) {\n    const session = this.sessions[sessionID];\n\n    WebRTCHelpers.trace(\n      `onIceCandidates. UserID: ${userID}. SessionID: ${sessionID}. ICE candidates count: ${extension.iceCandidates?.length ?? 0}`\n    );\n\n    if (session) {\n      if (session.state === SessionState.ACTIVE) {\n        session.processOnIceCandidates(userID, extension);\n      } else {\n        WebRTCHelpers.traceWarning(`Ignore 'OnIceCandidates', the session ( ${sessionID} ) has invalid state`);\n      }\n    } else {\n      WebRTCHelpers.traceWarning(`Ignore 'OnIceCandidates', there is no information about session ${sessionID}`);\n    }\n  }\n\n  public onIceRestartHandler(userID: number, sessionID: string, extension: Calls.ExtensionParams) {\n    const session = this.sessions[sessionID];\n\n    WebRTCHelpers.trace(\n      `onIceRestart. UserID: ${userID}. SessionID: ${sessionID}. Extension: ${JSON.stringify(extension)}`\n    );\n\n    if (session) {\n      if (session.state === SessionState.ACTIVE) {\n        session.processOnIceRestart(userID, extension);\n      } else {\n        WebRTCHelpers.traceWarning(`Ignore 'OnIceRestart', the session (${sessionID}) has invalid state`);\n      }\n    } else {\n      WebRTCHelpers.traceWarning(`Ignore 'OnIceRestart', there is no information about session ${sessionID}`);\n    }\n  }\n\n  public onIceRestartAcceptHandler(userID: number, sessionID: string, extension: Calls.ExtensionParams) {\n    const session = this.sessions[sessionID];\n\n    WebRTCHelpers.trace(\n      `onIceRestartAccept. UserID: ${userID}. SessionID: ${sessionID}. Extension: ${JSON.stringify(extension)}`\n    );\n\n    if (session) {\n      if (session.state === SessionState.ACTIVE) {\n        session.processOnIceRestartAccept(userID, extension);\n      } else {\n        WebRTCHelpers.traceWarning(`Ignore 'onIceRestartAccept', the session (${sessionID}) has invalid state`);\n      }\n    } else {\n      WebRTCHelpers.traceWarning(`Ignore 'onIceRestartAccept', there is no information about session ${sessionID}`);\n    }\n  }\n\n  private getListenerByName(name: CallsEvent): string | null {\n    switch (name) {\n      case CallsEvent.CALL:\n        return 'onCallListener';\n      case CallsEvent.ACCEPT:\n        return 'onAcceptCallListener';\n      case CallsEvent.REJECT:\n        return 'onRejectCallListener';\n      case CallsEvent.HUNG_UP:\n        return 'onStopCallListener';\n      case CallsEvent.INVALID:\n        return 'onInvalidEventsListener';\n      case CallsEvent.NOT_ANSWER:\n        return 'onUserNotAnswerListener';\n      case CallsEvent.REMOTE_STREAM:\n        return 'onRemoteStreamListener';\n      case CallsEvent.CONNECTION_STATE:\n        return 'onSessionConnectionStateChangedListener';\n      case CallsEvent.CLOSE:\n        return 'onSessionCloseListener';\n      case CallsEvent.STATS_REPORT:\n        return 'onCallStatsReport';\n      case CallsEvent.DEVICES:\n        return 'onDevicesChangeListener';\n      default:\n        return null;\n    }\n  }\n\n  public addListener(name: CallsEvent, listener: Calls.Listeners): () => void {\n    const listenerName = this.getListenerByName(name);\n    if (listenerName) {\n      this[listenerName] = listener;\n    }\n    return this.removeListener.bind(this, name);\n  }\n\n  public removeListener(name: CallsEvent): void {\n    const listenerName = this.getListenerByName(name);\n    if (listenerName) {\n      this[listenerName] = name === CallsEvent.DEVICES ? () => {} : undefined;\n    }\n  }\n\n  public removeAllListeners(): void {\n    Object.keys(this).forEach((key) => {\n      if (key.startsWith('on') && key.endsWith('Listener') && typeof this[key] === 'function') {\n        this[key] = key === 'onDevicesChangeListener' ? () => {} : undefined;\n      }\n    });\n  }\n}\n","import ProxyService from './Proxy';\nimport config from './config';\nimport Utils from './Utils';\nimport { EmptyResponse, Whiteboard } from './types';\nimport { ProxyMethod, ProxyType } from './types/proxy';\n\nexport default class WhiteboardService {\n  public proxy: ProxyService;\n  readonly route = config.urls.whiteboards;\n  readonly server = config.whiteboard.server;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public getURL({ id, title, username }: Whiteboard.GetUrlParams): string {\n    return `${this.server}?whiteboardid=${id}&username=${username}&title=${title}`;\n  }\n\n  public async get(paramsOrId: Whiteboard.GetParams): Promise<Whiteboard.Item[]> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route),\n      data: typeof paramsOrId === 'string' ? { chat_dialog_id: paramsOrId } : paramsOrId,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async create(params: Whiteboard.CreateParams): Promise<Whiteboard.Item> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async update(id: string, params: Whiteboard.UpdateParams): Promise<Whiteboard.Item> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, id),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(id: string): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, id),\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n","import { isWebRTCAvailable } from './platform';\nimport config from './config';\nimport AddressBookService from './AddressBook';\nimport AuthService from './Auth';\nimport ChatClient from './messaging/Chat';\nimport ConferenceClient from './videocalling_conference/ConferenceClient';\nimport DataService from './Data';\nimport MeetingsService from './Meetings';\nimport ProxyService from './Proxy';\nimport PushNotificationsService from './PushNotifications';\nimport StorageService from './Storage';\nimport UsersService from './Users';\nimport Utils from './Utils';\nimport WebRTCClient from './videocalling/WebRTCClient';\nimport WhiteboardService from './Whiteboard';\nimport { Config } from './types';\n\nclass ConnectyCube {\n  public ConnectyCube = ConnectyCube;\n  public utils: Utils;\n  public service: ProxyService;\n  public auth: AuthService;\n  public setSession: AuthService['setSession'];\n  public getSession: AuthService['getSession'];\n  public createSession: AuthService['createSession'];\n  public destroySession: AuthService['destroySession'];\n  public login: AuthService['login'];\n  public logout: AuthService['logout'];\n  public users: UsersService;\n  public storage: StorageService;\n  public pushnotifications: PushNotificationsService;\n  public data: DataService;\n  public addressbook: AddressBookService;\n  public chat: ChatClient;\n  public meeting: MeetingsService;\n  public whiteboard: WhiteboardService;\n  public videochat: WebRTCClient;\n  public videochatconference: ConferenceClient;\n\n  public init(credentials: Config.Credentials, configMap: Config.Options = {}): void {\n    if (configMap && typeof configMap === 'object') {\n      config.set(configMap);\n    }\n\n    this.utils = Utils;\n    this.service = new ProxyService();\n    this.auth = new AuthService(this.service);\n    this.users = new UsersService(this.service);\n    this.storage = new StorageService(this.service);\n    this.pushnotifications = new PushNotificationsService(this.service);\n    this.data = new DataService(this.service);\n    this.addressbook = new AddressBookService(this.service);\n    this.chat = new ChatClient(this.service);\n    this.meeting = new MeetingsService(this.service);\n    this.whiteboard = new WhiteboardService(this.service);\n\n    if (isWebRTCAvailable) {\n      this.videochat = new WebRTCClient(this.chat.xmppClient, this.service);\n      this.videochatconference = new ConferenceClient(this.service);\n      this.chat.webrtcSignalingProcessor = this.videochat.signalingProcessor;\n    }\n\n    if (credentials.token) {\n      config.creds.appId = credentials.appId;\n      this.service.setSession({ token: credentials.token });\n    } else {\n      config.creds.appId = credentials.appId;\n      config.creds.authKey = credentials.authKey;\n    }\n\n    this.setSession = this.auth.setSession;\n    this.getSession = this.auth.getSession;\n    this.createSession = this.auth.createSession;\n    this.destroySession = this.auth.destroySession;\n    this.login = this.auth.login;\n    this.logout = this.auth.logout;\n  }\n}\n\nexport default new ConnectyCube();\n"],"names":["ChatProtocol","JanusDebugMode","base64Encode","str","isBrowser","btoa","encodeURIComponent","replace","_","p1","String","fromCharCode","parseInt","Buffer","from","toString","window","document","isNodeJS","process","versions","node","isReactNative","isExpo","fetchImpl","require","fetch","formDataImpl","FormData","navigator","undefined","mediaDevices","MediaStream","MediaStreamTrack","RTCIceCandidate","RTCPeerConnection","RTCRtpReceiver","RTCRtpSender","RTCSessionDescription","isWebRTCAvailable","Boolean","adapter","Config","this","version","creds","appId","authKey","endpoints","api","chat","muc","chatProtocol","bosh","websocket","active","contactList","subscriptionMode","mutual","streamManagement","enable","ping","timeInterval","reconnect","videochat","alwaysRelayCalls","answerTimeInterval","dialingTimeInterval","disconnectTimeInterval","statsReportTimeInterval","iceServers","urls","username","credential","conference","server","debug","ALL","whiteboard","session","login","users","blobs","subscriptions","events","data","addressbook","meetings","whiteboards","calls","type","on","sessionExpired","xmppDataWrite","xmppDataRead","timeout","mode","getInstance","instance","prototype","set","options","_this","concat","Object","keys","forEach","key","hasOwnProperty","optionValue_1","nextKey","_a","__assign","assign","t","s","i","n","arguments","length","p","call","apply","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","label","sent","trys","ops","g","create","Iterator","verb","Symbol","iterator","v","op","TypeError","pop","push","__spreadArray","to","pack","ar","l","Array","slice","SuppressedError","ProxyMethod","ProxyType","Utils","safeCallbackCall","cb","args","_i","err","console","error","getUrl","base","res","ext","resource","extension","config","isArray","arg","isObject","obj","getBsonObjectId","ObjectId","machine","Math","floor","random","pid","increment","timestamp","Date","now","padStart","DLog","loggers","logger","log","mergeArrays","arrayTo","arrayFrom","merged","cloneObject","newItem","existingItem","find","item","user_id","arrayFrom_1","toBase64","callTrafficUsageCallback","callbackName","getStringSize_1","Blob","size","b","h","headers","JSON","stringify","getDataSize","escapeNull","json","jsonObject","parse","env","AddressBookService","proxy","route","uploadAddressBook","list","params","Error","ajaxParams","POST","url","contacts","ajax","get","udid","GET","getRegisteredUsers","compact","AuthService","routes","setSession","getSession","createSession","generateCreateSessionParams","response","setCurrentUserId","destroySession","DELETE","dataType","TEXT","user","id","logout","message","application_id","auth_key","password","email","provider","firebase_phone","firebase_email","TimeoutError_1","constructor","super","name","delay","ms","promise","setTimeout","TimeoutError","require$$0","require$$1","promiseDelay","race","finally","clearTimeout","EE","event","rejectEvent","timeoutId","cleanup","removeListener","onEvent","onError","reason","once","has","prefix","Events","fn","context","addListener","emitter","listener","evt","_events","_eventsCount","clearEvent","EventEmitter","__proto__","eventNames","names","getOwnPropertySymbols","listeners","handlers","ee","listenerCount","emit","a1","a2","a3","a4","a5","len","j","removeAllListeners","off","prefixed","module","Deferred","require$$2","require$$3","require$$4","require$$5","escaping","detect","local","search","escape","unescape","JID","domain","setDomain","setLocal","setResource","toPrimitive","hint","NaN","_domain","_local","getLocal","_resource","bare","equals","other","toLowerCase","getDomain","getResource","defineProperty","JID_1","resourceStart","indexOf","atStart","jid","jidModule","exports","bind","equal","a","detectEscape","escapeLocal","unescapeLocal","_escape","escapeXMLTable","escapeXMLReplace","match","unescapeXMLTable","unescapeXMLReplace","num","fromCodePoint","escapeXML","escapeXMLText","unescapeXML","start","end","previous","substring","unescapeXMLText","Element","attrs","parent","children","setAttrs","is","xmlns","getName","getNS","idx","findNS","attr","getXmlns","namespaces","m","getAttr","join","getChild","getChildren","child","getChildByAttr","val","recursive","getChildrenByAttr","flat","getChildrenByFilter","filter","getText","text","getChildText","getChildElements","root","up","c","cnode","append","nodes","prepend","unshift","remove","el","write","_addChildren","writer","k","tree","Element_1","XMLError_1","LtxParser","SaxLtx","remainder","parseRemainder","tagName","endTag","selfClosing","attrQuote","attrQuoteChar","attrName","state","recordStart","_handleTagOpening","pos","endRecording","recorded","lt","quot","endcomment","endCDATA","charCodeAt","substr","cData","startsWith","prevFirst","prevSecond","ltx","XMLError","Parser","parser","cursor","onStartElement","onEndElement","onText","element","Parser_1","createElement","createElement_1","__source","__self","entries","XMPPError","condition","application","fromElement","second","third","xml","StreamError","StreamError_1","parseHost","parseService","parseURI","URI","port","hostname","protocol","URL","host","service","includes","Connection","socketListeners","parserListeners","status","socket","_reset","_detachSocket","_detachParser","_streamError","send","_end","_onData","_onParserError","_attachSocket","close","dirty","_status","clean","connect","getOwnPropertyNames","_onElement","isStreamError","_onStreamError","isStanza","_onSeeOtherHost","lang","open","_attachParser","_jid","disconnect","promiseOnline","Socket","socketParameters","headerElement","header","stop","fragment","footer","footerElement","all","restart","sendReceive","string","isNonza","NS","connection","Client","transports","Transport","sendMany","_findTransport","Client_1","clientCore","Reconnect","entity","_timeout","scheduleReconnect","async","r","BINARY_TYPES","hasBlob","constants","EMPTY_BUFFER","alloc","GUID","kForOnEventAttribute","kListener","kStatusCode","kWebSocket","NOOP","FastBuffer","species","_mask","source","mask","output","offset","_unmask","buffer","bufferUtilModule","totalLength","target","allocUnsafe","buf","byteOffset","toArrayBuffer","byteLength","toBuffer","readOnly","isBuffer","ArrayBuffer","isView","unmask","WS_NO_BUFFER_UTIL","bufferUtil","zlib","Limiter","kDone","kRun","limiter","concurrency","pending","Infinity","jobs","add","job","shift","TRAILER","kPerMessageDeflate","kTotalLength","kCallback","kBuffers","kError","zlibLimiter","deflateOnData","chunk","inflateOnData","_maxPayload","RangeError","code","reset","inflateOnError","_inflate","permessageDeflate","isServer","maxPayload","_options","_threshold","threshold","_isServer","_deflate","concurrencyLimit","extensionName","offer","serverNoContextTakeover","server_no_context_takeover","clientNoContextTakeover","client_no_context_takeover","serverMaxWindowBits","server_max_window_bits","clientMaxWindowBits","client_max_window_bits","accept","configurations","normalizeParams","acceptAsServer","acceptAsClient","callback","offers","opts","accepted","Number","isInteger","decompress","fin","_decompress","compress","_compress","endpoint","windowBits","Z_DEFAULT_WINDOWBITS","createInflateRaw","zlibInflateOptions","flush","_readableState","endEmitted","createDeflateRaw","zlibDeflateOptions","Z_SYNC_FLUSH","isUtf8","_isValidUTF8","validationModule","isBlob","arrayBuffer","stream","toStringTag","isValidStatusCode","isValidUTF8","tokenChars","WS_NO_UTF_8_VALIDATE","Writable","PerMessageDeflate","receiver","_allowSynchronousEvents","allowSynchronousEvents","_binaryType","binaryType","_extensions","extensions","_skipUTF8Validation","skipUTF8Validation","_bufferedBytes","_buffers","_compressed","_payloadLength","_fragmented","_masked","_fin","_opcode","_totalPayloadLength","_messageLength","_fragments","_errored","_loop","_state","_write","encoding","startLoop","consume","dst","Uint8Array","getInfo","getPayloadLength16","getPayloadLength64","getMask","getData","createError","compressed","haveLength","readUInt16BE","readUInt32BE","pow","controlMessage","dataMessage","messageLength","fragments","setImmediate","ErrorCtor","statusCode","errorCode","captureStackTrace","randomFillSync","applyMask","kByteLength","maskBuffer","RANDOM_POOL_SIZE","randomPool","randomPoolPointer","Sender","generateMask","_generateMask","_maskBuffer","_socket","_firstFragment","_queue","onerror","frame","dataLength","merge","skipMasking","payloadLength","opcode","rsv1","writeUInt16BE","writeUIntBE","enqueue","dispatch","sendFrame","getBlobData","pong","perMessageDeflate","binary","blob","destroyed","nextTick","callCallbacks","dequeue","catch","Reflect","cork","uncork","sender","dest","elem","format","map","values","paramName","mustUnescape","isEscaping","inQuotes","SyntaxError","token","https","http","net","tls","randomBytes","createHash","require$$7","require$$8","Receiver","require$$9","require$$10","require$$11","require$$12","EventTarget","addEventListener","removeEventListener","kCode","kData","kMessage","kReason","kTarget","kType","kWasClean","Event","enumerable","CloseEvent","wasClean","ErrorEvent","MessageEvent","handler","wrapper","isBinary","callListener","_closeFrameReceived","_closeFrameSent","handleEvent","eventTarget","require$$13","require$$14","require$$15","kAborted","protocolVersions","readyStates","subprotocolRegex","WebSocket","address","protocols","_closeCode","_closeMessage","_closeTimer","_errorEmitted","_paused","_protocol","_readyState","CONNECTING","_receiver","_sender","_bufferedAmount","_redirects","initAsClient","_autoPong","autoPong","bufferedAmount","_writableState","isPaused","onclose","onopen","onmessage","readyState","_url","setSocket","head","receiverOnConclude","receiverOnDrain","receiverOnError","receiverOnMessage","receiverOnPing","receiverOnPong","senderOnError","setNoDelay","socketOnClose","socketOnData","socketOnEnd","socketOnError","OPEN","emitClose","CLOSED","CLOSING","errorEmitted","setCloseTimer","msg","abortHandshake","_req","pause","sendAfterClose","resume","needDrain","terminate","destroy","protocolVersion","followRedirects","maxRedirects","socketPath","method","path","parsedUrl","href","isSecure","isIpcUrl","invalidUrlMessage","pathname","hash","emitErrorAndClose","defaultPort","request","protocolSet","Set","req","createConnection","tlsConnect","netConnect","Upgrade","handshakeTimeout","test","origin","Origin","auth","parts","split","_originalIpc","_originalSecure","_originalHostOrSocketPath","isSameHost","authorization","cookie","location","addr","abort","upgrade","digest","update","serverProt","protError","secWebSocketExtensions","extensionNames","finishRequest","servername","isIP","setHeader","receiverOnFinish","read","finished","property","subprotocol","require$$6","keyRegex","STATUS_CODES","abortHandshakeOrEmitwsClientError","websocketServer","handleProtocols","clientTracking","verifyClient","noServer","backlog","_server","createServer","writeHead","listen","emitConnection","_removeListeners","addListeners","listening","handleUpgrade","clients","_shouldEmitClose","shouldHandle","index","secWebSocketProtocol","info","secure","authorized","encrypted","verified","completeUpgrade","readable","writable","ws","delete","createWebSocketStream","Duplex","duplexOnEnd","duplexOnError","terminateOnDestroy","duplex","autoDestroy","objectMode","writableObjectMode","_destroy","called","_final","_read","Server","WebSocketServer","WS","global","CODE","Socket_1","errno","FramedParser","FramedParser_1","NS_FRAMING","ConnectionWebSocket","elements","Connection_1","Context_1","stanza","compose","koaCompose","middleware","IncomingContext","Context","IncomingContext_1","OutgoingContext","OutgoingContext_1","ctx","errorHandler","reply","incoming","outgoing","incomingListener","outgoingListener","hookOutgoing","use","streamFeatures","feature","xid","StanzaError","StanzaError_1","timeoutPromise","IQCaller","Map","_route","isReply","deferred","_childRequest","caller","iqCaller","buildReply","buildReplyError","buildError","iqHandler","isQuery","isValidQuery","buildReplyResult","ns","callee","dns","IGNORE_CODES","lookup","addresses","family","uri","resolveSrv","records","record","sortSrv","sort","priority","weight","lookupSrvs","srvs","srv","srvAddresses","dns_1","protcol","compareAltConnections","altConnections","compare","link","rel","resolveModule","fetchURIs","fallbackConnect","uris","resolve_1","_connect","filterSupportedURIs","encode","decode","freeExports","freeModule","freeGlobal","InvalidCharacterError","TABLE","REGEX_SPACE_CHARACTERS","base64","input","padding","position","charAt","bitStorage","bitCounter","nodeType","Factory","factory","_mechs","mech","mechs","jlen","entry","SASLError","SASLError_1","SASLFactory","authenticate","SASL","mechname","credentials","realm","serviceType","serviceName","challenge","resp","mechanism","clientFirst","sasl","offered","intersection","makeBindElement","resourceBinding","sessionEstablishment","Mechanism","cred","trace","chal","saslAnonymous","authzid","saslPlain","xmppClient","propertyIsEnumerable","__rest","_Client","_reconnect","_websocket","_middleware","_streamFeatures","_iqCaller","iqCallee","_iqCallee","starttls","_resolve","_sasl","_resourceBinding","_sessionEstablishment","mechanisms","plain","anonymous","_b","ChatType","ChatEvent","PrivacyListAction","_xml","DialogsService","subscribeToPublic","subscribe","unsubscribeFromPublic","unsubscribe","occupants_ids","admins_ids","id_1","PUT","idOrIds_1","idOrIds","idsToDelete","trim","addAdmins","push_all","removeAdmins","pull_all","updateNotificationsSettings","enabled","getNotificationsSettings","getPublicOccupants","clearHistory","MessagesService","createSystem","unreadCount","chat_dialog_ids","listReactions","addReaction","reaction","updateReaction","removeReaction","putReaction","ChatUtils","buildUserJid","userId","buildUserJidLocalPart","createMessageStanza","createIqStanza","createPresenceStanza","createNonza","getElement","isErrorStanza","getAllElements","getElementText","getElementTreePath","elementsPath","reduce","prevElement","assignObjectToXml","assignExtraParamsToXml","extraParams","attachment","assignXmlToObject","parseExtraParams","attachments","dialogId","attachment_1","dialog_id","moduleIdentifier","buildErrorFromXMPPErrorStanza","errorStanza","errorElement","getUniqueId","suffix","uuid","parseReactions","items","ChatHelpers","xmppJID","isNumeric","jidOrUserId","getUserJid","getRoomJidFromDialogId","typeChat","getUserNickWithMucDomain","getUserIdFromJID","userCurrentJid","getDialogIdFromJID","getRoomJid","getIdFromResource","getRoomJidFromRoomFullJid","getUserIdFromRoomJid","roomJid","getDialogJid","identifier","StreamManagement","clientProcessedStanzasCounter","clientSentStanzasCounter","lastAck","unackedQueue","incomingStanzaHandler","numAcked","sentMessageCallback","answerStanza","originalSend","removeElementHandler","addElementHandler","isMessage","isChat","isContent","expect","ContactList","helpers","stanzasCallbacks","_reject","stanzaId","iqStanza","ask","subscription","name_1","isUniqName","userName","userJid","sendSubscriptionPresence","confirm","updateName","presenceParams","presenceStanza","PrivacyList","privacyList","acc","action","mutualBlock","privacyListKeys","iqParams","iq","isMutual","userMuc","assignPrivacyItem","order","getList","query","existentList","updatedList","getNames","defaultElement","activeElement","defaultName","activeName","allNames","default","setAsDefault","MultiUserChat","dialogIdOrJid","dialogJid","maxstanzas","x","joinedRooms","isJoin","endsWith","isError","errorResponse","leave","_stanza","listOnlineUsers","ChatService","isConnected","isConnecting","isLogout","isReconnect","xmppClientListeners","connectPromise","earlyIncomingMessagesQueue","pingTimer","dialog","_mechanism","contactlist","privacylist","isStreamManagementSupported","removeAllXMPPClientListeners","addXMPPClientListener","startPingTimer","postConnectActions","onDisconnectedListener","stopPingTimer","onChatStatusListener","onPresence","onIQ","onSystemMessage","onMessageError","onMessage","onConnectionErrorListener","getContacts","warn","pingWithTimeout","validTime","setInterval","clearInterval","messageId","messageStanza","markable","sendSystemMessage","sendIsTypingStatus","sendIsStopTypingStatus","sendDeliveredStatus","sendReadStatus","editMessage","originMessageId","last","deleteMessage","getLastUserActivity","onLastActivityStanza","seconds","onLastUserActivityListener","markActive","markInactive","start_date","toISOString","end_date","rawStanza","forwardedStanza","invite","delivered","replaceSubElement","reactionsSubElement","removeSubElement","composing","paused","isForwarded","isGroup","recipient","recipientId","currentUserJid","_c","currentUserId","onMessageTypingListener","onMessageUpdateListener","messageId_1","userId_1","_d","onMessageReactionsListener","messageId_2","onMessageDeleteListener","onDeliveredStatusListener","onReadStatusListener","recipient_id","is_forwarded","onMessageListener","mucUserId","actorElement","initiatorUserJid","initiatorId","onKickOccupant","listenerName","contact","_e","onSubscribeListener","onConfirmSubscribeListener","onRejectSubscribeListener","onContactListListener","onSystemMessageListener","webrtcSignalingProcessor","onMessageErrorListener","presence","messageLost","messageSent","onSentMessageCallback","enableCarbons","onReconnectListener","stanzasCallback_1","setSubscriptionToUserLastActivity","user_jid","subscribeToUserLastActivityStatus","unsubscribeFromUserLastActivityStatus","isEnabled","isWebsocket","removeXMPPClientListener","getListenerByName","STATUS","ERROR","DISCONNECTED","RECONNECTED","MESSAGE","SYSTEM_MESSAGE","ERROR_MESSAGE","TYPING_MESSAGE","UPDATE_MESSAGE","DELETE_MESSAGE","REACTIONS_MESSAGE","DELIVERED_MESSAGE","READ_MESSAGE","SENT_MESSAGE","USER_LAST_ACTIVITY","ROSTER_SUBSCRIBE","ROSTER_CONFIRM","ROSTER_REJECT","ROSTER_LIST","JOIN","LEAVE","KICK","CallType","DeviceInputType","JanusEvent","JanusMediaTrackReason","ConferenceEvent","Janus","sessions","mobile","isExtensionEnabled","getDisplayMedia","userAgent","chromever","maxver","isInstalled","defaultExtension","extensionId","querySelector","getScreen","cache","postMessage","init","sourceId","gatewayCallbacks","success","noop","initDone","isWebrtcSupported","websockets","wsHandlers","wsKeepaliveTimeoutId","servers","serversIndex","iceTransportPolicy","bundlePolicy","withCredentials","maxev","max_poll_events","apisecret","destroyOnUnload","keepAlivePeriod","isNaN","longPollTimeout","getMaxBitrates","simulcastMaxBitrates","maxBitrates","high","medium","low","connected","sessionId","pluginHandles","that","retries","transactions","eventHandler","longpoll","getTime","httpAPICall","textStatus","errorThrown","skipTimeout","pluginHandle","candidate","webrtcStuff","pc","remoteSdp","completed","addIceCandidate","endOfCandidates","candidates","webrtcState","hangup","ondetached","detach","mediaState","slowLink","transaction","reportSuccess","plugindata","jsep","vdebug","keepAlive","janus","session_id","randomString","callbacks","newWebSocket","eventName","sendMessage","handleId","sdp","e2ee","rid_order","force_relay","sendTrickleCandidate","createDataChannel","dclabel","dcprotocol","pendingData","onDataChannelStateChange","dcState","dataChannel","ondataopen","dcoptions","dataChannelOptions","ondata","sendData","dataChanDefaultLabel","sendDtmf","dtmfSender","audioSender","getSenders","track","kind","dtmf","ontonechange","tone","tones","duration","gap","insertDTMF","destroyHandle","noRequest","cleanupWebrtc","detached","createPeerconnectionIfNeeded","pc_config","insertableStreams","tracks","transforms","createEncodedStreams","createEncodedAudioStreams","createEncodedVideoStreams","forceEncodedAudioInsertableStreams","forceEncodedVideoInsertableStreams","encodedInsertableStreams","getStats","volume","bitrate","trickle","oniceconnectionstatechange","iceState","iceConnectionState","onicecandidate","iceDone","mySdp","localDescription","sdpSent","sendSDP","sdpMid","sdpMLineIndex","ontrack","streams","mid","transceiver","_mid","onremotetrack","onended","trackMutedTimeoutId","ev","transceivers","getTransceivers","_track","onmute","onunmute","prepareWebrtc","webrtcError","media","mediaToTracks","simulcast","simulcast2","svc","captureDevices","setRemoteDescription","answer","customizeSdp","createAnswer","setLocalDescription","mediaConstraints","iceRestart","createOffer","prepareWebrtcPeer","replaceTracks","openedConsentDialog","groups","gumGroup","capture","group","audio","video","ondatachannel","channel","nt","trackId","replaceTrack","getAudioTracks","getVideoTracks","consentDialog","constraints","trackConstraints","otherType","otherTrack","otherConstraints","getUserMedia","newDirection","recv","direction","setDirection","myStream","addTrack","webRTCAdapter","browserDetails","browser","addTransceiver","sendEncodings","rid","maxBitrate","scaleResolutionDownBy","parameters","getParameters","encodings","setParameters","scalabilityMode","codec","mimeType","codecs","getCapabilities","setCodecPreferences","framerate","maxFramerate","senderStreams","createAudioEncodedStreams","readableStream","writableStream","pipeThrough","pipeTo","receiverStreams","dontStop","rt","removeTrack","onlocaltrack","curdir","newdir","getLocalTracks","tr","getRemoteTracks","getVolume","remote","stats","remoteSource","audioLevel","isMuted","mute","videostream","audiostream","getBitrate","timer","bsnow","bsbefore","tsnow","tsbefore","inStats","mediaType","bytesReceived","googCodecName","timePassed","bitRate","round","setBitrate","hangupRequest","streamExternal","stopAllTracks","oncleanup","getServer","getSessionId","unload","notifyDestroyed","cleanupHandles","sendBeacon","unbindWebSocket","onUnbindMessage","onUnbindError","attach","ordered","plugin","opaqueId","loopIndex","handleToken","opaque_id","loop_index","started","getId","getPlugin","getRemoteVolume","getLocalVolume","isAudioMuted","muteAudio","unmuteAudio","isVideoMuted","muteVideo","unmuteVideo","setMaxBitrate","handleRemoteJsep","sendRequest","createHandle","useDefaultDependencies","deps","socketCls","proto","arr","fetchOptions","Accept","fetching","timerId","ok","parsed","useOldDependencies","jq","jQuery","payload","contentType","xhrFields","extend","xhr","keepAudio","audioSend","audioRecv","addAudio","replaceAudio","removeAudio","keepVideo","videoSend","videoRecv","addVideo","replaceVideo","removeVideo","screenshareFrameRate","frameRate","screenshareHeight","height","screenshareWidth","width","ideal","getTracks","mst","d","usedDependencies","dependencies","listDevices","isGetUserMediaAvailable","enumerateDevices","devices","safariVp8","testpc","offerToReceiveVideo","charSet","randomPoz","SignalingType","SessionConnectionState","SessionState","PeerConnectionState","CallsEvent","JanusClient","videoRoomPlugin","isOnlyAudio","currentRoomId","remoteFeeds","remoteJseps","remoteFeedsAttachingInProgress","bitrateTimers","timeoutSessionCallback","JanusEngine","engine","attachVideoConferencingPlugin","isRemote","skipMedia","remoteFeed","localStream","displayName","room","ptype","feed","display","uplink","nacks","feedId","offerParams","publishers","userDisplayName","PARTICIPANT_JOINED","userId_2","detachRemoteFeed","PARTICIPANT_LEFT","onLocalTrack","metadata","onRemoteTrack","channelLabel","DATA_CHANNEL_OPEN","DATA_CHANNEL_MESSAGE","eventType","CREATED","isStreamNoExistedBefore","REMOTE_STREAM","ENDED","trackToRemove","streamTrack","REMOTE_TRACKS_UPDATED","getPluginId","detachVideoConferencingPlugin","roomId","joinEvent","leaveEvent","listOnlineParticipants","listRequest","participants","toggleAudioMute","toggleRemoteAudioMute","audioTracks","isRemoteAudioMuted","toggleVideoMute","toggleRemoteVideoMute","videoTracks","isRemoteVideoMuted","sendKeyframeRequest","configureRequest","keyframe","getTracksFromStream","audioTrack","videoTrack","mediaParams","existedStream","createOfferParams","tracksFromStream","tracksFromParams","publish","getTracksMidsFromStream","getUserBitrate","resultCallback","getUserVolume","showBitrate","hideBitrate","ConferenceSession","onParticipantJoined","isExistingParticipant","createHandler","onParticipantJoinedListener","onParticipantLeft","onParticipantLeftListener","onErrorListener","onDataChannelOpen","onDataChannelOpenedListener","onDataChannelMessage","onDataChannelMessageListener","onLocalIceStateChanged","onSessionConnectionStateChangedListener","onRemoteIceStateChanged","onRemoteConnectionStateChangedListener","onRemoteStream","onRemoteStreamListener","onRemoteTracksUpdated","onRemoteTracksUpdatedListener","onSlowLink","onSlowLinkListener","client","isResolved","currentUserDisplayName","joinInternal","joinAsListener","user_id_1","isRemote_1","listOfOnlineParticipants","leaveGroup","elementId","upsertStream","shouldUpdateCurrentStream","detachMediaStream","attachMediaStream","localTrack","AUDIO","newTrack","currentPublisherPC","every","switchMediaTracks","VIDEO","device","deviceId","getRemoteUserBitrate","getRemoteUserVolume","opt","mediaElement","getElementById","srcObject","style","transform","mirror","muted","onloadedmetadata","_event","play","ConferenceClient","sessionsStore","createNewSession","getCurrentSessionToken","getMediaDevices","clearSession","currentSession","LEFT","SLOW_LINK","REMOTE_CONNECTION_STATE","DATA_CHANNEL_OPENED","SESSION_CONNECTION_STATE","DataService","className_1","className","isMany","multi","createRecord","readPermissions","permissions","isSearch","search_criteria","_id","isCriteria","isOne","MeetingsService","startTimestamp","ceil","endTimestamp","toLocaleString","year","month","day","hour","minute","defaultParams","attendees","getRecordings","ProxyService","sdkInstance","requestsNumber","abortControllersMap","requestMethod","responseType","getCurrentUserId","logRequest","requestId","logResponse","buildRequestAndURL","requestBody","isGetOrHeadType","isPostOrPutType","isInternalRequest","isMultipartFormData","requestURL","requestObject","buildRequestBody","dataObject","useArrayQuery","fileToCustomObject","serializeQueryParams","level","propName","propQueryName","isArrayVal","uriComponent","abortRequest","abortId","controllers","controller","processSuccessfulOrFailedRequest","abort_id","doneRequestsCount","requestAndURL","AbortController","signal","processAjaxResponse","processAjaxError","responseBody","errorObject","errors","isExpiredSessionError","handleExpiredSessionResponse","PushNotificationsService","SubscriptionsService","EventsService","StorageService","createAndUpload","file","content_type","public","createParams","blobObject","parseUri","blob_object_access","uploadParams","authority","queryKey","decodeURIComponent","upload","markUploaded","getFile","uid","getFileObject","privateUrl","fileUID","publicUrl","strictMode","q","strict","loose","exec","$0","$1","$2","UsersService","getV2","signup","resetPassword","generateFilter","dateFields","field","param","filters","numberFields","full_name","facebook_id","twitter_id","phone","tags","external","WebRTCHelpers","traceWarning","traceError","ua","ffInfo","sVer","WebRTCPeerConnection","userID","remoteSDP","NEW","iceCandidates","remoteStream","onStatusClosedChecker","dialingTimer","statsReportTimer","waitingReconnectTimeoutCallback","released","onMediaTrackHandler","callType","getWrappedStats","onIceCandidateHandler","iceCandidate","signalingState","processIceCandidates","onSignalingStateHandler","onIceConnectionStateHandler","getVersionSafari","CHECKING","onSessionConnectionStateChanged","CONNECTED","clearWaitingReconnectTimer","COMPLETED","FAILED","startWaitingReconnectTimer","setup","rtcConfiguration","original","startCallTime","onsignalingstatechange","ID","release","closeSessionIfAllConnectionsClosed","clearStatsReportTimer","addCandidates","addIceCandidatesPromises","promises","addIceCandidatePromise","clearDialingTimer","getAndSetLocalSessionDescription","maxBandwidth_1","maxBandwidth","offerOptions","sessionDescription","setRTCRtpSenderMaxBandwidth","senders","setParamsPromises","startDialingTimer","withOnNotAnswerCallback","dialingCallback","skipIncrement","processOnNotAnswer","processCall","setRemoteSessionDescription","desc","lastResult_1","getStatsCustom","results","lastResults","onCallStatsReport","onSuccess","onFail","statistic","getVersionFirefox","localVideoSettings","getSettings","frameHeight","frameWidth","getBitratePerSecond","packetsReceived","framerateMean","framesPerSecond","bytesSent","packetsSent","candidateType","mozLocalTransport","transport","ip","ipAddress","portNumber","getFramesPerSecond","isLocal","lastResult","framesSent","framesReceived","description","WebRTCSession","peerConnections","answerTimer","waitingOfferOrAnswerTimer","setMaxBandwidth","peers","peersKeys","connectionStateForUser","peerConnection","constrains","prepareExtension","ACTIVE","userInfo","opponentsIDs","callInternal","error_4","acceptCallTime","clearAnswerTimer","acceptInternal","initiatorID","startWaitingOfferOrAnswerTimer","opponentID","currentUserID","sdpRemote","sessionID","callerID","signalingProvider","ACCEPT","error_5","REJECTED","REJECT","HUNGUP","STOP","canInitiateIceRestart","RESTART","error_6","processOnCall","rtcSdpType","pc_1","startAnswerTimer","processOnAccept","error_7","processOnReject","clearWaitingOfferOrAnswerTimer","processOnStop","pcKeys","processOnIceCandidates","processOnIceRestart","RESTART_ACCEPT","error_8","processOnIceRestartAccept","error_9","CALL","sendCandidate","onUserNotAnswerListener","onCallStatsReportListener","connectionState","closeLocalMediaStream","onSessionCloseListener","isAllClosed","isClosed","muteStream","unmute","timeDiff","max","startCallDate","date","acceptCallDate","WebRTCSignalingProcessor","delegate","getExtension","signalType","onCallHandler","onAcceptHandler","onRejectHandler","onStopHandler","CANDIDATE","onIceCandidatesHandler","onIceRestartHandler","onIceRestartAcceptHandler","childName","childText","WebRTCSignalingProvider","signalingConnection","signalingType","platform","opponentId","WebRTCClient","onDevicesChangeListener","signalingProcessor","ondevicechange","callerJID","bandwidth","createAndStoreSession","currentUserJID","webRTCSession","callRejectRequest","onCallListener","onAcceptCallListener","onRejectCallListener","onInvalidEventsListener","onStopCallListener","HUNG_UP","INVALID","NOT_ANSWER","CONNECTION_STATE","CLOSE","STATS_REPORT","DEVICES","WhiteboardService","getURL","title","paramsOrId","chat_dialog_id","ConnectyCube","configMap","utils","storage","pushnotifications","ChatClient","meeting","videochatconference"],"mappings":"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","x_google_ignoreList":[3,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81]}